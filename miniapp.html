<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
  <meta name="viewport" content="width=660,user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <link rel="stylesheet" type="text/css" href="css/attrib.css">
  <script defer src="https://cdn.aerisapi.com/sdk/js/1.8.0/aerisweather.min.js"></script>
  <link rel="stylesheet" href="css/aerisweather.css">
  
    <style>
        body { margin:0; padding:0; }
        #map { position:absolute; top:0; bottom:0; width:100%; }
    </style>
	
</head>

<body>		
	
<div id="map"></div>	

<script>	 
window.addEventListener('load', () => { 
		
	const aeris = new AerisWeather('wgE96YE3scTQLKjnqiMsv', 'SVG2gQFV8y9DjKR0BRY9wPoSLvrMrIqF9Lq2IYaY');	
	const utils = aeris.utils;

	aeris.apps().then((apps) => {
		const app = new apps.InteractiveMapApp(document.getElementById('map'), {
            map: {
                strategy: "mapbox",
                accessToken: "pk.eyJ1IjoiYWNjdXdlYXRoZXItaW5jIiwiYSI6ImNqeGtxeDc4ZDAyY2czcnA0Ym9ubzh0MTAifQ.HjSuXwG2bI05yFYmc0c9lw",
                zoom: 4.5938447286996505,
        	//maxzoom: 15,
        	//minzoom: 4,
		//hash: true,
		//interactive: false

				layers: 'alerts, radar, wind-dir, temperatures-1hr-change',
				
				style:'mapbox://styles/accuweather-inc/cjknc24na2o5u2sqoy0t8ku8a',
    
                center: {
                    lat: 35.4343,
                    lon: -95.4464
                },

                //timeline: {
                //    from: -43200,
                //    to: 0
                //}
            },
            panels: {
                layers: {
                    buttons: [
					
						{
                            title: "Dark Map Theme",
                            value: "flat-dk"

                            //title: "Testing3",
                            //value: "stormreports"
				//value: "convective"
				//value: "tropical-cyclones-position-icons"

                        },
						

//						{
//							id: 'radar-type',
//							title: 'Global Radar',
//							segments: [{
//								title: 'Radar',
//								value: 'radar-est'
//							}],
//							options: {
//								style: {
//									opacity: 0.75
//								}
//							},
//							controls: {
//								settings: [{
//									type: 'opacity'
//								}]
//							}
//						},

					],
					
                    enabled: true,
                    toggleable: true,
                    position: {
                        pin: "topright",
                        translate: {
                            x: -10,
                            y: 10
                        }
                    }
                },

                    timeline: {
                        range: {
                            // set the initial timeline offset range value
                            value: [-6, 0],

                            // set the min and max time offsets for the timeline range
                            range: {
                                min: -12,
                                max: 0
                            },

                            // define the tick labels that should be rendered along the slider
                            marks: {
                                '-12': '-12',							
                                '-10': '-10',
                                '-8': '-8',
                                '-6': '-6',
                                '-4': '-4',
                                '-2': '-2',
                                0: 'Now'
                            },

                            // the value interval to render tick marks for, e.g. every 6 hours
                            step: 6
                        },

						enabled: true,
						toggleable: true,
						position: {
							pin: "bottomleft",
							translate: {
								x: 10,
								y: -10
							}
						}						
						
                    },

                search: {
                    enabled: false,
                    toggleable: true,
                    position: {
                        pin: "top",
                        translate: {
                            x: -300,
                            y: 10
                        }
                    }
                },
                legends: {
                    enabled: true,
                    toggleable: true,
                    position: {
                        pin: "bottomright",
                        translate: {
                            x: -10,
                            y: -10
                        }
                    }
                },
                info: {
                    enabled: true,
                    position: {
                        pin: "topleft",
                        translate: {
                            x: 10,
                            y: 10
                        }
                    },
                    metric: false
                }
            }
        });
		

        const determineAlertColor = (data) => {
            const title = data.ADVISORY;
 
            if (/warning|extreme/i.test(title)) return '#df1616';
            if (/watch|severe/i.test(title)) return '#ff9600';
            if (/advisory|moderate/i.test(title)) return '#009ac8';
            if (/statement|alert|minor/i.test(title)) return '#808080';
 
            return data.COLOR || '#000';
        };

		
		app.on('ready', () => {


			aeris.mapsgl(app, {
				//version: '1.3.2',
				layers: [
//						{
//                        title: "Testing",
//                        //value: "stormcells"
//			//value: "ocean-currents-particles"
//			//value: "pressure-msl-contour"
//			//value: "stormcells-positions"
//			value: "tropical-cyclones"
//
//                     },
					
					
//						{ title: 'Alerts', value: 'alerts', options: {
//						paint: {
//							fill: {
//								color: (data) => {
//									return determineAlertColor(data);
//								},
//								opacity: 0.5
//							},					
//							
//							stroke: {
//								color: (data) => {
//									return determineAlertColor(data);
//								},
//								  opacity: 1
//								}
//							},
//						
//						}
//					},					
					
			
				]
			},)


          aeris.mapsgl(app, {
				//version: '1.3.2',	
			
 
               layers: [ 
		   
				{
                    title: 'Global Radar', value: 'radar', options: {
                        paint: {
                            opacity: .75
                        }
                    }			
				
					
                },
				
			
//				{
//                    title: 'PlaceHolder', value: 'PlaceHolder', options: {
//                        paint: {
//                           opacity: .75
//                        }
//                    }
//                },

				{
				
                    buttons: [
					

			
                       { title: 'Temp Change', value: 'temp-change', segments: [
                            { title: 'Past 1 hour', value: 'temperatures-1hr-change' },
                            { title: 'Past 24 hours', value: 'temperatures-24hr-change' }], 
					
							options: {
								paint: {
									opacity: .25
								}
							},
	
						},


	                   { title: 'Wind Direction', value: 'winds', segments: [
							
				            { title: 'Particles', value: 'wind-particles' },
			
							
                            { title: 'Barbs', value: 'wind-barbs' },

							
                            //{ title: 'Arrows', value: 'wind-dir' },	
							
							
    			    //{ title: 'Fill', value: 'wind-speeds' },
														
                        ] },

			
			{ title: 'Wind Chill', value: 'wind-chill', options: {
                        paint: {
                            opacity: .15
                        }
                    }
                },		

				
	                  { title: 'Heat Index', value: 'heat-index', options: {
                        paint: {
                            opacity: .10
                        }
                    }
                },		

	
	                  { title: 'Visibility', value: 'visibility', options: {
                        paint: {
                            opacity: .2
                        }
                    }
                },				
			
				
                        //{ title: 'Wind Chill', value: 'wind-chill' },

					
                    ]
					
	
					
                }],
				
		
            })

			
			.then(({ controller, mapsgl }) => {
 
                //add the MapsGL legend control
                //controller.addLegendControl(app.$el, { width: 200 });
 
                // add the MapsGL data inspector control
				controller.addDataInspectorControl({ event: 'move'});
 
                // add Tropical module from the Javascript SDK
		aeris.modules().then((modules) => {
			const layerModules = [{
                name: "groups.Tropical",
                index: 50
            },


		//{
                //name: "groups.Aviation",
                //index: 5
            	//}


		];
			layerModules.forEach(({ name, index }) => {
				const m = utils.get(modules, name);
				if (m) {
					if (index !== -1) {
						app.modules.insertAt(index, m);
					} else {
						app.modules.add(m);
					}
				}
			});
		});


				app.modules.add(new Severe());


			//controller.addWeatherLayer('heat-index');


                controller.addWeatherLayer('temperatures', {
                    "paint" : {
                        "opacity" : 0
                    },
                },
	             //"aeroway-line"			
				
				);

                controller.addWeatherLayer('wind-dir', {
                    "paint" : {
                        "opacity" : 0
                    },
                },
	             //"aeroway-line"			
			
				);

                controller.addWeatherLayer('dew-points', {
                    "paint" : {
                        "opacity" : 0
                    },
                },
	             //"aeroway-line"			
				
				);



                controller.addWeatherLayer('humidity', {
                    "paint" : {
                        "opacity" : 0
                    },
                },
	             //"aeroway-line"			
				
				
				);



            });


			// configure views for local weather info panel
			app.panels.info.setContentView('localweather', {
                views: [{
                        renderer: "alerts"
                    },{
                        renderer: "threats"
                    },{
                        renderer: "outlook"
                    }]
            });
		
			// show info panel for location when map is clicked
			app.map.on('click', (e) => {
				app.showInfoAtCoord(e.data.coord, 'localweather', 'Local Weather');
			});

			// select initial layers
		

		//const layersPanel = app.getPanel('layers');

                app.getPanel('layers').select(['Visibility']);
				
	        //app.getPanel('layers').select(['humidity']);			

		app.map.addLayers(['alerts:50']);

		//app.map.addLayers(['surface-analysis']);


			// start playing the map animation
			//app.map.timeline.play();


		});
	
	});
			
});

</script>
	
<script src="https://cdn.aerisapi.com/sdk/js/modules/awxjs-severe-weather.min.js"></script>

</body>

</html>