<!DOCTYPE html>
<html>

<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta content="initial-scale=1,maximum-scale=1,user-scalable=no" name="viewport">
<link rel="stylesheet" type="text/css" href="css/buttons2.css">

<script src="map_css/mapbox-gl.js"></script>
<link href="https://api.mapbox.com/mapbox-gl-js/v3.6.0/mapbox-gl.css" rel="stylesheet" />

<title>Zip Codes</title>

</head>

<body>

<!-- Load the `mapbox-gl-geocoder` plugin. -->
//<script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.min.js"></script>
//<link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.css" type="text/css">

<style>
body {
    margin: 0;
    padding: 0;
}

h2,
h3 {
    margin: 10px;
    font-size: .5em;
}

h3 {
    font-size: 12px;
    text-align: center;
}

p {
    font-size: 12px;
    text-align: center;
}

#map {
    position: absolute;
    top: 0;
    bottom: 0;
    width: 100%;
}

#features {
    top: 70px;
    height: 35px;
	left: 13px;
    width: 70px;

}

#menu {

   position: absolute;
    z-index: 1;
    top: 10px;
    left: 0px;
    width: 500px;
    font-family: 'Open Sans', sans-serif;
}

@import url(https://fonts.googleapis.com/css?family=Roboto+Condensed:300,);
* {
  box-sizing: border-box;
}

body {
  font-family: Roboto Condensed, Helvetica Neue, sans-serif;
  display: table;
  height: 100%;
  width: 100%;
}

.map-overlay {
    position: absolute;
    bottom: 0;
    right: 0;
    background: rgba(255, 255, 255, 0.8);
    margin-right: 10px;
    font-family: Arial, sans-serif;
    overflow: auto;
    border-radius: 3px;

}

.btns{
  border-color: #3498db;
  color: #ffffff;
  box-shadow: 0 0 40px 40px #3498db inset, 0 0 0 0 #3498db;
  -webkit-transition: all 150ms ease-in-out;
  transition: all 150ms ease-in-out;

        font-size: 8px;
        position: absolute;
        left:13px;
        z-index:1000;
        float: left;
        top: 25px;
        font-size: 10px;
        width: 70px;
        height: 20px;


    }

.btns:hover {
  box-shadow: 0 0 10px 0 #3498db inset, 0 0 10px 4px #3498db;
  color: #ffffff;
  background-color: #000000;
}

</style>
   
    <nav id="menu">

            <div >

                <label>
                    <input class="btns" name="button" type="button" value="Zip" onclick="updateLayer(this.value)">
                       <input type="button" value="IntelliSTAR" class="button0" onclick="location.href='mobileX1.html';" /> 
                </label>
            </div>
        </div>
    </nav>


    <div id="map" class="mapboxgl-map">
    <div class="mapboxgl-canary" style="visibility: hidden;"></div><div class="mapboxgl-canvas-container mapboxgl-interactive mapboxgl-touch-drag-pan mapboxgl-touch-zoom-rotate"><canvas class="mapboxgl-canvas" style="position: absolute; width: 1366px; height: 765px;" tabindex="0" aria-label="Map" width="1366" height="765"></canvas></div><div class="mapboxgl-control-container"><div class="mapboxgl-ctrl-top-left"></div><div class="mapboxgl-ctrl-top-right"></div><div class="mapboxgl-ctrl-bottom-left"><div class="mapboxgl-ctrl" style="display: block;"><a class="mapboxgl-ctrl-logo" target="_blank" rel="noopener" href="https://www.mapbox.com/" aria-label="Mapbox logo"></a></div></div><div class="mapboxgl-ctrl-bottom-right"><div class="mapboxgl-ctrl mapboxgl-ctrl-attrib"><div class="mapboxgl-ctrl-attrib-inner"><a href="https://www.mapbox.com/about/maps/" target="_blank" title="Mapbox" aria-label="Mapbox">© Mapbox</a> <a href="https://www.openstreetmap.org/about/" target="_blank" title="OpenStreetMap" aria-label="OpenStreetMap">© OpenStreetMap</a> <a class="mapbox-improve-map" href="https://apps.mapbox.com/feedback/?owner=mapbox&amp;id=streets-v11&amp;access_token=pk.eyJ1Ijoic2FoaWxrYXNoeWFwNjQiLCJhIjoiY2tkNDFxYmtoMXQxbjJybXlleGxhejE4MSJ9.LGSnbgHFFcuBE8wXHxIMiA" target="_blank" title="Improve this map" aria-label="Improve this map" rel="noopener">Improve this map</a></div></div></div></div></div>
    <div class="map-overlay" id="features">
        <h2>
            
        </h2>
        <div id="pd"><h3><strong>Empty</strong></h3></div>
    </div>

    <script id="jsbin-javascript">

const frameCount = 10; // total intervals
const startMinutes = -60; // start time offset relative to now, where negative means past
const endMinutes = 0;
const MAPBOX_TOKEN = 'pk.eyJ1IjoiYWNjdXdlYXRoZXItaW5jIiwiYSI6ImNqeGtxeDc4ZDAyY2czcnA0Ym9ubzh0MTAifQ.HjSuXwG2bI05yFYmc0c9lw';
const AERIS_ID = 'wgE96YE3scTQLKjnqiMsv';
const AERIS_KEY = 'SVG2gQFV8y9DjKR0BRY9wPoSLvrMrIqF9Lq2IYaY';
const NUM_COLORS = '256'; // set to empty string for true color png
const TILE_SIZE = 256;

// layer to include on the map
// uncomment more layers or add more!
const layers = [
 	//'land-terrain',
    'alerts:50',
    //'satellite',
    'radar:75:blur(0)',
    //'stormcells',
	//'radar-global',
	//'satellite-infrared-color',
	//'stormreports',
	//'lightning-strike-density',
	//'lightning-strikes-5m-icons',
	//'lightning-flash-5m-icons',
	//'temperatures-text',
	//'dew-points-text',
	//'fires-obs-points',
	//'surface-analysis-pressure-text',
	//'surface-analysis-fronts',
	//'fradar'

];


function getTilePath(server, interval) {
	return `https://maps${server}.aerisapi.com/${AERIS_ID}_${AERIS_KEY}/${layers.join(',')}/{z}/{x}/{y}/${interval}min.png${NUM_COLORS}`;
}


        mapboxgl.accessToken = 'pk.eyJ1IjoiYWNjdXdlYXRoZXItaW5jIiwiYSI6ImNqeGtxeDc4ZDAyY2czcnA0Ym9ubzh0MTAifQ.HjSuXwG2bI05yFYmc0c9lw';
        if (mapboxgl.accessToken == '') {
            alert('Add Mapbox Access Token');
        }
        var map = new mapboxgl.Map({
            container: 'map',
            style:'mapbox://styles/accuweather-inc/cjknc24na2o5u2sqoy0t8ku8a',

            zoom: 3,
            center: [-96.5556199, 39.8097343],
            projection: 'mercator'

	});
	
    // Add the control to the map.
    map.addControl(
        new MapboxGeocoder({
            accessToken: mapboxgl.accessToken,
            mapboxgl: mapboxgl
        })
    );

	
        var zips_tiles = {
            'ac-zips': {
                'source-layer': 'ac-b0n2k5',
                'url': 'darsh99137.67h8ttal',
            },
            'nopr-zips': {
                'source-layer': 'nopr-aab0hu',
                'url': 'darsh99137.4a95ht04',
            },
            'stuv-zips': {
                'source-layer': 'stuv-bdvekc',
                'url': 'darsh99137.4qk2dlxt',
            },
            'klm-zips': {
                'source-layer': 'klm-1cyylf',
                'url': 'darsh99137.c10a4dg9',
            },
            'dfghi-zips': {
                'source-layer': 'dfghi-9jmprs',
                'url': 'darsh99137.45692mm0',
            },
            'w-zips': {
                'source-layer': 'w-6rljid',
                'url': 'darsh99137.4c878s8r',
            }
        };
        var zip_labels = [];
        var label_layers = ['states', 'counties', 'Zip', 'zips-kml'];
        var zoomThreshold = 5;

        map.on('load', function () {
            /////////////////////////////////////
            // var expression = ["match", ["get", "ZCTA5CE10"], '90032', 'green'];
            // expression.push("rgba(0,0,0,0)");
            Object.keys(zips_tiles).map(function (key) {
                map.addSource(key, {
                    type: 'vector',
                    url: 'mapbox://' + zips_tiles[key]['url']
                });

                map.addLayer({
                    'id': key + '-label',
                    'type': 'symbol',
                    'source': key,
                    'minzoom': 5,
                    'layout': {
                        'visibility': 'none',
                        'text-field': '{ZCTA5CE10}'
                    },
                    'source-layer': zips_tiles[key]['source-layer']
                });
                zip_labels.push(key + '-label');
            });
            // map.setFilter('ac-zips', ['match', ['get', 'ZCTA5CE10'],
            //     ['90032'], true, false
            // ]);

            ////////////////////////////////////////////////////////////////
            map.addSource('zips-kml', {
                type: 'vector',
                url: 'mapbox://darsh99137.4nf1q4ec'
            });

            map.addLayer({
                'id': 'zips-kml',
                'type': 'fill',
                'source': 'zips-kml',
                'minzoom': 20,
                'layout': {
                    'visibility': 'none'
                },
                'paint': {
                    'fill-outline-color': 'white',
                    'fill-opacity': .45,
                    // 'fill-color': expression
                },
                'source-layer': 'Layer_0'
            });

            map.addSource('zips', {
                type: 'vector',
                url: 'mapbox://jn1532.2z2q31r2'
            });

            map.addLayer({

                    'id': 'Zip',
                    'type': 'fill',
                    'source': 'zips',
                    'layout': {
                        'visibility': 'none'
                    },
                    'minzoom': 1,
                    'maxzoom': 20,
                    'paint': {
                        'fill-outline-color': '#696969',
                        'fill-color': {
                            property: 'fill',
                            type: 'identity'
                            // type: 'categorical' , // this is essential to match 'fill'
                            // stops: [
                            // ['#fbb4ae', '#fbb4ae'],
                            // ['#b3cde3', '#b3cde3'],
                            // ['#ccebc5', '#ccebc5'],
                            // ['#decbe4', '#decbe4'],
                            // ['#fed9a6', '#fed9a6'] 
                            // ] //'#fbb4ae','#b3cde3','#ccebc5','#decbe4','#fed9a6'                                       //red ,   blue,      green,   purple,   orange
                        },
                        'fill-opacity': .85
                    },
                    'source-layer': 'zip5_topo_color-2bf335'


                },
                'water' /// 'water'   helps the transparency
            );

    // disable map rotation using right click + drag
    map.dragRotate.disable();

    // disable map rotation using touch rotation gesture
    map.touchZoomRotate.disableRotation();	
		
            map.on('mousemove', function (e) {
                var features = map.queryRenderedFeatures(e.point, {
                    layers: label_layers
                });
                if (features.length > 0) {
                    if (features[0].layer.id == 'states') {
                        document.getElementById('pd').innerHTML = '<h3><strong>' + features[0].properties.NAME10 + '</strong></h3>';
                    } else if (features[0].layer.id == 'counties') {
                        document.getElementById('pd').innerHTML = '<h3><strong>' + features[0].properties.COUNTY + '</strong></h3>';
                    } else if (features[0].layer.id == 'Zip') {
                        document.getElementById('pd').innerHTML = '<h3><strong>' + features[0].properties.ZIP5 + '</strong></h3>';
                    } else if (features[0].layer.id == 'zips-kml') {
                        document.getElementById('pd').innerHTML = '<h3><strong>' + features[0].properties.Name.replace(/^\D+/g, '') + '</strong></h3>';
                    } else {
                        document.getElementById('pd').innerHTML = '<h3><strong>' + features[0].properties.ZCTA5CE10 + '</strong></h3>';
                    }

                } else {
                    document.getElementById('pd').innerHTML = '<p>Zip Code</p>';
                }
            });

            map.addSource('states', {
                'type': 'vector',
                'url': 'mapbox://darsh99137.0ecy31wq'
            });

            map.addSource('counties', {
                'type': 'vector',
                'url': 'mapbox://mapbox.82pkq93d'
            });

            var state_expression = ["match", ["get", 'STATEFP10']];
            var state_colors = ['#FFEDA0', '#FED976', '#FEB24C', '#FD8D3C', '#FC4E2A', '#E31A1C', '#BD0026', '#800026'];

            for (i = 1; i <= 56; i++) {
                rand = state_colors[Math.floor(Math.random() * state_colors.length)];
                state_expression.push(i < 10 ? '0' + i : i.toString(), rand);
            }
            state_expression.push("rgba(0,0,0,0)");

            map.addLayer({
                'id': 'states',
                'source': 'states',
                'source-layer': 'state-5rc59x',
                'type': 'fill',
                'layout': {
                    'visibility': 'none'
                },
                'paint': {
                    'fill-outline-color': 'white',
                    'fill-color': state_expression,
                    'fill-opacity': 0.75
                }
            }, 'waterway-label');

            map.addLayer({
                'id': 'counties',
                'source': 'counties',
                'source-layer': 'original',
                'type': 'fill',
                'layout': {
                    'visibility': 'none'
                },
                'paint': {
                    'fill-outline-color': 'white',
                    'fill-color': [
                        'interpolate', ['linear'],
                        ['get', 'population'],
                        0, '#F2F12D',
                        100, '#EED322',
                        1000, '#E6B71E',
                        5000, '#DA9C20',
                        10000, '#CA8323',
                        50000, '#B86B25',
                        100000, '#A25626',
                        500000, '#8B4225',
                        1000000, '#723122'
                    ],
                    'fill-opacity': 0.75
                }
            }, 'waterway-label');
        });

        function updateLayer(clickedLayer) {
            var visibility = map.getLayoutProperty(clickedLayer, 'visibility');
            for (var i = 0; i < document.getElementsByClassName('layer_class').length; ++i) {
                var layer = document.getElementsByClassName('layer_class')[i];
                if (layer.value !== clickedLayer) {
                    map.setLayoutProperty(layer.value, 'visibility', 'none');
                    if (layer.value == 'Zip') {
                        map.setLayoutProperty('zips-kml', 'visibility', 'none');
                        zip_labels.map(function (key) {
                            map.setLayoutProperty(key, 'visibility', 'none');
                        });
                    }
                }
            }


            map.setLayoutProperty(clickedLayer, 'visibility', 'visible');
            if (clickedLayer == 'Zip') {
                map.setLayoutProperty('zips-kml', 'visibility', 'visible');
                zip_labels.map(function (key) {
                    map.setLayoutProperty(key, 'visibility', 'visible');
                });
            }
        }


function addRasterLayer(map, interval, opacity = 0) {
	const id = `amp-${layers.join('::')}-${interval}`;
	map.addSource(id, {
		type: 'raster',
		tiles: [1, 2, 3, 4].map((s) => getTilePath(s, interval)),
		tileSize: TILE_SIZE,
		attribution: '<a href="https://www.aerisweather.com/">Xweather</a>'
	});
	map.addLayer({
		id, 
		type: 'raster',
		source: id,
		minzoom: 0,
		maxzoom: 22,
		paint: {
			'raster-opacity': opacity,
			'raster-opacity-transition': {
				duration: 0,
				delay: 0
			}
		}
	});

	return id;
}

function setRasterLayerOpacity(map, id, opacity) {
	map.setPaintProperty(id, 'raster-opacity', opacity);
}

map.on('load', () => {
	const interval = (endMinutes - startMinutes) / frameCount;
	// set up the animation frames and layers
	const frames = [];
	for (let i = 0; i < frameCount; i += 1) {
		const opacity = (i === 0) ? 1 : 0;
		const timeOffset = startMinutes + interval * i;
		const id = addRasterLayer(map, timeOffset, opacity);
		frames.push(id);
	}

	// wait time determines how long to wait and allow frames to load before
	// beginning animation playback
	const waitTime = 1000;

	// step time determines the time in milliseconds each frame holds before advancing
	const stepTime = 1000;

	let currentOffset = 0;
	let previousOffset = currentOffset;

	setTimeout(() => {
		setInterval(() => {
			previousOffset = currentOffset;
			currentOffset += 1;
			if (currentOffset === frames.length - 1) {
				currentOffset = 0;
			}
			setRasterLayerOpacity(map, frames[previousOffset], 0);
			setRasterLayerOpacity(map, frames[currentOffset], 1);
		}, stepTime);
	}, waitTime);
});
	    
map.setView(e.latlng, map.getZoom(), {
  "animate": true,
  "pan": {
    "duration": 20
  }
});


    </script>

</body>

</html>
