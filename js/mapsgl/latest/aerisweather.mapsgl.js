/*!
 * 
 * 	@aerisweather/mapsgl-sdk - 1.6.1
 * 	(c) 2024 AerisWeather
 * 	License: BSD
 * 	https://www.aerisweather.com
 *
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("aerisweather",[],t):"object"==typeof exports?exports.aerisweather=t():(e.aerisweather=e.aerisweather||{},e.aerisweather.mapsgl=t())}(this,(()=>(()=>{var e={VmRL:e=>{"use strict";function t(e,t,r){r=r||2;var s,n,o,l,d,u,m,f=t&&t.length,g=f?t[0]*r:e.length,v=i(e,0,g,r,!0),y=[];if(!v||v.next===v.prev)return y;if(f&&(v=function(e,t,r,a){var s,n,o,l=[];for(s=0,n=t.length;s<n;s++)(o=i(e,t[s]*a,s<n-1?t[s+1]*a:e.length,a,!1))===o.next&&(o.steiner=!0),l.push(p(o));for(l.sort(h),s=0;s<l.length;s++)r=c(l[s],r);return r}(e,t,v,r)),e.length>80*r){s=o=e[0],n=l=e[1];for(var x=r;x<g;x+=r)(d=e[x])<s&&(s=d),(u=e[x+1])<n&&(n=u),d>o&&(o=d),u>l&&(l=u);m=0!==(m=Math.max(o-s,l-n))?32767/m:0}return a(v,y,r,s,n,m,0),y}function i(e,t,i,r,a){var s,n;if(a===T(e,t,i,r)>0)for(s=t;s<i;s+=r)n=M(s,e[s],e[s+1],n);else for(s=i-r;s>=t;s-=r)n=M(s,e[s],e[s+1],n);return n&&v(n,n.next)&&(A(n),n=n.next),n}function r(e,t){if(!e)return e;t||(t=e);var i,r=e;do{if(i=!1,r.steiner||!v(r,r.next)&&0!==g(r.prev,r,r.next))r=r.next;else{if(A(r),(r=t=r.prev)===r.next)break;i=!0}}while(i||r!==t);return t}function a(e,t,i,h,c,d,p){if(e){!p&&d&&function(e,t,i,r){var a=e;do{0===a.z&&(a.z=u(a.x,a.y,t,i,r)),a.prevZ=a.prev,a.nextZ=a.next,a=a.next}while(a!==e);a.prevZ.nextZ=null,a.prevZ=null,function(e){var t,i,r,a,s,n,o,l,h=1;do{for(i=e,e=null,s=null,n=0;i;){for(n++,r=i,o=0,t=0;t<h&&(o++,r=r.nextZ);t++);for(l=h;o>0||l>0&&r;)0!==o&&(0===l||!r||i.z<=r.z)?(a=i,i=i.nextZ,o--):(a=r,r=r.nextZ,l--),s?s.nextZ=a:e=a,a.prevZ=s,s=a;i=r}s.nextZ=null,h*=2}while(n>1)}(a)}(e,h,c,d);for(var m,f,g=e;e.prev!==e.next;)if(m=e.prev,f=e.next,d?n(e,h,c,d):s(e))t.push(m.i/i|0),t.push(e.i/i|0),t.push(f.i/i|0),A(e),e=f.next,g=f.next;else if((e=f)===g){p?1===p?a(e=o(r(e),t,i),t,i,h,c,d,2):2===p&&l(e,t,i,h,c,d):a(r(e),t,i,h,c,d,1);break}}}function s(e){var t=e.prev,i=e,r=e.next;if(g(t,i,r)>=0)return!1;for(var a=t.x,s=i.x,n=r.x,o=t.y,l=i.y,h=r.y,c=a<s?a<n?a:n:s<n?s:n,d=o<l?o<h?o:h:l<h?l:h,u=a>s?a>n?a:n:s>n?s:n,p=o>l?o>h?o:h:l>h?l:h,f=r.next;f!==t;){if(f.x>=c&&f.x<=u&&f.y>=d&&f.y<=p&&m(a,o,s,l,n,h,f.x,f.y)&&g(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function n(e,t,i,r){var a=e.prev,s=e,n=e.next;if(g(a,s,n)>=0)return!1;for(var o=a.x,l=s.x,h=n.x,c=a.y,d=s.y,p=n.y,f=o<l?o<h?o:h:l<h?l:h,v=c<d?c<p?c:p:d<p?d:p,y=o>l?o>h?o:h:l>h?l:h,x=c>d?c>p?c:p:d>p?d:p,b=u(f,v,t,i,r),w=u(y,x,t,i,r),_=e.prevZ,M=e.nextZ;_&&_.z>=b&&M&&M.z<=w;){if(_.x>=f&&_.x<=y&&_.y>=v&&_.y<=x&&_!==a&&_!==n&&m(o,c,l,d,h,p,_.x,_.y)&&g(_.prev,_,_.next)>=0)return!1;if(_=_.prevZ,M.x>=f&&M.x<=y&&M.y>=v&&M.y<=x&&M!==a&&M!==n&&m(o,c,l,d,h,p,M.x,M.y)&&g(M.prev,M,M.next)>=0)return!1;M=M.nextZ}for(;_&&_.z>=b;){if(_.x>=f&&_.x<=y&&_.y>=v&&_.y<=x&&_!==a&&_!==n&&m(o,c,l,d,h,p,_.x,_.y)&&g(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;M&&M.z<=w;){if(M.x>=f&&M.x<=y&&M.y>=v&&M.y<=x&&M!==a&&M!==n&&m(o,c,l,d,h,p,M.x,M.y)&&g(M.prev,M,M.next)>=0)return!1;M=M.nextZ}return!0}function o(e,t,i){var a=e;do{var s=a.prev,n=a.next.next;!v(s,n)&&y(s,a,a.next,n)&&w(s,n)&&w(n,s)&&(t.push(s.i/i|0),t.push(a.i/i|0),t.push(n.i/i|0),A(a),A(a.next),a=e=n),a=a.next}while(a!==e);return r(a)}function l(e,t,i,s,n,o){var l=e;do{for(var h=l.next.next;h!==l.prev;){if(l.i!==h.i&&f(l,h)){var c=_(l,h);return l=r(l,l.next),c=r(c,c.next),a(l,t,i,s,n,o,0),void a(c,t,i,s,n,o,0)}h=h.next}l=l.next}while(l!==e)}function h(e,t){return e.x-t.x}function c(e,t){var i=function(e,t){var i,r=t,a=e.x,s=e.y,n=-1/0;do{if(s<=r.y&&s>=r.next.y&&r.next.y!==r.y){var o=r.x+(s-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(o<=a&&o>n&&(n=o,i=r.x<r.next.x?r:r.next,o===a))return i}r=r.next}while(r!==t);if(!i)return null;var l,h=i,c=i.x,u=i.y,p=1/0;r=i;do{a>=r.x&&r.x>=c&&a!==r.x&&m(s<u?a:n,s,c,u,s<u?n:a,s,r.x,r.y)&&(l=Math.abs(s-r.y)/(a-r.x),w(r,e)&&(l<p||l===p&&(r.x>i.x||r.x===i.x&&d(i,r)))&&(i=r,p=l)),r=r.next}while(r!==h);return i}(e,t);if(!i)return t;var a=_(i,e);return r(a,a.next),r(i,i.next)}function d(e,t){return g(e.prev,e,t.prev)<0&&g(t.next,e,e.next)<0}function u(e,t,i,r,a){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*a|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*a|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function p(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function m(e,t,i,r,a,s,n,o){return(a-n)*(t-o)>=(e-n)*(s-o)&&(e-n)*(r-o)>=(i-n)*(t-o)&&(i-n)*(s-o)>=(a-n)*(r-o)}function f(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&y(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(w(e,t)&&w(t,e)&&function(e,t){var i=e,r=!1,a=(e.x+t.x)/2,s=(e.y+t.y)/2;do{i.y>s!=i.next.y>s&&i.next.y!==i.y&&a<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==e);return r}(e,t)&&(g(e.prev,e,t.prev)||g(e,t.prev,t))||v(e,t)&&g(e.prev,e,e.next)>0&&g(t.prev,t,t.next)>0)}function g(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function v(e,t){return e.x===t.x&&e.y===t.y}function y(e,t,i,r){var a=b(g(e,t,i)),s=b(g(e,t,r)),n=b(g(i,r,e)),o=b(g(i,r,t));return a!==s&&n!==o||!(0!==a||!x(e,i,t))||!(0!==s||!x(e,r,t))||!(0!==n||!x(i,e,r))||!(0!==o||!x(i,t,r))}function x(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function b(e){return e>0?1:e<0?-1:0}function w(e,t){return g(e.prev,e,e.next)<0?g(e,t,e.next)>=0&&g(e,e.prev,t)>=0:g(e,t,e.prev)<0||g(e,e.next,t)<0}function _(e,t){var i=new S(e.i,e.x,e.y),r=new S(t.i,t.x,t.y),a=e.next,s=t.prev;return e.next=t,t.prev=e,i.next=a,a.prev=i,r.next=i,i.prev=r,s.next=r,r.prev=s,r}function M(e,t,i,r){var a=new S(e,t,i);return r?(a.next=r.next,a.prev=r,r.next.prev=a,r.next=a):(a.prev=a,a.next=a),a}function A(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function S(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function T(e,t,i,r){for(var a=0,s=t,n=i-r;s<i;s+=r)a+=(e[n]-e[s])*(e[s+1]+e[n+1]),n=s;return a}e.exports=t,e.exports.default=t,t.deviation=function(e,t,i,r){var a=t&&t.length,s=Math.abs(T(e,0,a?t[0]*i:e.length,i));if(a)for(var n=0,o=t.length;n<o;n++)s-=Math.abs(T(e,t[n]*i,n<o-1?t[n+1]*i:e.length,i));var l=0;for(n=0;n<r.length;n+=3){var h=r[n]*i,c=r[n+1]*i,d=r[n+2]*i;l+=Math.abs((e[h]-e[d])*(e[c+1]-e[h+1])-(e[h]-e[c])*(e[d+1]-e[h+1]))}return 0===s&&0===l?0:Math.abs((l-s)/s)},t.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},r=0,a=0;a<e.length;a++){for(var s=0;s<e[a].length;s++)for(var n=0;n<t;n++)i.vertices.push(e[a][s][n]);a>0&&i.holes.push(r+=e[a-1].length)}return i}},gzWB:e=>{e.exports=function(e,t,i,r){var a=e[0],s=e[1],n=!1;void 0===i&&(i=0),void 0===r&&(r=t.length);for(var o=(r-i)/2,l=0,h=o-1;l<o;h=l++){var c=t[i+2*l+0],d=t[i+2*l+1],u=t[i+2*h+1];d>s!=u>s&&a<(t[i+2*h+0]-c)*(s-d)/(u-d)+c&&(n=!n)}return n}},cQc6:(e,t,i)=>{var r=i("gzWB"),a=i("wfnw");e.exports=function(e,t,i,s){return t.length>0&&Array.isArray(t[0])?a(e,t,i,s):r(e,t,i,s)},e.exports.nested=a,e.exports.flat=r},wfnw:e=>{e.exports=function(e,t,i,r){var a=e[0],s=e[1],n=!1;void 0===i&&(i=0),void 0===r&&(r=t.length);for(var o=r-i,l=0,h=o-1;l<o;h=l++){var c=t[l+i][0],d=t[l+i][1],u=t[h+i][1];d>s!=u>s&&a<(t[h+i][0]-c)*(s-d)/(u-d)+c&&(n=!n)}return n}},JaUx:function(e){e.exports=function(){"use strict";function e(e,r,a,s,n){!function e(i,r,a,s,n){for(;s>a;){if(s-a>600){var o=s-a+1,l=r-a+1,h=Math.log(o),c=.5*Math.exp(2*h/3),d=.5*Math.sqrt(h*c*(o-c)/o)*(l-o/2<0?-1:1);e(i,r,Math.max(a,Math.floor(r-l*c/o+d)),Math.min(s,Math.floor(r+(o-l)*c/o+d)),n)}var u=i[r],p=a,m=s;for(t(i,a,r),n(i[s],u)>0&&t(i,a,s);p<m;){for(t(i,p,m),p++,m--;n(i[p],u)<0;)p++;for(;n(i[m],u)>0;)m--}0===n(i[a],u)?t(i,a,m):t(i,++m,s),m<=r&&(a=m+1),r<=m&&(s=m-1)}}(e,r,a||0,s||e.length-1,n||i)}function t(e,t,i){var r=e[t];e[t]=e[i],e[i]=r}function i(e,t){return e<t?-1:e>t?1:0}var r=function(e){void 0===e&&(e=9),this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function a(e,t,i){if(!i)return t.indexOf(e);for(var r=0;r<t.length;r++)if(i(e,t[r]))return r;return-1}function s(e,t){n(e,0,e.children.length,t,e)}function n(e,t,i,r,a){a||(a=m(null)),a.minX=1/0,a.minY=1/0,a.maxX=-1/0,a.maxY=-1/0;for(var s=t;s<i;s++){var n=e.children[s];o(a,e.leaf?r(n):n)}return a}function o(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function l(e,t){return e.minX-t.minX}function h(e,t){return e.minY-t.minY}function c(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function d(e){return e.maxX-e.minX+(e.maxY-e.minY)}function u(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function p(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function m(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function f(t,i,r,a,s){for(var n=[i,r];n.length;)if(!((r=n.pop())-(i=n.pop())<=a)){var o=i+Math.ceil((r-i)/a/2)*a;e(t,o,i,r,s),n.push(i,o,o,r)}}return r.prototype.all=function(){return this._all(this.data,[])},r.prototype.search=function(e){var t=this.data,i=[];if(!p(e,t))return i;for(var r=this.toBBox,a=[];t;){for(var s=0;s<t.children.length;s++){var n=t.children[s],o=t.leaf?r(n):n;p(e,o)&&(t.leaf?i.push(n):u(e,o)?this._all(n,i):a.push(n))}t=a.pop()}return i},r.prototype.collides=function(e){var t=this.data;if(!p(e,t))return!1;for(var i=[];t;){for(var r=0;r<t.children.length;r++){var a=t.children[r],s=t.leaf?this.toBBox(a):a;if(p(e,s)){if(t.leaf||u(e,s))return!0;i.push(a)}}t=i.pop()}return!1},r.prototype.load=function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0;t<e.length;t++)this.insert(e[t]);return this}var i=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var r=this.data;this.data=i,i=r}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},r.prototype.insert=function(e){return e&&this._insert(e,this.data.height-1),this},r.prototype.clear=function(){return this.data=m([]),this},r.prototype.remove=function(e,t){if(!e)return this;for(var i,r,s,n=this.data,o=this.toBBox(e),l=[],h=[];n||l.length;){if(n||(n=l.pop(),r=l[l.length-1],i=h.pop(),s=!0),n.leaf){var c=a(e,n.children,t);if(-1!==c)return n.children.splice(c,1),l.push(n),this._condense(l),this}s||n.leaf||!u(n,o)?r?(i++,n=r.children[i],s=!1):n=null:(l.push(n),h.push(i),i=0,r=n,n=n.children[0])}return this},r.prototype.toBBox=function(e){return e},r.prototype.compareMinX=function(e,t){return e.minX-t.minX},r.prototype.compareMinY=function(e,t){return e.minY-t.minY},r.prototype.toJSON=function(){return this.data},r.prototype.fromJSON=function(e){return this.data=e,this},r.prototype._all=function(e,t){for(var i=[];e;)e.leaf?t.push.apply(t,e.children):i.push.apply(i,e.children),e=i.pop();return t},r.prototype._build=function(e,t,i,r){var a,n=i-t+1,o=this._maxEntries;if(n<=o)return s(a=m(e.slice(t,i+1)),this.toBBox),a;r||(r=Math.ceil(Math.log(n)/Math.log(o)),o=Math.ceil(n/Math.pow(o,r-1))),(a=m([])).leaf=!1,a.height=r;var l=Math.ceil(n/o),h=l*Math.ceil(Math.sqrt(o));f(e,t,i,h,this.compareMinX);for(var c=t;c<=i;c+=h){var d=Math.min(c+h-1,i);f(e,c,d,l,this.compareMinY);for(var u=c;u<=d;u+=l){var p=Math.min(u+l-1,d);a.children.push(this._build(e,u,p,r-1))}}return s(a,this.toBBox),a},r.prototype._chooseSubtree=function(e,t,i,r){for(;r.push(t),!t.leaf&&r.length-1!==i;){for(var a=1/0,s=1/0,n=void 0,o=0;o<t.children.length;o++){var l=t.children[o],h=c(l),d=(u=e,p=l,(Math.max(p.maxX,u.maxX)-Math.min(p.minX,u.minX))*(Math.max(p.maxY,u.maxY)-Math.min(p.minY,u.minY))-h);d<s?(s=d,a=h<a?h:a,n=l):d===s&&h<a&&(a=h,n=l)}t=n||t.children[0]}var u,p;return t},r.prototype._insert=function(e,t,i){var r=i?e:this.toBBox(e),a=[],s=this._chooseSubtree(r,this.data,t,a);for(s.children.push(e),o(s,r);t>=0&&a[t].children.length>this._maxEntries;)this._split(a,t),t--;this._adjustParentBBoxes(r,a,t)},r.prototype._split=function(e,t){var i=e[t],r=i.children.length,a=this._minEntries;this._chooseSplitAxis(i,a,r);var n=this._chooseSplitIndex(i,a,r),o=m(i.children.splice(n,i.children.length-n));o.height=i.height,o.leaf=i.leaf,s(i,this.toBBox),s(o,this.toBBox),t?e[t-1].children.push(o):this._splitRoot(i,o)},r.prototype._splitRoot=function(e,t){this.data=m([e,t]),this.data.height=e.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},r.prototype._chooseSplitIndex=function(e,t,i){for(var r,a,s,o,l,h,d,u=1/0,p=1/0,m=t;m<=i-t;m++){var f=n(e,0,m,this.toBBox),g=n(e,m,i,this.toBBox),v=(a=f,s=g,o=Math.max(a.minX,s.minX),l=Math.max(a.minY,s.minY),h=Math.min(a.maxX,s.maxX),d=Math.min(a.maxY,s.maxY),Math.max(0,h-o)*Math.max(0,d-l)),y=c(f)+c(g);v<u?(u=v,r=m,p=y<p?y:p):v===u&&y<p&&(p=y,r=m)}return r||i-t},r.prototype._chooseSplitAxis=function(e,t,i){var r=e.leaf?this.compareMinX:l,a=e.leaf?this.compareMinY:h;this._allDistMargin(e,t,i,r)<this._allDistMargin(e,t,i,a)&&e.children.sort(r)},r.prototype._allDistMargin=function(e,t,i,r){e.children.sort(r);for(var a=this.toBBox,s=n(e,0,t,a),l=n(e,i-t,i,a),h=d(s)+d(l),c=t;c<i-t;c++){var u=e.children[c];o(s,e.leaf?a(u):u),h+=d(s)}for(var p=i-t-1;p>=t;p--){var m=e.children[p];o(l,e.leaf?a(m):m),h+=d(l)}return h},r.prototype._adjustParentBBoxes=function(e,t,i){for(var r=i;r>=0;r--)o(t[r],e)},r.prototype._condense=function(e){for(var t=e.length-1,i=void 0;t>=0;t--)0===e[t].children.length?t>0?(i=e[t-1].children).splice(i.indexOf(e[t]),1):this.clear():s(e[t],this.toBBox)},r}()},k8fO:e=>{"use strict";e.exports=JSON.parse('{"name":"@aerisweather/mapsgl-sdk","version":"1.6.1","description":"An easy-to-use, highly customizable Javascript library for visualizing both weather and custom data on a variety of web mapping platforms for WebGL.","author":"AerisWeather","homepage":"https://www.aerisweather.com","license":"BSD","private":true,"workspaces":["packages/*"],"scripts":{"postinstall":"husky install","clean":"rm -fr dist/*","clean:bundle":"rm -fr packages/main/dist/*; rm -fr packages/main/build/types/*;","dev":"yarn clean; DEPLOY_PATH=\'/dist/\' NODE_ENV=\'development\' webpack serve --config webpack.dev.js","transpile":"swc ./packages/webgl-maps/src -d output","build":"rm -fr dist; tsc --sourceMap false --outDir dist; babel --config-file ./babel-nodejs.config.js dist --out-dir dist","build:dev":"DEPLOY_PATH=\'/dist/\' webpack --config webpack.dev.js","build:prod":"yarn clean; DEPLOY_PATH=\'https://cdn.aerisapi.com/sdk/js/mapsgl/%%version%%/\' NODE_ENV=\'production\' webpack --env production --config webpack.prod.js","build:bundle":"yarn clean:bundle; NODE_ENV=\'production\' webpack --env production --config webpack.bundle.js; node scripts/buildBundle.js","build:dts":"sh scripts/build-dts.sh","build:dts-rollup":"rm -fr packages/main/build/types/*; rollup -c rollup.config.js --environment BUILD:production,MINIFY:true; node scripts/buildDts.js","build:sprite":"node assets/scripts/buildSprites.js","glsl:chunks":"node scripts/chunkNames.js","test":"jest --maxWorkers=50%","test:watch":"jest --maxWorkers=25% --watch --onlyChanged","test:ci":"jest --color --runInBand --ci","test:cypress":"yarn run cypress open","test:clear":"jest --clearCache","lint":"yarn lint:eslint","lint:all":"concurrently yarn:lint:*","lint:eslint":"eslint --ext .ts,.tsx --config .eslintrc.js \\"packages/**/src/**/*.ts\\"","lint:types":"tsc --noEmit --skipLibCheck","lint:fix":"yarn lint:eslint --fix","commit":"git-cz","changelog":"cz changelog --dry-run","changelog:gen":"ts-node scripts/changelog-generate.ts","changelog:write":"ts-node scripts/changelog-write.ts","changelog:commit":"git add CHANGELOG.md && git commit -am \'docs: add changelog\' && git push","changelog:format":"node scripts/changelog-format.js","release":"standard-version","release:version":"standard-version --release-as 1.6.1","release:beta":"standard-version --prerelease beta","release:rc":"standard-version --prerelease rc","deploy":"yarn run build:prod; sh scripts/deploy.sh dist/","deploy-staging":"DEPLOY_ENV=\'staging\' yarn run build:prod; sh scripts/deploy.sh dist/","deploy-latest":"DEPLOY_VERSION=\'latest\' yarn run build:prod; sh scripts/deploy.sh dist/ --version latest","test-npm":"sh scripts/npmPublish.sh --test","deploy-npm":"sh scripts/npmPublish.sh","deploy-npm-beta":"sh scripts/npmPublish.sh --tag beta","strip-keys":"node scripts/stripKeys.js"},"lint-staged":{"*.{js,ts,tsx}":["yarn lint:fix"],"*.(md|html)":["yarn run strip-keys","yarn changelog:format"]},"devDependencies":{"@aerisweather/eslint-plugin":"^1.0.4","@babel/cli":"^7.24.0","@babel/core":"^7.24.0","@babel/plugin-transform-runtime":"^7.24.0","@babel/preset-env":"^7.24.0","@babel/preset-typescript":"^7.24.0","@babel/runtime":"^7.24.0","@changesets/cli":"^2.23.0","@commitlint/cli":"^17.0.2","@commitlint/config-conventional":"^17.0.2","@jutaz/spritezero":"^9.0.0","@rollup/plugin-commonjs":"^24.0.0","@rollup/plugin-json":"^6.0.0","@rollup/plugin-typescript":"^10.0.1","@swc/cli":"^0.3.10","@swc/core":"^1.4.11","@types/gl":"^4.1.0","@types/jest":"^27.0.0","@types/jest-image-snapshot":"^4.3.1","@types/jsdom-screenshot":"^3.2.1","@types/pngjs":"^6.0.1","@types/stats.js":"^0.17.0","@typescript-eslint/eslint-plugin":"^5.25.0","@typescript-eslint/parser":"^5.25.0","babel-eslint":"^10.1.0","babel-jest":"^27.0.6","babel-loader":"^8.2.2","babel-plugin-add-module-exports":"^1.0.4","babel-plugin-transform-import-meta":"^2.1.1","canvas":"^2.9.1","circular-dependency-plugin":"^5.2.2","clean-webpack-plugin":"^3.0.0","commitizen":"^4.2.4","concat":"^1.0.3","core-js":"^3.15.1","css-loader":"^6.7.1","cz-conventional-changelog":"^3.3.0","dotenv-webpack":"^7.1.0","eslint":"^8.57.0","eslint-config-airbnb":"^19.0.4","eslint-plugin-import":"^2.29.0","eslint-plugin-unicorn":"^51.0.0","fast-glob":"^3.2.11","file-loader":"^6.2.0","html-webpack-harddisk-plugin":"^2.0.0","html-webpack-plugin":"^5.3.2","husky":"^6.0.0","jest":"^27.0.5","jest-canvas-mock":"^2.5.0","jest-fetch-mock":"^3.0.3","jest-image-snapshot":"^6.2.1","jest-transform-stub":"^2.0.0","jest-webgl-canvas-mock":"^0.2.3","js-beautify":"^1.14.0","lint-staged":"^13.0.2","mini-css-extract-plugin":"^2.6.1","msdf-bmfont-xml":"^2.7.0","node-pandoc":"^0.3.0","pngjs":"^6.0.0","rollup":"^3.9.1","rollup-plugin-dts":"^5.1.0","rollup-plugin-terser":"^7.0.2","sass":"^1.52.3","sass-loader":"^13.0.0","standard-version":"^9.5.0","stats.js":"^0.17.0","swc-loader":"^0.2.3","terser-webpack-plugin":"^5.1.4","ts-jest":"^29.1.0","ts-loader":"^9.2.3","ts-node":"^10.9.0","ts-shader-loader":"^2.0.2","typedoc":"^0.21.5","typedoc-plugin-merge-modules":"^3.0.1","typedoc-plugin-rename-defaults":"^0.3.0","types-webpack-bundler":"^1.0.2","typescript":"^5.4.0","webpack":"^5.70.0","webpack-bundle-analyzer":"^4.4.2","webpack-cli":"^4.9.0","webpack-dev-server":"^4.0.0","webpack-glsl-minify":"^1.5.0","webpack-merge":"^5.8.0"},"packageManager":"yarn@1.22.19"}')}},t={};function i(r){var a=t[r];if(void 0!==a)return a.exports;var s=t[r]={exports:{}};return e[r].call(s.exports,s,s.exports,i),s.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return(()=>{"use strict";i.r(r),i.d(r,{Account:()=>Ht,AerisMapController:()=>og,Animation:()=>nr,AnimationState:()=>ar,DataQuality:()=>ki,DataSourceType:()=>ji,EncodedTileSource:()=>Wo,GeoJSONSource:()=>xh,GoogleMapController:()=>Pg,ImageTileSource:()=>Jo,InterpolationMode:()=>Sr,LayerType:()=>Pi,LeafletMapController:()=>xg,LegendControl:()=>_m,LineCap:()=>Fr,LineJoin:()=>Ir,MapboxMapController:()=>gg,MaplibreMapController:()=>vg,ParticleDensity:()=>Vr,SampleExpression:()=>Tr,TileState:()=>Ls,TimeAnimation:()=>or,TimeClampMode:()=>wr,TimeSeriesMode:()=>br,Timeline:()=>bh,VectorSourceType:()=>Li,VectorTileSource:()=>vh,styles:()=>Dg,units:()=>Fg,utils:()=>zg,version:()=>kg,weather:()=>Ig,workers:()=>Vo});var e={};i.r(e),i.d(e,{CtoF:()=>d,CtoFUnit:()=>I,FtoC:()=>c,FtoCUnit:()=>F,Units:()=>o,convert:()=>B,dbzToMMRate:()=>U,defaultUnits:()=>l,degToDir:()=>V,ftToM:()=>E,getDefaultUnit:()=>h,getMeasurementType:()=>$,hgToMb:()=>w,inToM:()=>k,inToMM:()=>P,inToMMRate:()=>D,kmToM:()=>T,kmToMi:()=>O,kphToMph:()=>m,kphToMs:()=>f,mToFt:()=>M,mToIn:()=>A,mToKm:()=>_,mToMi:()=>S,mbToHg:()=>x,mbToPa:()=>y,miToM:()=>C,mmToIn:()=>R,mmToMMRate:()=>z,mphToKph:()=>u,mphToMs:()=>p,mphToMsUnit:()=>j,msToKph:()=>g,msToMph:()=>v,msToMphUnit:()=>N,paToMb:()=>b});var t={};i.r(t),i.d(t,{dewpoint:()=>Z,freeze:()=>G,heatmap:()=>oe,humidity:()=>X,mslp:()=>Q,prate:()=>re,precip_accum:()=>ae,radar:()=>se,radarRate:()=>ne,sky:()=>J,snowdepth:()=>ee,tempChange1Hour:()=>W,tempChange24Hour:()=>H,temperature:()=>q,uvi:()=>te,uvi_categories:()=>ie,visibility:()=>K,windspeed:()=>Y});var a={};i.r(a),i.d(a,{color_lookup:()=>Sd,decode_float_rgba:()=>Dd,encode_float_rgba:()=>kd,encoding:()=>zd,fbm:()=>Nd,get_data_value:()=>qd,get_texel:()=>Bd,interpolate_bicubic:()=>Cd,interpolate_bilinear:()=>Od,interpolate_biquadratic:()=>Rd,interpolated_texel:()=>Pd,isolines:()=>jd,operators:()=>Vd,project:()=>Ud,sample_color_value:()=>Td,sdf_arrows:()=>Ld,sdf_draw:()=>Fd,skip_nodata:()=>$d,symbol_vert_position:()=>Gd,texture_lookup_3x3:()=>Ed,transform:()=>Id});var s={};i.r(s),i.d(s,{fragmentShader:()=>ip,uniforms:()=>rp,vertexShader:()=>tp});var n={};i.r(n),i.d(n,{fragmentShader:()=>cp,uniforms:()=>rp,vertexShader:()=>hp});const o={temperature:{C:"C",F:"F"},speed:{kmh:"km/h",mph:"mph",ms:"m/s",kts:"kts"},pressure:{mb:"mb",pa:"Pa",hPa:"hPa",hg:"inHg"},distance:{m:"m",km:"km",ft:"ft",mi:"mi"},precipitation:{mm:"mm",cm:"cm",in:"in",m:"m",ft:"ft"},direction:{deg:"°"},time:{hr:"hr",min:"min",sec:"sec",ms:"ms"},rate:{mmhr:"mm/hr",inhr:"in/hr",mms:"mm/sec",dbz:"dBZ"},concentration:{ppm:"ppm",ugm3:"ug/m^3"},ratio:{percent:"%"}},l={metric:{temperature:o.temperature.C,speed:o.speed.kmh,pressure:o.pressure.mb,distance:o.distance.km,height:o.distance.m,precipitation:o.precipitation.mm,snowfall:o.precipitation.cm,direction:o.direction.deg,time:o.time.hr,rate:o.rate.mmhr,concentration:o.concentration.ugm3,ratio:o.ratio.percent},imperial:{temperature:o.temperature.F,speed:o.speed.mph,pressure:o.pressure.hg,distance:o.distance.mi,height:o.distance.ft,precipitation:o.precipitation.in,snowfall:o.precipitation.in,direction:o.direction.deg,time:o.time.hr,rate:o.rate.inhr,concentration:o.concentration.ugm3,ratio:o.ratio.percent}},h=(e,t)=>t?l.metric[e]:l.imperial[e],c=e=>5/9*(e-32),d=e=>1.8*e+32,u=e=>1.609344*e,p=e=>.45*e,m=e=>.6213712*e,f=e=>.28*e,g=e=>3.6*e,v=e=>2.236936*e,y=e=>100*e,x=e=>.029529983071445*e,b=e=>.01*e,w=e=>33.86389*e,_=e=>.001*e,M=e=>3.280839895*e,A=e=>12*M(e),S=e=>62e-5*e,T=e=>1e3*e,E=e=>.3048*e,O=e=>.62*e,C=e=>1609.34*e,R=e=>.03937*e,P=e=>25.4*e,k=e=>.0254*e,D=e=>P(e)/3600,z=e=>e/3600,I=e=>1.8*e,F=e=>.555*e,j=e=>.45*e,N=e=>2.24*e,U=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=0;return i=Math.pow(Math.pow(10,e/10)/200,5/8),t?i/3600:i},V=e=>{e<0?e+=360:e>360&&(e-=360);const t=["↓ N","↓ NNE","↙ NE","← ENE","← E","← ESE","↖ SE","↑ SSE","↑ S","↑ SSW","↗ SW","→ WSW","→ W","→ WNW","↘ NW","↓ NNW"],i=t.length;return t[Math.floor(e/(360/i))%i]},B=(e,t,i,r)=>{switch(e){case"temperature":if("C"===i&&"F"===r)return d(t);if("F"===i&&"C"===r)return c(t);break;case"temperature-change":if("C"===i&&"F"===r)return I(t);if("F"===i&&"C"===r)return F(t);break;case"speed":if("km/h"===i&&"mph"===r)return m(t);if("mph"===i&&"km/h"===r)return u(t);if("m/s"===i&&"mph"===r)return v(t);if("m/s"===i&&"km/h"===r)return g(t);if("mph"===i&&"m/s"===r)return p(t);if("km/h"===i&&"m/s"===r)return f(t);break;case"pressure":if("mb"===i&&"hPa"===r)return y(t);if("mb"===i&&"inHg"===r)return x(t);if("hPa"===i&&"mb"===r)return b(t);if("inHg"===i&&"mb"===r)return w(t);break;case"distance":if("m"===i&&"km"===r)return _(t);if("m"===i&&"ft"===r)return M(t);if("m"===i&&"in"===r)return A(t);if("m"===i&&"mi"===r)return S(t);if("km"===i&&"m"===r)return T(t);if("ft"===i&&"m"===r)return E(t);if("km"===i&&"mi"===r)return O(t);if("mi"===i&&"m"===r)return C(t);break;case"precipitation":if("mm/sec"===i)return B(e,3600*t,"mm",r);if("in"===i&&"mm"===r)return P(t);if("in"===i&&"m"===r)return k(t);if("in"===i&&"mm/sec"===r)return D(t);if("m"===i&&"in"===r)return A(t);if("m"===i&&"cm"===r)return 100*t;if("cm"===i&&"m"===r)return t/100;if("cm"===i&&"mm"===r)return 10*t;if("mm"===i&&"mm/sec"===r)return z(t);if("mm"===i&&"in"===r)return R(t);break;case"time":if("hr"===i&&"min"===r)return 60*t;if("hr"===i&&"sec"===r)return 3600*t;if("hr"===i&&"ms"===r)return 36e5*t;if("min"===i&&"hr"===r)return t/60;if("min"===i&&"sec"===r)return 60*t;if("min"===i&&"ms"===r)return 6e4*t;if("sec"===i&&"hr"===r)return t/3600;if("sec"===i&&"min"===r)return t/60;if("sec"===i&&"ms"===r)return 1e3*t;if("ms"===i&&"hr"===r)return t/36e5;if("ms"===i&&"min"===r)return t/6e4;if("ms"===i&&"sec"===r)return t/1e3;break;case"rate":if("mm/hr"===i&&"mm/sec"===r)return t/3600;if("mm/sec"===i&&"mm/hr"===r)return 3600*t;if("dbz"===i&&"mm/hr"===r)return U(t);if("dbz"===i&&"mm/sec"===r)return U(t,!0)}return t},$=e=>(e=e.replaceAll(/\s+/g,"-").replaceAll("_","-").toLowerCase(),/^(temp(erature)?|dew-?point|wind-?chill|heat-?index|feels-?like)/i.test(e)?"temperature":/^(wind-?speed|wind-?gust)/i.test(e)?"speed":/^(pressure)/i.test(e)?"pressure":/^(visibility|snow-depth)/i.test(e)?"distance":/^(precip|rain|snow(fall)?)/i.test(e)?"precipitation":/^(cloud-?cover|humidity)/i.test(e)?"ratio":void 0),q=[-90,"#bef7ff",-84.44,"#00c7fb",-78.89,"#0075b6",-73.33,"#1B0084",-67.78,"#6100FF",-62.22,"#D592FF",-56.67,"#D150FF",-51.111111111111,"#8f00ca",-45.555555555556,"#630078",-40,"#a50099",-34.444444444444,"#ed00dc",-28.888888888889,"#f671ff",-23.333333333333,"#dcc1ed",-17.777777777778,"#1b007b",-12.222222222222,"#6e51ff",-6.6666666666667,"#9bb6ff",-1.1111111111111,"#18a5fc",4.4444444444444,"#0900e7",10,"#14b000",15.555555555556,"#f5d508",21.111111111111,"#e17200",26.666666666667,"#f33300",32.222222222222,"#d00000",37.777777777778,"#720000",43.333333333333,"#ce0046",48.888888888889,"#ff4b98",54.44,"#ffadad",60,"#9f0000",65.56,"#ca4931",71.11,"#e9a696"],G=[-90,"#992BFF",-2.22,"#0046FF",0,"#73DAFC",2.22,"#73DAFC"],H=[.555*-60,"#EF90FF",.555*-50,"#D741DA",.555*-40,"#8B21DA",.555*-30,"#0013CA",.555*-20,"#0070F1",.555*-10,"#8ED4F9",-.555,"rgba(142,212,249,0)",0,"rgba(0,0,0,0)",.555,"rgba(255,217,42,0)",10*.555,"#FFD92A",20*.555,"#FF932A",30*.555,"#E2330B",40*.555,"#9D0000",50*.555,"#D00071",60*.555,"#FF698C"],W=[.555*-40,"#EF90FF",.555*-25,"#D741DA",.555*-15,"#8B21DA",.555*-10,"#0070F1",.555*-5,"#8ED4F9",-.555,"rgba(142,212,249,0)",0,"rgba(0,0,0,0)",.555,"rgba(255,217,42,0)",5*.555,"#FFD92A",10*.555,"#FF932A",15*.555,"#E2330B",19.425,"#9D0000",40*.555,"#D00071"],Y=[0,"rgba(0,0,0,0)",1.1176,"#0050ff",3.3528,"#1bd3ff",4.4704,"#34ff87",5.588,"#72ff09",6.7056,"#b4ff08",7.8232,"#efff0b",8.9408,"#fee20a",11.176,"#f0b90a",13.4112,"#ed9909",15.6464,"#fd8609",17.8816,"#fd5d08",20,"#fb3706",22.352,"#c71506",26.8224,"#731005",33.081,"#D01DC7",42.91584,"#FFB1FB",49.62144,"#C8F0F4",53.64,"#36E2F4",57.65856,"#00626C"],Z=[-84.44,"#fde3ff",-78.89,"#e0b6ec",-73.33,"#c38ad9",-67.78,"#a75ec6",-62.22,"#8f46b3",-56.67,"#782ea0",-51.11,"#61178e",-45.56,"#5d2d9d",-40,"#5943ac",-34.44,"#5559bc",-30.28,"#7f86dd",-26.11,"#aab4fe",-21.94,"#7f84a9",-17.78,"#555555",-13.61,"#62594f",-9.44,"#705e49",-5.28,"#816b57",-1.11,"#927865",3.06,"#a0938a",7.22,"#afafaf",10,"#5ee243",15.56,"#14b300",21.11,"#0e5e00",26.67,"#93a600",32.22,"#fff800"],X=[0,"#4b2b18",10,"#634a3b",20,"#7c695e",30,"#958881",40,"#aea7a4",50,"#c7c7c7",60,"#6aea55",70,"#18d200",80,"#14ab00",90,"#118400",100,"#0e5e00"],Q=[950,"#D08AFF",960,"#9A00FF",970,"#6401FF",980,"#0300B8",990,"#084ADA",1e3,"#01CDFF",1010,"#23DC02",1020,"#FEF90B",1030,"#FE7B00",1040,"#FA0107",1050,"#970100",1060,"#DB5C5F"],K=[0,"#ffb400",C(2.5),"#ffea00",C(5),"rgba(255, 255, 173, 0.5)",C(10),"rgba(162, 162, 162, 0)"],J=[0,"rgba(50, 50, 50, 0)",50,"rgba(100, 100, 100, 0.4)",100,"rgba(242, 242, 242, 1)"],ee=[0,"rgba(96,96,96,0)",k(.01),"rgba(96,96,96,0)",k(.1),"rgba(96,96,96,0.5)",k(1),"#888888",k(3),"#85D3FF",k(6),"#25B4FF",k(12),"#012DFF",k(18),"#7000D9",k(24),"#FF49C4",k(48),"#FFECF7",k(72),"#36E2F4",k(120),"#007682",k(168),"#C38EF2",k(240),"#A34AF2",k(300),"#7100FF"],te=[0,"rgba(0,0,0,0)",1,"#409F3F",3,"#FBFF00",6,"#DF8000",8,"#DF4000",12,"#C05FC0"],ie={minimal:"#409F3F",low:"#FBFF00",moderate:"#DF8000",high:"#DF4000",very_high:"#C05FC0"},re=[0,"rgba(0,0,0,0)",U(5.9,!0),"rgba(113,255,194,0)",U(6,!0),"#71ffc2",U(10,!0),"#49eb3a",U(33,!0),"#114c00",U(40,!0),"#e4c700",U(50,!0),"#da0000",U(60,!0),"#7a0009",U(65,!0),"#9e0570"],ae=[0,"rgba(198,247,199,0)",D(.001),"rgba(198,247,199,0.5)",D(.01),"#C6F7C7",D(.1),"#B8FF9C",D(.5),"#30D72F",D(1),"#006C00",D(2),"#FFFC0B",D(4),"#DF1400",D(6),"#860000",D(8),"#4D014B",D(10),"#E501E5",D(12),"#FF91FF",D(14),"#D6F1F4",D(16),"#36E2F4",D(20),"#00626C",D(25),"#F1CCC2",D(30),"#9F5F51"],se={rain:[0,"rgba(0,0,0,0)",5.99,"rgba(0,0,0,0)",6,"#8CF482",10,"#49eb3a",33,"#114c00",40,"#e4c700",50,"#da0000",60,"#7a0009",65,"#9e0570",70,"#dc42b1",80,"#dea8ff",87,"#faf3ff"],mix:[0,"rgba(0,0,0,0)",5.9,"rgba(255,163,249,0)",6,"#ffa3f9",25,"#d518be",58,"#58003c",87,"#58003c"],snow:[0,"rgba(0,0,0,0)",5.9,"rgba(124,255,255,0)",6,"#7cffff",7,"#00e8ff",25,"#0061ea",45,"#0000af",58,"#5c00f5",87,"#5c00f5"]},ne={rain:[U(0,!0),"rgba(0,0,0,0)",U(5.99,!0),"rgba(0,0,0,0)",U(6,!0),"#8CF482",U(10,!0),"#49eb3a",U(33,!0),"#114c00",U(40,!0),"#e4c700",U(50,!0),"#da0000",U(60,!0),"#7a0009",U(65,!0),"#9e0570",U(70,!0),"#dc42b1",U(80,!0),"#dea8ff",U(87,!0),"#faf3ff"],mix:[U(0,!0),"rgba(0,0,0,0)",U(5.9,!0),"rgba(255,163,249,0)",U(6,!0),"#ffa3f9",U(25,!0),"#d518be",U(58,!0),"#58003c",U(87,!0),"#58003c"],snow:[U(0,!0),"rgba(0,0,0,0)",U(5.9,!0),"rgba(124,255,255,0)",U(6,!0),"#7cffff",U(7,!0),"#00e8ff",U(25,!0),"#0061ea",U(45,!0),"#0000af",U(58,!0),"#5c00f5",U(87,!0),"#5c00f5"]},oe=[0,"rgba(0, 0, 0, 0)",.2,"rgba(0, 0, 255, 0.2)",.45,"rgba(0, 255, 0, 0.5)",.85,"rgba(255, 255, 0, 1)",1,"rgba(255, 0, 0, 1)"],le=e=>null==e,he=e=>!le(e),ce=((null===navigator||void 0===navigator?void 0:navigator.userAgent)||"").toLowerCase(),de=((null===navigator||void 0===navigator?void 0:navigator.vendor)||"").toLowerCase(),ue=()=>{const e=navigator.userAgent;if(/edge?\//i.test(navigator.userAgent))return{name:"edge/edgehtml",version:void 0,mobile:!1};if(/google/i.test(navigator.vendor))return{name:"chrome/blink",version:void 0,mobile:!1};if(/apple/i.test(navigator.vendor)){const t=e.match(/Version\/([\d.]+) .*Safari/);return{name:"safari/webkit",version:t?t[1]:void 0,mobile:/Mobile\//.test(e)}}return/firefox\//i.test(navigator.userAgent)?{name:"firefox/gecko",version:e.replace(/^.+Firefox\//,""),mobile:!1}:/trident\//i.test(navigator.userAgent)||/msie\//i.test(navigator.userAgent)?{name:"ie/trident",version:void 0,mobile:!1}:{name:`${navigator.userAgent}\n${navigator.vendor}`,version:void 0,mobile:!1}},pe=e=>{const t=(()=>{const e=window.document;return e.fullscreenElement||e.mozFullscreenElement||e.webkitFullscreenElement||e.msFullscreenElement})();return he(t)&&(t===e||t.contains(e))},me={firefox:!!ce.match(/(?:firefox|fxios)\/(\d+)/),chrome:!!(/google inc/.test(de)?ce.match(/(?:chrome|crios)\/(\d+)/):void 0),safari:!!function(){const{name:e}=ue();return"safari/webkit"===e}(),version:function(){const{version:e}=ue();return Number.parseFloat(e)}(),info:ue()},fe=e=>Array.isArray(e)?"array":e instanceof Date?"date":typeof e,ge=e=>{switch(fe(e)){case"array":case"string":return 0===e.length;case"date":case"boolean":case"number":case"function":case"symbol":return!1;case"object":return 0===Object.keys(e).length;default:return!0}},ve=e=>!ge(e),ye=e=>le(e)||ge(e),xe=e=>!ye(e),be=(e,t,i)=>(1-i)*e+i*t,we=.95047,_e=1.08883,Me=.137931034,Ae=.12841855,Se=e=>{const{x:t,y:i,z:r}=Oe(e),a=116*i-16;return{l:a<0?0:a,a:500*(t-i),b:200*(i-r)}},Te=e=>(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4),Ee=e=>e>.008856452?Math.pow(e,1/3):e/Ae+Me,Oe=e=>{let{r:t,g:i,b:r}=e;return t=Te(t),i=Te(i),r=Te(r),{x:Ee((.4124564*t+.3575761*i+.1804375*r)/we),y:Ee((.2126729*t+.7151522*i+.072175*r)/1),z:Ee((.0193339*t+.119192*i+.9503041*r)/_e)}},Ce=e=>255*(e<=.00304?12.92*e:1.055*Math.pow(e,1/2.4)-.055),Re=e=>e>.206896552?e*e*e:Ae*(e-Me),Pe=(e,t,i)=>Math.min(Math.max(e,t),i),ke=e=>"string"===fe(e),De=e=>{if(le(e))return;let t=0,i=0,r=0;if(ke(e)){const a=e.replace(/^#/,""),s=a.length;3===s?(t=Number.parseInt(a.charAt(0)+a.charAt(0),16),i=Number.parseInt(a.charAt(1)+a.charAt(1),16),r=Number.parseInt(a.charAt(2)+a.charAt(2),16)):6===s&&(t=Number.parseInt(a.charAt(0)+a.charAt(1),16),i=Number.parseInt(a.charAt(2)+a.charAt(3),16),r=Number.parseInt(a.charAt(4)+a.charAt(5),16))}else{const a=Math.floor(e);t=a>>16&255,i=a>>8&255,r=255&a}return{r:t,g:i,b:r,a:1}},ze=e=>"object"===fe(e),Ie=(e,t)=>{if("array"!==fe(t)||ye(e)||!ze(e))return!1;let i=!0;return t.forEach((t=>{!1===e.hasOwnProperty(t)&&(i=!1)})),i},Fe=e=>Ie(e,["r","g","b"]),Le=e=>Ie(e,["h","s","l"]),je=e=>Ie(e,["h","s","v"]),Ne=e=>ke(e)&&e.includes("%"),Ue=(e,t,i)=>{const r=Ne(e),a=i-t;return e=Pe(Number.parseFloat(`${e}`),t,i),r&&(e=Number.parseInt(""+e*i,10)/100),Math.abs(e-i)<1e-6?1:e%a/a},Ve=(e,t,i)=>(i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+(t-e)*(2/3-i)*6:e),Be=e=>{if(!Le(e))return;let t,i,r,{h:a,s,l:n,a:o}=e;if(a=Ue(a,0,360),s=Ue(s,0,100),n=Ue(n,0,100),o=o||1,0===s)t=i=r=n;else{const e=n<.5?n*(1+s):n+s-n*s,o=2*n-e;t=Ve(o,e,a+1/3),i=Ve(o,e,a),r=Ve(o,e,a-1/3)}return{r:Math.round(255*t),g:Math.round(255*i),b:Math.round(255*r),a:o}},$e=e=>{if(!je(e))return;let{h:t,s:i,v:r,a}=e;t=6*Ue(t,0,360),i=Ue(i,0,100),r=Ue(r,0,100),a=a||1;const s=Math.floor(t),n=t-s,o=r*(1-i),l=r*(1-n*i),h=r*(1-(1-n)*i),c=s%6,d=[h,r,r,l,o,o][c],u=[o,o,h,r,r,l][c];return{r:Math.round(255*[r,l,o,o,h,r][c]),g:Math.round(255*d),b:Math.round(255*u),a}},qe=e=>"number"===fe(e),Ge=e=>{if(Fe(e))return e;if(Le(e))return Be(e);if(je(e))return $e(e);if(ke(e)){const t=/^(rgb|hsl|hsv)a?\((\d+),\s*([\d%]+),\s*([\d%]+)(?:,\s*(\d+(?:\.\d+)?))?\)$/.exec(`${e}`);if(t&&t.length>=5){const e=t[1],i=he(t[5])?Number.parseFloat(t[5]):1,r=t.slice(2,5).map((e=>Ne(e)?e:Number.parseInt(e,10)));if("rgb"===e||"rgba"===e)return{r:Pe(r[0],0,255),g:Pe(r[1],0,255),b:Pe(r[2],0,255),a:i};if("hsl"===e)return Be({h:r[0],s:r[1],l:r[2],a:i});if("hsv"===e)return $e({h:r[0],s:r[1],v:r[2],a:i})}else if(/^#?([\dA-Fa-f]+)$/.test(e))return De(e)}return qe(e)?De(e):void 0},He={linear:e=>e,quadratic:e=>e*(-e*e*e+4*e*e-6*e+4),cubic:e=>e*(4*e*e-9*e+6),elastic:e=>e*(33*e*e*e*e-106*e*e*e+126*e*e-67*e+15),inQuad:e=>e*e,outQuad:e=>e*(2-e),inOutQuad:e=>e<.5?2*e*e:(4-2*e)*e-1,inCubic:e=>e*e*e,outCubic:e=>--e*e*e+1,inOutCubic:e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,inQuart:e=>e*e*e*e,outQuart:e=>1- --e*e*e*e,inOutQuart:e=>e<.5?8*e*e*e*e:1-8*--e*e*e*e,inQuint:e=>e*e*e*e*e,outQuint:e=>1+--e*e*e*e*e,inOutQuint:e=>e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e,inSine:e=>1-Math.cos(e*(Math.PI/2)),outSine:e=>Math.sin(e*(Math.PI/2)),inOutSine:e=>-(Math.cos(Math.PI*e)-1)/2,inExpo:e=>Math.pow(2,10*(e-1)),outExpo:e=>1-Math.pow(2,-10*e),inOutExpo:e=>(e/=.5)<1?Math.pow(2,10*(e-1))/2:(e--,(2-Math.pow(2,-10*e))/2),inCirc:e=>1-Math.sqrt(1-e*e),outCirc:e=>Math.sqrt(1-(e-=1)*e),inOutCirc:e=>(e/=.5)<1?-(Math.sqrt(1-e*e)-1)/2:(e-=2,(Math.sqrt(1-e*e)+1)/2),inSquare:e=>Math.pow(e,2),outSquare:e=>1-Math.pow(1-e,2),inOutSquare:e=>e<.5?2*e*e:(4-2*e)*e-1,inSqrt:e=>1-Math.pow(1-e,.5),outSqrt:e=>Math.pow(e,.5),inOutSqrt:e=>e<.5?(1-Math.pow(1-2*e,.5))/2:(Math.pow(2*e-1,.5)+1)/2},We=(e,t,i,r)=>{const a=Number.isNaN;(a(e)||a(t)||a(i)||a(r))&&console.warn(`Cubic bezier need to have 4 numbers, example: "0.25, 0, 0.25, 1", and not [${e}, ${t}, ${i}, ${r}]`),(e<0||e>1||i<0||i>1)&&console.warn(`Cubic bezier can not have horizontals Number < 0 or > 1, but you have ${e} and ${i}`),e=Math.min(Math.max(e,0),1),i=Math.min(Math.max(i,0),1);const s=(e,t)=>1-3*t+3*e,n=(e,t)=>3*t-6*e,o=e=>3*e,l=(e,t,i)=>((s(t,i)*e+n(t,i))*e+o(t))*e;return a=>e===t&&i===r?a:l((t=>{let r=t;for(let d=0;d<4;++d){const d=(a=r,3*s(h=e,c=i)*a*a+2*n(h,c)*a+o(h));if(0===d)return r;r-=(l(r,e,i)-t)/d}var a,h,c;return r})(a),t,r)},Ye=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"e",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:7;const r=Array.isArray(e)?(e=>{const t={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY,sum:0,values:[],count:0};return e.forEach((e=>(e=>{void 0===e||Number.isNaN(e)||(t.values.push(e),t.sum+=e,e<t.min&&(t.min=e),e>t.max&&(t.max=e),t.count+=1)})(e))),t.domain=[t.min,t.max],t.limits=(t,i)=>Ye(e,t,i),t})(e):e,{min:a,max:s,values:n}=r;if(n.sort(((e,t)=>e-t)),1===i)return[a,s];if(t.startsWith("c"))return[a,s];if(t.startsWith("e"))return Array.from({length:i+1},((e,t)=>be(a,s,t/i)));if(t.startsWith("l")){if(a<=0)throw new Error("Logarithmic scales are only possible for values > 0");const e=Math.log10(a),t=Math.log10(s);return Array.from({length:i+1},((r,a)=>Math.pow(10,be(e,t,a/i))))}return t.startsWith("q")?Array.from({length:i+1},((e,t)=>{const r=(n.length-1)*t/i,a=Math.floor(r);return a===r?n[a]:be(n[a],n[a+1],r-a)})):void 0},Ze=function(e,t){return arguments.length>2&&void 0!==arguments[2]&&arguments[2]?Math.ceil((e+t/2)/t)*t:Math.floor((e+t/2)/t)*t},Xe=function(e,t){const i=10*(arguments.length>2&&void 0!==arguments[2]?arguments[2]:4);return Math.round(e*i)===Math.round(t*i)},Qe=(e,t,i,r,a)=>(e-t)*(a-r)/(i-t)+r,Ke=(e,t,i,r)=>e<=r&&r<=t||(e>r?r+Math.ceil((e-r)/i)*i<=t:r-Math.ceil((r-t)/i)*i>=e),Je=(e,t,i)=>(i-e)/(t-e);var et;const tt={rgb:(e,t,i,r)=>({r:e.r+(t.r-e.r)*i,g:e.g+(t.g-e.g)*i,b:e.b+(t.b-e.b)*i,a:e.a+(t.a-e.a)*i}),lrgb:(e,t,i,r)=>({r:Math.sqrt(Math.pow(e.r,2)*(1-i)+Math.pow(t.r,2)*i),g:Math.sqrt(Math.pow(e.g,2)*(1-i)+Math.pow(t.g,2)*i),b:Math.sqrt(Math.pow(e.b,2)*(1-i)+Math.pow(t.b,2)*i),a:e.a+(t.a-e.a)*i}),lab:(e,t,i,r)=>{const a=Se(e),s=Se(t);return((e,t=1)=>{const{l:i,a:r,b:a}=e;let s,n,o;return n=(i+16)/116,s=Number.isNaN(r)?n:n+r/500,o=Number.isNaN(a)?n:n-a/200,n=1*Re(n),s=we*Re(s),o=_e*Re(o),{r:Ce(3.2404542*s-1.5371385*n-.4985314*o),g:Ce(-.969266*s+1.8760108*n+.041556*o),b:Ce(.0556434*s-.2040259*n+1.0572252*o),a:t}})({l:a.l+(s.l-a.l)*i,a:a.a+(s.a-a.a)*i,b:a.b+(s.b-a.b)*i},e.a+(t.a-e.a)*i)},hsl:(e,t,i,r)=>{}};class it{get colors(){return this._colors}get domain(){return this._domain}get positions(){return this._pos}get breaks(){return this._breaks}get range(){return Object.assign({},this._range)}constructor(e=[]){et.add(this),this.mode="rgb",this._range={min:0,max:1},this._domain=[0,1],this._colors=[],this._pos=[],this._cache=new Map,this._correctLightness=!1,this.setColors(e)}setColors(e){if(e=[...e]||["#fff","#000"],this._pos.length>0&&e.length!==this._pos.length)throw new Error(`[MapsGL] Invalid color length for color scale ${e.length}, must match current positions ${this._pos.length}`);if(Array.isArray(e)){1===e.length&&(e=[e[0],e[0]]);const t=(e=e.splice(0)).map((e=>Ge(e)));this._pos=t.map(((e,i)=>i/(t.length-1))),this._colors=t}}setDomain(e){if(!1===Array.isArray(e))throw new TypeError("invalid domain");if(this._range=Object.freeze({min:e[0],max:e.at(-1)}),this._domain=[...e],2===e.length)this._pos=this._colors.map(((e,t)=>t/(this._colors.length-1)));else{if(e.length!==this._colors.length)throw new Error(`[MapsGL] Invalid color scale domain ${e}`);this._pos=e.map((e=>Je(this._range.min,this._range.max,e)))}}setBreaks(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"e";if(Array.isArray(e))this._breaks=e,this._range={min:e[0],max:e.at(-1)};else{if(e%1!=0||e<1)throw new Error(`[MapsGL] Invalid color scale breaks param ${e}`);this._breaks=Ye(this._domain,t,e)}this._cache.clear()}setPositions(e){if(e.length!==this._colors.length)throw new Error(`[MapsGL] Invalid position length for color scale, total positions (${e.length}) must match total colors (${this._colors.length})`);this._pos=[...e],this._cache.clear()}getColors(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:He.linear;var i;let r=[];if(1===e)r=[this.getColor(.5)];else if(e>1){const i=this._range.min,a=this._range.max;r=Array.from({length:e},((r,s)=>{const n=t(s/(e-1));return this.getColor(be(i,a,n))}))}else r=((null===(i=this._breaks)||void 0===i?void 0:i.length)>2?this._breaks:this._domain).map((e=>this.getColor(e)));return r}getColor(e){let t,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t=i?e:this.getPosition(e,i),t=Pe(t,0,1);const r=t,a=this._cache&&this._cache.get(r);if(a)return a;let s;for(let e=0;e<this._pos.length;e++){const i=this._pos[e];if(t<=i){s=this._colors[e];break}if(t>=i&&e===this._pos.length-1){s=this._colors[e];break}if(t>i&&t<this._pos[e+1]){s=tt[n=this.mode](this._colors[e],this._colors[e+1],(t-i)/(this._pos[e+1]-i),n);break}}var n;return s&&(s.r=Math.floor(s.r),s.g=Math.floor(s.g),s.b=Math.floor(s.b),this._cache.set(r,s)),s}getColorRelative(e){return this.getColor(e,!0)}getBreak(e){if(he(this._breaks)){if(e>this._breaks.at(-1))return this._breaks.length-1;const t=this._breaks.indexOf(e);return t>-1?t:this._breaks.findIndex((t=>e<=t))-1}return 0}getPosition(e){const t=this._range.min,i=this._range.max;let r=e;if(arguments.length>1&&void 0!==arguments[1]&&arguments[1])r=e;else if(this._breaks&&this._breaks.length>2){const t=this.getBreak(e);r=this._breaks[t]}else i===t&&(r=i);r=Pe(r,t,i);let a=0;for(let e=0;e<this._domain.length;e++){const t=this._domain[e];if(r<=t){a=this._pos[e];break}if(r>=t&&e===this._domain.length-1){a=this._pos[e];break}if(r>t&&r<this._domain[e+1]){a=be(this._pos[e],this._pos[e+1],(r-t)/(this._domain[e+1]-t));break}}return a}scale(e,t){const i=this._domain.map((i=>be(e,t,Je(this.range.min,this.range.max,i))));this.setDomain(i)}correctLightness(e){this._correctLightness=e}clone(){const e=new it(this.colors);return e.setDomain(this.domain),this._breaks&&e.setBreaks([...this.breaks]),e.setPositions([...this._pos]),e}getRamp(e){var t,i,r,a;const s=null==e?void 0:e.totalColors,n=null!==(t=null==e?void 0:e.easing)&&void 0!==t?t:He.linear,o=null!==(i=null==e?void 0:e.interval)&&void 0!==i?i:0,l=null===(r=null==e?void 0:e.interpolate)||void 0===r||r,h=null!==(a=null==e?void 0:e.normalize)&&void 0!==a&&a,c=null==e?void 0:e.range,d=this.clone();h&&0!==d.range.min&&1!==d.range.max&&d.scale(0,1);const{min:u,max:p}=null!=c?c:d.range,m=[];let f=[];if(!1===l)f=this.domain;else if(o>0||xe(null==e?void 0:e.breaks)){if(xe(null==e?void 0:e.breaks))f=e.breaks;else{let e=Ze(u,o,!0);for(u<e&&f.push(u);e<=p;)f.push(e),e+=o;f.at(-1)<p&&f.push(p)}f=f.map((e=>Ze(e,.001)))}if(f.length>0&&d.setBreaks(f),s>1)for(let e=0;e<s;e++){const t=e/(s-1),i=f.length>0?t:n(t),r=be(u,p,i),a=d.getColor(r);m.push({value:r,color:a,position:t})}else(f.length>2?d.breaks:d.domain).forEach((e=>{m.push({value:e,color:d.getColor(e),position:d.getPosition(e)})}));return{stops:m.filter((e=>e.value>=u&&e.value<=p)),getValue:e=>{const t=n(e);return be(u,p,t)},getPosition:e=>this.getPosition(e)}}}et=new WeakSet;const rt=it,at=Object.assign(Object.assign({},{Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Inferno:["#000004","#160b39","#420a68","#6a176e","#932667","#ba3655","#ec6149","#f0882c","#f6a625"],Plasma:["#0d0887","#46039f","#7201a8","#9c179e","#bd3786","#d8576b","#ed7953","#fb9f3a","#fdca26"],Magma:["#000004","#1b0c41","#4a0c6b","#781c6d","#a52c60","#cf4446","#f1642e","#fca636","#f0f921"],Cividis:["#002350","#193B6E","#50566C","#787877","#A29A76","#D6C363","#FFE945"],Mako:["#12070B","#352446","#414283","#3579A3","#36A6AC","#79D5AF","#DBF4E3"],Rocket:["#06061C","#3D1942","#771F59","#C71F51","#EE5740","#F7A67C","#FAE9D9"],Turbo:["#331646","#4682F8","#1BD6CB","#86FA4F","#F6C339","#E74C0C","#881001"]}),{OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"],Rainbow:["#800026","#e31a1c","#fd8d3c","#feb24c","#fed976","#ffeda0","#ffffcc","#ffffe5"],Sinebow:["#0000ff","#00ff00","#ff0000","#ff00ff","#0000ff"],White:["#ffffff","#ffffff"],Black:["#000000","#000000"]}),st=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=[],a=[],s=he(null==t?void 0:t.min)?t.min:Number.NEGATIVE_INFINITY,n=he(null==t?void 0:t.max)?t.max:Number.POSITIVE_INFINITY;let o,l;for(let t=0,h=e.length;t<h;t+=2){if(o=e[t],i&&(o=be(s,n,o)),o<s){l=`${e[t+1]}`.replaceAll(/^\s+|\s+$/g,"");continue}o>s&&xe(l)&&(r.push(l),a.push(s),l=null);const h=`${e[t+1]}`.replaceAll(/^\s+|\s+$/g,"");0===t&&s!==Number.NEGATIVE_INFINITY&&o>s&&(r.push(h),a.push(s)),(Xe(o,s)||Xe(o,n)||o>=s&&o<=n)&&(r.push(h),a.push(o))}o<n&&n!==Number.POSITIVE_INFINITY&&(r.push(r.at(-1)),a.push(n));const h=new rt(r);return h.setDomain(a),h},nt=e=>e&&"object"==typeof e,ot=(e,t)=>(Object.keys(t).forEach((i=>{const r=e[i],a=t[i];e[i]=Array.isArray(r)&&Array.isArray(a)?[...r,...a]:nt(r)&&nt(a)?ot(Object.assign({},r),a):a})),e),lt=(...e)=>{if(e.length<2)throw new Error("deepMerge: this function expects at least 2 objects to be provided");if(e.some((e=>!nt(e))))throw new Error('deepMerge: all values should be of type "object"');const t=e.shift();let i;for(;i=e.shift();)ot(t,i);return t},ht=class{constructor(e,t){var i;this.type=e,(i=t=Object.assign({},t),he(i)&&"object"===fe(i)?Object.getOwnPropertyNames(i):[]).forEach((e=>{this[e]=t[e]}))}},ct=e=>"object"==typeof e&&"type"in e,dt=class{constructor({validEventTypes:e=[/.*/],triggerLastEvent:t=!1}={}){this.callbacks={},this.lastEvents={},this.validEventTypes=e,this.triggerLastEvent=t,this.callbackContext=this}setCallbackContext(e){return this.callbackContext=e,this}on(e,t,i,r){if(ke(e)&&/\s+/.test(e))return e.split(" ").forEach((e=>{this.on(e,t,i,r)})),this;if(this.validateEventType(e),this.hasListener(e)||(this.callbacks[e]=new Set),this.callbacks[e].add({callback:t,context:r}),(null==i?void 0:i.triggerLastEvent)||this.triggerLastEvent){const i=this.lastEvents[e];i&&t.call(r||this.callbackContext||this,i)}return this}once(e,t,i,r){if(ke(e)&&/\s+/.test(e))return e.split(" ").forEach((e=>{this.once(e,t,i,r)})),this;this.validateEventType(e);const a=i=>(this.off(e,a),t.call(r||this.callbackContext||this,i));return this.on(e,a,i,r)}off(e,t){if(ke(e)&&/\s+/.test(e))return e.split(" ").forEach((e=>{this.off(e,t)})),this;if(this.validateEventType(e),!this.hasCallbacks(e))return this;if(!t)return delete this.callbacks[e],this;for(const i of this.callbacks[e])if(i.callback===t){this.callbacks[e].delete(i);break}return this}trigger(e,t){const i=ct(e)?e:new ht(e,t||{}),r=ct(e)?e.type:e;i.target=this,this.validateEventType(r),this.lastEvents[r]=i;const a=this.callbacksForEvent(r);if(a)return[...a].map((({callback:e,context:t})=>e.call(t||this.callbackContext||this,i)))}hasListener(e){return e in this.callbacks}clearListeners(){return this.callbacks={},this}addEventListener(e,t,i,r){return this.on(e,t,i)}removeEventListener(e,t,i){return this.off(e,t)}dispatchEvent(e,t){return this.trigger(e,t)}validateEventType(e){if(!this.isValidEvent(e)){const t=this.validEventTypes.join("|");throw new Error(`Invalid event type {${e}}.\nEvent type should be any of: ${t}.`)}}isValidEvent(e){const t=Array.isArray(e)?e:[e];let i=0;for(const r of t)for(const a of this.validEventTypes)if((a instanceof RegExp?a.test(r):e===a)&&(i+=1,i===t.length))return!0;return!1}hasCallbacks(e){return e in this.callbacks}callbacksForEvent(e){return this.callbacks[e]}},ut=(e,t,i)=>{if(null==e||le(t)||!ke(t))return i;const r=t.split(/["'.[\]]{1,2}/),a=r.length;for(let t=0;t<a;t+=1)if(!ge(r[t])&&null==(e=e[r[t]]))return i;return null==e?i:e},pt=(e,t,i)=>{if(le(t))return e;const r=t.split("."),a=r.length-1;let s;for(s=0;s<a;s+=1)e[r[s]]=e[r[s]]||{},e=e[r[s]];return e[r[s]]=i,e},mt=e=>"date"===fe(e),ft=class{constructor(e,t,i,r=null){let a=null;if(i){const{code:e}=i||{};e.startsWith("warn_")&&(a=i)}this.response=e,this.data=t,this.error=he(a)?null:i,this.warning=a,this.params=r}headers(){return this.response?this.response.headers:void 0}},gt=class{constructor(e=[]){this._conditions=e||[]}addCondition(e){return this._conditions.push(e),this}removeCondition(e){const t=this._conditions.indexOf(e);return-1!==t&&this._conditions.splice(t,1),this}removeAllConditions(){return this._conditions=[],this}toString(){const e=this._conditions.length-1;return this._conditions.reduce(((t,i,r)=>t+`${i.toString()}${r<e?i.nextOperator:""}`),"")}};class vt extends Error{}Error,Error;class yt extends Error{constructor(e,t){super(e),this.response=t}}const xt={second:1,minute:60,hour:3600,day:86400,week:604800,month:2592e3,year:31536e3},bt={a:e=>e.getHours()<12?"am":"pm",yyyy:e=>`${e.getFullYear()}`,MMM:e=>`${e.toLocaleString("default",{month:"short"})}`,MM:e=>`${e.getMonth()+1}`.padStart(2,"0"),M:e=>`${e.getMonth()+1}`,dd:e=>`${e.getDate()}`.padStart(2,"0"),d:e=>`${e.getDate()}`,H:e=>`${e.getHours()>12?e.getHours()-12:e.getHours()}`,HH:e=>`${e.getHours()>12?e.getHours()-12:e.getHours()}`.padStart(2,"0"),hh:e=>`${e.getHours()}`.padStart(2,"0"),h:e=>`${e.getHours()}`,mm:e=>`${e.getMinutes()}`.padStart(2,"0")},wt=e=>new Date(e.getTime()+60*e.getTimezoneOffset()*1e3),_t=/^\d{4}-(?:0[1-9]|1[0-2])-(?:[0-2][1-9]|[1-3]0|3[01])T(?:[01]\d|2[0-3])(?::[0-6]\d){1,2}(?:\.\d{3})?(?:[+-][0-2]\d:[0-5]\d|Z)?$/,Mt=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(ke(e)&&_t.test(e))return(e=>{const t=e.split(/\D+/),i=e.includes("+")?-1:1;return new Date(Date.UTC(+t[0],+t[1]-1,+t[2],+t[3]+i*(+t[7]||0),+t[4]+i*(+t[8]||0),+t[5],+t[6]||0))})(e);if(ke(e)||qe(e)){const i=new Date(e);return t?wt(i):i}return mt(e)?e:null},At=function(){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map((t=>Mt(t,e))).sort(((e,t)=>e.getTime()<t.getTime()?-1:1)).filter(Boolean)},St=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=e;if(t.endsWith("iso"))return i.toISOString();if(t.startsWith("utc:")&&(i=wt(e),t=t.replace(/^utc:/,"")),"epoch"===t)return`${i.getTime()}`;const r=t.match(/^format\[([\w ,/:-]+)]/g);if(r&&r.length>0){let e=r[0].replace(/^format\[/,"").replace(/]$/,"");const a=[];let s=t;return Object.keys(bt).forEach((e=>{s.includes(e)&&(a.push(e),s=s.replaceAll(e,""))})),a.forEach((t=>{const r=bt[t];e=e.replace(new RegExp(t),r(i))})),e}return e.toString()},Tt=(e,t)=>{if("now"===t)return e;const i=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=0;if(qe(e))return t;const i=e.match(/[\d.-]+\s*\w+/g);return i&&i.length>0&&i.forEach((e=>{const i=e.match(/^([\d.-]+)\s*(\w+)$/);if(i&&i.length>=3){const e=Number.parseFloat(i[1]),r=(i[2]||"").replace(/s$/,"");t+=e*(xt[r]||0)}})),t}(t),r=e.getTime()+1e3*i;return new Date(r)};let Et=1;const Ot=e=>{const t=new Map;return function(){for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];const s=r.map((e=>`${e}_${typeof e}`)).join("|");if(t.has(s))return t.get(s);const n=e(...r);return t.set(s,n),n}},Ct=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e=e.replace(/{s::([^}]+)}/,((e,t)=>{const i=t.split(",");return i[Math.round(Math.random()*(i.length-1))]})),e=e.replace(/{time::([^}]+)}/,((e,i)=>{const r=i;return St(t.time||new Date,r)})),Object.keys(t).forEach((i=>{e=e.replaceAll(new RegExp(`{${i}}`,"g"),`${t[i]}`)})),e=e.replaceAll(/{[^}]+}/g,""),e},Rt=e=>{if(e.status>=200&&e.status<=299)return e;if(401===e.status)throw new vt(e.statusText);if(404!==e.status){if(e.status>=500)throw new Error(e.statusText);return e}},Pt=(e,t)=>Object.keys(e).filter((i=>t(e[i],i))).reduce(((t,i)=>(t[i]=e[i],t)),{}),kt=new Set;var Dt=function(e,t,i,r){return new(i||(i=Promise))((function(a,s){function n(e){try{l(r.next(e))}catch(e){s(e)}}function o(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,o)}l((r=r.apply(e,t||[])).next())}))};class zt{get requests(){return this._requests}constructor(e,t){this.config={server:"https://api.aerisapi.com",client:{id:void 0,secret:void 0}},this._params={endpoint:void 0},this._requests=[],this._paramKeys=["p","limit","radius","filter","fields","query","sort","skip","from","to","plimit","psort","pskip","callback","metric","requests","lang","format","mindist","pfilter","lod","mindist"],this._requestKeys=[],this.config=lt({},this.config,e),this._range={},t&&this.setParams(t)}param(e,t){return he(t)?(this._paramKeys.includes(e)&&pt(this._params,e,t),this):ut(this._params,e)}getParams(){return lt({},this._params)}setParams(e){if(le(e))return this;const t=Object.keys(e).filter((e=>this._paramKeys.includes(e))).reduce(((t,i)=>(t[i]=e[i],t)),{});return this._params=lt({},this._params,t),this}resetParams(){return this._params={endpoint:this._endpoint},this}endpoint(e){return this._endpoint=e,this.param("endpoint",e),this}getEndpoint(){return this._endpoint}action(e){return this._action=e,this}getAction(){return this._action}place(e){return this.param("p",e),this}bounds(e){if(ke(e)){const t=e;if(/,/.test(t)){const i=t.split(",").map((e=>Number.parseFloat(e)));4===i.length&&(e={north:i[0],west:i[1],south:i[2],east:i[3]})}}return this.place(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if(!e||0===Object.keys(e).length)return null;const i=Object.assign({},e);return i.north=Math.min(90,Math.max(-90,i.north)),i.south=Math.min(90,Math.max(-90,i.south)),(i.west<-180||i.west>180)&&(i.west-=360*Math.floor(i.west/360)),(i.east<-180||i.east>180)&&(i.east-=360*Math.ceil(i.east/360)),`${i.north.toFixed(t)},${i.west.toFixed(t)},${i.south.toFixed(t)},${i.east.toFixed(t)}`}(e))}limit(e){return this.param("limit",e),this}lod(e){return this.param("lod",e),this}mindist(e){return qe(e)&&(e=`${e}mi`),this.param("mindist",e),this}radius(e){return this.param("radius",e),this}filter(e){return this.param("filter",e),this}fields(e){return this.param("fields",e),this}query(e){return e instanceof gt&&(e=e.toString()),this.param("query",e),this}sort(e){return this.param("sort",e),this}skip(e){return this.param("skip",e),this}from(e){if(mt(e)){const t=e;if(Math.abs(t.getTime()-Date.now())<6e4)return this.param("from","now"),this;e=t.toISOString(),this._range.from=t}return this.param("from",e),this}to(e){if(mt(e)){const t=e;if(Math.abs(t.getTime()-Date.now())<6e4)return this.param("to","now"),this;e=t.toISOString(),this._range.to=t}return this.param("to",e),this}plimit(e){return this.param("plimit",e),this}psort(e){return this.param("psort",e),this}pskip(e){return this.param("pskip",e),this}format(e){return this.param("format",e),this}route(e){return this._route=e,this}addRequest(e){const t=e.url();let i=!this._requests.includes(e);return i&&this._requestKeys.forEach((e=>{t===e&&(i=!1)})),i&&(this._requestKeys.push(t),this._requests.push(e)),this}removeRequest(e){const t=this._requests.indexOf(e);return t>=0&&this._requests.splice(t,1),this}removeAllRequests(){this._requests=[]}get(e){return new Promise(((t,i)=>Dt(this,void 0,void 0,(function*(){var i;try{null===(i=this._request)||void 0===i||i.abort(),this._request=new AbortController;const r="route"===this._action?"POST":"GET",a={},s=yield fetch(this.url(),{method:r,body:"route"===this._action?JSON.stringify(this._route):void 0,headers:a,signal:this._request.signal}).then((e=>Dt(this,void 0,void 0,(function*(){const t=yield e.json();return{status:e.status,data:t}}))));if(s){const i=(e=>{const t=e&&e.data?e.data:{};let i=t.error;return!i||"warn_no_data"!==i.code&&"warn_invalid_param"!==i.code&&"invalid_location"!==i.code||(i=null),new ft(e,t.response||t,i,null)})(s);e&&e(i),t(i)}}catch(e){console.error("ApiRequest Error",e),t(new ft(null,null,e,null))}}))))}cancel(){var e;null===(e=this._request)||void 0===e||e.abort()}url(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=e?"":this.config.server;const i=lt({},Pt(this._params,(e=>!ge(e))),e?{}:{client_id:this.config.client.id,client_secret:this.config.client.secret});if(this._requests.length>0){t+="/batch";const e=[];this._requests.forEach((t=>{e.push(t.url(!0))})),i.requests=e.join(",")}else{if(!this._endpoint)throw new Error("Invalid ApiRequest - No endpoint specified");t+=`/${this._endpoint}`,this._action&&":id"!==this._action&&":all"!==this._action?t+=`/${this._action}`:i.p&&(t+=`/${encodeURIComponent(i.p)}`,delete i.p)}const r=Object.keys(i).filter((e=>"endpoint"!==e)).map((e=>`${encodeURIComponent(e)}=${encodeURIComponent(i[e])}`)).join("&");return r.length>0&&(t+=`?${r}`),t}clone(){const e=new zt(this.config);return e.setParams(this._params),e}}const It=zt,Ft=class extends dt{constructor(e,t){super(),this.loading=!1,this.id=e,this.secret=t,this.get()}get(){return new Promise(((e,t)=>{this.hasLoaded()?e(lt({},this.permissions)):this.loading?this.on("load:done",(()=>{e(lt({},this.permissions))})):(this.loading=!0,this.trigger("load:start"),new It({client:{id:this.id,secret:this.secret}}).endpoint("oauth2/permissions").get().then((t=>{this.loading=!1,t.data&&(this.permissions=t.data,this.cached=new Date),e(lt({},this.permissions)),this.trigger("load:done")})))}))}isLoading(){return this.loading}hasLoaded(){return null!=this.permissions}canAccess(e){const t=ut(this.permissions,e);return!!t&&t.allow}},Lt=class{constructor(e){let t,i,r,a;ze(e)&&(t=e["x-aeris-valid-date"],i=e["x-aeris-min-valid-date"],r=e["x-aeris-max-valid-date"],a=e["x-aeris-run-date"]),t&&(this.validDate=new Date(t)),i&&(this.minValidDate=new Date(i)),r&&(this.maxValidDate=new Date(r)),a&&(this.runDate=new Date(a))}},jt=class{constructor(e,t,i,r=null){this.response=e,this.image=t,this.error=i,this.params=r,e&&e.headers&&(this.metadata=new Lt(e.headers))}headers(){return this.response?this.response.headers:void 0}},Nt=class{constructor(e){this._opts={alpha:100,darkStyle:!1,text:!1,largeText:!1,metric:!1,blendMode:void 0,blur:0,filters:[],mask:void 0,includeText:!1},this._opts.darkStyle=/-dk/.test(e),this._opts.text=/-text/.test(e),this._opts.largeText=/-lg/.test(e),this.code=e.replace(/-(dk|text|lg)/,"").replace(/:.+$/,"")}opt(e,t){return t?(pt(this._opts,e,t),this):ut(this._opts,e)}options(e){return e&&(this._opts=e),this._opts}alpha(e){return this.opt("alpha",e),this}darkStyle(e){return this.opt("darkStyle",e),this}text(e){return this.opt("text",e),this}includeText(e){return this.opt("includeText",e),this}largeText(e){return this.opt("largeText",e),this}metric(e){return this.opt("metric",e),this}blendMode(e){return this.opt("blendMode",e),this}blur(e){return this.opt("blur",e),this}mask(e){return this.opt("mask",e),this}addFilter(e){return this._opts.filters.push(e),this}removeFilter(e){const t=this._opts.filters.indexOf(e);return-1!==t&&this._opts.filters.splice(t,1),this}removeAllFilters(){return this._opts.filters=[],this}toString(){const e=this._opts;let t,i=this.code;return(e.includeText||e.text)&&(t=`${i}-text`,e.metric&&(t=`${t}-metric`),e.largeText&&(t=`${t}-lg`),e.text&&(i=t)),e.darkStyle&&(i=`${i}-dk`),e.alpha<100&&(i=`${i}:${e.alpha}`),e.blur>0&&(i=`${i}:blur(${e.blur})`),e.blendMode&&(i=`${i}:blend(${e.blendMode})`),e.filters.length>0&&(i=`${i}:${e.filters.join(":")})`),e.includeText&&t&&(i=`${i},${t}`),i}},Ut=e=>(e||"").replace(/\s/,"").split(","),Vt=e=>ge(e)?[]:Array.isArray(e)?e.map((e=>e instanceof Nt?e.toString():e)):Ut(e),Bt=e=>(Object.keys(e).forEach((t=>{const i=e[t];if("layers"===t)ze(i)?Object.keys(i).forEach((e=>{i[e]=Vt(i[e])})):e[t]=Vt(i);else if("p"===t&&ze(e[t])){const{lat:i,lon:r}=e[t];i&&r&&(e[t]=`${i},${r}`)}})),e);class $t{constructor(e,t){this.config={server:"https://maps.aerisapi.com",client:{id:void 0,secret:void 0}},this._params={type:"image",layers:{base:void 0,data:void 0,overlays:void 0,text:void 0},p:void 0,zoom:3,bounds:void 0,size:{width:void 0,height:void 0},offset:"0",metric:!1,format:"png"},this._serverRange=[1,2,3,4],this._paramKeys=["type","layers","layers.base","layers.data","layers.overlays","layers.text","p","center","zoom","bounds","size","size.width","size.height","offset","metric","format","suffix"],this.config=lt(this.config,e),t&&this.setParams(t)}param(e,t){return t?(this._paramKeys.includes(e)&&(pt(this._params,e,t),e.startsWith("layers")&&(this._params=Bt(this._params))),this):ut(this._params,e)}setParams(e){return this._params=Bt(lt(this._params,e)),this}type(e){return this.param("type",e),this}base(e){return this.param("layers.base",Vt(e)),this}data(e){return this.param("layers.data",Vt(e)),this}overlays(e){return this.param("layers.overlays",Vt(e)),this}text(e){return this.param("layers.text",Vt(e)),this}layers(e){return this.param("layers",Vt(e)),this}place(e){return this.param("p",e),this}center(e){if(ze(e)){const{lat:t,lon:i}=e;t&&i&&(e=`${t},${i}`)}return this.param("p",e),this}zoom(e){return this.param("zoom",e),this}bounds(e){return this.param("bounds",e),this}size(e,t){return this.param("size",{width:e,height:t}),this}offset(e){return this.param("offset",`${e}`),this}suffix(e){return this.param("suffix",e),this}date(e){e=new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes());const t=new Date(e.getTime()+60*e.getTimezoneOffset()*1e3),i=[`${t.getFullYear()}`,`${t.getMonth()+1}`.padStart(2,"0"),`${t.getDate()}`.padStart(2,"0"),`${t.getHours()}`.padStart(2,"0"),`${t.getMinutes()}`.padStart(2,"0"),"00"].join("");return this.offset(i)}metric(e){return e?(this.param("metric",e),this):this.param("metric")}range(e){return e?(this._serverRange=[...e],this):this._serverRange}get(e){return t=this,void 0,r=function*(){try{const t=this.url();if(!t){const t=new jt(null,null,new Error("Invalid map url"),this._params);return e&&e(t),t}const i=yield fetch(t,{method:"GET",signal:this._request.signal}).then((e=>{const t=e.json();return{status:e.status,data:t}}));let r,a;i.status>=400?(a=(yield i.data).error,!a||"warn_no_data"!==a.code&&"warn_invalid_param"!==a.code&&"invalid_location"!==a.code||(a=null)):(r=new Image,r.src=t.includes(this.config.server)?t:`${this.config.server}/${t}`);const s=new jt(i,r,a,this._params);return e&&e(s),s}catch(e){console.error("MapRequest Error",e)}return null},new((i=void 0)||(i=Promise))((function(e,a){function s(e){try{o(r.next(e))}catch(e){a(e)}}function n(e){try{o(r.throw(e))}catch(e){a(e)}}function o(t){var r;t.done?e(t.value):(r=t.value,r instanceof i?r:new i((function(e){e(r)}))).then(s,n)}o((r=r.apply(t,[])).next())}));var t,i,r}url(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=this.config.server;const i=lt({},Pt(this._params,(e=>!ge(e))),{layers:[]});ke(i.p)&&(i.p=i.p.replace(/\+/,"%20"));const r=this._params.layers;if(ze(r)){const t=r;e=ge(e)?Object.keys(t):e,ge(e)||e.forEach((e=>{let r=t[e];ge(r)||(Array.isArray(r)||(r=Ut(r)),i.layers=[...i.layers,...r])}))}else Array.isArray(r)&&(i.layers=r);if(!ge(i.layers)){if(i.offset=i.offset||"{time}","tile"===i.type)ge(this._serverRange)||(t=t.replace(/maps\./,"maps{s}.")),t+=`/${this.config.client.id}_${this.config.client.secret}/${i.layers}/{z}/{x}/{y}/${i.offset}${i.suffix||""}.${i.format}`;else{if((ge(i.p)||":auto"===i.p)&&ge(i.bounds))return void console.warn(`No valid location or bounds provided for the map - p: ${i.p}; bounds: ${i.bounds}`);const e=i.bounds;i.loc=ge(e)?`${i.p},${i.zoom}`:`${e.south},${e.west},${e.north},${e.east}`,t+=`/${this.config.client.id}_${this.config.client.secret}/${i.layers}/${i.size.width}x${i.size.height}/${i.loc}/${i.offset}${i.suffix||""}.${i.format}`}return t}e.length>1&&console.warn(`No map layers specified - layers: ${i.layers}; groups: ${e.join(",")}`)}clone(){const e=new $t(this.config);return e.setParams(this._params),e}}const qt=$t,Gt={api:"https://api.aerisapi.com",maps:"https://maps.aerisapi.com"},Ht=class{constructor(e,t,i={}){this.id=e,this.secret=t,this.servers=Object.assign(Object.assign({},Gt),i),this._permissions=new Ft(e,t)}credentials(){return{id:this.id,secret:this.secret}}permissions(){return this._permissions}canAccess(e){return this.permissions().canAccess(e)}api(){return new It(lt({},{server:this.servers.api,client:{id:this.id,secret:this.secret}},arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}))}map(){return new qt(lt({},{server:this.servers.maps,client:{id:this.id,secret:this.secret}},arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}))}},Wt={},Yt=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"id";Wt[e]=Wt[e]||1;const t=Wt[e];return Wt[e]+=1,`${e}-${t}`},Zt=function(e){if(!e)throw new Error(`Assert failed: ${(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||""}`)},Xt=e=>{const t=e.match(/#define[\s*]SHADER_NAME[\s*]([\w-]+)[\s*]/);return t?t[1]:"unnamed"},Qt=(e,t)=>{switch(t){case e.FRAGMENT_SHADER:return"fragment";case e.VERTEX_SHADER:return"vertex";default:return"unknown type"}},Kt=(e,t)=>void 0!==t&&(e&t)===t,Jt=e=>"function"===fe(e),ei={temperature:{title:"Temperature",fn:e=>`${e.toFixed(2)}&deg;C, ${d(e).toFixed(2)}&deg;F`},temperature_change:{title:"Temp Change",fn:e=>{const t=e>0?"+":"";return`${t}${e.toFixed(2)}&deg;C, ${t}${I(e).toFixed(2)}&deg;F`}},winds:{title:"Winds",fn:e=>{if(Number.isNaN(null==e?void 0:e.value))return;const t=e.value;return`${V(e.angle-180)} ${g(t).toFixed(1)} kph, ${v(t).toFixed(1)} mph`}},wind_gusts:{title:"Wind Gusts",fn:e=>`${g(e).toFixed(1)} kph, ${v(e).toFixed(1)} mph`},humidity:{title:"Humidity",fn:e=>`${Math.round(e)}%`},pressure_msl:{title:"Surface Pressure",fn:e=>`${e.toFixed(1)} mb, ${x(e).toFixed(2)} in`},visibility:{title:"Visibility",fn:e=>`${_(e).toFixed(1)} km, ${S(e).toFixed(1)} mi`},wave_height:{title:"Wave Height",fn:e=>`${e.toFixed(1)} m, ${M(e).toFixed(1)} ft`},angle:{title:"Direction",fn:e=>`${V(e-180)}`},angle_reversed:{title:"Direction",fn:e=>{let t=e-180-180;return t<0&&(t+=360),`${V(t)}`}},period:{title:"Period",fn:e=>`${Math.round(e)} sec`},height_change:{title:"Height Change",fn:e=>{const t=e>0?"+":"";return`${t}${e.toFixed(2)} m, ${t}${M(e).toFixed(1)} ft`}},radar:{title:"Radar",fn:e=>{if(e<5)return"";let t="Very Light";return e>=60?t="Extreme/Hail":e>=55?t="Intense":e>=45?t="Heavy":e>=35?t="Moderate":e>=25&&(t="Light"),`${t}: ${e.toFixed(2)} dbz`}},accum_precip:{title:"Accum Precip",fn:e=>{const t=3600*e;return`${t.toFixed(1)} mm, ${R(t).toFixed(2)} in`}}},ti=ei,ii={code:"weather-surface_TMP_2-HTGL",measurement:{type:"temperature",units:o.temperature.C},dataRange:{min:-62.22,max:54.44}},ri={code:{u:"weather-surface_UGRD_10-HTGL",v:"weather-surface_VGRD_10-HTGL"},measurement:{type:"speed",units:o.speed.ms},dataRange:{min:-53.64,max:53.64}},ai=Object.assign(Object.assign({},ri),{code:"weather-surface_GUST_10-HTGL",dataRange:{min:0,max:53.64}}),si={code:"weather-surface_DPT_2-HTGL",measurement:{type:"temperature",units:o.temperature.C},dataRange:{min:-84.44,max:32.22}},ni={code:"weather-surface_RH_2-HTGL",measurement:{type:"ratio",units:o.ratio.percent},dataRange:{min:0,max:100}},oi=Object.assign(Object.assign({},ii),{code:"weather-surface_APTMP_2-HTGL"}),li={code:"weather-surface_PRMSL_0-MSL",measurement:{type:"pressure",units:o.pressure.mb},dataRange:{min:950,max:1060}},hi={code:"weather-surface_VIS_0-SFC",measurement:{type:"distance",units:o.distance.m},dataRange:{min:0,max:C(10)}},ci={code:"weather-surface_TCDC_0-SFC",measurement:{type:"ratio",units:o.ratio.percent},dataRange:{min:0,max:100}},di={code:"weather-surface_PTYPE_0-SFC",measurement:void 0,dataRange:{min:0,max:255}},ui={code:"weather-surface_PRATE_0-SFC",measurement:{type:"rate",units:o.rate.mms},dataRange:{min:0,max:D(30)}},pi={code:"forecast_SNOD_0-SFC",measurement:{type:"snowfall",units:o.distance.m},dataRange:{min:0,max:7.9248}},mi={code:"conditions_UVI_0-SFC",measurement:void 0,dataRange:{min:0,max:12}},fi={dbz:{code:"radar-composite_REFC_0-SFC",measurement:{type:"intensity",units:o.rate.dbz},dataRange:{min:0,max:87}},precipRate:{code:"radar-composite_PRATE_0-SFC",measurement:void 0,dataRange:{min:0,max:U(65,!0)}},precipType:{code:"radar-composite_PTYPESMPL_0-SFC",measurement:void 0,dataRange:{min:0,max:255}}},gi=(Object.assign(Object.assign({},fi.dbz),{code:"nowcast-composite_REFC_0-SFC"}),Object.assign(Object.assign({},fi.precipRate),{code:"nowcast-composite_PRATE_0-SFC"}),Object.assign(Object.assign({},fi.precipType),{code:"nowcast-composite_PTYPESMPL_0-SFC"}),{dbz:Object.assign(Object.assign({},fi.dbz),{code:"precip_REFC_0-SFC"}),precipType:Object.assign(Object.assign({},fi.precipType),{code:"precip_PTYPESMPL_0-SFC"}),dbzArchive:Object.assign({},fi.dbz)}),vi={aqiAirNow:{code:"air-quality_AQI-AirNow_0-SFC",measurement:void 0,dataRange:{min:0,max:500}},aqiHealthIndex:{code:"air-quality_AQHI-Canada_0-SFC",measurement:void 0,dataRange:{min:0,max:20}},aqiChina:{code:"air-quality_AQI-China_0-SFC",measurement:void 0,dataRange:{min:0,max:500}},aqiIndia:{code:"air-quality_AQI-India_0-SFC",measurement:void 0,dataRange:{min:0,max:500}},aqiEAQI:{code:"air-quality_AQI-EAQI_0-SFC",measurement:void 0,dataRange:{min:0,max:150}},aqiCAI:{code:"air-quality_AQI-CAI_0-SFC",measurement:void 0,dataRange:{min:0,max:500}},aqiCAQI:{code:"air-quality_AQI-CAQI_0-SFC",measurement:void 0,dataRange:{min:0,max:200}},aqiUbaDAQI:{code:"air-quality_AQI-UBA-DAQI_0-SFC",measurement:void 0,dataRange:{min:0,max:125}},aqiUkDAQI:{code:"air-quality_AQI-UK-DAQI_0-SFC",measurement:void 0,dataRange:{min:0,max:10}},co:{code:"air-quality_CO_0-SFC",measurement:{type:"concentration",units:o.concentration.ugm3},dataRange:{min:0,max:1e3}},no:{code:"air-quality_NO_0-SFC",measurement:{type:"concentration",units:o.concentration.ugm3},dataRange:{min:0,max:100}},no2:{code:"air-quality_NO2_0-SFC",measurement:{type:"concentration",units:o.concentration.ugm3},dataRange:{min:0,max:100}},o3:{code:"air-quality_O3_0-SFC",measurement:{type:"concentration",units:o.concentration.ugm3},dataRange:{min:0,max:300}},pm2p5:{code:"air-quality_PM2P5_0-SFC",measurement:{type:"concentration",units:o.concentration.ugm3},dataRange:{min:0,max:300}},pm10:{code:"air-quality_PM10_0-SFC",measurement:{type:"concentration",units:o.concentration.ugm3},dataRange:{min:0,max:1e3}},so2:{code:"air-quality_SO2_0-SFC",measurement:{type:"concentration",units:o.concentration.ugm3},dataRange:{min:0,max:100}}},yi={height:{measurement:{type:"height",units:o.distance.m},dataRange:{min:0,max:15},noData:0},direction:{measurement:{type:"direction",units:o.direction.deg},dataRange:{min:0,max:359},noData:0},period:{measurement:{type:"time",units:o.time.sec},dataRange:{min:0,max:24},noData:0}},xi={waveHeight:Object.assign({code:"marine_HTSGW_0-SFC"},yi.height),waveDir:Object.assign({code:"marine_DIRPW_0-SFC"},yi.direction),wavePeriod:Object.assign({code:"marine_PERPW_0-SFC"},yi.period),swellHeightPrimary:Object.assign({code:"marine_SWELL_1-SEQ"},yi.height),swellPeriodPrimary:Object.assign({code:"marine_SWPER_1-SEQ"},yi.period),swellDirPrimary:Object.assign({code:"marine_SWDIR_1-SEQ"},yi.direction),swellHeightSecondary:Object.assign({code:"marine_SWELL_2-SEQ"},yi.height),swellPeriodSecondary:Object.assign({code:"marine_SWPER_2-SEQ"},yi.period),swellDirSecondary:Object.assign({code:"marine_SWDIR_2-SEQ"},yi.direction),swellHeightTertiary:Object.assign({code:"marine_SWELL_3-SEQ"},yi.height),swellPeriodTertiary:Object.assign({code:"marine_SWPER_3-SEQ"},yi.period),swellDirTertiary:Object.assign({code:"marine_SWDIR_3-SEQ"},yi.direction),current:{code:{u:"marine_UOGRD_0-SFC",v:"marine_VOGRD_0-SFC"},measurement:{type:"speed",units:o.speed.ms},dataRange:{min:-3.0864,max:3.0864},noData:0},sst:{code:"marine_WTMP_0-SFC",measurement:{type:"temperature",units:o.temperature.C},dataRange:{min:-100,max:100},noData:0},surge:{code:"marine_SURGE_0-SFC",measurement:{type:"height",units:o.distance.m},dataRange:{min:0,max:5},noData:0},tide:{code:"marine_TIDE_0-SFC",measurement:{type:"height",units:o.distance.m},dataRange:{min:-12.192,max:12.192},noData:0}},bi={summary:{code:"roadSeverity_0-SFC",measurement:void 0,dataRange:{min:0,max:0}},surface:{code:"roadCondition_0-SFC",measurement:void 0,dataRange:{min:0,max:0}},temperature:{code:"roadTemperature_0-SFC",measurement:{type:"temperature",units:o.temperature.C},dataRange:{min:-62.22,max:54.44}},temperatureFreeze:{code:"roadTemperature_0-SFC",measurement:{type:"temperature",units:o.temperature.C},dataRange:{min:-62.22,max:54.44}},riskRollover:{code:"roadRiskRollover_0-SFC",measurement:void 0,dataRange:{min:0,max:0}},riskHydroplane:{code:"hydroplaneRisk_0-SFC",measurement:void 0,dataRange:{min:0,max:0}},riskLowVizSnow:{code:"roadRiskSnow_0-SFC",measurement:void 0,dataRange:{min:0,max:0}},riskLowVizFog:{code:"roadRiskFog_0-SFC",measurement:void 0,dataRange:{min:0,max:0}}},wi={bar:{height:14,rounded:!0,labels:{every:10,placement:"middle",marks:"none"}},text:{color:"#fff",stroke:{color:"#000",width:1},shadow:{color:"#000"}}},_i={points:{radius:4}},Mi=(e,t,i)=>B("temperature",e,t,i),Ai=(e,t,i)=>B("temperature-change",e,t,i),Si=(e,t,i)=>B("speed",e,t,i),Ti=(e,t,i)=>B("pressure",e,t,i),Ei=(e,t,i)=>B("precipitation",e,t,i),Oi=(e,t,i)=>B("distance",e,t,i),Ci=(e,t)=>(t.type="bar",t.title=e,lt({},wi,t)),Ri=(e,t)=>(t.type="point",t.title=e,lt({},_i,t));var Pi,ki;!function(e){e.raster="raster",e.circle="circle",e.fill="fill",e.line="line",e.sample="sample",e.grid="grid",e.heatmap="heatmap",e.contour="contour",e.particle="particle",e.particles="particles",e.symbol="symbol",e.text="text",e.query="query",e.voronoi="voronoi",e.data="data",e.debug="debug"}(Pi||(Pi={})),function(e){e.exact="exact",e.high="high",e.medium="medium",e.normal="normal",e.low="low",e.minimal="minimal"}(ki||(ki={}));const Di=class{constructor(e){this.variables=e}formattedForRequest(){return this.variables.reduce(((e,t)=>{var i,r;const a={dataMin:t.dataRange.min,dataMax:t.dataRange.max,noData:t.noData,outputMin:null===(i=t.outputRange)||void 0===i?void 0:i.min,outputMax:null===(r=t.outputRange)||void 0===r?void 0:r.max,timeOffset:t.timeOffset};return"string"==typeof t.code?e.push(Object.assign({id:t.code},a)):e.push(Object.assign({id:t.code.u},a),Object.assign({id:t.code.v},a)),e}),[])}},zi="https://{s::a-,b-,c-,d-}prod.v1.mapsgl.api.xweather.com",Ii=9999,Fi={us:{north:49.5904,south:24.9493,west:-125.0011,east:-66.9326},europe:{north:75.7433,south:35.2634,west:-12.7357,east:41.8283},japan:{north:45.850936,south:29.670306,west:127.275892,east:151.1554},australia:{north:-9.14218,south:-43.7405,west:112.9211,east:153.6383},new_zealand:{north:-34,south:-47,west:166,east:179}};var Li,ji;!function(e){e.point="point",e.line="line",e.polygon="polygon",e.symbol="symbol"}(Li||(Li={})),function(e){e.raster="raster",e.vector="vector",e.geojson="geojson",e.encoded="encoded",e.debug="debug"}(ji||(ji={}));const Ni=(e,t,i=!1)=>{let r;return function(...a){const s=this,n=i&&void 0===r;void 0!==r&&clearTimeout(r),r=setTimeout((()=>{r=void 0,i||e.apply(s,a)}),t),n&&e.apply(s,a)}},Ui={PLAY:"play",PAUSE:"pause",RESUME:"resume",STOP:"stop",END:"end",RESTART:"restart",RESET:"reset",ADVANCE:"advance",RANGE_CHANGE:"range:change",TIMELINE_CHANGE:"timeline:change"},Vi={PLAY:"play",STOP:"stop",ADVANCE:"advance",INTERVAL_ADVANCE:"interval:advance",DATA_ADVANCE:"data:advance",DATA_CHANGE:"data:change",DATA_REQUEST:"data:request",DATA_READY:"data:ready",DATA_REMOVE:"data:remove",LOAD_START:"load:start",LOAD_COMPLETE:"load:complete",LOAD_INTERVAL:"load:interval",INTERVALS_CHANGE:"intervals:change",INVALIDATE:"invalidate"};var Bi,$i,qi,Gi,Hi,Wi=function(e,t,i,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,i):a?a.value=i:t.set(e,i),i},Yi=function(e,t,i,r){if("a"===i&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?r:"a"===i?r.call(e):r?r.value:t.get(e)};const Zi=()=>("undefined"==typeof performance?Date:performance).now();Bi=new WeakMap,$i=new WeakMap,qi=new WeakMap,Gi=new WeakMap,Hi=new WeakMap;const Xi=class{constructor(e=!0){Bi.set(this,0),$i.set(this,0),qi.set(this,0),Gi.set(this,!1),Hi.set(this,!1),Wi(this,Hi,e,"f")}start(){Yi(this,Gi,"f")||(this.reset(),Wi(this,Gi,!0,"f"))}stop(){this.getElapsedTime(),Wi(this,Gi,!1,"f"),Wi(this,Hi,!1,"f")}reset(){Wi(this,Bi,Zi(),"f"),Wi(this,$i,Yi(this,Bi,"f"),"f"),Wi(this,qi,0,"f")}getElapsedTime(){return this.getDelta(),Yi(this,qi,"f")}getDelta(){let e=0;if(Yi(this,Hi,"f")&&!Yi(this,Gi,"f"))return this.start(),0;if(Yi(this,Gi,"f")){const t=Zi();e=(t-Yi(this,$i,"f"))/1e3,Wi(this,$i,t,"f"),Wi(this,qi,Yi(this,qi,"f")+e,"f")}return e}},Qi=class{get elapsedTime(){return this._clock.getElapsedTime()}constructor(e,t=!0){this._clock=new Xi,this._running=!1,this._callback=()=>{const t=this._clock.getElapsedTime();e&&e(t)},t&&this.start()}start(){this.stop(),this._running=!0,this._clock.start(),this.tick()}stop(){this._running=!1,this._clock.stop(),this._handle>=0&&cancelAnimationFrame(this._handle),this._handle=-1}dispose(){this.stop(),this._callback=void 0}tick(){this._handle=requestAnimationFrame((()=>{this._running&&this.tick()})),this._callback&&this._callback()}},Ki=new class{constructor(){this._animations=new Set,this._loop=new Qi(this._tick.bind(this))}add(e){this._animations.has(e)||(this._animations.add(e),this._loop.start())}remove(e){this._animations.has(e)&&this._animations.delete(e),0===this._animations.size&&this._loop.stop()}_tick(e){this._animations.forEach((t=>{t.tick(e)}))}};var Ji,er=function(e,t,i,r){if("a"===i&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?r:"a"===i?r.call(e):r?r.value:t.get(e)},tr=function(e,t,i,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,i):a?a.value=i:t.set(e,i),i};class ir extends dt{get value(){return er(this,Ji,"f")}constructor(e){super(),Ji.set(this,void 0),tr(this,Ji,Object.assign({},e),"f")}get(e,t){return ut(er(this,Ji,"f"),e,t)}setState(e,t){if("string"==typeof e){const i=e;pt(er(this,Ji,"f"),i,t),this.trigger(ir.Events.UPDATE_KEY,{key:e,value:t})}else tr(this,Ji,lt({},er(this,Ji,"f"),e),"f");this.trigger(ir.Events.UPDATE,Object.assign({},er(this,Ji,"f")))}}Ji=new WeakMap,ir.Events={UPDATE:"update",UPDATE_KEY:"key:update"};const rr=ir;var ar;!function(e){e.initial="initial",e.loading="loading",e.ready="ready",e.playing="playing",e.paused="paused",e.stopped="stopped",e.completed="completed"}(ar||(ar={}));const sr={id:void 0,enabled:!0,autoplay:!1,duration:1,delay:0,endDelay:0,timeScale:1,repeat:!0,manualAdvance:!1},nr=class extends dt{get id(){return this._config.value.id}get config(){return this._config}get state(){return this._state}get enabled(){return this._enabled}get duration(){return this._config.value.duration}set duration(e){this._config.setState({duration:e})}get delay(){return this._config.value.delay}set delay(e){this._config.setState({delay:e})}get endDelay(){return this._config.value.endDelay}set endDelay(e){this._config.setState({endDelay:e})}get timeScale(){return this._config.value.timeScale}set timeScale(e){if(e<=0)throw new Error("[MapsGL] Animation time scale must be greater than zero.");this._config.setState({timeScale:Math.max(0,e)})}get totalDuration(){return this.delay+this.duration+this.endDelay}get elapsedTime(){return this._elapsed}get position(){return this._elapsed<this.delay?0:this._elapsed>=this.delay+this.duration?1:Math.max(0,Math.min(1,(this._elapsed-this.delay)/this.duration))}get totalPosition(){return Math.max(0,Math.min(1,this._elapsed/this.totalDuration))}get isAnimating(){return this._state===ar.playing}get isPaused(){return this._state===ar.paused}get isActive(){return this.isAnimating||this.isPaused}constructor(e={}){super(),this._state=ar.initial,this._active=!1,this._enabled=!0,this._elapsed=0,this._clampedRange={min:0,max:1},this._lastElapsed=-1,this._config=new rr(Object.assign(Object.assign({},sr),e)),this._enabled=this._config.value.enabled,e.autoplay&&setTimeout((()=>{this.play()}),1e3)}play(){!this.isActive&&this.enabled&&(this._active=!0,this._state=ar.playing,this.advance(0),this.timeline||!0===this.config.value.manualAdvance||Ki.add(this),this.trigger(Ui.PLAY,this.eventPayload()))}pause(){this._state===ar.playing&&(this._state=ar.paused,this.trigger(Ui.PAUSE,this.eventPayload()))}resume(){this._state===ar.paused&&(this._state=ar.playing,this.trigger(Ui.RESUME,this.eventPayload()))}stop(){this.isActive&&(this._active=!1,this._state=ar.stopped,this.advanceToStopPosition(),this.timeline||Ki.remove(this),this.trigger(Ui.STOP,this.eventPayload()))}restart(){this._elapsed=0,this.timeline||Ki.add(this),this.trigger(Ui.RESTART)}reset(){this._state===ar.playing?this.stop():this.advanceToStopPosition(),this.trigger(Ui.RESET)}toggle(){this._active&&(this.isAnimating?this.pause():this.resume())}enable(){this._enabled=!0}disable(){this._enabled=!1}goTo(e){this.advance(e,arguments.length>1&&void 0!==arguments[1]&&arguments[1])}clampRange(e,t){if(this._clampedRange={min:Pe(e,0,1),max:Pe(t,0,1)},this._clampedRange.min>this._clampedRange.max)throw new Error("[MapsGL] Animation clamped range min must be less than max.");if(this._clampedRange.min===this._clampedRange.max)throw new Error("[MapsGL] Animation clamped range min and max cannot be equal.");this.position<this._clampedRange.min?this.advance(this._clampedRange.min,!1):this.position>this._clampedRange.max&&this.advance(this._clampedRange.max,!1)}proxyEvents(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];[Ui.PLAY,Ui.STOP,Ui.PAUSE,Ui.RESUME,Ui.RESTART,Ui.RESET,Ui.ADVANCE].filter((e=>!t.includes(e))).forEach((t=>this.on(t,(i=>{e.trigger(t,i)}))))}tick(e){this._lastElapsed<0&&(this._lastElapsed=e);const t=this._lastElapsed;if(this._lastElapsed=e,this._state!==ar.playing)return;this._elapsed+=(e-t)*this.timeScale,this._elapsed=Math.min(this._elapsed,this.totalDuration);const i=this.position,r=this.totalPosition;1===i&&this.trigger(Ui.END,this.eventPayload());const a=this._clampedRange;a.min>0&&i<=a.min||a.max<1&&i>=a.max?this.advance(this._clampedRange.min,!1):1===r?(this.advance(r),this._config.value.repeat?this.restart():this.stop()):this.advance(r)}advance(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=Pe(e,0,1);this._elapsed=t?this.totalDuration*i:this.delay+this.duration*i,this.trigger(Ui.ADVANCE,this.eventPayload())}eventPayload(){return{position:this.position,totalPosition:this.totalPosition}}advanceToStopPosition(){this.advance(0)}},or=class extends nr{get startDate(){return this._startDate}set startDate(e){this._startDate=e,this.trigger(Ui.RANGE_CHANGE,{start:this.startDate,end:this.endDate})}get endDate(){return this._endDate}set endDate(e){this._endDate=e,this.trigger(Ui.RANGE_CHANGE,{start:this.startDate,end:this.endDate})}get currentDate(){const e=this.deltaTime*this.position;return new Date(this.startDate.getTime()+e)}get referenceDate(){return this.timeline?this.timeline.referenceDate:this._now}get containsPast(){return this.startDate.getTime()-this.referenceDate.getTime()<-1e3}get containsFuture(){return this.endDate.getTime()-this.referenceDate.getTime()>1e3}get isPast(){return!1===this.containsFuture}get isFuture(){return!1===this.containsPast}get deltaTime(){return this.endDate.getTime()-this.startDate.getTime()}get info(){return{isActive:this.isActive,currentDate:this.currentDate,startDate:this.startDate,endDate:this.endDate,deltaTime:this.deltaTime}}constructor(e){var{start:t=new Date,end:i=new Date,alwaysStopAtStart:r=!1}=e;super(function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(i[r[a]]=e[r[a]])}return i}(e,["start","end","alwaysStopAtStart"])),this.alwaysStopAtStart=!1,ke(t)&&(t=Tt(new Date,t)),ke(i)&&(i=Tt(new Date,i)),this._startDate=t,this._endDate=i,this._now=new Date,this.alwaysStopAtStart=r,this.on(Ui.RANGE_CHANGE,(()=>{this.stop(),this.state===ar.stopped&&this.advanceToStopPosition()}))}setStartDateUsingOffset(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Date;this.startDate=new Date(t.getTime()+e)}setStartDateUsingRelativeTime(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Date;this.startDate=Tt(t,e)}setEndDateUsingOffset(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Date;this.endDate=new Date(t.getTime()+e)}setEndDateUsingRelativeTime(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Date;this.endDate=Tt(t,e)}goToDate(e){e.getTime()<this.startDate.getTime()?e=this.startDate:e.getTime()>this.endDate.getTime()&&(e=this.endDate);const t=(e.getTime()-this.startDate.getTime())/this.deltaTime;this.goTo(t)}goToOffset(e){this.goToDate(new Date(this.startDate.getTime()+e))}clampDateRange(e,t){this.clampRange((e.getTime()-this.startDate.getTime())/this.deltaTime,(t.getTime()-this.startDate.getTime())/this.deltaTime)}eventPayload(){return{position:this.position,date:this.currentDate}}advanceToStopPosition(){this.timeline||this.advance(this.alwaysStopAtStart?0:this.isPast?1:0)}};function lr(e,t,i){const{width:r,height:a}=e;if(i){if(i instanceof Uint8ClampedArray)i=new Uint8Array(i.buffer);else if(i.length!==r*a*t)throw new RangeError(`mismatched image size. expected: ${i.length} but got: ${r*a*t}`)}else i=new Uint8Array(r*a*t);return{width:r,height:a,data:i}}function hr(e,t,i,r,a,s,n){let o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:4;if(0===n.width||0===n.height)return t;if(n.width>e.width||n.height>e.height||i>e.width-n.width||r>e.height-n.height)throw new RangeError("out of range source coordinates for image copy");if(n.width>t.width||n.height>t.height||a>t.width-n.width||s>t.height-n.height)throw new RangeError("out of range destination coordinates for image copy");const l=e.data,h=t.data;for(let c=0;c<n.height;c++){const d=((r+c)*e.width+i)*o,u=((s+c)*t.width+a)*o;for(let e=0;e<n.width*o;e++)h[u+e]=l[d+e]}return t}const cr=class{get width(){return this.dimension+2*this.padding}get height(){return this.dimension+2*this.padding}constructor(e,t,i=0){this.stride=4,this.padding=0,this._backfilledEdges=new Set,this.padding=i,this.dimension=t;const r=Math.sqrt(e.length/this.stride),a=t+2*i;if(i>0&&r===t){const t={width:r,height:r,data:e},s=lr({width:a,height:a},this.stride);hr(t,s,0,0,i,i,{width:r,height:r}),hr(t,s,0,0,0,i,{width:i,height:r}),hr(t,s,r-i,0,i+r,i,{width:i,height:r}),hr(t,s,0,0,i,0,{width:r,height:i}),hr(t,s,0,r-i,i,i+r,{width:r,height:i}),hr(t,s,0,0,0,0,{width:i,height:i}),hr(t,s,r-i,0,i+r,0,{width:i,height:i}),hr(t,s,0,r-i,0,i+r,{width:i,height:i}),hr(t,s,r-i,r-i,i+r,i+r,{width:i,height:i}),this.rawData=s.data}else this.rawData=e}get(e,t){const i=this.rawData,r=this._idx(e,t);return{r:i[r],g:i[r+1],b:i[r+2],a:i[r+3]}}backfillEdge(e,t,i){Zt(e.dimension===this.dimension,`EncodedData mismatch - neighbor data must have the same dimension as instance data, ${this.dimension} does not equal ${e.dimension}`);const r=`${t},${i}`;if(this._backfilledEdges.has(r))return;const a=this.padding,s=this.dimension+2*a;this._backfilledEdges.add(r);let n=a,o=a,l=a,h=a,c=a,d=a;const u=s-a;-1===t?(n=u-a,l=0):1===t&&(l=u),-1===i?(o=u-a,h=0):1===i&&(h=u),0===t&&(c=s-2*a),0===i&&(d=s-2*a),hr({width:s,height:s,data:e.rawData},{width:s,height:s,data:this.rawData},n,o,l,h,{width:c,height:d}),this._backfilledEdges.add(r)}_idx(e,t){if(e<-1||e>=this.dimension+1||t<-1||t>=this.dimension+1)throw new RangeError("[MapsGL] Out of range source coordinates for image bitmap");return 4*(t*(this.dimension+2*this.padding)+e)}};class dr{constructor(e){this.index=-1,this.current=-1,this.next=-1,this.data=e}}const ur=class extends dt{get intervals(){return[...this._intervals]}get count(){return Object.keys(this.data).length}get validCount(){return Object.values(this.data).filter((e=>he(e.data))).length}get timeRange(){if(ge(this.intervals))return{start:void 0,end:void 0};const e=this.intervals[0],t=this.intervals.at(-1);return{start:new Date(e),end:new Date(t)}}get data(){return Object.assign({},this._data)}constructor(e){super(),this._data=Object.create(null),this._intervals=[],this.setData(e)}setData(e){this._data=he(e)?Object.keys(e).reduce(((t,i)=>(t[i]=new dr(e[i]),t)),Object.create(null)):Object.create(null),this._generateIntervalsFromData(),this.trigger(Vi.DATA_CHANGE)}appendData(e){Object.keys(e).sort().forEach((t=>{this._data[t]=e[t]})),this._generateIntervalsFromData(),this.trigger(Vi.DATA_CHANGE)}setDataForInterval(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=this.data[e];r?r.data=t:i?this.appendData({[e]:new dr(t)}):console.warn(`[MapsGL] Cannot set time series data for interval ${e} because it does not exist and \`createIfMissing\` is false.`),this.trigger(Vi.DATA_CHANGE)}hasDataForInterval(e){return!ye(this.data)&&he(this.dataForInterval(e))}entryForInterval(e){return this.data[e]}dataForInterval(e){return this.dataForTimeInterval(e)}dataForTimeInterval(e){var t;return null===(t=this.data[e])||void 0===t?void 0:t.data}dataAtIndex(e){var t;const i=Object.keys(this.data);if(e>-1&&e<i.length)return null===(t=this.data[i[e]])||void 0===t?void 0:t.data}intervalAtIndex(e){if(e>-1&&e<this.intervals.length)return this.intervals[e]}intervalsInRange(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.intervals.filter((r=>i?r>=e.getTime()&&r<=t.getTime():r>e.getTime()&&r<t.getTime()))}closestInterval(e){if(0===this.intervals.length)return{interval:void 0,index:-1};const t=e.getTime();let i=this.intervals[0],r=0,a=Math.abs(t-i);return this.intervals.forEach(((e,s)=>{const n=t-e;n>=0&&n<=a&&(a=n,i=e,r=s)})),{interval:i,index:r}}intervalsNeedingData(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.intervals).filter((e=>!this.hasDataForInterval(e)))}removeInterval(e){delete this._data[e],this._generateIntervalsFromData()}invalidate(){this.trigger(Vi.INVALIDATE),this._data=Object.create(null)}_generateIntervalsFromData(){this._intervals=Object.keys(this._data).map(Number).sort(((e,t)=>e-t))}};class pr{constructor(e){this.image=e}dispose(){var e;null===(e=this.texture)||void 0===e||e.dispose(),this.texture=void 0}}class mr extends pr{}class fr extends pr{}const gr=pr,vr=class{get count(){return this.series.count}get validCount(){return this.series.validCount}get validIntervals(){return this._validIntervals}constructor(e,t,i){this.index={current:-1,next:-1},this.textures={current:void 0,next:void 0},this.renderTargets={current:void 0,next:void 0},this.useLinearTextureFilter=!1,Object.keys(e).forEach((t=>{if(e[t]instanceof gr==0)throw new TypeError(`[MapsGL] Invalid data type for time series data interval ${t}`)})),this.series=new ur(e),this.size=t,this.setValidIntervals(i)}setValidIntervals(e){this._validIntervals=[...e].sort()}getData(e){return this.series.dataForTimeInterval(e)}setData(e,t){if(t instanceof gr==0)throw new TypeError("[MapsGL] Invalid data type for time series data");this.series.setDataForInterval(e,t,!0)}purgeData(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;this.series.intervals.forEach(((t,i)=>{var r;if(t!==e){const e=this.series.dataForTimeInterval(t);e&&(null===(r=e.texture)||void 0===r||r.dispose(),e.texture=void 0),this.series.setDataForInterval(t,void 0)}}))}dataAtIndex(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=this.validIntervals;if(e<0||e>=i.length)return;let r=this.series.dataForInterval(i[e]);if(he(r)||!t)return{data:r,index:e};let a=-1;return i.forEach(((t,i)=>{const s=this.series.dataForInterval(t);he(s)&&(a<0||Math.abs(i-e)<Math.abs(a-e))&&(r=s,a=i)})),{data:r,index:a}}prepareTextures(e){const t=e.gl;this.series.intervals.forEach(((i,r)=>{const a=this.series.dataForInterval(i);if((null==a?void 0:a.image)&&!a.texture){const i=a.image,r=this.useLinearTextureFilter?t.LINEAR:t.NEAREST;a.texture=e.createTexture({image:i instanceof cr?i.rawData:i,size:{width:i.width,height:i.height},minFilter:r,magFilter:r,generateMipmaps:!1})}}))}updateTextures(e,t,i){var r,a,s,n;this.prepareTextures(e);let o=!1;if(t!==this.index.current){const e=this.dataAtIndex(t,!0);if(e){const{data:t,index:i}=e;i!==this.index.current&&((null===(r=null==t?void 0:t.texture)||void 0===r?void 0:r.image)?(this.textures.current=t.texture,this.index.current=i,o=!0):(this.textures.current=void 0,this.index.current=-1))}else this.textures.current=void 0,this.index.current=-1}if(i!==this.index.next){const e=this.dataAtIndex(i,!0);if(e){const{data:t,index:i}=e;i!==this.index.next&&((null===(a=null==t?void 0:t.texture)||void 0===a?void 0:a.image)?(this.textures.next=t.texture,this.index.next=i,o=!0):(this.textures.next=void 0,this.index.next=-1))}else this.textures.next=void 0,this.index.next=-1}this.index.current>=0&&!(null===(s=this.textures.current)||void 0===s?void 0:s.image)&&(this.textures.current=void 0,this.textures.next=void 0,this.index.current=-1,this.index.next=-1),(null===(n=this.textures.next)||void 0===n?void 0:n.image)||(this.textures.next=this.textures.current,this.index.next=this.index.current)}dispose(){this.series.intervals.forEach((e=>{const t=this.series.dataForInterval(e);null==t||t.dispose()})),this.series.invalidate(),this.textures.current=void 0,this.textures.next=void 0}};class yr extends vr{constructor(){super(...arguments),this.padding=2}getPixel(e,t,i){var r;const a=null===(r=this.series.dataForTimeInterval(e))||void 0===r?void 0:r.image;if(a)return a.get(t,i)}backfillEdge(e,t,i){Object.keys(this.series.data).forEach((r=>{const a=this.series.dataForInterval(Number(r)),s=e.series.dataForInterval(Number(r));(null==a?void 0:a.image)&&(null==s?void 0:s.image)&&(a.image.backfillEdge(s.image,t,i),a.texture&&(a.texture.needsUpdate=!0))}))}serialized(){return{series:this.series.intervals.reduce(((e,t)=>{var i;return e[t]=null===(i=this.series.dataForInterval(t))||void 0===i?void 0:i.image,e}),Object.create(null)),validIntervals:this.validIntervals,size:this.size,padding:this.padding,metadata:void 0}}static fromSerialized(e){if(le(e))return void console.warn("[MapsGL] Cannot create EncodedTileData from invalid serialized data.");const t=Object.keys(e.series).reduce(((t,i)=>{const r=e.series[i];if(he(null==r?void 0:r.rawData)){const{rawData:e,dimension:a,pad:s}=r;if(xe(e)){const r=new cr(e,a,s);t[i]=new fr(r)}}return t}),Object.create(null));return new yr(t,e.size,e.validIntervals)}}const xr=yr;var br,wr,_r;!function(e){e.none="none",e.any="any",e.interval="interval"}(br||(br={})),(_r=wr||(wr={})).none="none",_r.past="past",_r.future="future",_r.range="range";const Mr=class extends dt{constructor(e,t,i={}){super(),this.enabled=!0,this.clamp=wr.none,this._debouncedLoadData=Ni((e=>{var t;null===(t=this._provider)||void 0===t||t.loadData(e)}),100),this._handleAdvanceDebounced=Ni((()=>{this._handleAdvance()}),10),this._updateEntriesStateDebounced=Ni((()=>{this._updateEntriesState()}),10),Zt(he(e),"[MapsGL] Time series animator was not initialized with a valid time series"),this.series=e;const{mode:r=wr.none,animation:a}=i,s=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(i[r[a]]=e[r[a]])}return i}(i,["mode","animation"]);this.clamp=r,this._animation=a||new or(s),this._provider=t;const n=this.animation.startDate.getTime();this._intervalState={time:{current:{interval:n,index:-1},next:{interval:n,index:-1}},data:{current:{interval:n,index:-1},next:{interval:n,index:-1}}},this._setupEvents()}get id(){return this.animation.id}get state(){if(this.provider){if(this.provider.isLoading)return ar.loading;if(this.animation.state===ar.initial&&this.hasData)return ar.ready}return this.animation.state}get position(){return this.animation.position}get relativePosition(){var e,t;const{current:{interval:i,index:r},next:{index:a}}=this._intervalState.data,s=this.series.intervals,n=s[0],o=s[a],l=null===(e=this.series.dataForInterval(s[r]))||void 0===e?void 0:e.valid,h=null===(t=this.series.dataForInterval(o))||void 0===t?void 0:t.valid;if(r===a||le(o)||!1===h)return 0;if(!l&&h)return 1;if(l&&!h)return 0;if(this.animation.currentDate.getTime()<n)return 0;const c=(this.animation.currentDate.getTime()-i)/(o-i);return Math.max(0,Math.min(1,c))}get animation(){return this._animation}get provider(){return this._provider}get currentInterval(){return Object.assign({},this._intervalState.time.current)}get totalIntervals(){return this.series.intervals.length}get timeRange(){return xe(this._timeRange)?this._timeRange:this.series.timeRange}set timeRange(e){this._timeRange=Object.assign({},e)}get info(){return this._eventPayload()}get hasData(){return ve(this.series.data)}get isEnabled(){return this.enabled}get isReady(){return this.state===ar.ready}get isAnimating(){return this.animation.isAnimating}get isPaused(){return this.animation.isPaused}get isActive(){return this.isAnimating||this.isPaused}canShowForDate(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.animation.currentDate;var t;if(this.animation instanceof or){const i=this.animation.referenceDate.getTime(),r=e.getTime(),a=this.clamp;if(!a||a===wr.none)return!0;if(a===wr.range){if(ye(this._timeRange)&&0===(null===(t=this.series.intervals)||void 0===t?void 0:t.length))return!1;const{start:e,end:i}=this.timeRange;return r>=e.getTime()&&r<=i.getTime()}return(a!==wr.past||!1!==this.animation.containsPast)&&(a!==wr.future||!1!==this.animation.containsFuture)&&(a===wr.past&&r<=i||a===wr.future&&r>i)}return!0}hasDataForCurrentInterval(){return this.hasDataForInterval(this._intervalState.data.current.interval,!0)}hasDataForDate(e,t){var i;return void 0===t&&(t=null===(i=this.animation)||void 0===i?void 0:i.isActive),this.hasDataForInterval(e.getTime(),t)}hasDataForInterval(e,t){var i;if(void 0===t&&(t=null===(i=this.animation)||void 0===i?void 0:i.isActive),ye(this.series.data))return!1;const r=this.series.dataForInterval(e);return t?Boolean(null==r?void 0:r.valid):he(r)}needsDataForDate(e){const t=Date.now(),i=e.getTime(),{start:r,end:a}=this.timeRange,s=this.clamp;return!(s===wr.range&&(le(r)||le(a)||i<r.getTime()||i>a.getTime())||s===wr.past&&i>t||s===wr.future&&i<t||!1!==this.hasDataForDate(e))}positionForTime(e){return(e.getTime()-this.animation.startDate.getTime())/this.animation.deltaTime}loadData(){this.loadDataIfNeeded(!1,!0)}loadDataIfNeeded(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var i,r,a,s;if(!this.animation)return void console.warn("[MapsGL] TimeSeriesAnimator: No animation instance available to load data for");const n=null===(r=null===(i=this._provider)||void 0===i?void 0:i.layer.source.spec.timeSeries.operation)||void 0===r?void 0:r.type;if(xe(n)&&"none"!==n)return;const o=this.animation,l=new Date(o.startDate),h=new Date(o.endDate),c=this.series.intervalsInRange(l,h),d=(null===(a=this.series.closestInterval(o.currentDate))||void 0===a?void 0:a.interval)||o.currentDate.getTime(),u=o.isActive||t?c:[d];e?this._debouncedLoadData(u):null===(s=this._provider)||void 0===s||s.loadData(u)}loadDataForIntervals(e){var t;null===(t=this.provider)||void 0===t||t.setNeedsUpdate(),this._debouncedLoadData(e)}updateEntryState(){this._updateEntriesStateDebounced()}invalidate(){var e;null===(e=this.provider)||void 0===e||e.invalidate()}play(){this.enabled&&this.animation.play()}stop(){this.animation.stop()}pause(){this.animation.pause()}resume(){this.enabled&&this.animation.resume()}_setupEvents(){const e=this.series,t=this.animation,i=this.provider;e.on(Vi.DATA_CHANGE,(()=>{this.invalidate()})),i&&(i.on(Vi.LOAD_START,(i=>{let{intervals:r}=i;t.disable(),r.forEach((t=>{const i=e.dataForInterval(t);i&&(i.loading=!0)}))})),i.on(Vi.LOAD_INTERVAL,(t=>{let{intervals:i}=t;i.forEach((t=>{const i=e.dataForInterval(t);i&&(i.loading=!1)})),this._updateEntriesStateDebounced()})),i.on(Vi.LOAD_COMPLETE,(()=>{this._updateEntriesStateDebounced()})),i.on(Vi.DATA_READY,(()=>{t.enable()})),i.on(Vi.DATA_CHANGE,this._handleAdvance,void 0,this),i.on(Vi.DATA_REMOVE,(i=>{let{tile:r}=i;const a=null==r?void 0:r.data,s=t.currentDate,{interval:n}=e.closestInterval(s);n&&(a instanceof xr||a instanceof vr)&&(null==a||a.purgeData(n))}))),this.on(Vi.DATA_CHANGE,(()=>{this._handleAdvanceDebounced()})),t.proxyEvents(this,[Ui.ADVANCE,Ui.PLAY,Ui.STOP]),t.on(Ui.PLAY,(()=>{this.loadDataIfNeeded(),this.trigger(Vi.PLAY,this._eventPayload())})).on(Ui.STOP,(()=>{this.trigger(Vi.STOP,this._eventPayload())})).on(Ui.ADVANCE,(e=>{this._handleAdvance()}))}_handleAdvance(){const{interval:e}=this._intervalState.time.current,{interval:t,index:i}=this.series.closestInterval(this.animation.currentDate);if(this.animation.currentDate.getTime()!==this._lastAdvanceTime&&(this.trigger(Vi.ADVANCE,this._eventPayload()),this._lastAdvanceTime=this.animation.currentDate.getTime()),!ye(this.series.data)&&(e&&t===e||(this._intervalState.time.current={interval:t,index:i},this.trigger(Vi.INTERVAL_ADVANCE,this._eventPayload())),this.hasDataForInterval(t))){const e=this.series.entryForInterval(t),r=null==e?void 0:e.next,a=this.series.intervalAtIndex(r);(i!==this._intervalState.data.current.index||-1===this._intervalState.data.next.index&&he(r))&&(this._intervalState.data.current=Object.assign({},this._intervalState.time.current),this._intervalState.data.next={interval:a,index:r},this.trigger(Vi.DATA_ADVANCE,this._eventPayload()))}}_updateEntriesState(){if(ye(this.series.intervals))return;const e=this.series.intervals,t=this.series.data||Object.create(null);if(this.provider){const i=this.provider.dataStateForIntervals(e);Object.keys(i).forEach((e=>{t[Number(e)].data.valid=i[e]}))}e.forEach(((i,r)=>{var a,s;const n=t[i];if(n.index=r,null===(a=n.data)||void 0===a?void 0:a.valid){n.current=r;for(let t=e.length-1;t>r;t--)(null===(s=this.series.dataForInterval(e[t]))||void 0===s?void 0:s.valid)&&(n.next=t);(-1===n.next||n.next<n.current)&&(n.next=n.current)}else n.current=-1,n.next=-1})),this._handleAdvance()}_eventPayload(){const{interval:e,index:t}=this._intervalState.time.current,i=Math.min(this.totalIntervals-1,t+1);return{animator:this,position:this.position,date:this.animation.currentDate,interval:e,nextInterval:this.series.intervals[i],dataInterval:this._intervalState.data.current.interval,nextDataInterval:this._intervalState.data.next.interval,index:t,nextIndex:i,dataIndex:this._intervalState.data.current.index,nextDataIndex:this._intervalState.data.next.index,totalIntervals:this.totalIntervals,intervalPosition:this.relativePosition,data:this.series.dataForInterval(e)}}dispose(){var e,t;this.animation.off(Ui.PLAY),this.animation.off(Ui.STOP),this.animation.off(Ui.ADVANCE),null===(e=this.provider)||void 0===e||e.off(Vi.DATA_CHANGE,this._handleAdvance),null===(t=this.provider)||void 0===t||t.dispose()}},Ar=["r","g","b","a","rg","gb","rb","ra","ga","ba","rgb","gba","rgba"];var Sr,Tr,Er;!function(e){e[e.none=0]="none",e[e.bilinear=1]="bilinear",e[e.bicubic=2]="bicubic",e[e.biquadratic=3]="biquadratic"}(Sr||(Sr={})),(Er=Tr||(Tr={})).number="number",Er.vector="vector",Er.sum="sum",Er.difference="diff",Er.angle="angle",Er.custom="custom";const Or=e=>e.startsWith("")?e:`${e}`,Cr=(e,t)=>{const{dataRange:i}=e,r=(i.max-i.min)/t;return Array.from({length:t}).map(((t,a)=>Object.assign(Object.assign({},e),{dataRange:{min:i.min+r*a,max:i.min+r*(a+1)}})))},Rr=function(e){return lt({type:Pi.sample,source:e,quality:ki.medium,zoomOffset:-1,timeSeries:{mode:br.interval},paint:{sample:{interpolation:Sr.bicubic,colorscale:{interval:0}}}},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})},Pr=function(e){return lt({type:Pi.raster,source:e,timeSeries:{mode:br.interval,intervals:10,interleaved:!1},paint:{raster:{meld:!1}}},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})},kr=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r={type:Pi.query,source:e,sourceType:Li.point,sourceLayer:"cities",paint:{text:[{value:Object.assign({property:"{dataProp}",transform:e=>Math.round(e)},t),size:20,color:"#fff",outlineColor:"#000",weight:"bold",anchor:"center",offset:{x:0,y:-4}},{value:{property:"place.name"},size:11,color:"#fff",outlineColor:"#444",weight:"bold",anchor:"top",offset:{x:0,y:8}}],symbol:{key:e=>e.place.name,rank:{property:"profile.rankScore",direction:"desc"},fadeOpacity:!1,pitchWithMap:!1,rotateWithMap:!1,allowOverlap:!1}}};return lt({},r,i)};var Dr;!function(e){e.base_osm="base.osm",e.base_cities="base.cities",e.conditions_TMP_UGRD_VGRD="conditions.TMP_2:UGRD_10:VGRD_10",e.conditions_TMP_DPT_RH="conditions.TMP_2:DPT_2:RH_2",e.conditions_TMP_DELTA="conditions.TMP_2:DELTA",e.conditions_APTMP_DPT_RH="conditions.APTMP_2:DPT_2:RH_2",e.conditions_PRMSL_VIS_GUST="conditions.PRMSL_0:VIS_0:GUST_10",e.conditions_SKY_PRECIP_UVI="conditions.TCDC_0:PRECIP_0:UVI_0",e.conditions_PTYPE_PRECIP_TMP="conditions.PTYPE_0:PRECIP_0:TMP_2",e.conditions_PRECIP="conditions.PRECIP_0",e.conditions_SNOW_DERIVED="conditions.SNOW-PRECIP_0:TMP_2",e.conditions_SNOD="conditions.SNOD_0",e.radar_REFC_PRATE_PTYPE="radar.REFC_0:PRATE_0:PTYPESMPL_0",e.forecast_REFC_PRATE_PTYPE="forecast.REFC_0:PRATE_0:PTYPESMPL_0",e.airquality_AQI_PM2P5_PM10="airquality.AQI-AirNow:PM2P5_0:PM10_0",e.airquality_AQI_HI_China_India="airquality.AQI-AQHI:AQI-China:AQI-India",e.airquality_AQI_EAQI_UBA_UK="airquality.AQI-EAQI:AQI-UBA_DAQI:AQI-UK_DAQI",e.airquality_AQI_CAI_CAQI="airquality.AQI-CAI:AQI-CAQI",e.airquality_CO_NO_NO2="airquality.CO_0:NO_0:NO2_0",e.airquality_O3_SO2="airquality.O3_0:SO2_0",e.airquality_points="airquality.points",e.maritime_WAVE="maritime.HTSGW_0:DIRPW_0:PERPW_0",e.maritime_SWELL1="maritime.SWELL_1:SWPER_1:SWDIR_1",e.maritime_SWELL2="maritime.SWELL_2:SWPER_2:SWDIR_2",e.maritime_SWELL3="maritime.SWELL_3:SWPER_3:SWDIR_3",e.maritime_WTMP_UOGRD_VOGRD="maritime.WTMP_0:UOGRD_0:VOGRD_0",e.maritime_SURGE_TIDE="maritime.SURGE_0:TIDE_0",e.severe_alerts="severe.alerts",e.severe_stormcells="severe.stormcells",e.severe_stormreports="severe.stormreports",e.severe_lightning="severe.lightning",e.severe_lightning_all="severe.lightning.all",e.severe_lightning_flash="severe.lightning.flash",e.severe_convective="severe.convective",e.fires_obs="fires.obs",e.fires_perimeter="fires.perimeter",e.fires_outlook="fires.outlook",e.drought="drought",e.earthquakes="earthquakes",e.rivers="rivers",e.tropical_active="tropical.active",e.tropical_archive="tropical.archive",e.tropical_invests="tropical.invests",e.roadweather_nowcast_us="roadweather.nowcast.us",e.roadweather_nowcast_europe="roadweather.nowcast.europe",e.roadweather_nowcast_japan="roadweather.nowcast.japan",e.roadweather_nowcast_australia="roadweather.nowcast.australia",e.roadweather_nowcast_new_zealand="roadweather.nowcast.new_zealand",e.roadweather_forecast_us="roadweather.forecast.us",e.roadweather_forecast_europe="roadweather.forecast.europe",e.roadweather_forecast_japan="roadweather.forecast.japan",e.roadweather_forecast_australia="roadweather.forecast.australia",e.roadweather_forecast_new_zealand="roadweather.forecast.new_zealand",e.satellite_infrared="satellite.infrared",e.satellite_infrared_color="satellite.infrared_color",e.satellite_visible="satellite.visible",e.satellite_water_vapor="satellite.water_vapor",e.satellite_geocolor="satellite.geocolor"}(Dr||(Dr={}));const zr=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{from:e.from||new Date,to:e.to||new Date}};var Ir,Fr;!function(e){e.Bevel="bevel",e.Round="round",e.Miter="miter"}(Ir||(Ir={})),function(e){e.Butt="butt",e.Round="round",e.Square="square"}(Fr||(Fr={}));const Lr=function(e,t){return lt({},{id:e,layer:{type:Pi.line,source:Dr.base_osm,sourceLayer:"boundary",paint:{stroke:{color:"#000",thickness:1,lineJoin:Ir.Round,lineCap:Fr.Round}}}},{layer:{filter:t,paint:arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}}})},jr=function(e,t){return lt({},{id:e,layer:{type:Pi.line,source:Dr.base_osm,sourceType:Li.line,sourceLayer:"transportation",paint:{stroke:{color:"#000",thickness:3,lineJoin:Ir.Round,lineCap:Fr.Round}}}},{layer:{filter:t,paint:arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}}})},Nr=function(e,t){return lt({},{id:e,layer:{type:Pi.symbol,source:Dr.base_osm,sourceType:Li.point,sourceLayer:"place",paint:{text:{value:{property:["name:en","name"]},weight:"normal",size:12,color:"#333",outlineColor:"#fff"},symbol:{rank:{property:"rank",direction:"asc"},pitchWithMap:!1,rotateWithMap:!1,allowOverlap:!1,overlapMode:"map"}}}},{layer:{filter:t,paint:arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}}})},Ur=function(e,t){return lt({},{id:e,layer:{type:Pi.line,source:Dr.base_osm,sourceType:Li.polygon,sourceLayer:"water",paint:{fill:{color:"#333"}}}},{layer:{filter:t,paint:arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}}})};var Vr;!function(e){e[e.count=0]="count",e[e.minimal=8]="minimal",e[e.low=24]="low",e[e.normal=48]="normal",e[e.high=76]="high",e[e.extreme=128]="extreme"}(Vr||(Vr={}));const Br={measurement:{type:"temperature",units:o.temperature.C},transform:(e,t)=>Number.isNaN(e)?"":"F"===t?Math.round(1.8*e+32):Math.round(e)},$r={measurement:{type:"temperature",units:o.temperature.C},transform:(e,t)=>{if(Number.isNaN(e))return"";let i=Math.round(e);const r=e>0?"+":"";return"F"===t&&(i=Math.round(1.8*e)),`${0===i?"":r}${i}`}},qr={measurement:{type:"speed",units:o.speed.ms},transform:(e,t)=>Number.isNaN(e)?"":"mph"===t?Math.round(2.236936*e):"kmh"===t||"km/h"===t?Math.round(3.6*e):"kts"===t||"knots"===t?Math.round(1.943844*e):Math.round(e)},Gr={measurement:{type:"pressure",units:o.pressure.mb},transform:(e,t)=>{if(Number.isNaN(e))return"";switch(t){case"inHg":return`${(Math.round(.02953*e*100)/100).toFixed(2)}`;case"Pa":return Math.round(100*e);default:return Math.round(e)}}},Hr={measurement:{type:"precipitation",units:o.rate.mms},transform:(e,t)=>{if(Number.isNaN(e)||0===e)return"";switch(t){case"cm":return Math.round(e/10);case"in":return`${(Math.round(.0393701*e*100)/100).toFixed(2)}`;default:return Math.round(e)}}},Wr={measurement:{type:"rate",units:o.rate.mms},transform:(e,t)=>{if(Number.isNaN(e))return"";const i=3600*e;let r=0;switch(t){case"mm/hr":case"mm":e=Math.round(10*i)/10;break;case"in/hr":case"in":e=Math.round(.03937*i*100)/100,r=2;break;default:e=Math.round(e)}return 0===e?"":e.toFixed(r)}},Yr={measurement:{type:"distance",units:o.distance.m},transform:(e,t)=>{if(Number.isNaN(e))return"";switch(t){case"km":return Math.round(e/1e3);case"ft":return Math.round(3.28084*e);case"in":return Math.round(39.3701*e);case"mi":return Math.round(621371e-9*e);default:return Math.round(e)}}},Zr=(e,t,i)=>{if(i>0){const r=Ze(Math.round(d(e)),i),a=Math.round(d(t)),s=Array.from({length:Math.ceil((a-r)/i)},((e,t)=>c(r+t*i)));return s.push(t),s}},Xr={layerId:"water",overrides:{paint:{fill:{color:"#fff"}}}},Qr=Object.assign(Object.assign({},Xr),{invert:!0}),Kr={current:[0,"rgba(16,145,253,0)",.5144,"#1091FD",.7716,"#37FF84",1.0288,"#B6FF06",1.286,"#FEE10A",1.5432,"#EFB80C",1.8004,"#FD8408",2.0576,"#F43305",2.3148,"#AB1406",2.572,"#931537",3.0864,"#A4168A"],wave_height:[0,"#091597",2.43,"#04C9FC",4.88,"#8CFB37",6.09,"#FCFA3A",7.3,"#FF6116",8.53,"#FF040B",10.36,"#79003C",12.19,"#FF2391",14.26,"#FFE0FF"],surge:[0,"#091597",.6096,"#04C9FC",1.2192,"#8CFB37",1.8288,"#FCFA3A",2.4384,"#FF6116",3.048,"#FF040B",3.6576,"#79003C",4.2672,"#FF2391",4.8768,"#FFE0FF"],period:[2,"#091597",6,"#0030AE",10,"#04C9FC",14,"#8CFB37",16,"#FCFA3A",18,"#FF6116",20,"#FF040B",22,"#79003C",24,"#FF2391"],height_diff:[-12.192,"#EF90FF",-9.144,"#D741DA",-6.096,"#8B21DA",-4.572,"#0013CA",-3.048,"#0070F1",-1.524,"#8ED4F9",-.6096,"rgba(142,212,249,0)",0,"rgba(0,0,0,0)",.6096,"rgba(255,217,42,0)",1.524,"#FFD92A",3.048,"#FF932A",4.572,"#E2330B",6.096,"#9D0000",9.144,"#D00071",12.192,"#FF698C"]},Jr={current:Ci("Ocean Currents",{id:"current",bar:{measurement:Object.assign(Object.assign({},xi.current.measurement),{converter:Si}),colorscale:{range:{min:0,max:xi.current.dataRange.max},stops:Kr.current},labels:{every:e=>1,formatter:(e,t,i)=>0===t?`${Math.round(e)} %%units%%`:`${Math.round(e)}`}}}),wave_height:Ci("Wave/Swell Height",{id:"wave-height",bar:{measurement:Object.assign(Object.assign({},xi.swellHeightPrimary.measurement),{converter:Oi}),colorscale:{range:xi.waveHeight.dataRange,stops:Kr.wave_height},labels:{every:e=>"m"===e?1:5,formatter:(e,t,i)=>0===t?`${Math.round(e)} %%units%%`:`${Math.round(e)}`}}}),period:Ci("Wave/Swell Period",{id:"period",bar:{measurement:Object.assign(Object.assign({},xi.swellPeriodPrimary.measurement),{converter:(e,t,i)=>B("time",e,t,i)}),colorscale:{range:xi.wavePeriod.dataRange,stops:Kr.period},labels:{every:2,formatter:(e,t,i)=>0===t?`${Math.round(e)} %%units%%`:`${Math.round(e)}`}}}),surge:Ci("Storm Surge",{id:"surge",bar:{measurement:Object.assign(Object.assign({},xi.surge.measurement),{converter:Oi}),colorscale:{range:xi.surge.dataRange,stops:Kr.surge},labels:{every:e=>"m"===e?.2:1,formatter:(e,t,i)=>{const r=i.metric?e.toFixed(1):Math.round(e);return 0===t?`${r} %%units%%`:`${r}`}}}}),tide_height:Ci("Tide Height",{id:"tide-height",bar:{measurement:Object.assign(Object.assign({},xi.tide.measurement),{converter:Oi}),colorscale:{range:xi.tide.dataRange,stops:Kr.height_diff},labels:{every:e=>"m"===e?.5:2,formatter:(e,t,i)=>{const r=`${e>0?"+":""}${Math.round(e)}`;return 0===t?`${r}°%%units%%`:`${r}`}}}})},ea=e=>xe(e)&&ke(e)?e.replace(/(?:^|\s)\S/g,(e=>e.toUpperCase())):"",ta={type:"concentration",units:"µg/m³"},ia={good:"#29e11f",moderate:"#f8f92a",usg:"#f9681b",unhealthy:"#f60115",very_unhealthy:"#7a2c83",hazardous:"#65001b"},ra="#0000ff",aa="#00ff00",sa="#ffff00",na="#ff0000",oa="#00ff00",la="#ffff00",ha="#ff9900",ca="#ff0000",da="#540099",ua="#800000",pa="#00cc00",ma="#66cc00",fa="#ffff00",ga="#ff9900",va="#ff0000",ya="#a52a2a",xa="#50f0e6",ba="#50ccaa",wa="#f0e641",_a="#ff5050",Ma="#960032",Aa="#7d2181",Sa="#0000ff",Ta="#00ff00",Ea="#ffff00",Oa="#ff0000",Ca="#79bc6a",Ra="#bbcf4c ",Pa="#eec20b",ka="#f29305",Da="#e8416f",za="#50f0e6",Ia="#50cdaa",Fa="#f0e641",La="#ff5050",ja="#960032",Na="#009900",Ua="#ff9900",Va="#ff0000",Ba="#990099",$a={aqi:[0,ia.good,25,ia.good,75,ia.moderate,125,ia.usg,175,ia.unhealthy,251,ia.very_unhealthy,301,ia.hazardous,500,ia.hazardous],aqi_cats:[0,ia.good,51,ia.moderate,101,ia.usg,151,ia.unhealthy,200,ia.very_unhealthy,301,ia.hazardous],health:[0,ra,3.5,aa,6.5,sa,10.5,na],china:[0,oa,51,la,101,ha,151,ca,201,da,301,ua],india:[0,pa,51,ma,101,fa,201,ga,301,va,401,ya],eaqi:[0,xa,26,ba,51,wa,76,_a,101,Ma,126,Aa],cai:[0,Sa,51,Ta,101,Ea,251,Oa],caqi:[0,Ca,26,Ra,51,Pa,76,ka,101,Da],uba_daqi:[0,za,26,Ia,51,Fa,76,La,101,ja],uk_daqi:[0,Na,1.5,Ua,4.5,Va,7.5,Ba],pm2p5:[0,"rgb(7, 54, 161, 0)",25,"#0B8ACE",50,"#F2D538",100,"#F28012",200,"#DF0612",300,"#980657"],pm10:[0,"rgb(7, 54, 161, 0)",50,"#0B8ACE",100,"#F2D538",250,"#F28012",500,"#DF0612",1e3,"#980657"],so2:[0,"rgb(7, 54, 161, 0)",5,"#0B8ACE",10,"#F2D538",25,"#F28012",50,"#DF0612",100,"#980657"],no:[0,"rgb(7, 54, 161, 0)",5,"#0B8ACE",25,"#F2D538",50,"#F28012",100,"#DF0612"],no2:[0,"rgb(7, 54, 161, 0)",10,"#0B8ACE",20,"#F2D538",30,"#F28012",50,"#DF0612",100,"#980657"],co:[0,"rgb(7, 54, 161, 0)",500,"#0B8ACE",650,"#F2D538",800,"#F28012",900,"#DF0612",1e3,"#980657"],o3:[0,"rgb(7, 54, 161, 0)",50,"#0B8ACE",100,"#F2D538",150,"#F28012",200,"#DF0612",300,"#980657"],pollutant:[0,"#0043D3",.2,"#3AADF3",.4,"#FAF530",.6,"#FF8418",.8,"#DE1C06",1,"#650D03"]},qa={points:Ri("Air Quality",{id:"airquality-aqi-categories",points:{values:[{color:ia.good,label:"Good"},{color:ia.moderate,label:"Moderate"},{color:ia.usg,label:"Sensitive Groups"},{color:ia.unhealthy,label:"Unhealthy"},{color:ia.very_unhealthy,label:"Very Unhealthy"},{color:ia.hazardous,label:"Hazardous"}]}}),aqi:Ci("Air Quality Index (AQI)",{id:"airquality-aqi",bar:{colorscale:{range:vi.aqiAirNow.dataRange,stops:$a.aqi,positions:[0,.1,.2,.4,.6,.8,.95,1]},labels:{values:[0,50,100,150,200,300,400,500]}}}),aqhi:Ri("Air Quality Health Index (AQHI)",{id:"airquality-aqhi",points:{values:[{color:ra,label:"Low"},{color:aa,label:"Moderate"},{color:sa,label:"High"},{color:na,label:"Very High"}]}}),china:Ri("Air Quality Index (China)",{id:"airquality-aqi-china",points:{values:[{color:oa,label:"Excellent"},{color:la,label:"Good"},{color:ha,label:"Lightly Polluted"},{color:ca,label:"Moderately Polluted"},{color:da,label:"Heavily Polluted"},{color:ua,label:"Severely Polluted"}]}}),india:Ri("Air Quality Index (India)",{id:"airquality-aqi-india",points:{values:[{color:pa,label:"Good"},{color:ma,label:"Satisfactory"},{color:fa,label:"Moderate"},{color:ga,label:"Poor"},{color:va,label:"Severe"},{color:ya,label:"Hazardous"}]}}),eaqi:Ri("Air Quality Index (European)",{id:"airquality-aqi-eaqi",points:{values:[{color:xa,label:"Good"},{color:ba,label:"Fair"},{color:wa,label:"Moderate"},{color:_a,label:"Poor"},{color:Ma,label:"Very Poor"},{color:Aa,label:"Extremely Poor"}]}}),cai:Ri("Air Quality Index (Korean)",{id:"airquality-aqi-cai",points:{values:[{color:Sa,label:"Good"},{color:Ta,label:"Moderate"},{color:Ea,label:"Unhealthy"},{color:Oa,label:"Very Unhealthy"}]}}),caqi:Ri("Air Quality Index (Common)",{id:"airquality-aqi-caqi",points:{values:[{color:Ca,label:"Very Low"},{color:Ra,label:"Low"},{color:Pa,label:"Medium"},{color:ka,label:"High"},{color:Da,label:"Very High"}]}}),uba_daqi:Ri("Air Quality Index (German)",{id:"airquality-aqi-uba-daqi",points:{values:[{color:za,label:"Very Good"},{color:Ia,label:"Good"},{color:Fa,label:"Moderate"},{color:La,label:"Poor"},{color:ja,label:"Very Poor"}]}}),uk_daqi:Ri("Air Quality Index (UK)",{id:"airquality-aqi-uk-daqi",points:{values:[{color:Na,label:"Low"},{color:Ua,label:"Moderate"},{color:Va,label:"High"},{color:Ba,label:"Very High"}]}}),pm2p5:Ci("Particle Pollution (PM2.5)",{id:"airquality-pm2p5",bar:{measurement:Object.assign({},ta),colorscale:{range:vi.pm2p5.dataRange,stops:$a.pm2p5,resample:We(.65,0,.85,1)},labels:{values:[0,10,25,50,100,200,300],formatter:(e,t,i)=>0===t?`${Math.round(e)} %%units%%`:`${Math.round(e)}`}}}),pm10:Ci("Particle Pollution (PM10)",{id:"airquality-pm10",bar:{measurement:Object.assign({},ta),colorscale:{range:vi.pm10.dataRange,stops:$a.pm10,resample:He.inCubic},labels:{values:[0,10,25,50,100,250,500,1e3],formatter:(e,t,i)=>0===t?`${Math.round(e)} %%units%%`:`${Math.round(e)}`}}}),co:Ci("Carbon Monoxide (CO)",{id:"airquality-co",bar:{measurement:Object.assign({},ta),colorscale:{range:vi.co.dataRange,stops:$a.co,resample:He.inOutSqrt},labels:{values:[0,125,250,500,750,1e3],formatter:(e,t,i)=>0===t?`${Math.round(e)} %%units%%`:`${Math.round(e)}`}}}),no:Ci("Nitrogen Monoxide (NO)",{id:"airquality-no",bar:{measurement:Object.assign({},ta),colorscale:{range:vi.no.dataRange,stops:$a.no,resample:He.inSine},labels:{values:[0,5,10,25,50,100],formatter:(e,t,i)=>0===t?`${Math.round(e)} %%units%%`:`${Math.round(e)}`}}}),no2:Ci("Nitrogen Dioxide (NO2)",{id:"airquality-no2",bar:{measurement:Object.assign({},ta),colorscale:{range:vi.no2.dataRange,stops:$a.no2,resample:He.inSqrt},labels:{values:[0,10,20,30,50,100],formatter:(e,t,i)=>0===t?`${Math.round(e)} %%units%%`:`${Math.round(e)}`}}}),o3:Ci("Ozone (03)",{id:"airquality-o3",bar:{measurement:Object.assign({},ta),colorscale:{range:vi.o3.dataRange,stops:$a.o3,resample:He.inSqrt},labels:{values:[0,50,100,150,225,300],formatter:(e,t,i)=>0===t?`${Math.round(e)} %%units%%`:`${Math.round(e)}`}}}),so2:Ci("Sulfur Dioxide (SO2)",{id:"airquality-so2",bar:{measurement:Object.assign({},ta),colorscale:{range:vi.so2.dataRange,stops:$a.so2,resample:He.inSqrt},labels:{values:[0,5,10,25,50,100],formatter:(e,t,i)=>0===t?`${Math.round(e)} %%units%%`:`${Math.round(e)}`}}})},Ga=["us","europe","japan","australia","new-zealand"],Ha=Object.keys(bi),Wa={primary:{filter:["in","class","motorway","motorway_link","motorway_junction","trunk","trunk_link"]},secondary:{filter:["in","class","primary","primary_link","secondary","secondary_link","tertiary","tertiary_link"]},bridges:{type:"bridge",filter:["all",["==","brunnel","bridge"],["in","class","motorway","motorway_link","motorway_junction","trunk","trunk_link","primary","primary_link"]]}},Ya=Object.keys(Wa),Za={summary:{green:"#00C500",yellow:"#FFCE00",red:"#FF0000",unknown:"#666"},surface:{dry:"#bbb",moist:"#3B960F",wet:"#00E300",slush:"#B643FF",snow:"#0043FF",ice:"#FF00A6",unknown:"#666"},risk:{minimal:"#ccc",low:"#FFEB00",moderate:"#FF9C00",high:"#E00200",major:"#9A00B8"}};function Xa(e){return Ri(e,{id:"roadweather-risk",points:{values:[{key:"minimal",color:Za.risk.minimal,label:"Minimal"},{key:"low",color:Za.risk.low,label:"Low"},{key:"moderate",color:Za.risk.moderate,label:"Moderate"},{key:"high",color:Za.risk.high,label:"High"},{key:"major",color:Za.risk.major,label:"Major"}]}})}function Qa(e,t){return{type:t,sourceType:Li.point,timeSeries:{mode:br.interval},paint:Object.assign({fill:{color:t=>{const i=bi[e].code;if("temperature"===e){const e=q,r=t[i];let a;for(let t=0;t<e.length;t+=2)r>=e[t]&&r<e[t+2]&&(a=e[t+1]);return a||"#ccc"}if("temperatureFreeze"===e){const e=G,r=t[i];let a;for(let t=0;t<e.length;t+=2)r>=e[t]&&r<e[t+2]&&(a=e[t+1]);return a||"#ccc"}if(/(rollover|fog|snow|hydroplane)/i.test(e)){const e=t[i];return e>=.8?Za.risk.major:e>=.6?Za.risk.high:e>=.4?Za.risk.moderate:e>=.2?Za.risk.low:Za.risk.minimal}const r=(t[i]||"unknown").toLowerCase();return Za[e][r]||"#ccc"}}},t===Pi.circle?{circle:{radius:4},stroke:{color:"#222",thickness:1}}:{})}}const Ka={stormcells:{general:"#2ED300",hail:"#EBE100",rotating:"#F17200",tornado:"#FF2600"},stormreports:{avalanche:"#629FEC",blizzard:"#4100E2",fire:"#E66300",flood:"#117D01",fog:"#767676",ice:"#B300E2",hail:"#61DEF7",lightning:"#8C8C8C",rain:"#39E600",snow:"#165CEF",tides:"#40DB83",tornado:"#C50000",wind:"#D8CC03",tropical:"#FF59B3",other:"#999"},convective:{general:"#b3e6b1",marginal:"#6cbd69",slight:"#f4f964",enhanced:"#e0b767",moderate:"#e0686a",high:"#fe59ff"},lightningStrikes:{age60:"#eeeeee",age300:"#F8E203",age600:"#F97000",ageOld:"#C4150D",typeIC:"#999"}},Ja=e=>{let t=e.toLowerCase();return t=t.replace(/thunderstorm/,"t-storm"),t=t.replace(/temperature/,"temp"),t=t.replace(/fog \(marine\)/,"fog"),ea(t)},es={alerts:e=>Ri("Alerts",{id:"alerts",points:{layerId:"^alerts(-outline)?::",values:t=>new Promise(((i,r)=>{const a=[],s=[];if(t.features)t.features.forEach((e=>{const{ADVISORY:t,COLOR:i}=e.properties;s.includes(t)||(a.push({color:i.startsWith("#")?i:`#${i}`,label:Ja(t)}),s.push(t))})),i(a.sort(((e,t)=>e.label.localeCompare(t.label))));else if(ge(t.bounds)){const r=Object.assign({},t.bounds);if(e.canAccess("advisories_summary"),ge(r))return void console.warn("[MapsGL] Cannot load data for alerts legend, coordinate bounds not provided");const n=Math.abs(r.east-r.west),o=Math.floor(n/360),l=e.api().action("within");t.time&&l.from(t.time),o>0?(r.west=-180,r.east=180):(r.west<-180||r.west>180)&&(r.west+=360*Math.floor(r.west/360)),l.bounds(r),l.get().then((e=>{var t,r;if((null===(t=e.data)||void 0===t?void 0:t.length)>0){const t=null===(r=e.data[0].summary)||void 0===r?void 0:r.types;if(t&&Array.isArray(t))return t.forEach((e=>{let{type:t,color:i}=e;s.includes(t)||(a.push({color:i.startsWith("#")?i:`#${i}`,label:Ja(t)}),s.push(t))})),void i(a)}i([])}))}}))}}),stormcells:Ri("Storm Cells",{id:"stormcells",points:{values:function(){const e=Ka.stormcells;return[{color:e.general,label:"General"},{color:e.hail,label:"Hail"},{color:e.rotating,label:"Rotating"},{color:e.tornado,label:"Tornadic"}]}()}}),stormreports:Ri("Storm Reports",{id:"stormreports",points:{values:function(){const e=Ka.stormreports;return[{color:e.avalanche,label:"Avalanche"},{color:e.blizzard,label:"Blizzard"},{color:e.fire,label:"Fire"},{color:e.flood,label:"Flood"},{color:e.fog,label:"Fog"},{color:e.ice,label:"Ice"},{color:e.hail,label:"Hail"},{color:e.lightning,label:"Lightning"},{color:e.rain,label:"Rain"},{color:e.snow,label:"Snow"},{color:e.tides,label:"Tides"},{color:e.tornado,label:"Tornado"},{color:e.wind,label:"Wind"},{color:e.tropical,label:"Tropical"},{color:e.other,label:"Other"}]}()}}),lightning_strikes:Ri("Lightning Strikes",{id:"lightning-all",points:{values:[{color:Ka.lightningStrikes.age60,label:"< 1 minute"},{color:Ka.lightningStrikes.age300,label:"1-5 minutes"},{color:Ka.lightningStrikes.age600,label:"5-10 minutes"},{color:Ka.lightningStrikes.ageOld,label:"> 10 minutes"},{color:Ka.lightningStrikes.typeIC,label:"Intra-cloud"}]}}),convective:Ri("Convective Outlook",{id:"convective",points:{values:[{color:Ka.convective.general,label:"General"},{color:Ka.convective.marginal,label:"Marginal"},{color:Ka.convective.slight,label:"Slight"},{color:Ka.convective.enhanced,label:"Enhanced"},{color:Ka.convective.moderate,label:"Moderate"},{color:Ka.convective.high,label:"High"}]}})},ts={alerts:{title:"Alerts",fn:e=>`${e.reduce(((e,t)=>{const i=ea(t.ADVISORY.toLowerCase());return e.includes(i)||e.push(i),e}),[]).join("<br>")}`},stormcells:{title:"Storm Cells",fn:e=>{var t,i,r;const a=e[0];if(null==a?void 0:a.ob){const e=null===(i=null===(t=a.ob)||void 0===t?void 0:t.movement)||void 0===i?void 0:i.dirTo;return`${ea(null===(r=a.traits)||void 0===r?void 0:r.type)}${e?`, moving ${e}`:""}`}return""}},convective:{title:"Convective Outlook",fn:e=>{var t,i;const r=e.at(-1);return(null==r?void 0:r.details)?`${ea(null===(i=null===(t=r.details)||void 0===t?void 0:t.risk)||void 0===i?void 0:i.type)}`:""}}},is={LO:"#4875FB",I:"#4875FB",TD:"#FFE700",TS:"#FEA800",H1:"#DD0002",H2:"#FF0491",H3:"#DD00FD",H4:"#FEAFFF",H5:"#EFEFEF",TY:"#DD0002",STY:"#EFEFEF"},rs={"TR.A":"#FFE403","TR.W":"#FF9100","HU.A":"#FF00D2","HU.W":"#FF0018"},as={point:{type:Pi.circle,sourceType:Li.point,paint:{fill:{color:e=>{var t,i;const r=null===(i=null===(t=e.details)||void 0===t?void 0:t.stormCat)||void 0===i?void 0:i.toUpperCase();return is[r]||"#000000"}},stroke:{color:"#fff",thickness:3},circle:{radius:8}}},symbol:{type:Pi.symbol,sourceType:Li.point,paint:{fill:{color:e=>{var t,i;const r=null===(i=null===(t=e.details)||void 0===t?void 0:t.stormCat)||void 0===i?void 0:i.toUpperCase();return is[r]||"#000000"}},stroke:{color:"#fff",thickness:1},icon:{image:e=>{var t;switch(null===(t=e.details)||void 0===t?void 0:t.stormType){case"H":case"TY":case"STY":return"mapsgl:hurricane";case"TS":return"mapsgl:tropical-storm";case"TD":return"mapsgl:tropical-depression";default:return"mapsgl:tropical-low"}},size:e=>e.zoom<4?{width:20,height:20}:{width:36,height:36},factor:e=>{var t,i;switch(null===(t=e.details)||void 0===t?void 0:t.stormType){case"H":case"TY":case"STY":case"TS":case"TD":{const[t,r]=(null===(i=e.location)||void 0===i?void 0:i.coordinates)||[];return r>0?1:-1}default:return 0}}},text:[{value:e=>{var t;if(e.zoom<4)return null;const i=null===(t=e.details)||void 0===t?void 0:t.stormCat;return/^H\d$/.test(i)?i.replace("H",""):"STY"===i?"S":void 0},size:12,color:"#fff",outlineColor:"#444",weight:"bold",anchor:"center",offset:{x:0,y:-3}}]}},track:{type:Pi.line,paint:{stroke:{color:e=>{var t,i;const r=null===(i=null===(t=e.details)||void 0===t?void 0:t.stormCat)||void 0===i?void 0:i.toUpperCase();return is[r]||"#fff"},thickness:3}}},name:{type:"text",paint:{text:{value:{property:"details.stormShortName"},size:12,color:"#fff",outlineColor:"#444",weight:"bold",anchor:"top",offset:e=>e.zoom<4?{x:0,y:8}:{x:0,y:12}},symbol:{fadeOpacity:!1,pitchWithMap:!1,rotateWithMap:!1,allowOverlap:!0}}}},ss=Ri("Tropical Cyclones",{id:"tropical-cyclones",points:{values:[{color:(ns=is).LO,label:"Low"},{color:ns.TD,label:"Depression"},{color:ns.TS,label:"Storm"},{color:ns.H1,label:"Cat 1"},{color:ns.H2,label:"Cat 2"},{color:ns.H3,label:"Cat 3"},{color:ns.H4,label:"Cat 4"},{color:ns.H5,label:"Cat 5"},{color:ns.TY,label:"Typhoon"},{color:ns.STY,label:"Super Typhoon"}]}});var ns;const os=Ri("Tropical Cyclone Breakpoints",function(e){return{id:"tropical-breakpoints",points:{values:[{color:e["TR.A"],label:"Tropical Storm Watch"},{color:e["TR.W"],label:"Tropical Storm Warning"},{color:e["HU.A"],label:"Hurricane Watch"},{color:e["HU.W"],label:"Hurricane Warning"}]}}}(rs)),ls={title:e=>{var t,i;const r=e[0];return null===(i=null===(t=null==r?void 0:r.details)||void 0===t?void 0:t.stormShortName)||void 0===i?void 0:i.replace(/(-\w)$/,(e=>e.toUpperCase()))},fn:e=>{var t,i,r,a,s;const n=e[0];if(!n||"errorCone"===n.featureType)return"";const o=(null==n?void 0:n.timestamp)||Date.now()/1e3,l=St(new Date(1e3*o),"format[MMM d, yyyy H:mm a]"),h=[],c=null===(t=null==n?void 0:n.details)||void 0===t?void 0:t.windSpeedMPH,d=null===(i=null==n?void 0:n.details)||void 0===i?void 0:i.windSpeedKPH,u=null===(r=null==n?void 0:n.details)||void 0===r?void 0:r.windSpeedKTS;let p=null===(a=null==n?void 0:n.details)||void 0===a?void 0:a.stormCat;if(h.push("forecastPoint"===n.featureType?"Forecast":`Advisory #${null===(s=null==n?void 0:n.details)||void 0===s?void 0:s.advisoryNumber}`,`${l}`),p){switch(p=p.replace(/^H(\d)/,"Cat $1 Hurricane"),p){case"LO":p="Low";break;case"I":p="Invest";break;case"TD":p="Tropical Depression";break;case"TS":p="Tropical Storm";break;case"TY":p="Typhoon";break;case"STY":p="Super Typhoon"}h.push(`${p}`)}return c&&u&&h.push(`${u} knots, ${d} kph, ${c} mph`),h.join("<br>")}},hs={drought:{d0:"#ffff00",d1:"#fccc66",d2:"#ff9b00",d3:"#e10000",d4:"#600000"},fire_obs:{contained:"#6C6461",active:"#E88900",new:"#E83A00"},fire_outlook:{elevated:"#FFB268",critical:"#FE666A",extreme:"#FE58FF"},earthquakes:{mini:"#6fb314",minor:"#dfcb01",light:"#ce8f00",moderate:"#ff5d01",strong:"#e90004",major:"#ce0052",great:"#b90285",catastrophic:"#f500ff"},rivers:{out_of_service:"#535353",obs_not_current:"#AFB6AD",not_defined:"#5F9CE6",low_threshold:"#7F5013",no_flooding:"#0EFF00",action:"#FFFF00",minor:"#FE8700",moderate:"#FF0100",major:"#C000FF"},vpd:[0,"rgba(255,217,42,0)",10,"#FFD92A",20,"#FF932A",30,"#E2330B",40,"#9D0000",50,"#D00071",60,"#FF698C",70,"#FFE9FF"]},cs=e=>{var t,i,r;if(!(null==e?void 0:e.report))return;let a=(null===(t=e.report)||void 0===t?void 0:t.mag)>=9?"catastrophic":null===(r=null===(i=e.report)||void 0===i?void 0:i.type)||void 0===r?void 0:r.toLowerCase();return a||(a="mini"),{color:hs.earthquakes[a],size:{mini:12,minor:18,light:20,moderate:22,strong:26,major:30,great:36,catastrophic:42}[a]}},ds=e=>{const t=null==e?void 0:e.report;if(!t)return;const i=hs.fire_obs,r=t.perContained||0,a=Math.max(1,t.areaAC)*(100===r?.75:1)/1e4,s=new Date(t.startDateISO);let n=i.active,o=Math.min(40,Math.round(10+30*a)),l=2;return 100===r?(n=i.contained,o*=.75):Date.now()-s.getTime()<864e5&&(n=i.new,l=2),{color:n,size:o,thickness:l}},us=(e,t)=>t?t.reduce(((t,i)=>(t[i]=e[i],t)),{}):{},ps="metadata:range",ms="metadata:load:start",fs="metadata:load",gs="metadata:error",vs="data:change",ys="data:stale",xs="tile:load",bs="tile:load:start",ws="tile:load:complete",_s="tile:error",Ms="load:start",As="load:complete",Ss=class extends dt{constructor(e,t){super(),this.maxValidTimeIntervals=0,this._isLoading=!1,this._hasLoaded=!1,this.url=e,this._data=Object.assign({startDate:new Date,endDate:new Date},t),this._transformer=e=>e,this.data.maxValidTimes>0&&(this.maxValidTimeIntervals=this.data.maxValidTimes)}get data(){return this._data}get minZoom(){var e;return(null===(e=this.data)||void 0===e?void 0:e.minZoom)||0}get maxZoom(){var e;return(null===(e=this.data)||void 0===e?void 0:e.maxZoom)||21}get bounds(){var e;return null===(e=this.data)||void 0===e?void 0:e.bounds}get projection(){var e;return null===(e=this.data)||void 0===e?void 0:e.projection}get datasets(){var e;return null===(e=this.data)||void 0===e?void 0:e.datasets}get isLoading(){return this._isLoading}get hasLoaded(){return this._hasLoaded}get hasValidTimes(){var e;return xe(null===(e=this.data)||void 0===e?void 0:e.validTimes)}getAllValidTimes(){return this.getValidTimes(0,0)}getValidTimes(){return this.getDatasetValidTimesAtIndex(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.maxValidTimeIntervals).sort(((e,t)=>e.getTime()-t.getTime()))}getValidTimeForTime(e){const t=this.getValidTimes(arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),i=e.getTime();if(0===t.length)return;let r=t[0],a=Math.abs(i-r.getTime());return t.forEach(((e,t)=>{const s=e.getTime(),n=i-s;n>=0&&n<=a&&(a=n,r=e)})),r}setValidTimeRange(e){this.data.startDate=e.start,this.data.endDate=e.end,this.trigger(ps,{startDate:e.start,endDate:e.end})}getDatasetAtIndex(e){var t;return((null===(t=this.data)||void 0===t?void 0:t.datasets)||[])[e]}getDatasetValidTimesAtIndex(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.maxValidTimeIntervals;var i;const r=null===(i=this.data)||void 0===i?void 0:i.validTimes;if(le(r))return[];const a=Array.isArray(r[0])?r[e]:r;let s=At(a);return t>0&&a.length>t&&(s=((e,t,i,r)=>{if(le(t)||le(i))return[];const a=e.filter((e=>e>=t&&e<=i));if(a.length<=r)return a;const s=a.length/(r-1),n=[];for(let e=0;e<r;e++){const t=Math.min(Math.floor(e*s),a.length-1);n.push(a[t])}return n})(s,this.data.startDate,this.data.endDate,t)),s.sort()||[]}setTransformer(e){this._transformer=e}setRequestTransformer(e){this._requestTransformer=e}load(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise(((t,i)=>{if(le(this.url))return le(this._data)&&(this._data={}),void t(this._data);if(this.isLoading)return void this.once(fs,(()=>{t(this._data)}));if(this._hasLoaded&&ve(this._data)&&!0!==e.reload)return void t(this._data);this._isLoading=!0,this.trigger(ms);let r=Object.assign({url:this.url,params:{startDate:this.data.startDate.toISOString(),endDate:this.data.endDate.toISOString()}},e);this._requestTransformer&&(r=this._requestTransformer(r));const a=r.params,s=Ct(r.url,a);this._lastRequestOptions=Object.assign({},r),fetch(s,us(r,["headers","params"])).then((e=>(e?e.status>=400&&i(new Error("[MapsGL] An error occurred while requesting metadata")):i(new Error("[MapsGL] No response for metadata request")),e.json()))).then((e=>this.processMetadata(e))).then((e=>{const i={};xe(null==a?void 0:a.startDate)&&xe(null==a?void 0:a.endDate)&&(i.range={start:new Date(a.startDate),end:new Date(a.endDate)}),this._data=Object.assign(Object.assign({},this.data),this._transformer(e,i)),this._isLoading=!1,this._hasLoaded=!0,t(this._data),this.trigger(fs,{metadata:this.data})})).catch((e=>{this._isLoading=!1,i(e),this.trigger(gs,{error:e})}))}))}processMetadata(e){return e}};class Ts extends dt{get type(){}get isReady(){return!0}constructor(e,t){if(super(),this.consumingLayers=[],ye(e))throw new Error("[MapsGL] Invalid value provided for the 'id' argument for the data source.");if(ye(t))throw new Error(`[MapsGL] Invalid configuration for data source {${e}}`);this.id=e,this.spec=Object.freeze(t);const i=us(t,["minZoom","maxZoom","projection","bounds","datasets"]);this.metadata=new Ss(t.metadataUrl,Object.assign(Object.assign({},i),t.timeSeries)),this.metadata.on(ps,(()=>{this.getMetadata({reload:!0})})),Jt(t.transformMetadataRequest)&&this.metadata.setRequestTransformer((e=>t.transformMetadataRequest(this,e))),Jt(t.transformMetadata)&&this.metadata.setTransformer(((e,i)=>t.transformMetadata(this,e,i)))}getMetadata(e){return Promise.resolve({})}addConsumer(e){this.consumingLayers.find((t=>t.layerId===e.layerId))||this.consumingLayers.push(e)}removeConsumer(e){this.consumingLayers=this.consumingLayers.filter((t=>t.layerId!==e.layerId))}removeConsumerForLayerId(e){const t=this.consumingLayers.find((t=>t.layerId===e));t&&this.removeConsumer(t)}dispose(){}}class Es extends Ts{}const Os=Ts,Cs="undefined"!=typeof navigator&&/iphone|ipad|ipod|android/i.test(navigator.userAgent),Rs=("undefined"!=typeof window&&window.matchMedia("(max-width: 767px)"),!("object"==typeof process&&"[object process]"===String(process)&&!process.browser)&&"undefined"!=typeof document),Ps=Rs&&Cs;let ks=Rs&&"complete"===document.readyState;const Ds=Rs?new Promise(((e,t)=>{ks?e(document):window.addEventListener("load",(()=>{ks=!0,e(document)}))})):Promise.resolve({}),zs=function(){let{width:e=800,height:t=600,dpi:i=window.devicePixelRatio||1,id:r="gl-canvas",insert:a=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const s=document.createElement("canvas");return s.id=r,s.width=e*i,s.height=t*i,s.style.width=Number.isFinite(e)?`${e}px`:"100%",s.style.height=Number.isFinite(t)?`${t}px`:"100%",a&&Ds.then((e=>{const t=e.body;t.insertBefore(s,t.firstChild)})),s},Is=e=>("undefined"==typeof window?1:window.devicePixelRatio)/(e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1),Fs=class extends dt{constructor(e,t){super(),this._isAuthorizing=!1,this._requireToken=!0,this.account=e,this._server=t||e.servers.mapsgl||zi}get credentials(){return this._token}get headers(){return this.isSessionValid?{Authorization:this.credentials?`Bearer ${this.credentials.accessToken}`:void 0}:{}}get isSessionValid(){var e,t;return!le(null===(e=this.credentials)||void 0===e?void 0:e.accessToken)&&!le(null===(t=this.credentials)||void 0===t?void 0:t.expires)&&this.credentials.expires.getTime()>=Date.now()}authenticate(){return this.getAccessToken().then((()=>this.headers))}getAccessToken(){if(!this._requireToken)return Promise.resolve();if(this.isSessionValid)return new Promise((e=>{e()}));if(this._isAuthorizing)return new Promise((e=>{this.once("token",(()=>e()))}));this._isAuthorizing=!0;const e=Ct(`${this._server}/auth/token`),t=this.account,i=`${t.id}:${t.secret}`;return fetch(e.replace(/api-key=[^&]+$/,""),{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:`Basic ${window.btoa(i)}`},body:"grant_type=client_credentials"}).then((e=>{if(401===e.status)throw console.error("[MapsGL] Invalid Xweather access keys provided."),new Error("Invalid Xweather access keys provided.");return e.json()})).then((e=>{const t=new Date(e.expires);this._isAuthorizing=!1,this._token={accessToken:e.access_token,expires:new Date(t.getTime()+60*-t.getTimezoneOffset()*1e3),tokenType:e.token_type},this.trigger("token",{token:this.credentials})}))}};var Ls;!function(e){e[e.Initial=0]="Initial",e[e.Loading=1]="Loading",e[e.Processing=2]="Processing",e[e.Ready=3]="Ready",e[e.Expired=4]="Expired",e[e.Failed=5]="Failed",e[e.UpsampledOnly=6]="UpsampledOnly"}(Ls||(Ls={}));const js=e=>e*(Math.PI/180),Ns=e=>e*(180/Math.PI),Us=2*Math.PI*6371008.8,Vs=Us/2;var Bs=1e-6,$s="undefined"!=typeof Float32Array?Float32Array:Array;function qs(){var e=new $s(3);return $s!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Gs(e,t,i){var r=new $s(3);return r[0]=e,r[1]=t,r[2]=i,r}function Hs(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e}function Ws(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e}function Ys(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e}function Zs(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e}function Xs(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Qs(e,t){var i=e[0],r=e[1],a=e[2],s=t[0],n=t[1],o=t[2],l=Math.sqrt(i*i+r*r+a*a)*Math.sqrt(s*s+n*n+o*o),h=l&&Xs(e,t)/l;return Math.acos(Math.min(Math.max(h,-1),1))}Math,Math,Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var Ks,Js=Ws;function en(){var e=new $s(9);return $s!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function tn(e,t){var i=t[0],r=t[1],a=t[2],s=t[3],n=t[4],o=t[5],l=t[6],h=t[7],c=t[8],d=c*n-o*h,u=-c*s+o*l,p=h*s-n*l,m=i*d+r*u+a*p;return m?(e[0]=d*(m=1/m),e[1]=(-c*r+a*h)*m,e[2]=(o*r-a*n)*m,e[3]=u*m,e[4]=(c*i-a*l)*m,e[5]=(-o*i+a*s)*m,e[6]=p*m,e[7]=(-h*i+r*l)*m,e[8]=(n*i-r*s)*m,e):null}function rn(e,t,i){var r=i[0],a=i[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=a*t[3],e[4]=a*t[4],e[5]=a*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function an(e,t,i,r){var a=new $s(4);return a[0]=e,a[1]=t,a[2]=i,a[3]=r,a}function sn(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e}function nn(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}function on(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e[3]=t[3]*i[3],e}function ln(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e[3]=t[3]/i[3],e}function hn(e){return Math.hypot(e[0],e[1],e[2],e[3])}function cn(e,t){var i=t[0],r=t[1],a=t[2],s=t[3],n=i*i+r*r+a*a+s*s;return n>0&&(n=1/Math.sqrt(n)),e[0]=i*n,e[1]=r*n,e[2]=a*n,e[3]=s*n,e}function dn(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function un(e,t){var i=e[0],r=e[1],a=e[2],s=e[3],n=t[0],o=t[1],l=t[2],h=t[3];return Math.abs(i-n)<=Bs*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(r-o)<=Bs*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(a-l)<=Bs*Math.max(1,Math.abs(a),Math.abs(l))&&Math.abs(s-h)<=Bs*Math.max(1,Math.abs(s),Math.abs(h))}function pn(){var e=new $s(4);return $s!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}qs(),Ks=new $s(4),$s!=Float32Array&&(Ks[0]=0,Ks[1]=0,Ks[2]=0,Ks[3]=0);var mn=an,fn=dn,gn=hn,vn=cn,yn=un;qs(),Gs(1,0,0),Gs(0,1,0),pn(),pn(),en();class xn{get x(){return this._value[0]}set x(e){this._value[0]=e,this.triggerChange()}get y(){return this._value[1]}set y(e){this._value[1]=e,this.triggerChange()}get z(){return this._value[2]}set z(e){this._value[2]=e,this.triggerChange()}get w(){return this._value[3]}set w(e){this._value[3]=e,this.triggerChange()}get value(){return this._value}get elements(){return this.value.length}constructor(e=0,t=0,i=0,r=0){this._changeCallbacks=[],this._value=mn(e,t,i,r)}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this.triggerChange(),this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromObject(e){let{x:t,y:i,z:r,w:a}=e;return void 0!==t&&(this.x=t),void 0!==i&&(this.y=i),void 0!==r&&(this.z=r),void 0!==a&&(this.w=a),this.triggerChange(),this}toObject(){return{x:this.x,y:this.y}}fromAxisAngle(e,t){return function(e,t,i){i*=.5;var r=Math.sin(i);e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(i)}(this.value,e.value,t),this.triggerChange(),this}fromEuler(e){return function(e,t,i,r){var a=.5*Math.PI/180;t*=a,i*=a,r*=a;var s=Math.sin(t),n=Math.cos(t),o=Math.sin(i),l=Math.cos(i),h=Math.sin(r),c=Math.cos(r);e[0]=s*l*c-n*o*h,e[1]=n*o*c+s*l*h,e[2]=n*l*h-s*o*c,e[3]=n*l*c+s*o*h}(this.value,Ns(e.x),Ns(e.y),Ns(e.z)),this.triggerChange(),this}fromRotationMatrix(){return this}set(e,t,i,r){return this._value=mn(e,t,i,r),this.triggerChange(),this}length(){return gn(this.value)}clone(){return(new xn).copy(this)}copy(e){let t=0;for(;t<this.value.length;)this.value[t]=e.value[t],t+=1;return this.triggerChange(),this}equals(e){return yn(this.value,e.value)}identity(){var e;return(e=this.value)[0]=0,e[1]=0,e[2]=0,e[3]=1,this.triggerChange(),this}invert(){return function(e,t){var i=t[0],r=t[1],a=t[2],s=t[3],n=i*i+r*r+a*a+s*s,o=n?1/n:0;e[0]=-i*o,e[1]=-r*o,e[2]=-a*o,e[3]=s*o}(this.value,this.value),this.triggerChange(),this}normalize(){return vn(this.value,this.value),this.triggerChange(),this}dot(e){return fn(this.value,e.value)}angleTo(e){return t=fn(this.value,e.value),Math.acos(2*t*t-1);var t}onChange(e){this._changeCallbacks.includes(e)||this._changeCallbacks.push(e)}triggerChange(){this._changeCallbacks.forEach((e=>e()))}}const bn=xn,wn=class{get value(){return null}fromArray(e){return this}toArray(){return[]}};class _n extends wn{get value(){return this._value}get x(){return this.value[0]}set x(e){this.value[0]=e}get y(){return this.value[1]}set y(e){this.value[1]=e}get z(){return this.value[2]}set z(e){this.value[2]=e}get elements(){return this.value.length}constructor(e=0,t=0,i=0){super(),this._value=Gs(e,t,i)}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t+0],this.y=e[t+1],this.z=e[t+2],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t+0]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromObject(e){let{x:t,y:i,z:r}=e;return void 0!==t&&(this.x=t),void 0!==i&&(this.y=i),void 0!==r&&(this.z=r),this}toObject(){return{x:this.x,y:this.y,z:this.z}}set(e,t,i){return this._value=Gs(e,t,i),this}setScalar(e){return this.set(e,e,e)}length(){return e=this.value,Math.hypot(e[0],e[1],e[2]);var e}distanceToSquared(e){return(r=(i=e.value)[0]-(t=this.value)[0])*r+(a=i[1]-t[1])*a+(s=i[2]-t[2])*s;var t,i,r,a,s}angle(){const e=Gs(1,0,0);return Qs(this.value,e)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}clone(){return new _n(this.x,this.y,this.z)}add(e){return Hs(this.value,this.value,e.value),this}addScalar(e){return Hs(this.value,this.value,Gs(e,e,e)),this}subtract(e){return Ws(this.value,this.value,e.value),this}subtractScalar(e){return Ws(this.value,this.value,Gs(e,e,e)),this}subVectors(e,t){return Js(this.value,e.value,t.value),this}multiply(e){return Ys(this.value,this.value,e.value),this}multiplyScalar(e){return Ys(this.value,this.value,Gs(e,e,e)),this}divide(e){return Zs(this.value,this.value,e.value),this}divideScalar(e){return Zs(this.value,this.value,Gs(e,e,e)),this}distanceTo(e){return t=this.value,i=e.value,Math.hypot(i[0]-t[0],i[1]-t[1],i[2]-t[2]);var t,i}angleTo(e){return Qs(this.value,e.value)}dot(e){return Xs(this.value,e.value)}equals(e){return r=(t=this.value)[0],a=t[1],s=t[2],n=(i=e.value)[0],o=i[1],l=i[2],Math.abs(r-n)<=Bs*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(a-o)<=Bs*Math.max(1,Math.abs(a),Math.abs(o))&&Math.abs(s-l)<=Bs*Math.max(1,Math.abs(s),Math.abs(l));var t,i,r,a,s,n,o,l}lerp(e,t){var i,r,a,s,n,o,l;return o=(r=this.value)[1],l=r[2],(i=this.value)[0]=(n=r[0])+(s=t)*((a=e.value)[0]-n),i[1]=o+s*(a[1]-o),i[2]=l+s*(a[2]-l),this}normalize(){return function(e,t){var i=t[0],r=t[1],a=t[2],s=i*i+r*r+a*a;s>0&&(s=1/Math.sqrt(s)),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s}(this.value,this.value),this}scale(e){var t,i,r;return(t=this.value)[0]=(i=this.value)[0]*(r=e),t[1]=i[1]*r,t[2]=i[2]*r,this}applyEuler(e){const t=(new bn).fromEuler(e);return this.applyQuaternion(t)}applyMatrix3(e){return function(e,t,i){var r=t[0],a=t[1],s=t[2];e[0]=r*i[0]+a*i[3]+s*i[6],e[1]=r*i[1]+a*i[4]+s*i[7],e[2]=r*i[2]+a*i[5]+s*i[8]}(this.value,this.value,e.value),this}applyMatrix4(e){return function(e,t,i){var r=t[0],a=t[1],s=t[2],n=i[3]*r+i[7]*a+i[11]*s+i[15];e[0]=(i[0]*r+i[4]*a+i[8]*s+i[12])/(n=n||1),e[1]=(i[1]*r+i[5]*a+i[9]*s+i[13])/n,e[2]=(i[2]*r+i[6]*a+i[10]*s+i[14])/n}(this.value,this.value,e.value),this}applyQuaternion(e){return function(e,t,i){var r=i[0],a=i[1],s=i[2],n=t[0],o=t[1],l=t[2],h=a*l-s*o,c=s*n-r*l,d=r*o-a*n,u=a*d-s*c,p=s*h-r*d,m=r*c-a*h,f=2*i[3];c*=f,d*=f,p*=2,m*=2,e[0]=n+(h*=f)+(u*=2),e[1]=o+c+p,e[2]=l+d+m}(this.value,this.value,e.value),this}negate(){for(let e=0;e<this.elements;++e)this.value[e]=-this.value[e];return this}}const Mn=_n;var An;!function(e){e.mercator="mercator"}(An||(An={}));const Sn=85.0511287798,Tn=e=>(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360,En=e=>360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90,On=class{get type(){return An.mercator}project(e,t){e=Pe(e,-85.0511287798,Sn);const i=(e=>(180+e)/360)(t);return{x:i,y:Tn(e),z:0}}unproject(e,t){const i=(e=>360*e-180)(e);return{lat:En(t),lon:i}}projectTilePoint(e,t){return{x:e,y:t}}pixelsPerMeter(e,t){return((e,t)=>1/(e=>Us*Math.cos(e*Math.PI/180))(t))(0,e)*t}upVector(e){return new Mn(0,0,1)}upVectorScale(e,t,i){return{metersToTile:1,metersToLabelSpace:1}}},Cn=e=>Us*Math.cos(e*Math.PI/180),Rn=e=>(180+e)/360,Pn=e=>(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360,kn=e=>360*e-180,Dn=e=>360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90;class zn{constructor(e,t,i=0){this.x=0,this.y=0,this.z=0,this.x=e,this.y=t,this.z=i}static fromCoordinate(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new zn(Rn(e.lon),Pn(e.lat),((e,t)=>e/Cn(t))(t,e.lat))}toCoordinate(){return{lon:kn(this.x),lat:Dn(this.y)}}toAltitude(){return this.z*Cn(Dn(this.y))}meterInMercatorCoordinateUnits(e){const t=Pn(e);return 1/Us*(e=>1/Math.cos(e*Math.PI/180))(Dn(t))}}const In=zn,Fn=512,Ln=(Math,Math,e=>Math.pow(2,e)),jn=function(e){return 1/Ln(e)},Nn=(e,t,i)=>({x:e*Us/Math.pow(2,i)-Vs,y:-(t*Us/Math.pow(2,i)-Vs)}),Un=e=>{const{x:t,y:i,z:r}=e,a=Math.pow(2,r),s=t/a*360-180,n=Math.PI-2*Math.PI*i/a;return{lat:180/Math.PI*Math.atan(.5*(Math.exp(n)-Math.exp(-n))),lon:s}},Vn=e=>{const t=Un({x:e.x,y:e.y,z:e.z}),i=Un({x:e.x+1,y:e.y+1,z:e.z});return{north:t.lat,south:i.lat,west:t.lon,east:i.lon}},Bn=e=>{const t=1/Math.pow(2,e.z);return{x:t*e.x,y:t*e.y}},$n=(e,t)=>{const{lat:i,lon:r}=e,a=Math.floor(t),s=Pe(i,-85.0511287798,Sn),n=js(s);return{x:Math.floor((r+180)/360*Math.pow(2,a)),y:Math.floor((1-Math.log(Math.tan(n)+1/Math.cos(n))/Math.PI)/2*Math.pow(2,a)),z:a}},qn=(e,t)=>{const i=Hn(e);return $n(i,t)},Gn=e=>({x:Rn(e.lon),y:Pn(e.lat)}),Hn=e=>({lat:Dn(e.y),lon:kn(e.x)}),Wn=function(e,t){return arguments.length>2&&void 0!==arguments[2]&&!arguments[2]?e.lat<t.north&&e.lat>t.south&&e.lon>t.west&&e.lon<t.east:e.lat<=t.north&&e.lat>=t.south&&e.lon>=t.west&&e.lon<=t.east},Yn=(e,t)=>(e%t+t)%t;class Zn{get hash(){return`${this.wrap}:${this.z}/${this.x}/${this.y}`}get wrap(){const e=Math.pow(2,this.z);return Math.floor(this.x/e)}get isRoot(){return 0===this.z}constructor(e,t,i){this.x=t,this.y=i,this.z=e}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}normalize(){const e=Math.pow(2,this.z);return new Zn(this.z,Yn(this.x,e),Yn(this.y,e))}getAncestor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const t=Math.pow(2,e);return new Zn(this.z-e,Math.floor(this.x/t),Math.floor(this.y/t))}getDescendants(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const t=Math.pow(2,e),i=Array.from({length:t*t});for(let r=0;r<t;r++){const a=r*t;for(let s=0;s<t;s++)i[a+s]=new Zn(this.z+e,this.x*t+r,this.y*t+s)}return i}getNeighbor(e,t){const{x:i,y:r,z:a,wrap:s}=this,n=Math.pow(2,a);let o=0,l=0,h=0;return 0===a?(o=i,h=s+e):(o=i+e,l=r+t,h=i+e<0?s-1:i+e>n?s+1:s),l<0||l>=n?null:new Zn(a,o,l)}getNeighbors(){const[e,t,i,r,a,s]=[-1,0,1,-1,0,1];return{tl:this.getNeighbor(e,r),tc:this.getNeighbor(t,r),tr:this.getNeighbor(i,r),ml:this.getNeighbor(e,a),mc:this,mr:this.getNeighbor(i,a),bl:this.getNeighbor(e,s),bc:this.getNeighbor(t,s),br:this.getNeighbor(i,s)}}getQuadrant(){return[this.x%2,this.y%2]}isAncestorOf(e){if(this.z>=e.z)return!1;const t=Math.pow(2,e.z-this.z),i=Math.floor(e.x/t),r=Math.floor(e.y/t);return this.x===i&&this.y===r}isDescendantOf(e){return e.isAncestorOf(this)}getPosition(){const e=Ln(this.z);return{x:this.x/e,y:this.y/e}}getCenter(){const e=Ln(this.z);return{x:(this.x+.5)/e,y:(this.y+.5)/e}}toString(){return`TileCoord: ${this.z}/${this.x}/${this.y}, wrap: ${this.wrap}`}toInfo(){return{z:this.z,x:this.x,y:this.y}}static fromHash(e){const t=(e||"").replace(/^\d+:/,"").split("/").map((e=>Number.parseInt(e,10)));return new Zn(t[0],t[1],t[2])}}const Xn=Zn;class Qn{get coord(){return this._coord}get span(){return this._span}get bounds(){return this._bounds}get state(){return this._state}set state(e){this._state=e}get data(){return this._data}set data(e){this._data=e}get size(){const e=this.data;let t={width:Fn,height:Fn};if(e instanceof HTMLImageElement)t.width=e.width,t.height=e.height;else if(e instanceof vr)t=e.size;else if(Array.isArray(e)){const i=e[0];i instanceof vr&&(t=i.size)}return t}constructor(e){this.uid=Et++,this._coord=e;const t=e.x,i=e.y,r=e.z,a=Nn(t,i,r),s=Nn(t+1,i+1,r);this._span={x:s.x-a.x,y:-(s.y-a.y)},this._bounds={nw:{x:a.x,y:s.y},se:{x:s.x,y:a.y}},this._state=Ls.Initial}clone(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this.coord;0!==e&&(t=new Xn(t.z,t.x+e*Math.pow(2,t.z),t.y));const i=new Qn(t);return i.state=this.state,i.data=this.data,i}dispose(){const e=this.data;Jt(null==e?void 0:e.dispose)&&e.dispose()}toString(){return`Tile: ${this.coord.toString()}`}}const Kn=Qn;class Jn{constructor(e,t,i,r){this.value=e,this.list=r,t?(t.next=this,this.prev=t):this.prev=void 0,i?(i.prev=this,this.next=i):this.next=void 0}}const eo=class{constructor(){this._head=void 0,this._tail=void 0}*items(){let e=this._head||this._tail;for(;e;)yield e,e=e.next}get size(){let e=0;return this.forEach((t=>e+=1)),e}get head(){return this._head}get tail(){return this._tail}push(e){const t=new Jn(e,this._tail,void 0,this);return this._tail=t,this._head||(this._head=t),t}unshift(e){const t=new Jn(e,void 0,this._head,this);return this._head=t,this._tail||(this._tail=t),t}pop(){if(!this._tail)return;const e=this._tail;return this._tail=e.prev,this._tail?this._tail.next=void 0:this._head=void 0,e.value}shift(){if(!this._head)return;const e=this._head;return this._head=e.next,this._head?this._head.prev=void 0:this._tail=void 0,e.value}find(e){if(this.isEmpty())return;let t=this._head;for(;t;){if(e(t.value))return t;t=t.next}}isEmpty(){return!this._head}forEach(e){let t=this._head||this._tail;for(let i=0;null!==t;i++)e(t.value,i),t=t.next}pushNode(e){if(e===this._tail)return;e.list&&e.list.removeNode(e);const t=this._tail;e.list=this,e.prev=t,t&&(t.next=e),this._tail=e,this._head||(this._head=e)}unshiftNode(e){if(e===this._head)return;e.list&&e.list.removeNode(e);const t=this._head;e.list=this,e.next=t,t&&(t.prev=e),this._head=e,this._tail||(this._tail=e)}removeNode(e){if(e.list!==this)throw new Error("Removing list node which does not belong to this list.");const t=e.next,i=e.prev;t&&(t.prev=i),i&&(i.next=t),e===this._head&&(this._head=t),e===this._tail&&(this._tail=i),this._head&&(this._head.prev=void 0),this._tail&&(this._tail.next=void 0),e.next=void 0,e.prev=void 0,e.list=void 0}delete(e){let t=!1;for(;this._head&&this._head.value===e;)t=!0,this._head=this._head.next;return t}clear(){this._head=void 0,this._tail=void 0}},to=class{get size(){return this._cache.size}get cache(){return this._cache}get first(){return this._list.head.value.val}get last(){return this._list.tail.value.val}*keys(){for(const e of this._list.items())yield e.value.key}*values(){for(const e of this._list.items())yield e.value.val}*entries(){for(const e of this._list.items()){const t={key:e.value.key,val:e.value.val};yield t}}constructor({capacity:e=200,ttl:t=0,onRemove:i=(()=>{})}={}){this.capacity=20,this._ttl=0,this._cache=new Map,this._list=new eo,this.capacity=Math.max(1,e||256),this._ttl=t,this._onRemove=i}has(e){return this._cache.has(e)}get(e){const t=this._cache.get(e);if(t){if(!this._isExpired(t.value))return this._bumpAge(t.value),t.value.val;this.delete(t.value.key)}}peek(e){const t=this._cache.get(e);if(t)return t.value.val}set(e,t){const i=this._cache.get(e);if(i){const e=i.value;return e.val!==t&&(this._onRemove(e.key,e.val),e.val=t),void this._bumpAge(e)}const r={key:e,val:t,exp:Date.now()+this._ttl,node:void 0},a=this._list.unshift(r);if(this._cache.set(e,a),r.node=a,this._cache.size>this.capacity){const e=this._list.pop();this.delete(e.key)}}delete(e){const t=this._cache.get(e);if(!t)return;const i=t.value;return this._onRemove(i.key,i.val),this._cache.delete(e),this._list.removeNode(t),i.val}clear(){this.forEach((e=>{this._onRemove(e.key,e.val)})),this._cache.clear(),this._list.clear()}forEach(e){if(Jt(e))for(const[t,i]of this._cache)e(i.value)}_bumpAge(e){e.exp=Date.now()+this._ttl,this._list.unshiftNode(e.node)}_isExpired(e){return this._ttl>0&&e.exp<Date.now()}},io=e=>Math.log2(e)%1==0,ro=class{get identifier(){return this._identifier}set identifier(e){this._identifier=e}get context(){return this._context}set context(e){this._context=e}get gl(){return this.context.gl}constructor(e){this._context=e}},ao="[AerisGL] Resource subclass must define virtual methods";let so=1;const no=new Set,oo=class extends ro{get handle(){return this._handle}static get resourceCount(){return no.size}constructor(e,t={}){super(e);const{name:i}=t||{};this.id=so,this.name=i,this.opts=Object.assign({},t),so+=1,void 0===this.handle&&(this._handle=this.createHandle())}dispose(){throw new Error(`${this.constructor.name} - ${ao}`)}getParameter(e){throw new Error(`${this.constructor.name} - ${ao}`)}setParameter(e,t){throw new Error(`${this.constructor.name} - ${ao}`)}createHandle(){throw new Error(`${this.constructor.name} - ${ao}`)}deleteHandle(){throw new Error(`${this.constructor.name} - ${ao}`)}getOptsFromHandle(e){throw new Error(`${this.constructor.name} - ${ao}`)}incrementResourceCount(){no.has(this.id)||no.add(this.id)}decrementResourceCount(){no.delete(this.id)}toString(){return`${this.constructor.name}(${this.id})`}},lo=class extends oo{get version(){return this._state.version}constructor(e,t={}){super(e,Object.assign(((e,t)=>({type:e.UNSIGNED_BYTE,format:e.RGBA,internalFormat:t.format||e.RGBA,wrapS:e.CLAMP_TO_EDGE,wrapT:e.CLAMP_TO_EDGE,generateMipmaps:!0,minFilter:t.generateMipmaps?e.LINEAR_MIPMAP_LINEAR:e.LINEAR,magFilter:e.LINEAR,premultiplyAlpha:!1,unpackAlignment:4,flipY:!1,anisotropy:0,level:0}))(e.gl,t),t)),this.size={width:0,height:0},this.needsUpdate=!1,this.textureUnit=0,this.image=this.opts.image,this.type=this.opts.type,this.format=this.opts.format,this.internalFormat=this.opts.internalFormat,this.wrapS=this.opts.wrapS,this.wrapT=this.opts.wrapT,this.minFilter=this.opts.minFilter,this.magFilter=this.opts.magFilter,this.generateMipmaps=this.opts.generateMipmaps,this.premultiplyAlpha=this.opts.premultiplyAlpha,this.unpackAlignment=this.opts.unpackAlignment,this.flipY=this.opts.flipY,he(this.opts.size)&&this.opts.size.width>0&&this.opts.size.height>0&&(this.size=this.opts.size),this._state={},this._state.version=-1,this.needsUpdate=!0,this.update()}updateImage(e,t,i,r,a){const s=this.gl;this.bind(),this.updateContextState(),ArrayBuffer.isView(e)?s.texSubImage2D(s.TEXTURE_2D,0,t,i,r,a,this.format,this.type,e):(e=>e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap)(e)&&s.texSubImage2D(s.TEXTURE_2D,0,t,i,this.format,this.type,e)}update(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const t=this.gl,i=!(this.image===this._state.image&&!this.needsUpdate);if((i||this.context.state.textureUnits[e]!==this.id||this.context.state.activeTextureUnit!==e)&&(this.context.state.setActiveTexture(e),this.bind(e)),!i)return;this.needsUpdate=!1,this.wrapS!==this._state.wrapS&&(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,this.wrapS),this._state.wrapS=this.wrapS),this.wrapT!==this._state.wrapT&&(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,this.wrapT),this._state.wrapT=this.wrapT),this.minFilter!==this._state.minFilter&&(t.texParameteri(t.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.minFilter),this._state.minFilter=this.minFilter),this.magFilter!==this._state.magFilter&&(t.texParameteri(t.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.magFilter),this._state.magFilter=this.magFilter),this.updateContextState();const r=this.image;r?(r.width&&(this.size={width:r.width,height:r.height}),ArrayBuffer.isView(r)?t.texImage2D(t.TEXTURE_2D,0,this.internalFormat,this.size.width,this.size.height,0,this.format,this.type,r):t.texImage2D(t.TEXTURE_2D,0,this.internalFormat,this.format,this.type,r),this.generateMipmaps&&(this.context.isWebGL2||io(r.width)&&io(r.height)?this.gl.generateMipmap(t.TEXTURE_2D):(this.generateMipmaps=!1,this.wrapS=this.wrapT=this.gl.CLAMP_TO_EDGE,this.minFilter=this.gl.LINEAR)),this.onUpdate&&this.onUpdate()):this.size.width>0?t.texImage2D(t.TEXTURE_2D,0,this.internalFormat,this.size.width,this.size.height,0,this.format,this.type,null):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this._state.image=this.image,this._state.version+=1}bind(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.textureUnit;const t=this.gl;this.textureUnit=e,this.context.state.textureUnits[e]=this.id,t.bindTexture(t.TEXTURE_2D,this.handle)}unbind(){Zt(he(this.textureUnit),"[AerisGL] Texture.unbind: must specify texture unit");const e=this.gl;e.activeTexture(e.TEXTURE0+this.textureUnit),e.bindTexture(e.TEXTURE_2D,null),delete this.context.state.textureUnits[this.textureUnit]}updateContextState(){this.context.state.setPixelStoreFlipY(this.flipY),this.context.state.setPixelStoreUnpackPremultiplyAlpha(this.premultiplyAlpha),this.context.state.setPixelStoreUnpackAlignment(this.unpackAlignment)}createHandle(){return this.incrementResourceCount(),this.gl.createTexture()}deleteHandle(){this.handle&&(this.gl.deleteTexture(this.handle),this.decrementResourceCount()),this._handle=void 0}dispose(){this.unbind(),this.deleteHandle(),this.image=void 0,this._state.image=void 0}toString(){return`${this.constructor.name}:${this.id} - size: ${this.size.width}x${this.size.height}`}},ho=class{get available(){return this._available.length}get used(){return this._used.size}constructor(e,t={}){const{capacity:i=256,size:r={width:256,height:256}}=t,a=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(i[r[a]]=e[r[a]])}return i}(t,["capacity","size"]);this.context=e,this._available=Array.from({length:i}),this._used=new Map,this._textureOpts=Object.assign({},a),this._blank=new lo(e,Object.assign({size:r},a)),this.resize(r)}resize(e){this._size=e;const t=this._available.length+this._used.size;this._used=new Map;for(let i=0;i<t;i++)this._available[i]={data:void 0,texture:new lo(this.context,Object.assign({size:e},this._textureOpts))}}has(e){return this._used.has(e)}get(e){return this._used.get(e)}set(e,t,i,r){let a=this.get(e);if(a&&!0!==i)return a;if(0===this._available.length)return void console.error("[MapsGL] No available texture chunks in array");a||(a=this._available.pop());const s=(e=>{let t=e;return Array.isArray(t)&&(t=t[0]),t})(t);return a.data=t,a.texture.image=s,he(r)&&r.width>0&&r.height>0&&(a.texture.size=r),this._used.set(e,a),a}delete(e){if(!this.has(e))return{texture:this._blank};const t=this._used.get(e);t.texture.image=void 0,this._used.delete(e),this._available.push(t)}clear(){const e=this._available.length+this._used.size;this._available.forEach((e=>{var t;null===(t=e.texture)||void 0===t||t.dispose()})),this._used=new Map;for(let t=0;t<e;t++)this._available[t]={data:void 0,texture:new lo(this.context,Object.assign({size:this._size},this._textureOpts))}}dispose(){this._blank.dispose(),this._available.forEach((e=>{var t;null===(t=e.texture)||void 0===t||t.dispose()})),this._used=new Map,this._available=[]}},co=class{get capacity(){return this._tiles.capacity+1/3*(Math.pow(4,this._persistantLevels)-1)}get keys(){return[...this._tiles.cache.keys()]}get levels(){return this._levels}get total(){return this._tiles.size}get totalPending(){return this._pending.size}get totalStale(){return this._stale.size}get textures(){return this._textures}constructor(e=128){this._persistantLevels=0,this._removeCallbacks=[],this._tiles=new to({capacity:e,onRemove:(e,t)=>{this.remove(t)}}),this._textureDataProvider=e=>e,this._levels=new Map,this._persistants=new Map,this._pending=new Map,this._stale=new Map,this._persistantLevels=1}has(e){return e.z<this._persistantLevels?this._persistants.has(e.hash):this._tiles.has(e.hash)}get(e){return ye(e)?null:e.z<this._persistantLevels?this._persistants.get(e.hash):this._tiles.get(e.hash)}add(e,t){if(!ye(e)&&(e.coord.z<this._persistantLevels?this._persistants.set(e.coord.hash,e):this._tiles.set(e.coord.hash,e),this._levels.has(e.coord.z)||this._levels.set(e.coord.z,[]),this._levels.get(e.coord.z).push(e),this.textures)){const i=this._textureDataProvider(e.data);he(i)&&this.textures.set(e.coord.hash,i,!0,t)}}remove(e){e.coord.z<this._persistantLevels&&this._persistants.delete(e.coord.hash);const t=this._levels.get(e.coord.z);t&&(t.splice(t.indexOf(e),1),0===t.length&&this._levels.delete(e.coord.z)),this.textures&&this.textures.delete(e.coord.hash),Ie(e.data,["dispose"])&&e.data.dispose(),this._removeCallbacks.forEach((t=>t(e)))}isPending(e){return this._pending.has(e.hash)}isStale(e){return this._stale.has(e.coord.hash)}setPending(e,t){t?this._pending.set(e.coord.hash,e):this._pending.delete(e.coord.hash)}setStale(e,t){t?this._stale.set(e.coord.hash,!0):this._stale.delete(e.coord.hash)}setTextureDataProvider(e){this._textureDataProvider=e}clearPending(){this._pending.forEach((e=>{this._stale.set(e.coord.hash,!0)})),this._pending=new Map}clear(){var e;this.clearPending(),this._persistants.forEach((e=>{this.remove(e)})),this._persistants.clear(),this._tiles.clear(),this._stale.clear(),this._levels.clear(),null===(e=this._textures)||void 0===e||e.clear()}forEach(e){this._persistants.forEach((t=>e(t))),this._tiles.forEach((t=>e(t.val)))}prepareTextureArray(e,t){this._textures||(this._textures=new ho(e,t))}onRemove(e){this._removeCallbacks.push(e)}dispose(){var e;this.clear(),null===(e=this._textures)||void 0===e||e.dispose()}},uo=class{constructor(){this.pending=new Map}get size(){return this.pending.size}isPending(e,t){const i=this.pending.get(e.hash);return!!i&&i.has(t)}setPending(e,t,i){let r=this.pending.get(e.hash);r||(r=new Set,this.pending.set(e.hash,r)),he(t)&&t.forEach(i?e=>r.add(e):e=>r.delete(e)),0===r.size&&this.pending.delete(e.hash)}get(e){return this.pending.get(e.hash)}delete(e,t){he(t)?this.setPending(e,t,!1):this.pending.delete(e.hash)}clear(){this.pending.clear()}},po=class{get pending(){return this._pending}get totalPending(){return Object.keys(this._requests).length}constructor(e,t){this._pending=new uo,this._state=new Map,this._requests={},this._retries=new Map,this._source=e,this._tileFetcher=Jt(t)?t:function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{method:r="GET",body:a,headers:s,signal:n}=i;return fetch(t,{method:r,headers:s,body:"POST"===r&&xe(a)?JSON.stringify(a):void 0,signal:n}).then(Rt)}}setTileFetcher(e){this._tileFetcher=e}loadTile(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{authenticator:i,params:r,intervals:a}=t,s=this._source.getTileUrl(e,r),n=e.hash;let o;return he(a)&&Array.isArray(a)&&(o=a.filter((t=>!1===this.pending.isPending(e,t.getTime()))).map((e=>e.getTime())),0===o.length)?Promise.resolve({data:null,headers:null}):(this._requests[n]&&this.abortTile(e),new Promise(((r,a)=>{var l;this.pending.setPending(e,o,!0),this._requests[n]=new AbortController,t.authenticator&&(t.headers=Object.assign(Object.assign({},t.headers),{Authorization:(null===(l=t.authenticator.credentials)||void 0===l?void 0:l.accessToken)?`Bearer ${t.authenticator.credentials.accessToken}`:void 0})),this.fetchTile(e,s,Object.assign({signal:this._requests[n].signal},t)).then((s=>{return l=this,void 0,c=function*(){if(this.pending.setPending(e,o,!1),delete this._requests[n],s){if(i&&401===s.status)return i.authenticate().then((()=>this.loadTile(e,t)));{const e=s instanceof Response?yield s.blob():s;r({data:e,headers:s.headers})}}else a(new Error("[MapsGL] No response for tile request"))},new((h=void 0)||(h=Promise))((function(e,t){function i(e){try{a(c.next(e))}catch(e){t(e)}}function r(e){try{a(c.throw(e))}catch(e){t(e)}}function a(t){var a;t.done?e(t.value):(a=t.value,a instanceof h?a:new h((function(e){e(a)}))).then(i,r)}a((c=c.apply(l,[])).next())}));var l,h,c})).catch((i=>{const l=this._requests[e.hash];if((null==l?void 0:l.signal.aborted)&&this.pending.setPending(e,o,!1),!l||!0!==(null==l?void 0:l.signal.aborted)){this.pending.setPending(e,o,!1);let l=this._retries.get(n);le(l)&&(l=0),l<1?setTimeout((()=>{l+=1,console.warn(`[MapsGL] Retrying failed tile request, attempt ${l} of 1; url: ${s}`),this._retries.set(n,l),r(this.loadTile(e,t))}),100):(console.error("[MapsGL] - Tile Error",i),a(i))}}))})))}fetchTile(e,t,i){if(this._source.spec.transformRequest){const e=this._source.spec.transformRequest(this._source,{url:t,options:i});t=e.url,i=e.options}return this._tileFetcher(e,t,i)}abortTile(e){this.abort(e.hash)}abort(e){const t=this._requests[e];t&&t.abort(),delete this._requests[e]}},mo=class{get credentials(){}get headers(){return{}}authenticate(){return Promise.resolve({})}};var fo=function(e,t,i,r){return new(i||(i=Promise))((function(a,s){function n(e){try{l(r.next(e))}catch(e){s(e)}}function o(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,o)}l((r=r.apply(e,t||[])).next())}))},go=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(i[r[a]]=e[r[a]])}return i};const vo=class extends Os{get tileUrl(){return this._url}get tileSize(){return"number"==typeof this.spec.tileSize?{width:this.spec.tileSize,height:this.spec.tileSize}:this.spec.tileSize}get tileManager(){return this._tileManager}get tiles(){return this._tiles}get bounds(){var e;return null===(e=this.metadata)||void 0===e?void 0:e.bounds}get isReady(){return!this.needsMetadata||this.metadata.hasLoaded}get isLoading(){return Object.keys(this._requests).length>0}get needsMetadata(){return xe(this.spec.metadataUrl)}constructor(e,t){super(e,Object.assign({tileSize:Fn},t)),this.minZoom=0,this.maxZoom=21,this._requests={},this._tileRetries=new Map,this._triggerLoadCompleteEvent=!1,this._isDisposed=!1,this.shouldTriggerLoadEvents=!0,this.authenticator=this.spec.authenticator||new mo,this._url=this.spec.url,this.minZoom=he(t.minZoom)?t.minZoom:0,this.maxZoom=he(t.maxZoom)?t.maxZoom:21,this.metadata.on(ms,(e=>{this.trigger(ms,Object.assign({},e))})),this.metadata.on(fs,(e=>{this.trigger(fs,Object.assign({},e))})),this.metadata.on(gs,(e=>{this.trigger(gs,Object.assign({},e))})),this._tileManager=new po(this),this._tiles=new co,this.tiles.onRemove((e=>{const t=this._requests[e.coord.hash];t&&t.abort(),e.dispose(),this.trigger("tile:remove",{sourceId:this.id,tile:e})})),this.metadata.setTransformer(((e,i)=>{Jt(t.transformMetadata)&&(e=t.transformMetadata(this,e,i));const r=Object.assign(Object.assign({},this.metadata.data),e);return r.maxZoom=he(e.maxZoom)?e.maxZoom:this.maxZoom,r.validTimes=At(r.validTimes),r})),t.loadTile&&this.tileManager.setTileFetcher(((e,i,r)=>t.loadTile(e,i,r)))}generateTile(e){return new Kn(e)}setTileUrl(e){this._url=e,this.trigger(ys,{source:this})}getTileUrl(e,t){return Ct(this.tileUrl,Object.assign(Object.assign({},t),{x:e.x,y:e.y,z:e.z,s:Math.abs(e.x+e.y)%4+1,size:this.tileSize.width,width:this.tileSize.width,height:this.tileSize.height}))}hasTile(e,t){return he(this.tiles.get(e))}hasTileData(e,t){return!!this.hasTile(e,t)&&he(this.tiles.get(e).data)}getTileData(e){const t=this.tiles.get(e);return null==t?void 0:t.data}getTileDataSize(e){return this.tileSize}shouldRequestTile(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=this.tiles.get(e.coord);return!(i&&(!i||i.state!==Ls.Initial))||!0!==(i||this.tiles.isPending(e.coord)||i.state===Ls.Failed&&!t)}requestTile(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=t||{},{reload:r=!1,checkPending:a=!0}=i,s=go(i,["reload","checkPending","body"]),{time:n}=s.params||{};if(this._isDisposed)return;this.shouldTriggerLoadEvents&&0===this.tiles.totalPending&&(this.trigger(Ms,{sourceId:this.id}),this._triggerLoadCompleteEvent=!0);let o=this.tiles.get(e);if(o||(o=this.generateTile(e),this.tiles.add(o)),!this.shouldRequestTile(o,r)&&a)return new Promise((e=>{e(null)}));if(this.metadata.getValidTimes().length>0){const e=this.metadata.getValidTimeForTime(n||new Date);if(n&&!e)return void console.warn(`[MapsGL] No data interval available for time ${null==n?void 0:n.toString()}`);he(e)&&(s.params=Object.assign(Object.assign({},s.params),{time:e}),t.intervals||(t.intervals=[e]))}return this.tiles.setStale(o,!1),this.tiles.setPending(o,!0),this.trigger(bs,{sourceId:this.id,tile:o}),this.getMetadata().then((()=>this.loadTile(o,t)))}loadTile(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=t||{},{reload:r=!1,checkPending:a=!0,body:s,intervals:n}=i,o=go(i,["reload","checkPending","body","intervals"]);return new Promise(((i,a)=>{e.state=Ls.Loading,this._tileManager.loadTile(e.coord,Object.assign({headers:Object.assign({},this.authenticator.headers),body:s,intervals:n,reload:r},o)).then((t=>fo(this,[t],void 0,(function*(t){let{data:r,headers:a}=t;if(!this._isDisposed&&he(r)){const t=yield this.parseTile(e,r,a);this.onTileLoaded(e,t),i(t)}})))).catch((r=>fo(this,void 0,void 0,(function*(){if((r instanceof yt&&401===r.response.status||r instanceof vt)&&this.authenticator){const r=yield this.authenticator.authenticate().then((()=>this.requestTile(e.coord,t)));i(r)}else this.onTileError(e,r),a(r)}))))}))}getMetadata(e){return this.authenticator.authenticate().then((()=>this.metadata.load(Object.assign(Object.assign({},e),{headers:this.authenticator.headers})))).then((()=>(he(this.metadata.minZoom)&&(this.minZoom=Math.max(this.minZoom,this.metadata.minZoom)),he(this.metadata.maxZoom)&&(this.maxZoom=Math.min(this.maxZoom,this.metadata.maxZoom)),this.metadata)))}removeConsumer(e){super.removeConsumer(e),0===this.consumingLayers.length&&this.cancelAllRequests()}abortTile(e){const t=e.coord.normalize(),i=this._requests[t.hash];i&&i.abort()}parseTile(e,t,i){return Promise.resolve(t)}handleTileResponse(e){}onTileLoaded(e,t){if(!this._isDisposed){if(e.data=t,e.state=Ls.Ready,this.tiles.setPending(e,!1),this.tiles.isStale(e))return this.tiles.setStale(e,!1),void this.trigger("tile:discard",{sourceId:this.id,tile:e});try{this.tiles.add(e,this.getTileDataSize(t))}catch(e){console.error("[MapsGL] Failed adding tile to cache",e)}this.trigger("tile:add",{tile:e}),this.trigger(xs,{sourceId:this.id,tile:e,pending:this.tiles.totalPending}),this.trigger(ws,{sourceId:this.id,tile:e}),this.trigger(vs,{source:this}),0===this.tiles.totalPending&&this._triggerLoadCompleteEvent&&(this.trigger(As,{sourceId:this.id}),this._triggerLoadCompleteEvent=!1)}}onTileError(e,t){this._isDisposed||(this.tiles.setPending(e,!1),e.state=Ls.Failed,this.trigger(_s,{sourceId:this.id,tile:e,error:t}),0===this.tiles.totalPending&&this._triggerLoadCompleteEvent&&(this.trigger(As,{sourceId:this.id}),this._triggerLoadCompleteEvent=!1))}cancelAllRequests(){this.tiles.clearPending(),Object.values(this._requests).forEach((e=>e.abort()))}expireAllTiles(){this.tiles.forEach((e=>{e.state===Ls.Ready&&(e.state=Ls.Expired)}))}dispose(){super.dispose(),this._isDisposed=!0,this.cancelAllRequests(),this._tileRetries.clear(),this._tiles.dispose()}};var yo=function(e,t){this.x=e,this.y=t},xo=function(){function e(e,t,i,r,a){for(this.reader=e,this.extent=a,this.type=0,this.properties={},this.geometryOffset=0;e.pos<t;){var s=e.tag(),n=s[0],o=s[1];if(1==n)this.id=e.int64().toString();else if(2==n)for(var l=e.uint32()+e.pos;e.pos<l;){var h=i[e.uint32()],c=r[e.uint32()];this.properties[h]=c}else 3==n?this.type=e.uint32():4==n&&(this.geometryOffset=e.pos,e.skip(o))}}var t=e.prototype;return t.loadGeometry=function(){this.reader.pos=this.geometryOffset;for(var e=this.reader.uint32()+this.reader.pos,t=1,i=0,r=0,a=0,s=[],n=null;this.reader.pos<e;){if(i<=0){var o=this.reader.uint32();t=7&o,i=o>>>3}var l;--i,1==t||2==t?(r+=this.reader.sint32(),a+=this.reader.sint32(),1==t&&(n&&s.push(n),n=[]),null==(l=n)||l.push(new yo(r,a))):7==t&&n&&n.push(new yo(n[0].x,n[0].y))}return n&&s.push(n),s},t.bbox=function(){this.reader.pos=this.geometryOffset;for(var e=this.reader.uint32()+this.reader.pos,t=0,i=0,r=0,a=0,s=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER,o=Number.MAX_SAFE_INTEGER,l=Number.MIN_SAFE_INTEGER;this.reader.pos<e;){if(i<=0){var h=this.reader.uint32();t=7&h,i=h>>>3}--i,1!=t&&2!=t||(r+=this.reader.sint32(),a+=this.reader.sint32(),n=Math.max(r,n),s=Math.min(r,s),l=Math.max(a,l),o=Math.min(a,o))}return[s,o,n,l]},t.toGeoJSON=function(e,t,i){var r,a=this.extent*Math.pow(2,i),s=this.extent*e,n=this.extent*t,o="",l=function(e){return e.map((function(e){return[360*(e.x+s)/a-180,360/Math.PI*Math.atan(Math.exp((180-360*(e.y+n)/a)*Math.PI/180))-90]}))};switch(this.type){case 1:o="Point",r=l(this.asPoints());break;case 2:o="LineString",r=this.asLines().map((function(e){return l(e)}));break;case 3:o="Polygon",(r=this.asPolygons()).forEach((function(e,t){e.forEach((function(e,i){r[t][i]=l(e)}))}))}1==r.length?r=r[0]:o="Multi"+o;var h={type:"Feature",geometry:{type:o,coordinates:r},properties:this.properties};return null!=this.id&&(h.id=this.id),h},t.asPoints=function(){var e=this.loadGeometry().map((function(e){return e[0]}));return 1==this.type?e:null},t.asLines=function(){return 2==this.type?this.loadGeometry():null},t.asPolygons=function(){return 3==this.type?function(e){var t=e.length;if(t<=1)return[e];for(var i=[],r=null,a=0;a<t;a++){var s,n=bo(e[a]);0!=n&&(n>0?(r&&i.push(r),r=[e[a]]):null==(s=r)||s.push(e[a]))}return r&&i.push(r),i}(this.loadGeometry()):null},e}();function bo(e){for(var t=0,i=0,r=e.length,a=r-1;i<r;a=i++){var s=e[i],n=e[a];t+=(n.x-s.x)*(s.y+n.y)}return t}var wo=i("JaUx"),_o=i.n(wo),Mo=i("cQc6"),Ao=i.n(Mo);const So=e=>Co/Fn*e,To=function(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(3===e)return((e,t)=>{const i={minX:Number.POSITIVE_INFINITY,minY:Number.POSITIVE_INFINITY,maxX:Number.NEGATIVE_INFINITY,maxY:Number.NEGATIVE_INFINITY};for(let t=0;t<e.length;t++){const r=e[t][0];for(let e=0;e<r.length;e++){const t=r[e];i.minX=Math.min(i.minX,t.x),i.minY=Math.min(i.minY,t.y),i.maxX=Math.max(i.maxX,t.x),i.maxY=Math.max(i.maxY,t.y)}}if(i.minX<Co&&i.minY<Co&&i.maxX>=0&&i.maxY>=0)return Object.assign(Object.assign({},i),{key:t})})(t,i);if(2===e);else if(1===e)return xe(r.collisionBox)?((e,t,i)=>{const r=e[0];return{minX:r.x+i.x1,minY:r.y+i.y1,maxX:r.x+i.x2,maxY:r.y+i.y2,key:t}})(t,i,r.collisionBox):function(e,t){const i=e[0],r=So(arguments.length>2&&void 0!==arguments[2]?arguments[2]:5);return{minX:i.x-r,minY:i.y-r,maxX:i.x+r,maxY:i.y+r,key:t}}(t,i,r.radius)},Eo=(e,t,i)=>{const r=i[0].map((e=>[e.x,e.y]));if(Ao()([e,t],r)){if(i.length>1)for(let r=1;r<i.length;r++){const a=i[r].map((e=>[e.x,e.y]));if(Ao()([e,t],a))return!1}return!0}return!1},Oo=class{constructor(){this.tree=new(_o())}populate(e){const t=e.map(((e,t)=>{let{type:i,geometry:r,properties:a}=e;return To(i,r,t,a)})).filter((e=>he(e)));this.tree.load(t)}insert(e,t,i){if(!t)return;const r=To(e,t,i);r&&this.tree.insert(r)}query(e,t,i,r){const a=this.within({minX:e,minY:t,maxX:e,maxY:t}).filter((a=>{const s=r.features[a.key];if(s.geometry){if(3===s.type){for(let i=0;i<s.geometry.length;i++)if(Eo(e,t,s.geometry[i]))return!0;return!1}if(1===s.type){const r=s.geometry,a=1-i%1*.5,n=xe(s.properties.collisionBox)?function(e,t,i,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;return e>=i.x+r.x1*a&&e<=i.x+r.x2*a&&t>=i.y+r.y1*a&&t<=i.y+r.y2*a}(e,t,r[0],s.properties.collisionBox,a):function(e,t,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const a=So(arguments.length>3&&void 0!==arguments[3]?arguments[3]:5)*r;return Math.hypot(i.x-e,i.y-t)<=a}(e,t,r[0],s.properties.radius,a);return!!n}}return!0}));return a}within(e){return this.tree.search(e)}collides(e){return this.tree.collides(e)}},Co=8192,Ro=class{get type(){throw new Error("Subclasses of VectorStore must override `type`")}get isEmpty(){return!1}get featureIndex(){return this._featureIndex}constructor(e){this.features=[],this.options=Object.freeze(e)}populate(e,t,i){const r=[],a={},s={};let n=0;for(let t=0;t<e.length;t++){const i=e[t],a=i.properties||{};Object.keys(a).forEach((e=>{ke(a[e])&&/^([[{])/.test(a[e])&&(a[e]=JSON.parse(a[e]))})),a.zoom=this.options.zoom,r.push(i instanceof xo?{type:i.type,featureIndex:n++,feature:i,sourceId:void 0,sourceLayerIndex:0,properties:a}:i)}for(let e=0;e<r.length;e++){const n=this.addFeature(r[e],Object.assign(Object.assign({},this.options),i));if(n){const{dependencies:e}=n;this.features.push(n),(null==e?void 0:e.glyphs)&&Object.assign(a,e.glyphs),(null==e?void 0:e.icons)&&Object.assign(s,e.icons),t&&t.insert(n.type,n.geometry,n.featureIndex)}}}addFeature(e,t){throw new Error("Subclasses of VectorStore must override `addFeature`")}trim(){throw new Error("Subclasses of VectorStore must override `trim`")}query(e,t,i){this._featureIndex||(this._featureIndex=new Oo,this._featureIndex.populate(this.features)),(e<1||t<1)&&(e=Math.round(e*Co),t=Math.round(t*Co));const r=this.featureIndex.query(e,t,i,this);if(r.length>0)return r.map((e=>this.features[e.key].properties))}serialize(){return{type:this.type,id:this.id,options:Object.assign({},this.options),layoutVertexArray:void 0,indexArray:void 0,features:[...this.features]}}static from(e){throw new Error("Subclasses of VectorStore must override `VectorStore.from`")}};var Po,ko,Do,zo,Io=function(e,t,i,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,i):a?a.value=i:t.set(e,i),i},Fo=function(e,t,i,r){if("a"===i&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?r:"a"===i?r.call(e):r?r.value:t.get(e)};Po=new WeakMap,ko=new WeakMap,Do=new WeakMap,zo=new WeakMap;const Lo=class{constructor(e){Po.set(this,void 0),ko.set(this,void 0),Do.set(this,!1),zo.set(this,[]),Io(this,ko,e,"f")}get(){return new Promise(((e,t)=>{if(Fo(this,Po,"f"))return void e(Fo(this,Po,"f"));if(Fo(this,Do,"f"))return void Fo(this,zo,"f").push((()=>e(Fo(this,Po,"f"))));const i=Fo(this,ko,"f")instanceof URL?Fo(this,ko,"f").toString():Fo(this,ko,"f");Io(this,Do,!0,"f"),fetch(i).then((e=>e.text())).then((t=>{Io(this,Po,new Worker(window.URL.createObjectURL(new Blob([t],{type:"text/javascript"}))),"f"),Io(this,Do,!1,"f"),Fo(this,zo,"f").forEach((e=>e())),Io(this,zo,[],"f"),e(Fo(this,Po,"f"))})).catch((e=>{t(e)}))}))}terminate(){Fo(this,Po,"f")&&Fo(this,Po,"f").terminate()}};var jo,No=function(e,t,i,r){if("a"===i&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?r:"a"===i?r.call(e):r?r.value:t.get(e)};jo=new WeakMap;const Uo=class{constructor(e){jo.set(this,{}),this._messageHandlers={},e instanceof Lo?this.worker=e:(this.worker="string"==typeof e?new Worker(e):e,this.worker.onmessage=this.receive.bind(this))}registerMessageHandler(e,t){this._messageHandlers[e]=t}send(e){var{type:t,action:i}=e,r=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(i[r[a]]=e[r[a]])}return i}(e,["type","action"]);const a=Math.round(1e18*Math.random()).toString(36).slice(0,10);return new Promise(((e,s)=>{No(this,jo,"f")[a]=t=>{let{data:i,error:r,status:a}=t;if(r){let e=new Error(r);if((null==a?void 0:a.code)>0){const t=new Response(void 0,{status:a.code,statusText:a.message});e=new yt(r,t)}s(e)}else e(i)},this.worker instanceof Lo?this.worker.get().then((e=>{e.onmessage||(e.onmessage=this.receive.bind(this)),e.postMessage({id:a,type:t,action:i,data:r})})).catch((e=>{s(e)})):this.worker.postMessage({id:a,type:t,data:r})}))}receive(e){const{id:t,type:i,data:r,error:a,status:s}=e.data||{},n=No(this,jo,"f")[t];if(i){const e=this._messageHandlers[i];if(Jt(e)){const a=e(r);return void(a instanceof Promise?a:Promise.resolve(a)).then((e=>{this.worker instanceof Lo?this.worker.get().then((r=>{r.onmessage||(r.onmessage=this.receive.bind(this)),r.postMessage({id:t,type:i,data:e})})):this.worker.postMessage({id:t,type:i,data:e})}))}}Jt(n)&&(n({data:r,error:a,status:s}),delete No(this,jo,"f")[t])}abort(){this.worker.terminate()}},Vo=new class{constructor(){this.urls={}}addWorker(e,t){this.urls[e]=t}getWorker(e){return this.urls[e]}},Bo=e=>{let t=e.toString().replaceAll("://",":\\/\\/").replaceAll(/\/{2}.*/g,"").replaceAll("\n","").replaceAll("\t","").replaceAll(/\s+/g," ");return e.name&&new RegExp(`^\\s*${e.name}\\s*([(])`).test(t)&&(t=`function ${t}`),JSON.stringify(`_FUNC${t}`)},$o=(e,t)=>t.startsWith("_FUNC")?(t=t.replace(/^_FUNC/,""),new Function(`return (${t}).apply(this, arguments);`)):t,qo=(e,t)=>{Object.keys(t).forEach((i=>{Array.isArray(t[i])?e[i]=t[i].map((e=>{if(ze(e)){const t={};return qo(t,e),t}return Jt(e)?Bo(e):e})):ze(t[i])?(e[i]={},qo(e[i],t[i])):Jt(t[i])?["value","transform","key","rank","size","factor","offset","image"].includes(i)&&(e[i]=Bo(t[i])):e[i]=t[i]}))},Go=(e,t)=>{if(le(t))throw new Error("[MapsGL] Serialized style is null or undefined");Object.keys(t).forEach((i=>{if(Array.isArray(t[i]))e[i]=t[i].map((e=>{if(ze(e)){const t={};return Go(t,e),t}return/_FUNC/.test(e)?JSON.parse(e,$o):e}));else if(ze(t[i]))e[i]={},Go(e[i],t[i]);else if(/_FUNC/.test(t[i]))try{e[i]=JSON.parse(t[i],$o)}catch(e){console.error(`[MapsGL] Failed to deserialize function '${i}':`,e)}else e[i]=t[i]}))},Ho=(e,t,i,r)=>{var a;const s=t.height,n=Math.floor(t.width/e.width),o=(Math.floor(s/e.height),{}),l="undefined"!=typeof OffscreenCanvas;if((null==i?void 0:i.length)===n){const s=l?new OffscreenCanvas(e.width,e.height):window.document.createElement("canvas");s.width=e.width,s.height=e.height;const h=s.getContext("2d",{alpha:!1,willReadFrequently:!0});h.imageSmoothingEnabled=!1;for(let l=0;l<n;l++){const n=i[l].getTime();h.drawImage(t,l*e.width,0,e.width,e.height,0,0,s.width,s.height);const c=null===(a=h.getImageData(0,0,s.width,s.height))||void 0===a?void 0:a.data,d=new cr(c,s.width,2);Jt(r)&&r(d),o[n]={rawData:d.rawData,dimension:d.dimension,padding:d.padding}}}return{data:o}},Wo=class extends vo{get type(){return ji.encoded}constructor(e,t){var i,r,a;Zt(xe(t.datasets)||xe(t.metadataUrl),"[MapsGL] Invalid encoded data source specification, `datasets` or `metadataUrl` must be provided."),le(null===(i=t.timeSeries)||void 0===i?void 0:i.validTimes)&&(null===(r=t.datasets)||void 0===r?void 0:r.length)>0&&(t.timeSeries=Object.assign(Object.assign({},t.timeSeries),{validTimes:t.datasets[0].validTimes})),super(e,Object.assign(Object.assign({},t),{datasets:null===(a=t.datasets)||void 0===a?void 0:a.filter((e=>he(e.id)))})),this.shouldUseTimesFromMetadata=!1,this.maxTextureSize=Number.POSITIVE_INFINITY,this._activeTileRequests=new Set,this.tiles.setTextureDataProvider((e=>null)),this.tileManager.setTileFetcher(((e,t,i)=>{var r,a,s;const{body:n}=i,o=this.tiles.get(e);let l;return"none"!==(null===(a=null===(r=this.spec.timeSeries)||void 0===r?void 0:r.operation)||void 0===a?void 0:a.type)&&(l=this.metadata.getAllValidTimes()),this.worker.send({command:"loadTile",source:{datasets:[...this.metadata.datasets],validTimes:this.metadata.getValidTimes(),operation:null===(s=this.spec.timeSeries)||void 0===s?void 0:s.operation,transformer:Jt(this.spec.transformTileData)?Bo(this.spec.transformTileData):void 0},tile:{uid:o.uid,info:{x:e.x,y:e.y,z:e.z,size:this.tileSize}},request:{url:this.getTileUrl(e,i.params),method:i.method,body:xe(n)?JSON.stringify(n):void 0,headers:i.headers,intervals:l,params:i.params}})}))}get worker(){if(!this._worker){let e=Vo.getWorker("encoded");le(e)&&(e="https://cdn.aerisapi.com/sdk/js/mapsgl/latest/mapsgl.encoded.worker.js",Vo.addWorker("encoded",e));const t=new Lo(e);this._worker=new Uo(t)}return this._worker}getMetadataForBand(e){const t=["r","g","b","a"];let i;return[...e].forEach((e=>{const r=t.indexOf(e),a=this.metadata.getDatasetAtIndex(r);a&&!i&&(i=a)})),i}getDataRange(e){if(!this.hasValidDatasets())return;const t=["r","g","b","a"],i=[...e],r={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return i.forEach((e=>{const i=t.indexOf(e),a=this.metadata.getDatasetAtIndex(i);if(!a)throw new Error(`[MapsGL] Dataset index ${i} is out of bounds for data source {${this.id}}, total datasets is ${this.metadata.datasets.length}`);i>=0&&(r.min=Math.min(a.dataMin,r.min),r.max=Math.max(a.dataMax,r.max))})),r}parseTile(e,t,i){return new Promise(((r,a)=>{if(t instanceof Blob){const r=new Image;return r.addEventListener("load",(()=>{let t=[];const a=null==i?void 0:i.get("x-data-set-locs");if(a){const e=((e,t)=>{const i=JSON.parse(e);return{layout:{columns:0,rows:0,size:{width:0,height:0}},datasets:null==t?void 0:t.map(((e,t)=>{const{id:r,dataMin:a,dataMax:s,outputMin:n=0,outputMax:o=255,outputNoDataValue:l}=e,{animDir:h,x:c=0,y:d=0,b:u=0,validTimes:p}=i[t]||{};return{id:r,dataMin:a,dataMax:s,outputMin:n,outputMax:o,outputNoDataValue:l,maxZoom:-1,degreesPerPixel:{x:-1,y:-1},column:c,row:d,band:u,layout:"H"===h?"horizontal":"vertical",validTimes:null==p?void 0:p.map((e=>new Date(e)))}}))}})(a,this.spec.datasets);t=At(e.datasets[0].validTimes)}Ho(e.size,r,t)})),r.addEventListener("error",(()=>{a(r)})),r.crossOrigin="anonymous",void(r.src=URL.createObjectURL(t))}let s=e.data;this.tiles.isStale(e)&&(null==s||s.dispose(),s=void 0);const n=this.metadata.getValidTimes().map((e=>e.getTime()));le(s)?(s=new xr({},this.tileSize,n),s.id=e.coord.hash,this.tiles.setStale(e,!1)):([...s.series.intervals].forEach((e=>{n.includes(e)||s.series.removeInterval(e)})),s.setValidIntervals(n));const{image:o,validTimes:l}=t;let h=null==t?void 0:t.data;if(ye(h)){const t=Ho(e.size,o,l);h=null==t?void 0:t.data}he(h)&&(ge(h)?console.warn(`[MapsGL] Encoded tile data for ${e.coord.hash} is empty.`):Object.keys(h).filter((e=>n.includes(Number(e)))).forEach((t=>{const{rawData:i,dimension:r,padding:a}=h[t];if(he(i)){const e=new cr(i,r,a);s.setData(Number(t),new fr(e))}else console.warn(`[MapsGL] Encoded raster tile data for ${e.coord.hash} at time ${t} is empty.`)})),r(s))}))}onTileLoaded(e,t){super.onTileLoaded(e,t);const i=e.coord.getNeighbors();if(e&&i){const t=(t,i)=>{let r=i.coord.x-t.coord.x;const a=i.coord.y-t.coord.y,s=Math.pow(2,e.coord.z);0!==r||0!==a?Math.abs(a)>1||(Math.abs(r)>1&&(1===Math.abs(r+s)?r+=s:1===Math.abs(r-s)&&(r-=s)),i.data&&t.data&&t.data.backfillEdge(i.data,r,a)):0===t.coord.z&&(t.data.backfillEdge(i.data,-1,0),t.data.backfillEdge(i.data,1,0))};Object.keys(i).forEach((r=>{const a=i[r];if(a){const i=this.tiles.get(a.normalize());if(i){const r=new Kn(a);r.data=null==i?void 0:i.data,t(e,r),t(r,e)}}}))}}processMetadata(e){const t=Object.assign({},e);return t.datasets&&(t.datasets=t.datasets.map((e=>(e.row=e.row||0,e.column=e.column||0,e.layout=e.layout||"horizontal",e.validTimes=At(e.validTimes,!0),e)))),t}hasValidDatasets(){if(ye(this.metadata.datasets))throw new Error(`[MapsGL] Cannot request tiles for encoded data source "${this.id}", empty or invalid value for "datasets". Check the source configuration and/or its metadata.`);return!0}},Yo=Ps?20:40,Zo=class{constructor(e){this.account=e,this.authenticator=new Fs(e)}getEncodedSourceConfig(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=t||this.account.servers.mapsgl||zi;return Object.assign({type:ji.encoded,url:`${r}/tile/{z}/{x}/{y}/{width}x{height}/{time::iso}.png`,metadataUrl:`${r}/tile?details=true&{datasets}&begin={startDate}&end={endDate}`,tileSize:512,authenticator:this.authenticator,transformMetadataRequest:(e,t)=>(e instanceof Wo&&(t.params=Object.assign(Object.assign({},t.params),{datasets:e.spec.datasets.map((e=>`data-set-ids=${e.id}`)).join("&")})),t),transformMetadata:(e,t)=>{var i,r;const a=e.metadata,s=Object.assign({},a.data);s.minZoom=0,s.maxZoom=e instanceof vo?e.maxZoom:a.maxZoom,Object.values(t).forEach((e=>{e.maxZoom>0&&(s.maxZoom=Math.min(a.maxZoom,e.maxZoom))}));const n=Object.keys(t);s.validTimes=At(t[n[0]].validTimes);const o=fi.dbz.code,l=gi.dbz.code;if(n.includes(o)&&n.includes(l)){const e=At(t[o].validTimes),i=At(t[l].validTimes),r=new Date;s.validTimes=[...e,...i.filter((e=>e>r))]}const h=a.datasets[0];return(null===(i=h.animation)||void 0===i?void 0:i.interval)>0&&(a.maxValidTimeIntervals=null===(r=h.animation)||void 0===r?void 0:r.interval),s},transformRequest:(e,t)=>(t.options.method="POST",t.options.headers=Object.assign(Object.assign({},t.options.headers),{"Content-Type":"application/json","Access-Control-Request-Headers":"x-data-set-locs"}),e instanceof Wo&&(t.options.body=((e,t)=>{const i=e.map((e=>{const{id:i,dataMin:r,dataMax:a,outputMin:s=0,outputMax:n=255,timeOffset:o=0}=e,l={dataSetId:i,dataMin:r,dataMax:a,outputMin:s,outputMax:n,outputNoDataValue:void 0,validTimes:null==t?void 0:t.map((e=>new Date(e.getTime()+1e3*o).toISOString()))};return Object.keys(l).reduce(((e,t)=>{const i=l[t];return he(i)&&(e[t]=i),e}),{})}));return i})(e.spec.datasets,t.options.intervals)),t),timeSeries:{maxValidTimes:Yo},datasets:e.formattedForRequest()},i)}getVectorTileSourceConfig(e,t){const i=t||this.account.servers.mapsgl||zi;return Object.assign({type:ji.vector,url:`${i}/vector/${e}/{time::iso}/{z}/{x}/{y}.pbf`,metadataUrl:`${i}/vector/?details=true&products=${e}&begin={startDate}&end={endDate}`,authenticator:this.authenticator,transformMetadata:(e,t)=>{const i=Object.assign({},e.metadata.data);if(ze(t)){const e=t[Object.keys(t)[0]];e&&(i.maxZoom=e.layers[0].maxZoom,i.validTimes=At(e.validTimes))}return i.minZoom=0,i}},arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}getVectorSourceConfig(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Date;return{type:ji.vector,url:this.getTileUrl(e,t,"pbf")}}getGeoJSONSourceConfig(e,t,i,r){var a;le(t)&&(t="search");const s=null===(a=this.account)||void 0===a?void 0:a.api().endpoint(e).action(t);if(s.format("geojson"),i){const{from:e,to:t}=i,r=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(i[r[a]]=e[r[a]])}return i}(i,["from","to"]);s.from(e),s.to(t),s.setParams(r)}return Object.assign({type:ji.geojson,url:s.url()},r)}getRasterSourceConfig(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Date;const i=this.account,r=`${i.id}_${i.secret}`;return{type:ji.raster,url:this.getTileUrl(e,t),metadataUrl:`https://maps.aerisapi.com/${r}/${e}.json`,transformMetadata:(e,t,i)=>{const r=Object.assign({},e.metadata.data);return Array.isArray(t.files)&&(r.validTimes=t.files.map((e=>new Date(1e3*e.timestamp))).sort(((e,t)=>e.getTime()-t.getTime()))),r},timeSeries:{maxValidTimes:Yo/2}}}getTileUrl(e){arguments.length>1&&void 0!==arguments[1]||new Date;let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"png";var i;return null===(i=this.account)||void 0===i?void 0:i.map().type("tile").layers(e).offset("{time::utc:format[yyyyMMddhhmm00]}").suffix("@3x").url().replace(/\.png/,`.${t}`)}},Xo=e=>{switch(e){case"circle":return Pi.circle;case"symbol":case"text":return Pi.symbol;case"fill":return Pi.fill;case"line":return Pi.line;case"query":return Pi.query;case"sample":return Pi.sample;case"grid":return Pi.grid;case"heatmap":return Pi.heatmap;case"contour":return Pi.contour;case"particle":return Pi.particle;case"voronoi":return Pi.voronoi;case"debug":return Pi.debug;case"data":return Pi.data;case"none":return"composite";default:return Pi.raster}},Qo=Object.assign({},["temperatures","temperatures-contour","wind-speeds","wind-speeds-contour","wind-dir","wind-barbs","wind-particles","feels-like","wind-chill","heat-index","dew-points","humidity","pressure-msl","pressure-msl-contour","visibility","cloud-cover","precip","radar"].reduce(((e,t)=>(e[`f${t}`]=t,e)),{})),Ko=class{constructor(e){var t,i;this.service=new Zo(e),this.sources=(t=this.service,{[Dr.base_osm]:()=>t.getVectorTileSourceConfig("open-street-map",i),[Dr.base_cities]:()=>({type:ji.vector,url:"https://cdn.aerisapi.com/sdk/js/mapsgl/data/cities/{z}/{x}/{y}.pbf",maxZoom:14}),[Dr.conditions_TMP_UGRD_VGRD]:()=>t.getEncodedSourceConfig(new Di([ii,ri]),i),[Dr.conditions_TMP_DELTA]:()=>t.getEncodedSourceConfig(new Di([ii,Object.assign(Object.assign({},ii),{timeOffset:-86400}),Object.assign(Object.assign({},ii),{timeOffset:-3600})]),i),[Dr.conditions_TMP_DPT_RH]:()=>t.getEncodedSourceConfig(new Di([ii,si,ni]),i),[Dr.conditions_APTMP_DPT_RH]:()=>t.getEncodedSourceConfig(new Di([oi,si,ni]),i),[Dr.conditions_PRMSL_VIS_GUST]:()=>t.getEncodedSourceConfig(new Di([li,hi,ai]),i),[Dr.conditions_SNOD]:()=>t.getEncodedSourceConfig(new Di([pi]),i),[Dr.conditions_SKY_PRECIP_UVI]:()=>t.getEncodedSourceConfig(new Di([ci,ui,mi]),i),[Dr.conditions_PTYPE_PRECIP_TMP]:()=>t.getEncodedSourceConfig(new Di([di,ui,ii]),i),[Dr.conditions_PRECIP]:()=>t.getEncodedSourceConfig(new Di(Cr(ui,3)),i),[Dr.conditions_SNOW_DERIVED]:()=>Object.assign(Object.assign({},t.getEncodedSourceConfig(new Di([...Cr(ui,2),ii]),i)),{transformTileData:(e,t)=>{const i=e.dimension+2*e.padding,r=t[1].dataMax,a=t[2].dataMin,s=t[2].dataMax;for(let t=0;t<i*i;t++){const i=4*t,n=0+(e.rawData[i+0]/255+e.rawData[i+1]/255)/2*r,o=a+e.rawData[i+2]/255*(s-a)+273.15;let l=.75;o>271.16&&(l=1.75);let h=10+l*(271.16-o);h=Math.max(0,Math.min(h,20));let c=n*h;c*=3.6,c=(c-0)/1.524,c=Math.max(0,Math.min(c,1)),c=Math.floor(3*c*255);let d=c;for(let t=0;t<3;t++){const r=Math.min(255,d);e.rawData[i+t]=Math.round(r),d-=r}e.rawData[i+3]=255}}}),[Dr.radar_REFC_PRATE_PTYPE]:()=>t.getEncodedSourceConfig(new Di([gi.dbz,gi.precipType,gi.dbzArchive]),i),[Dr.airquality_points]:()=>t.getVectorSourceConfig("air-quality"),[Dr.airquality_AQI_PM2P5_PM10]:()=>t.getEncodedSourceConfig(new Di([vi.aqiAirNow,vi.pm2p5,vi.pm10]),i),[Dr.airquality_AQI_HI_China_India]:()=>t.getEncodedSourceConfig(new Di([vi.aqiHealthIndex,vi.aqiChina,vi.aqiIndia]),i),[Dr.airquality_AQI_EAQI_UBA_UK]:()=>t.getEncodedSourceConfig(new Di([vi.aqiEAQI,vi.aqiUbaDAQI,vi.aqiUkDAQI]),i),[Dr.airquality_AQI_CAI_CAQI]:()=>t.getEncodedSourceConfig(new Di([vi.aqiCAI,vi.aqiCAQI]),i),[Dr.airquality_CO_NO_NO2]:()=>t.getEncodedSourceConfig(new Di([vi.co,vi.no,vi.no2]),i),[Dr.airquality_O3_SO2]:()=>t.getEncodedSourceConfig(new Di([vi.o3,vi.so2]),i),[Dr.maritime_WAVE]:()=>t.getEncodedSourceConfig(new Di([xi.waveHeight,xi.wavePeriod,xi.waveDir]),i),[Dr.maritime_SWELL1]:()=>t.getEncodedSourceConfig(new Di([xi.swellHeightPrimary,xi.swellPeriodPrimary,xi.swellDirPrimary]),i),[Dr.maritime_SWELL2]:()=>t.getEncodedSourceConfig(new Di([xi.swellHeightSecondary,xi.swellPeriodSecondary,xi.swellDirSecondary]),i),[Dr.maritime_SWELL3]:()=>t.getEncodedSourceConfig(new Di([xi.swellHeightTertiary,xi.swellPeriodTertiary,xi.swellDirTertiary]),i),[Dr.maritime_WTMP_UOGRD_VOGRD]:()=>t.getEncodedSourceConfig(new Di([xi.sst,xi.current]),i),[Dr.maritime_SURGE_TIDE]:()=>t.getEncodedSourceConfig(new Di([xi.surge,xi.tide]),i),[Dr.severe_alerts]:()=>t.getVectorSourceConfig("alerts"),[Dr.severe_stormcells]:()=>t.getVectorSourceConfig("stormcells"),[Dr.severe_stormreports]:()=>t.getVectorSourceConfig("stormreports"),[Dr.severe_lightning]:()=>t.getVectorSourceConfig("lightning-strikes"),[Dr.severe_lightning_all]:()=>t.getVectorSourceConfig("lightning-all"),[Dr.severe_lightning_flash]:()=>t.getVectorSourceConfig("lightning-flash"),[Dr.severe_convective]:function(){let{timeline:e,params:i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{from:r,to:a}=zr(e);return t.getGeoJSONSourceConfig("convective/outlook",void 0,Object.assign({from:r,to:a,filter:"categorical"},i))},[Dr.fires_obs]:function(){let{timeline:e,params:i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{from:r,to:a}=zr(e);return t.getGeoJSONSourceConfig("fires",void 0,Object.assign({from:r,to:a,query:"area:1",filter:"all",limit:1e3},i))},[Dr.fires_perimeter]:function(){let{timeline:e,params:i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{from:r,to:a}=zr(e);return t.getGeoJSONSourceConfig("fires",void 0,Object.assign({from:r,to:a,query:"area:1",filter:"all,geo",limit:1e3},i))},[Dr.fires_outlook]:function(){let{timeline:e,params:i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{from:r,to:a}=zr(e);return t.getGeoJSONSourceConfig("fires/outlook",void 0,Object.assign({from:r,to:a,filter:"firewx"},i))},[Dr.drought]:function(){let{timeline:e,params:i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{from:r,to:a}=zr(e);return t.getGeoJSONSourceConfig("droughts/monitor",void 0,Object.assign({from:r,to:a,filter:"all,geo",sort:"code"},i))},[Dr.earthquakes]:function(){let{timeline:e,params:i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{from:r,to:a}=zr(e);return t.getGeoJSONSourceConfig("earthquakes",void 0,Object.assign({from:r,to:a,query:"mag:0",limit:1e3},i))},[Dr.rivers]:()=>t.getVectorSourceConfig("river-observations"),[Dr.tropical_active]:function(){let{timeline:e,params:i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{from:r,to:a}=zr(e);return t.getGeoJSONSourceConfig("tropicalcyclones/archive","search",Object.assign({filter:"active,dateline",from:r,to:a},i))},[Dr.tropical_archive]:function(){let{timeline:e,params:i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{from:r,to:a}=zr(e);return t.getGeoJSONSourceConfig("tropicalcyclones/archive","search",Object.assign({filter:"active;notactive,dateline",from:r,to:a},i),{transformGeoJSON:(e,t)=>{const i=[];let r,a,s;return t.features.forEach(((e,t)=>{if(/-trackPoint-/.test(`${e.id}`)){const t=e.properties.id;r&&t===r||(a&&(a.properties.details=s.properties.details,i.push(a)),a=Object.assign(Object.assign({},e),{id:`${e.id}`.replace(/-trackPoint-.*$/,"-Position"),properties:Object.assign(Object.assign({},e.properties),{id:r,featureType:"position"})}),r=t),s=e}else`${e.id}`.endsWith("-Position")&&(a=void 0)})),t.features=[...t.features,...i],t}})},[Dr.tropical_invests]:function(){let{timeline:e,params:i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{from:r,to:a}=zr(e);return t.getGeoJSONSourceConfig("tropicalcyclones/archive","search",Object.assign({filter:"invests",from:r,to:a},i))},[Dr.roadweather_nowcast_us]:()=>t.getVectorTileSourceConfig("road-wx-nowcast-us",i,{bounds:Fi.us}),[Dr.roadweather_nowcast_europe]:()=>t.getVectorTileSourceConfig("road-wx-nowcast-europe",i,{bounds:Fi.europe}),[Dr.roadweather_nowcast_japan]:()=>t.getVectorTileSourceConfig("road-wx-nowcast-japan",i,{bounds:Fi.japan}),[Dr.roadweather_nowcast_australia]:()=>t.getVectorTileSourceConfig("road-wx-nowcast-australia",i,{bounds:Fi.australia}),[Dr.roadweather_nowcast_new_zealand]:()=>t.getVectorTileSourceConfig("road-wx-nowcast-new-zealand",i,{bounds:Fi.new_zealand}),[Dr.roadweather_forecast_us]:()=>t.getVectorTileSourceConfig("road-wx-forecast-us",i,{bounds:Fi.us}),[Dr.roadweather_forecast_europe]:()=>t.getVectorTileSourceConfig("road-wx-forecast-europe",i,{bounds:Fi.europe}),[Dr.roadweather_forecast_japan]:()=>t.getVectorTileSourceConfig("road-wx-forecast-japan",i,{bounds:Fi.japan}),[Dr.roadweather_forecast_australia]:()=>t.getVectorTileSourceConfig("road-wx-forecast-australia",i,{bounds:Fi.australia}),[Dr.roadweather_forecast_new_zealand]:()=>t.getVectorTileSourceConfig("road-wx-forecast-new-zealand",i,{bounds:Fi.australia}),[Dr.satellite_infrared]:()=>t.getRasterSourceConfig("satellite"),[Dr.satellite_infrared_color]:()=>t.getRasterSourceConfig("satellite-infrared-color"),[Dr.satellite_visible]:()=>t.getRasterSourceConfig("satellite-visible"),[Dr.satellite_water_vapor]:()=>t.getRasterSourceConfig("satellite-water-vapor"),[Dr.satellite_geocolor]:()=>t.getRasterSourceConfig("satellite-geocolor")}),this.layers=(e=>{const t={temperature:Ci("Temperatures",{id:"temperature",bar:{measurement:Object.assign(Object.assign({},ii.measurement),{converter:Mi}),colorscale:{range:ii.dataRange,stops:q},labels:{every:e=>20,formatter:(e,t,i)=>0===t?`${Math.round(e)}°%%units%%`:`${Math.round(e)}`}}}),temperature_change_24hr:Ci("24-Hour Temp Change",{id:"temperature-change-24hr",bar:{measurement:Object.assign(Object.assign({},ii.measurement),{converter:Ai}),colorscale:{range:{min:F(-50),max:F(50)},stops:H},labels:{every:e=>"C"===e?10:20,formatter:(e,t,i)=>{const r=`${e>0?"+":""}${Math.round(e)}`;return 0===t?`${r}°%%units%%`:`${r}`}}}}),temperature_change_1hr:Ci("1-Hour Temp Change",{id:"temperature-change-1hr",bar:{measurement:Object.assign(Object.assign({},ii.measurement),{converter:Ai}),colorscale:{range:{min:F(-40),max:F(40)},stops:W},labels:{every:e=>10,formatter:(e,t,i)=>{const r=`${e>0?"+":""}${Math.round(e)}`;return 0===t?`${r}°%%units%%`:`${r}`}}}}),dewpoint:Ci("Dew Point",{id:"dew-point",bar:{measurement:Object.assign(Object.assign({},ii.measurement),{converter:Mi}),colorscale:{range:si.dataRange,stops:Z},labels:{every:e=>20,formatter:(e,t,i)=>0===t?`${Math.round(e)}°%%units%%`:`${Math.round(e)}`}}}),humidity:Ci("Humidity",{id:"humidity",bar:{measurement:Object.assign({},ni.measurement),colorscale:{range:ni.dataRange,stops:q},labels:{every:20,formatter:(e,t,i)=>0===t?`${Math.round(e)}%`:`${Math.round(e)}`}}}),pressure_msl:Ci("Surface Pressure",{id:"mslp",bar:{measurement:Object.assign(Object.assign({},li.measurement),{converter:Ti}),colorscale:{range:li.dataRange,stops:Q},labels:{every:e=>"mb"===e?20:1,formatter:(e,t,i)=>{const r=i.metric?Math.round(e):e.toFixed(2);return 0===t?`${r} %%units%%`:`${r}`}}}}),heatindex:Ci("Heat Index",{id:"heat-index",bar:{measurement:Object.assign(Object.assign({},ii.measurement),{converter:Mi}),colorscale:{range:{min:c(80),max:ii.dataRange.max},stops:q},labels:{every:e=>"C"===e?5:10,formatter:(e,t,i)=>0===t?`${Math.round(e)}°%%units%%`:`${Math.round(e)}`}}}),windchill:Ci("Wind Chill",{id:"wind-chill",bar:{measurement:Object.assign(Object.assign({},ii.measurement),{converter:Mi}),colorscale:{range:{min:ii.dataRange.min,max:c(40)},stops:q},labels:{every:e=>"C"===e?10:20,formatter:(e,t,i)=>0===t?`${Math.round(e)}°%%units%%`:`${Math.round(e)}`}}}),windspeed:Ci("Wind Speeds",{id:"windspeed",bar:{measurement:Object.assign(Object.assign({},ri.measurement),{converter:Si}),colorscale:{range:{min:0,max:ri.dataRange.max},stops:Y},labels:{every:e=>"kmh"===e?20:10,formatter:(e,t,i)=>0===t?`${Math.round(e)} %%units%%`:`${Math.round(e)}`}}}),cloudcover:Ci("Cloud Cover",{id:"cloud-cover",bar:{colorscale:{range:ci.dataRange,stops:J},labels:{every:20,formatter:(e,t,i)=>0===t?`${Math.round(e)}%`:`${Math.round(e)}`}}}),visibility:Ci("Visibility",{id:"visibility",bar:{measurement:Object.assign(Object.assign({},hi.measurement),{converter:Oi}),colorscale:{range:hi.dataRange,stops:K},labels:{every:e=>"km"===e?2:1,formatter:(e,t,i)=>0===t?`${Math.round(e)} %%units%%`:`${Math.round(e)}`}}}),radar:{id:"radar",type:"bar",title:"Radar",bar:[lt({},wi.bar,{colorscale:{range:{min:6,max:fi.dbz.dataRange.max},stops:se.rain},labels:{values:[{value:0,label:"Light"},{value:.5,label:"RAIN"},{value:1,label:"Heavy"}],normalized:!0}}),lt({},wi.bar,{colorscale:{range:{min:6,max:fi.dbz.dataRange.max},stops:se.mix},labels:{values:[{value:0,label:"Light"},{value:.5,label:"MIX"},{value:1,label:"Heavy"}],normalized:!0}}),lt({},wi.bar,{colorscale:{range:{min:6,max:fi.dbz.dataRange.max},stops:se.snow},labels:{values:[{value:0,label:"Light"},{value:.5,label:"SNOW"},{value:1,label:"Heavy"}],normalized:!0}})],text:wi.text},accum_precip:Ci("Accumulated Precipitation",{id:"accum-precip",bar:{measurement:{type:"precipitation",units:o.rate.mms,converter:Ei},colorscale:{range:{min:D(.01),max:ui.dataRange.max},resample:He.inCirc},labels:{values:e=>"in"===e?[.01,.1,.5,1,2,3,4,6,8,12,16,18,20,30]:[1,2,5,10,25,50,75,100,150,200,300,400,500,600,700],formatter:(e,t,i)=>{const r=+`${Math.round(Number(`${e}e+2`))}e-2`;return 0===t?`${r} %%units%%`:`${r}`}}}}),accum_snow:Ci("Accumulated Snowfall",{id:"accum-snow",bar:{measurement:{type:"snowfall",units:o.precipitation.m,converter:Ei},colorscale:{range:{min:k(.1),max:k(60)},stops:ee,resample:We(.55,.09,1,.75)},labels:{values:e=>"in"===e?[.1,1,3,6,12,18,24,36,48,60]:[.5,3,5,10,25,50,100,150],formatter:(e,t,i)=>0===t?`${Math.round(e)} %%units%%`:`${Math.round(e)}`}}}),snow_depth:Ci("Snow Depth",{id:"snow-depth",bar:{measurement:{type:"snowfall",units:o.precipitation.m,converter:Ei},colorscale:{range:{min:k(1),max:pi.dataRange.max},stops:ee,resample:We(.7,0,1,.6)},labels:{values:e=>"in"===e?[1,3,6,12,18,24,36,48,72,96,120,168,216,300]:[3,5,10,25,50,100,200,350,500,700],formatter:(e,t,i)=>0===t?`${Math.round(e)} %%units%%`:`${Math.round(e)}`}}}),uvi:Ci("Ultraviolet Index (UVI)",{id:"uvi",bar:{colorscale:{range:{min:1,max:12},stops:te,interval:1},labels:{every:1,formatter:(e,t,i)=>`${Math.round(e)}`}}})};return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},{water:{id:"base.water.fill",layer:{type:Pi.fill,source:Dr.base_osm,sourceType:Li.polygon,sourceLayer:"water",paint:{fill:{color:"#333"}}}},"admin-2-boundaries":Lr("base.admin_2_boundaries.line",["all",["==","admin_level",2],["!=","maritime",1]],{stroke:{color:"#333",thickness:e=>e.zoom<2?1:2,opacity:.85}}),"admin-3-4-boundaries":Lr("base.admin_3_4_boundaries.line",["all",[">=","admin_level",3],["<=","admin_level",4],["!=","maritime",1]],{stroke:{color:"#333",opacity:e=>e.zoom<2?.5:.75}}),"admin-5-6-boundaries":Lr("base.admin_5_6_boundaries.line",["all",[">=","admin_level",5],["<=","admin_level",6],["!=","maritime",1]],{stroke:{color:"#333",opacity:.6}}),"waterway-ocean-boundaries":Ur("base.waterway_ocean.line",["==","class","ocean"],{stroke:{color:"#333",thickness:e=>e.zoom<2?1:2,opacity:.85}}),"waterway-lake-river-boundaries":Ur("base.waterway_lake.line",["any",["==","class","river"],["==","class","lake"]],{stroke:{color:"#333",thickness:1,opacity:.7}}),boundaries:["admin-2-boundaries","admin-3-4-boundaries","admin-5-6-boundaries","waterway-ocean-boundaries","waterway-lake-river-boundaries"],"place-city":Nr("base.place_city.text",["in","class","city","town"],{text:{size:e=>{const t=e.rank,i=e.zoom;return"city"===e.class?i<4?10:i<6?12:i<8?t<5?16:12:i<11?t<5?20:16:22:i>10?16:12}}}),"place-neighborhood":Nr("base.place_neighborhood.text",["in","class","village","neighbourhood","hamlet","suburb"],{text:{size:e=>{const t=e.zoom;return console.warn("z",t),t<13?11:14}}}),"place-state":Nr("base.place_state.text",["in","class","state","province"],{text:{size:e=>e.zoom<4?10:12,color:"#999",weight:"bold",transform:"uppercase",letterSpacing:.1}}),"place-country":Nr("base.place_country.text",["in","class","country","continent"],{text:{size:e=>{const t=e.zoom;return t<2?13:t<4?16:20},color:"#666"}}),places:["place-country","place-state","place-city","place-neighborhood"],"waterways-text":{id:"base.waterways.text",layer:{type:Pi.symbol,source:Dr.base_osm,sourceType:Li.point,sourceLayer:"water_name",paint:{text:{value:{property:["name:en","name"]},weight:e=>"ocean"===e.class?"bold":"normal",size:e=>{const t=e.zoom;return"ocean"===e.class?t<3?13:20:"sea"===e.class&&t<4?10:12},letterSpacing:e=>"ocean"===e.class?.1:0,color:"#999"},symbol:{rank:{property:"rank",direction:"asc"},pitchWithMap:!1,rotateWithMap:!1,allowOverlap:!1}}}},"road-all":jr("admin.road_all.line"),"road-motorway":jr("admin.road_motorway.line",["==","class","motorway"],{stroke:{thickness:e=>{const t=e.zoom;return t<5?1:t<10?2:t<15?4:10}}}),"road-trunk":jr("admin.road_trunk.line",["==","class","trunk"],{stroke:{thickness:e=>e.zoom<10?1:2,opacity:e=>{const t=e.zoom;return t<5?0:t<10?.5:1}}}),"road-primary":jr("admin.road_primary.line",["==","class","primary"],{stroke:{thickness:1,opacity:e=>{const t=e.zoom;return t<5?0:t<10?.5:1}}}),"road-secondary-tertiary":jr("admin.road_secondary_tertiary.line",["in","class","secondary","tertiary"],{stroke:{thickness:e=>e.zoom<12?1:2,opacity:e=>{const t=e.zoom;return t<8?0:t<12?.5:1}}}),"road-street":jr("admin.road_street.line",["in","class","minor","service"],{stroke:{thickness:1,opacity:.6}}),roads:["road-motorway","road-trunk","road-primary","road-secondary-tertiary","road-street"],"cities-points":{id:"base.cities.points",layer:{type:Pi.circle,source:Dr.base_cities,sourceType:Li.point,sourceLayer:"cities",paint:{fill:{color:"#000"},circle:{radius:3}}}}}),[{id:"conditions.radar.fill",code:"radar",source:Dr.radar_REFC_PRATE_PTYPE}].reduce(((e,i)=>{let{id:r,code:a,source:s}=i;return e[a]={id:r,layer:Rr(s,{quality:ki.exact,zoomOffset:0,paint:{sample:{channel:"r",colorscale:{masks:[{channel:"g",value:1,drawRange:{min:10},colorscale:{range:{min:0,max:87},stops:se.rain}},{channel:"g",value:3,colorscale:{range:{min:0,max:87},stops:se.mix}},{channel:"g",value:2,colorscale:{range:{min:0,max:87},stops:se.snow}}]}}}}),legend:t.radar,evaluator:ti.radar},e}),{})),((e,t,i)=>{const r={temperatures:{id:Or("conditions.temperature.fill"),layer:Rr(Dr.conditions_TMP_UGRD_VGRD,{paint:{sample:{channel:"r",colorscale:{stops:q,breaks:Zr}}}}),legend:t.temperature,evaluator:i.temperature},"temperatures-contour":{id:Or("conditions.temperature.contour"),layer:Rr(Dr.conditions_TMP_UGRD_VGRD,{type:Pi.contour,paint:{sample:{channel:"r",smoothing:1,colorscale:{stops:q,interval:1,breaks:Zr}},contour:{interval:F(2),majorInterval:F(10)}}}),legend:t.temperature,evaluator:i.temperature},"temperatures-24hr-change":{id:Or("conditions.temperature_24hr_change.fill"),layer:Rr(Dr.conditions_TMP_DELTA,{paint:{sample:{expression:Tr.difference,channel:"rg",offset:.5,colorscale:{range:{min:F(-50),max:F(50)},stops:H}}}}),legend:t.temperature_change_24hr,evaluator:i.temperature_change},"temperatures-1hr-change":{id:Or("conditions.temperature_1hr_change.fill"),layer:Rr(Dr.conditions_TMP_DELTA,{paint:{sample:{expression:Tr.difference,channel:"rb",offset:.5,colorscale:{range:{min:F(-40),max:F(40)},stops:W}}}}),legend:t.temperature_change_1hr,evaluator:i.temperature_change},"wind-speeds":{id:Or("conditions.wind_speed.fill"),layer:Rr(Dr.conditions_TMP_UGRD_VGRD,{paint:{sample:{channel:"gb",expression:Tr.vector,colorscale:{range:{min:0,max:ri.dataRange.max},stops:Y}}}}),legend:t.windspeed,evaluator:i.winds},"wind-speeds-contour":{id:Or("conditions.wind_speed.contour"),layer:Rr(Dr.conditions_TMP_UGRD_VGRD,{type:Pi.contour,paint:{sample:{channel:"gb",expression:Tr.vector,smoothing:1,colorscale:{range:{min:0,max:ri.dataRange.max},stops:Y,interval:j(5)}},contour:{interval:j(5),majorInterval:j(25)}}}),legend:t.windspeed,evaluator:i.winds},"wind-dir":{id:Or("conditions.wind_speed.arrow"),layer:Rr(Dr.conditions_TMP_UGRD_VGRD,{type:Pi.grid,paint:{sample:{channel:"gb",expression:Tr.vector,interpolation:Sr.bilinear,smoothing:1,colorscale:{range:{min:0,max:ri.dataRange.max},stops:Y}},grid:{spacing:30},icon:{type:"arrow",size:{width:40,height:20},anchor:"left"}}}),legend:t.windspeed,evaluator:i.winds},"wind-barbs":{id:Or("conditions.wind_speed.barb"),layer:Rr(Dr.conditions_TMP_UGRD_VGRD,{type:Pi.grid,paint:{sample:{channel:"gb",expression:Tr.vector,interpolation:Sr.bilinear,smoothing:1,colorscale:{range:{min:0,max:ri.dataRange.max},stops:Y}},grid:{spacing:30},icon:{atlas:{ids:[0,5,10,15,20,25,30,35,40,45,50,55,60,65,70,75,80,85,90,95,100].map((e=>`mapsgl:wind-barb-${e}`)),interval:2.572222},size:{width:40,height:40},anchor:"bottom",offset:{x:0,y:5},rotation:-90},fill:{color:"#fff"}}}),legend:t.windspeed,evaluator:i.winds},"wind-particles":{id:Or("conditions.wind_speed.particle"),layer:Rr(Dr.conditions_TMP_UGRD_VGRD,{type:Pi.particle,paint:{sample:{channel:"gb",expression:Tr.vector,interpolation:Sr.bilinear,smoothing:1,colorscale:{range:{min:0,max:ri.dataRange.max},stops:Y}},particle:{density:Vr.normal,size:2}}}),legend:t.windspeed,evaluator:i.winds},"wind-gusts":{id:Or("conditions.wind_gust.fill"),layer:Rr(Dr.conditions_PRMSL_VIS_GUST,{paint:{sample:{channel:"b",colorscale:{range:{min:0,max:ri.dataRange.max},stops:Y}}}}),legend:t.windspeed,evaluator:i.wind_gusts},"feels-like":{id:Or("conditions.feels_like.fill"),layer:Rr(Dr.conditions_APTMP_DPT_RH,{paint:{sample:{channel:"r",colorscale:{stops:q,breaks:Zr}}}}),legend:t.temperature,evaluator:Object.assign(Object.assign({},i.temperature),{title:"Feels Like"})},"wind-chill":{id:Or("conditions.wind_chill.fill"),layer:Rr(Dr.conditions_APTMP_DPT_RH,{paint:{sample:{channel:"r",drawRange:{max:c(40)},colorscale:{stops:q,breaks:Zr}}}}),legend:t.windchill,evaluator:Object.assign(Object.assign({},i.temperature),{title:"Wind Chill"})},"heat-index":{id:Or("conditions.heat_index.fill"),layer:Rr(Dr.conditions_APTMP_DPT_RH,{paint:{sample:{channel:"r",drawRange:{min:c(80)},colorscale:{stops:q,breaks:Zr}}}}),legend:t.heatindex,evaluator:Object.assign(Object.assign({},i.temperature),{title:"Heat Index"})},"dew-points":{id:Or("conditions.dew_point.fill"),layer:Rr(Dr.conditions_APTMP_DPT_RH,{paint:{sample:{channel:"g",colorscale:{stops:Z,breaks:Zr}}}}),legend:t.dewpoint,evaluator:Object.assign(Object.assign({},i.temperature),{title:"Dew Point"})},humidity:{id:Or("conditions.humidity.fill"),layer:Rr(Dr.conditions_APTMP_DPT_RH,{paint:{sample:{channel:"b",colorscale:{stops:X}}}}),legend:t.humidity,evaluator:i.humidity},"pressure-msl":{id:Or("conditions.pressure_msl.fill"),layer:Rr(Dr.conditions_PRMSL_VIS_GUST,{quality:ki.low,paint:{sample:{channel:"r",colorscale:{stops:Q}}}}),legend:t.pressure_msl,evaluator:i.pressure_msl},"pressure-msl-contour":{id:Or("conditions.pressure_msl.contour"),layer:Rr(Dr.conditions_PRMSL_VIS_GUST,{type:Pi.contour,quality:ki.low,paint:{sample:{channel:"r",smoothing:.5,colorscale:{stops:Q,interval:1}},contour:{interval:2,majorInterval:10}}}),legend:t.pressure_msl,evaluator:i.pressure_msl},"cloud-cover":{id:Or("conditions.cloud_cover.fill"),layer:Rr(Dr.conditions_SKY_PRECIP_UVI,{paint:{sample:{channel:"r",colorscale:{stops:J}}}}),legend:t.cloud_cover},precip:{id:Or("conditions.precip.fill"),layer:Rr(Dr.conditions_PRECIP,{quality:ki.high,paint:{sample:{channel:"rgb",colorscale:{stops:ae},drawRange:{min:D(.01)}}}}),legend:t.accum_precip,evaluator:i.accum_precip},"precip-rate":{id:Or("conditions.precip_rate.fill"),layer:Rr(Dr.conditions_SKY_PRECIP_UVI,{paint:{sample:{channel:"g",colorscale:{range:{min:0,max:D(25)},stops:re}}}}),legend:t.radar,evaluator:Object.assign(Object.assign({},i.radar),{title:"Precip Rate"})},snow:{id:Or("conditions.snow.fill"),layer:Rr(Dr.conditions_SNOW_DERIVED,{quality:ki.high,paint:{sample:{channel:"rgb",colorscale:{stops:ee},dataRange:{min:0,max:k(60)},drawRange:{min:k(.1)}}}}),legend:t.accum_snow,evaluator:{title:"Accum Snow",fn:e=>`${(100*e).toFixed(1)} cm, ${A(e).toFixed(1)} in`}},"snow-depth":{id:Or("conditions.snow_depth.fill"),layer:Rr(Dr.conditions_SNOD,{quality:ki.high,paint:{sample:{channel:"r",colorscale:{stops:ee},drawRange:{min:k(1)}}}}),legend:t.snow_depth,evaluator:{title:"Snow Depth",fn:e=>`${e.toFixed(1)} m, ${A(e).toFixed(1)} in`}},visibility:{id:Or("conditions.visibility.fill"),layer:Rr(Dr.conditions_PRMSL_VIS_GUST,{paint:{sample:{channel:"g",colorscale:{stops:K}}}}),legend:t.visibility,evaluator:i.visibility},uvi:{id:Or("conditions.uvi.fill"),layer:Rr(Dr.conditions_SKY_PRECIP_UVI,{quality:ki.low,paint:{sample:{channel:"b",smoothing:1,colorscale:{stops:te,interval:1}}}}),legend:t.uvi,evaluator:{title:"UV Index",fn:e=>`${Math.round(e)}`}}};return r["wind-particles-arrow"]=lt({},r["wind-particles"],{id:Or("conditions.wind_speed.particle_arrow"),layer:{paint:{particle:{type:"arrow",density:Vr.low,size:{width:20,height:10},speed:2,trails:!1}}}}),r["precip-accum"]=Object.assign(Object.assign({},r.precip),{id:Or("conditions.precip_accum.fill"),operation:{type:"sum"}}),r["snow-accum"]=Object.assign(Object.assign({},r.snow),{id:Or("conditions.snow_accum.fill"),operation:{type:"sum"}}),r["temperatures-max"]=Object.assign(Object.assign({},r.temperatures),{id:Or("conditions.temperature_max.fill"),operation:{type:"max"}}),r["temperatures-min"]=Object.assign(Object.assign({},r.temperatures),{id:Or("conditions.temperature_min.fill"),operation:{type:"min"}}),r["wind-speeds-max"]=Object.assign(Object.assign({},r["wind-speeds"]),{id:Or("conditions.wind_speed_max.fill"),operation:{type:"max"}}),r["wind-gusts-max"]=Object.assign(Object.assign({},r["wind-gusts"]),{id:Or("conditions.wind_gust_max.fill"),operation:{type:"max"}}),Object.keys(r).forEach((e=>{const t=r[e];if(t.layer.type===Pi.sample){let i=(e=>{switch(e){case"temperature":return Br;case"precipitation":return Hr;case"rate":return Wr;case"speed":return qr;case"pressure":return Gr;case"distance":return Yr}})($(e));/^temperature.+-change$/.test(e)?i=$r:e.startsWith("precip")&&(i=Wr),r[`${e}-text`]={id:t.id.replace(/\.\w+$/,".text"),layer:kr(Dr.base_cities,i),query:{layerId:e,hidden:!0}}}})),r})(0,t,ti)),((e,t,i)=>Object.assign(Object.assign({sst:{id:Or("maritime.sst.fill"),layer:Rr(Dr.maritime_WTMP_UOGRD_VOGRD,{paint:{sample:{channel:"r",colorscale:{stops:q}}}}),mask:Xr,legend:t.temperature,evaluator:i.temperature},"ocean-currents":{id:Or("maritime.ocean_current.fill"),layer:Rr(Dr.maritime_WTMP_UOGRD_VOGRD,{paint:{sample:{channel:"gb",expression:Tr.vector,colorscale:{range:{min:0,max:xi.current.dataRange.max},stops:Kr.current}}}}),mask:Xr,legend:Jr.current,evaluator:Object.assign(Object.assign({},i.winds),{title:"Ocean Current"})},"ocean-currents-particles":{id:Or("maritime.ocean_current.particle"),layer:Rr(Dr.maritime_WTMP_UOGRD_VOGRD,{type:Pi.particle,paint:{sample:{channel:"gb",expression:Tr.vector,interpolation:Sr.bilinear,colorscale:{range:{min:0,max:xi.current.dataRange.max},stops:Kr.current}},particle:{density:Vr.normal,size:2,speed:10}}}),mask:Xr,legend:Jr.current,evaluator:Object.assign(Object.assign({},i.winds),{title:"Ocean Current"})}},[{prefix:"wave",dataset:Dr.maritime_WAVE,title:"Wave"},{prefix:"swell",dataset:Dr.maritime_SWELL1,title:"Swell"},{prefix:"swell2",dataset:Dr.maritime_SWELL2,title:"Swell 2"},{prefix:"swell3",dataset:Dr.maritime_SWELL3,title:"Swell 3"}].reduce(((e,t)=>{let{prefix:r,dataset:a,title:s}=t;return e[`${r}-heights`]={id:Or(`maritime.${r}_height.fill`),layer:Rr(a,{paint:{sample:{channel:"r",colorscale:{stops:Kr.wave_height}}}}),mask:Xr,legend:Jr.wave_height,evaluator:Object.assign(Object.assign({},i.wave_height),{title:`${s} Height`})},e[`${r}-periods`]={id:Or(`maritime.${r}_period.fill`),layer:Rr(a,{paint:{sample:{channel:"g",colorscale:{stops:Kr.period,interval:1}}}}),mask:Xr,legend:Jr.period,evaluator:Object.assign(Object.assign({},i.period),{title:`${s} Period`})},e[`${r}-dir`]={id:Or(`maritime.${r}_dir.fill`),layer:Rr(a,{type:Pi.grid,paint:{sample:{channel:"b",expression:Tr.angle,interpolation:Sr.bilinear,colorscale:{range:{min:0,max:359},stops:[0,"#ffffff",1,"#ffffff"],normalized:!0}},grid:{spacing:30},icon:{type:"arrow",size:{width:40,height:20},anchor:"left"}}}),mask:Xr,evaluator:Object.assign(Object.assign({},i.angle_reversed),{title:`${s} Direction`})},e[`${r}-particles`]={id:Or(`maritime.${r}_dir.particle`),layer:Rr(a,{type:Pi.particle,paint:{sample:{channel:"b",expression:Tr.angle,interpolation:Sr.bilinear,colorscale:{range:{min:0,max:359},stops:[0,"#ffffff",1,"#ffffff"],normalized:!0}},particle:{type:"bar",size:{width:8,height:1},speed:3,trails:!0,trailsFade:.94}}}),mask:Xr,evaluator:Object.assign(Object.assign({},i.angle_reversed),{title:`${s} Direction`})},e}),{})),{"storm-surge":{id:Or("maritime.storm_surge.fill"),layer:Rr(Dr.maritime_SURGE_TIDE,{paint:{sample:{channel:"r",colorscale:{stops:Kr.surge}}}}),mask:Xr,legend:Jr.surge,evaluator:Object.assign(Object.assign({},i.wave_height),{title:"Storm Surge"})},"tide-heights":{id:Or("maritime.tide_height.fill"),layer:Rr(Dr.maritime_SURGE_TIDE,{paint:{sample:{channel:"g",colorscale:{stops:Kr.height_diff}}}}),mask:Xr,legend:Jr.tide_height,evaluator:Object.assign(Object.assign({},i.height_change),{title:"Tide Height"})}}))(0,t,ti)),Object.assign(Object.assign({"air-quality":{id:Or("air_quality.point"),layer:{type:Pi.circle,source:Dr.airquality_points,sourceType:Li.point,paint:{fill:{color:e=>{var t,i;if(le(null==e?void 0:e.periods)||0===(null===(t=null==e?void 0:e.periods)||void 0===t?void 0:t.length))return;const r=null===(i=e.periods[0].category)||void 0===i?void 0:i.replace(/[\s-]/,"_").toLowerCase();return ia[r]||"#000000"}},stroke:{color:"#fff",thickness:3},circle:{radius:8}}},legend:qa.points,evaluator:{title:"Air Quality",fn:e=>{const t=e[0];if(null==t?void 0:t.periods){const e=t.periods[0];return`${ea(t.place.name)}: ${e.aqi||"N/A"}${e.dominant?` (${e.dominant.toUpperCase()})`:""}`}return""}}},"air-quality-index":{id:Or("air_quality.index.fill"),layer:Rr(Dr.airquality_AQI_PM2P5_PM10,{paint:{sample:{channel:"r",colorscale:{stops:$a.aqi}}}}),legend:qa.aqi,evaluator:{title:"AQI",fn:e=>`${Math.round(e)}`}},"air-quality-index-text":{id:Or("air_quality.index.text"),layer:kr(Dr.base_cities),query:{layerId:"air-quality-index",hidden:!0}},"air-quality-index-categories":{id:Or("air_quality.index_categories.fill"),layer:Rr(Dr.airquality_AQI_PM2P5_PM10,{paint:{sample:{channel:"r",colorscale:{stops:$a.aqi_cats,interpolate:!1}}}}),legend:qa.points,evaluator:{title:"AQI",fn:e=>`${Math.round(e)}`}},"air-quality-health-index-categories":{id:Or("air_quality.aqhi.fill"),layer:Rr(Dr.airquality_AQI_HI_China_India,{paint:{sample:{channel:"r",colorscale:{stops:$a.health,interpolate:!1}}}}),legend:qa.aqhi,evaluator:{title:"AQI",fn:e=>`${Math.round(e)}`}}},[{source:Dr.airquality_AQI_HI_China_India,items:["china","india"],channels:["g","b"]},{source:Dr.airquality_AQI_EAQI_UBA_UK,items:["eaqi","uba_daqi","uk_daqi"],channels:["r","g","b"]},{source:Dr.airquality_AQI_CAI_CAQI,items:["cai","caqi"],channels:["r","g"]}].reduce(((e,t)=>{let{source:i,items:r,channels:a}=t;return r.forEach(((t,r)=>{const s=t.replace(/_/,"-");e[`air-quality-index-${s}-categories`]={id:Or(`air_quality.${t}.fill`),layer:Rr(i,{paint:{sample:{channel:a[r],colorscale:{stops:$a[t],interpolate:!1}}}}),legend:qa[t],evaluator:{title:"AQI",fn:e=>`${Math.round(e)}`}},e[`air-quality-index-${s}-text`]={id:Or(`air_quality.${t}.text`),layer:kr(Dr.base_cities),query:{layerId:`air-quality-index-${s}-categories`,hidden:!0}}})),e}),{})),[{source:Dr.airquality_AQI_PM2P5_PM10,items:["pm2p5","pm10"],channels:["g","b"]},{source:Dr.airquality_CO_NO_NO2,items:["co","no","no2"],channels:["r","g","b"]},{source:Dr.airquality_O3_SO2,items:["o3","so2"],channels:["r","g"]}].reduce(((e,t)=>{let{source:i,items:r,channels:a}=t;return r.forEach(((t,r)=>{e[`air-quality-${t}`]={id:Or(`air_quality.${t}.fill`),layer:Rr(i,{paint:{sample:{channel:a[r],colorscale:{stops:$a[t]}}}}),legend:qa[t],evaluator:{title:t.toUpperCase(),fn:e=>{const t="ug/m^3";return"number"==typeof e?`${Math.round(e)}${t?` ${t}`:""}`:Object.keys(e).map((i=>`${i}: ${Math.round(e[i])}${t?` ${t}`:""}`)).join(", ")}}},e[`air-quality-${t}-text`]={id:Or(`air_quality.${t}.text`),layer:kr(Dr.base_cities),query:{layerId:`air-quality-${t}`,hidden:!0}}})),e}),{}))),[{sourceType:"nowcast",prefix:""},{sourceType:"forecast",prefix:"f"}].reduce(((e,t)=>{let{sourceType:i,prefix:r}=t;const a={summary:Ri("Road Summary",{id:"roadweather-summary",points:{values:[{key:"green",color:Za.summary.green,label:"Low Risk"},{key:"yellow",color:Za.summary.yellow,label:"Moderate Risk"},{key:"red",color:Za.summary.red,label:"High Risk"},{key:"unknown",color:Za.summary.unknown,label:"Unknown"}]}}),surface:Ri("Road Condition",{id:"roadweather-surface",points:{values:[{key:"dry",color:Za.surface.dry,label:"Dry"},{key:"moist",color:Za.surface.moist,label:"Moist"},{key:"wet",color:Za.surface.wet,label:"Wet"},{key:"slush",color:Za.surface.slush,label:"Slush"},{key:"snow",color:Za.surface.snow,label:"Snow"},{key:"ice",color:Za.surface.ice,label:"Ice"},{key:"unknown",color:Za.surface.unknown,label:"Unknown"}]}}),temperature:Ci("Road Temperature",{id:"roadweather-temperature",bar:{measurement:{type:"temperature",units:o.temperature.C,converter:Mi},colorscale:{range:{min:-40,max:71.11},stops:q,interval:F(10)},labels:{every:e=>20,formatter:(e,t,i)=>0===t?`${Math.round(e)}°%%units%%`:`${Math.round(e)}`}}}),temperatureFreeze:Ri("Road Temperature - Freeze",{id:"roadweather-temperature-freeze",points:{values:[{color:"#992BFF",label:"Hard Freeze"},{color:"#0046FF",label:"Freeze"},{color:"#73DAFC",label:"Near Freeze"}]}}),riskRollover:Object.assign({id:"roadweather-risk-rollover"},Xa("Road Rollover Risk")),riskHydroplane:Object.assign({id:"roadweather-risk-hydroplane"},Xa("Road Hydroplane Risk")),riskLowVizSnow:Object.assign({id:"roadweather-risk-snow"},Xa("Road Snow Visibility Risk")),riskLowVizFog:Object.assign({id:"roadweather-risk-fog"},Xa("Road Fog Visibility Risk"))};return Ga.forEach((t=>{let s;switch(t){case"us":s="forecast"===i?Dr.roadweather_forecast_us:Dr.roadweather_nowcast_us;break;case"europe":s="forecast"===i?Dr.roadweather_forecast_europe:Dr.roadweather_nowcast_europe;break;case"japan":s="forecast"===i?Dr.roadweather_forecast_japan:Dr.roadweather_nowcast_japan;break;case"australia":s="forecast"===i?Dr.roadweather_forecast_australia:Dr.roadweather_nowcast_australia;break;case"new-zealand":s="forecast"===i?Dr.roadweather_forecast_new_zealand:Dr.roadweather_nowcast_new_zealand}Ha.forEach((n=>{const o=n.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),l=`${r}road-weather-${o}-${t}`;Ya.forEach((r=>{const{type:h=r,filter:c}=Wa[r];e[`${l}-${r}-points`]={id:Or(`road_weather.${o}.${t}.${r}.point`),layer:Object.assign(Object.assign({},Qa(n,Pi.circle)),{source:s,sourceLayer:`road-wx-${i}`,filter:["==","roadType_0-SFC",h]}),legend:a[`${n}`]},e[`${l}-${r}`]={id:Or(`road_weather.${o}.${t}.${r}.fill`),layer:Object.assign(Object.assign({},Qa(n,Pi.voronoi)),{source:s,sourceLayer:`road-wx-${i}`,filter:["==","roadType_0-SFC",h]}),mask:{layerId:"road-all",overrides:{filter:c,paint:{stroke:"bridges"===r?{color:"#fff",thickness:6,lineJoin:"round",lineCap:"square"}:{color:"#fff",thickness:"secondary"===h?2:4}}}},legend:a[`${n}`]}})),e[`${l}-points`]={id:Or(`road_weather.${o}.${t}.point`),layer:Object.assign(Object.assign({},Qa(n,Pi.circle)),{source:s,sourceLayer:`road-wx-${i}`}),legend:a[`${n}`]},e[l]=Ya.map((e=>`${l}-${e}`))}))})),e}),{})),((e,t,i)=>{const r={alerts:{id:Or("severe.alerts.fill"),layer:{type:Pi.fill,source:Dr.severe_alerts,timeSeries:{mode:br.any},paint:{fill:{color:{property:"COLOR"}},stroke:{color:"#000"}}},legend:es.alerts(e),evaluator:ts.alerts},"alerts-outline":{id:Or("severe.alerts.line"),layer:{type:Pi.line,source:Dr.severe_alerts,timeSeries:{mode:br.any},paint:{stroke:{color:{property:"COLOR"},thickness:3,lineJoin:Ir.Round,lineCap:Fr.Round}}},legend:es.alerts(e),evaluator:ts.alerts},"stormcells-positions":{id:Or("severe.stormcells.position.circle"),layer:{type:Pi.circle,source:Dr.severe_stormcells,sourceType:Li.point,timeSeries:{mode:br.any},paint:{fill:{color:e=>{var t,i;const r=null===(i=null===(t=e.traits)||void 0===t?void 0:t.type)||void 0===i?void 0:i.toLowerCase();return Ka.stormcells[r]||"#000000"}},stroke:{color:"#fff",thickness:3},circle:{radius:7}}},legend:es.stormcells,evaluator:ts.stormcells},"stormcells-tracks":{id:Or("severe.stormcells.track.line"),layer:{type:Pi.line,source:Dr.severe_stormcells,sourceType:Li.line,timeSeries:{mode:br.any},paint:{stroke:{color:"#fff",thickness:3,lineCap:Fr.Round}}},evaluator:ts.stormcells},"stormcells-cones":{id:Or("severe.stormcells.cone.line"),layer:{type:Pi.fill,source:Dr.severe_stormcells,timeSeries:{mode:br.any},paint:{fill:{color:e=>{var t,i;const r=null===(i=null===(t=e.traits)||void 0===t?void 0:t.type)||void 0===i?void 0:i.toLowerCase();return Ka.stormcells[r]||"#000000"},opacity:.5}}},legend:es.stormcells,evaluator:ts.stormcells},stormcells:["stormcells-cones","stormcells-tracks","stormcells-positions"],"stormcells-heat":{id:Or("severe.stormcells.heat"),layer:{type:Pi.heatmap,source:Dr.severe_stormcells,sourceType:Li.point,timeSeries:{mode:br.any},paint:{heatmap:{radius:20,color:oe}}}},stormreports:{id:Or("severe.stormreports.circle"),layer:{type:Pi.circle,source:Dr.severe_stormreports,sourceType:Li.point,timeSeries:{mode:br.any},paint:{fill:{color:e=>{var t,i;const r=null===(i=null===(t=e.report)||void 0===t?void 0:t.cat)||void 0===i?void 0:i.toLowerCase();return Ka.stormreports[r]||"#000000"}},stroke:{color:"#fff",thickness:3},circle:{radius:8}}},legend:es.stormreports,evaluator:{title:"Storm Reports",fn:e=>{const t=e[0];return(null==t?void 0:t.report)?`${ea(t.report.type)}`:""}}},"stormreports-heat":{id:Or("severe.stormreports.heat"),layer:{type:Pi.heatmap,source:Dr.severe_stormreports,sourceType:Li.point,timeSeries:{mode:br.any},paint:{heatmap:{radius:20,color:oe}}}},"lightning-strikes":{id:Or("severe.lightning.circle"),layer:{type:Pi.circle,source:Dr.severe_lightning,sourceType:Li.point,timeSeries:{mode:br.any},paint:{fill:{color:e=>{const t=Ka.lightningStrikes,i=e.age||0;return i<=60?t.age60:i<=300?t.age300:i<=600?t.age600:t.ageOld}},stroke:{color:"#333",thickness:2},circle:{radius:6}}},legend:es.lightning_strikes},"lightning-flash":{id:Or("severe.lightning_flash.circle"),layer:{type:Pi.circle,source:Dr.severe_lightning_flash,sourceType:Li.point,timeSeries:{mode:br.any},paint:{fill:{color:Ka.lightningStrikes.typeIC},stroke:{color:"#333",thickness:2},circle:{radius:4}}}},"lightning-all":["lightning-flash","lightning-strikes"],"lightning-strike-density":{id:Or("severe.lightning.heat"),layer:{type:Pi.heatmap,source:Dr.severe_lightning,sourceType:Li.point,timeSeries:{mode:br.any},paint:{heatmap:{radius:20,color:oe}}}},convective:{id:Or("severe.convective.fill"),layer:{type:Pi.fill,source:Dr.severe_convective,paint:{fill:{color:e=>{var t;const i=null===(t=e.details.risk.type)||void 0===t?void 0:t.toLowerCase();return Ka.convective[i]||"#000000"},opacity:.9}}},legend:es.convective,evaluator:ts.convective},"convective-outline":{id:Or("severe.convective.line"),layer:{type:Pi.line,source:Dr.severe_convective,paint:{stroke:{color:e=>{var t;const i=null===(t=e.details.risk.type)||void 0===t?void 0:t.toLowerCase();return Ka.convective[i]||"#000000"},thickness:3}}},legend:es.convective,evaluator:ts.convective}};return r["lightning-strikes-icons"]=lt({},r["lightning-strikes"],{id:Or("severe.lightning.symbol"),layer:{type:Pi.symbol,paint:{stroke:{thickness:1},icon:{image:"mapsgl:lightning-bolt",size:{width:20,height:20}}}}}),r["lightning-all-icons"]=["lightning-flash","lightning-strikes-icons"],r})(e)),Object.assign(Object.assign({},["active","notactive","invests"].reduce(((e,t)=>{const i="tropical-cyclones-";let r="",a="",s=Dr.tropical_active;switch(t){case"active":a="_active";break;case"notactive":r="-archive",a="_archive",s=Dr.tropical_archive;break;case"invests":r="-invests",a="_invests",s=Dr.tropical_invests}return e[`${i}track-points${r}`]={id:Or(`tropical.track${a}.circle`),layer:Object.assign(Object.assign({},as.point),{source:s,filter:["==","featureType","trackPoint"]}),legend:ss,evaluator:ls},e[`${i}track-point-icons${r}`]={id:Or(`tropical.track${a}.symbol`),layer:Object.assign(Object.assign({},as.symbol),{source:s,filter:["==","featureType","trackPoint"]}),legend:ss,evaluator:ls},e[`${i}track-lines${r}`]={id:Or(`tropical.track${a}.line`),layer:Object.assign(Object.assign({},as.track),{source:s,filter:["==","featureType","trackLine"]})},e[`${i}names${r}`]={id:Or(`tropical.names${a}.text`),layer:Object.assign(Object.assign({},as.name),{source:s,sourceType:Li.point,filter:["==","featureType","position"]})},"active"===t||"invests"===t?(e[`${i}positions${r}`]={id:Or(`tropical.positions${a}.circle`),layer:Object.assign(Object.assign({},as.point),{source:s,filter:["==","featureType","position"]}),legend:ss,evaluator:ls},e[`${i}position-icons${r}`]={id:Or(`tropical.positions${a}.symbol`),layer:lt({},as.symbol,{source:s,filter:["==","featureType","position"],paint:{icon:{size:e=>e.zoom<4?{width:28,height:28}:{width:44,height:44},shaderOnBeforeCompile:e=>{e.vertex=e.vertex.replace("#include <symbol_vert_position>","\n                                    symbolAngle += (time * -PI * 2.0) * 0.5 * factor;\n                                    #include <symbol_vert_position>\n                                ")},animated:!0}}}),legend:ss,evaluator:ls},e[`${i}forecast-points${r}`]={id:Or(`tropical.forecast${a}.circle`),layer:Object.assign(Object.assign({},as.point),{source:s,filter:["==","featureType","forecastPoint"]}),legend:ss,evaluator:ls},e[`${i}forecast-point-icons${r}`]={id:Or("tropical.forecast.symbol"),layer:Object.assign(Object.assign({},as.symbol),{source:s,filter:["==","featureType","forecastPoint"]}),legend:ss,evaluator:ls},e[`${i}forecast-lines${r}`]={id:Or(`tropical.forecast${a}.line`),layer:Object.assign(Object.assign({},as.track),{source:s,filter:["==","featureType","forecastLine"]})},"invests"===t?(e[`tropical-cyclones${r}`]=["track-lines","track-points","positions","names"].map((e=>{const t=e.startsWith("forecast-")?"":r;return`${i}${e}${t}`})),e[`tropical-cyclones${r}-icons`]=["track-lines","track-point-icons","position-icons","names"].map((e=>{const t=e.startsWith("forecast-")?"":r;return`${i}${e}${t}`}))):(e[`tropical-cyclones${r}`]=["forecast-error-cones","track-lines","forecast-lines","track-points","forecast-points","positions","names"].map((e=>{const t=e.startsWith("forecast-")?"":r;return`${i}${e}${t}`})),e[`tropical-cyclones${r}-icons`]=["forecast-error-cones","track-lines","forecast-lines","track-point-icons","forecast-point-icons","position-icons","names"].map((e=>{const t=e.startsWith("forecast-")?"":r;return`${i}${e}${t}`})))):(e[`tropical-cyclones${r}`]=["forecast-error-cones","track-lines-archive","forecast-lines","track-points-archive","forecast-points","names-archive"].map((e=>`${i}${e}`)),e[`tropical-cyclones${r}-icons`]=["forecast-error-cones","track-lines-archive","forecast-lines","track-point-icons-archive","forecast-point-icons","position-icons","names-archive"].map((e=>`${i}${e}`))),e}),{})),{"tropical-cyclones-forecast-error-cones":{id:Or("tropical.cone.fill"),layer:{type:Pi.fill,source:Dr.tropical_active,paint:{fill:{color:"#ff0000",opacity:.3},stroke:{color:"#ff0000",thickness:1}}}},"tropical-cyclones-break-points":{id:Or("tropical.active.breakpoints"),layer:{type:Pi.line,source:Dr.tropical_active,filter:["==","featureType","breakPointAlert"],paint:{stroke:{color:e=>{var t;const i=null===(t=e.alertType)||void 0===t?void 0:t.toUpperCase();return rs[i]||"#999"},thickness:e=>{var t;switch(null===(t=e.alertType)||void 0===t?void 0:t.toUpperCase()){case"TR.W":case"HU.W":return 8;default:return 4}},lineJoin:Ir.Round,lineCap:Fr.Round}}},legend:os}})),{"fires-obs":function(e){return{id:Or("climate.fire_obs.point"),layer:{type:Pi.circle,source:Dr.fires_obs,paint:{fill:{color:e=>{const{color:t}=ds(e);return t}},stroke:{color:"#fff",thickness:e=>{const{thickness:t}=ds(e);return t}},circle:{radius:e=>{const{size:t}=ds(e);return t/2}}}},legend:Ri("Fires",{id:Or("fire-obs"),points:{values:[{color:e.new,label:"New"},{color:e.active,label:"Active"},{color:e.contained,label:"Contained"}]}}),evaluator:{title:"Fires",fn:e=>{const t=e[0];if(null==t?void 0:t.report){const e=t.report,i=null===e.perContained?"":` (${e.perContained}% contained)`;return`${e.name} - ${e.areaAC.toLocaleString("en-US")} acres${i}`}return""}}}}(hs.fire_obs),"fires-obs-heat":{id:Or("climate.fire_obs.heat"),layer:{type:Pi.heatmap,source:Dr.fires_obs,paint:{heatmap:{radius:20,color:oe}}}},"fires-perimeter":{id:Or("climate.fire_obs.perimeter"),layer:{type:Pi.fill,source:Dr.fires_perimeter,paint:{fill:{color:"#ff0000",opacity:.6},stroke:{color:"#ff0000"}}},evaluator:{title:"Fires",fn:e=>{const t=e[0];if(null==t?void 0:t.report){const e=t.report,i=null===e.perContained?"":` (${e.perContained}% contained)`;return`${e.name} - ${e.areaAC.toLocaleString("en-US")} acres${i}`}return""}}},"fires-outlook":function(e){return{id:Or("climate.fire_outlook.fill"),layer:{type:Pi.fill,source:Dr.fires_outlook,paint:{fill:{color:t=>{var i;const r=null===(i=t.details.risk.type)||void 0===i?void 0:i.toLowerCase();return e[r]||"#FFB268"},opacity:.9}}},legend:Ri("Fire Outlook",{id:Or("fire-outlook"),points:{values:[{color:e.elevated,label:"Elevated"},{color:e.critical,label:"Critical"},{color:e.extreme,label:"Extreme"}]}}),evaluator:{title:"Fire Outlook",fn:e=>{var t,i;const r=e.at(-1);return(null==r?void 0:r.details)?`${ea(null===(i=null===(t=r.details)||void 0===t?void 0:t.risk)||void 0===i?void 0:i.type)}`:""}}}}(hs.fire_outlook),"fires-vpd":{id:Or("climate.fires_vpd.fill"),layer:Rr(Dr.conditions_TMP_DPT_RH,{paint:{sample:{expression:Tr.custom,expressionOperation:{dataRange:{min:0,max:70},value:e=>((e,t)=>{const i=e+273.15,r=-2836.5744/Math.pow(i,2)-6.028076559*1e3/i+19.54263612-2.737830188*.01*i+1.6261698*1e-5*Math.pow(i,2)+7.0229056e-10*Math.pow(i,3)-18680009e-20*Math.pow(i,4)+2.7150305*Math.log(i);return(100-t)/100*Math.exp(r)/100})(e.value0,e.value1),chunk:"\n                            float temp = dataValue1;\n                            float rh = dataValue2;\n    \n                            // temp in Kelvin\n                            float T = temp + 273.15;\n    \n                            // ew in Pa (Pascals)\n                            float logew = -2.8365744 * 1000. / pow(T, 2.)\n                                - 6.028076559 * 1000. / T\n                                + 1.954263612 * 10.\n                                - 2.737830188 * 0.01 * T\n                                + 1.6261698 * 0.00001 * pow(T, 2.)\n                                + 7.0229056 * 1E-10 * pow(T, 3.)\n                                - 1.8680009 * 1E-13 * pow(T, 4.)\n                                + 2.7150305 * log(T);\n                            float ew = exp(logew);\n    \n                            // VPD in Pa (Pascals)\n                            float vpd = ((100. - rh) / 100.) * ew;\n                            vpd /= 100.; // convert to hPa    \n    \n                            // convert to a normalized value from 0...1 based on configured min/max data range\n                            value = clamp((vpd - dataRange.x) / (dataRange.y - dataRange.x), 0.0, 1.0);\n                        "},channel:"rb",colorscale:{stops:hs.vpd}}}}),mask:Qr,legend:Ci("Vapor Pressure Deficit (VPD)",{id:Or("fires-vpd"),bar:{measurement:{type:"pressure",units:o.pressure.hPa},colorscale:{range:{min:0,max:70},stops:hs.vpd},labels:{every:e=>20,formatter:(e,t,i)=>0===t?`${Math.round(e)} %%units%%`:`${Math.round(e)}`}}}),evaluator:{title:"Vapor Pressure Deficit (VPD)",fn:e=>`${e.toFixed(2)} hPa`}},"drought-monitor":function(e){return{id:Or("climate.drought_monitor.fill"),layer:{type:Pi.fill,source:Dr.drought,paint:{fill:{color:t=>{var i;const r=null===(i=t.details.category)||void 0===i?void 0:i.toLowerCase();return e[r]||"#000000"}}}},legend:Ri("Drought Monitor",{id:Or("drought"),points:{values:[{color:e.d0,label:"Abnormally Dry"},{color:e.d1,label:"Moderate"},{color:e.d2,label:"Severe"},{color:e.d3,label:"Extreme"},{color:e.d4,label:"Exceptional"}]}}),evaluator:{title:"Drought Monitor",fn:e=>{var t,i;const r=e[0];return(null==r?void 0:r.details)?`${ea(null===(i=null===(t=e[0].details)||void 0===t?void 0:t.risk)||void 0===i?void 0:i.name)}`:""}}}}(hs.drought),"drought-monitor-outline":function(e){return{id:Or("climate.drought_monitor.outline"),layer:{type:Pi.line,source:Dr.drought,paint:{stroke:{color:t=>{var i;const r=null===(i=t.details.category)||void 0===i?void 0:i.toLowerCase();return e[r]||"#000000"},thickness:3}}}}}(hs.drought),earthquakes:function(e){return{id:Or("climate.earthquakes.point"),layer:{type:Pi.circle,source:Dr.earthquakes,paint:{fill:{color:e=>{const{color:t}=cs(e);return t}},stroke:{color:"#fff",thickness:2},circle:{radius:e=>{const{size:t}=cs(e);return(t||12)/2}}}},legend:Ri("Earthquakes",{id:Or("earthquakes"),points:{values:[{color:e.mini,label:"Mini"},{color:e.minor,label:"Minor"},{color:e.light,label:"Light"},{color:e.moderate,label:"Moderate"},{color:e.strong,label:"Strong"},{color:e.major,label:"Major"},{color:e.great,label:"Great"},{color:e.catastrophic,label:"Catastrophic"}]}}),evaluator:{title:"Earthquakes",fn:e=>{var t,i,r;const a=e[0];return(null==a?void 0:a.report)?`${null===(t=a.report)||void 0===t?void 0:t.mag} (${null===(i=a.report)||void 0===i?void 0:i.type}) - ${(null===(r=a.report)||void 0===r?void 0:r.location)||""}`:""}}}}(hs.earthquakes),"earthquakes-heat":{id:Or("climate.earthquakes.heat"),layer:{type:Pi.heatmap,source:Dr.earthquakes,paint:{heatmap:{radius:20,color:oe}}}},"river-observations":function(e){return{id:Or("climate.river_obs.point"),layer:{type:Pi.circle,source:Dr.rivers,sourceType:Li.point,paint:{fill:{color:t=>{var i,r;const a=null===(r=null===(i=t.ob)||void 0===i?void 0:i.status)||void 0===r?void 0:r.toLowerCase();return e[a]||"#000000"}},stroke:{color:"#fff",thickness:3},circle:{radius:8}}},legend:Ri("River Observations",{id:Or("rivers"),points:{values:[{color:e.out_of_service,label:"Out of Service"},{color:e.obs_not_current,label:"Old Data"},{color:e.not_defined,label:"Unavailable"},{color:e.low_threshold,label:"Low Threshold"},{color:e.no_flooding,label:"No Flooding"},{color:e.action,label:"Action"},{color:e.minor,label:"Minor"},{color:e.moderate,label:"Moderate"},{color:e.major,label:"Major"}]}}),evaluator:{title:"River Obs",fn:e=>{var t;const i=e[0];if(null==i?void 0:i.ob){let e="";return(null===(t=null==i?void 0:i.profile)||void 0===t?void 0:t.waterbody)&&(e+=`${ea(i.profile.waterbody)} - `),e+=ea(i.ob.status.replace(/_/," ")),e}return""}}}}(hs.rivers)}),{satellite:{id:"raster.satellite.infrared",layer:Pr(Dr.satellite_infrared)},"satellite-geocolor":{id:"raster.satellite.geocolor",layer:Pr(Dr.satellite_geocolor)},"satellite-visible":{id:"raster.satellite.visible",layer:Pr(Dr.satellite_visible)},"satellite-infrared-color":{id:"raster.satellite.infrared-color",layer:Pr(Dr.satellite_infrared_color)},"satellite-water-vapor":{id:"raster.satellite.water-vapor",layer:Pr(Dr.satellite_water_vapor)}})})(e)}isWeatherLayer(e){return xe(this.layers[e])||xe(this.getLayerAlias(e))}isDeprecated(e){return!!this.getLayerAlias(e)}getLayerAlias(e){return Qo[e]}getLayerMetadata(){return fetch("https://www.xweather.com/docs/mapsgl/api/layers").then((e=>e.json())).then((e=>e.layers.map((e=>({id:e.id,title:e.title,description:e.description,style:Xo(e.type||e.style),animatable:e.animatable,categories:e.categories,dataRange:e.dataRange,dataCoverage:e.dataCoverage,updateInterval:e.updateInterval}))).filter((e=>he(this.layers[e.id])))))}getWeatherLayerConfig(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var i,r,a,s,n,o,l,h,c,d;let u=this.getConfig(e);if(Zt(xe(u),`[MapsGL] No weather configuration found for '${e}'`),Array.isArray(u))return u;if(Zt(xe(u.layer),`[MapsGL] No weather layer specification found for '${e}'`),u.ref){const e=this.getConfig(u.ref);Zt(xe(e),`[MapsGL] No weather configuration found for base reference layer '${u.ref}'`),u=lt({},e,u)}he(t.type)&&(u.layer.type=t.type),xe(t.filter)&&(u.layer.filter=t.filter),u.source=this.getSourceConfig(u.layer.source,{timeline:t.timeline},Object.assign(Object.assign({},t),{timing:lt({},t.timing||{},{operation:u.operation||{}})})),Zt(xe(u.source),`[MapsGL] No weather source configuration found for '${e}'`),"string"==typeof u.layer.source&&(u.source.id=u.layer.source);const p=null===(i=(u.source instanceof Os?u.source.spec:u.source).timeSeries)||void 0===i?void 0:i.operation;if(xe(p)&&"none"!==p.type&&(u.source.id+=`-${p.type}`,"none"!==p.period&&(u.source.id+=`-${p.period}`),p.aggregate&&(u.source.id+="-aggregate")),xe(null===(r=t.timing)||void 0===r?void 0:r.intervals)&&(u.source.timeSeries.maxValidTimes=t.timing.intervals),xe(null===(a=t.data)||void 0===a?void 0:a.quality)&&(u.layer.quality=t.data.quality),he(t.paint)&&(u.layer.paint=Jt(u.layer.paint)?t.paint:lt({},Object.assign({},u.layer.paint),t.paint),"object"==typeof(null===(s=t.paint.sample)||void 0===s?void 0:s.colorscale)&&(null===(o=null===(n=t.paint.sample)||void 0===n?void 0:n.colorscale)||void 0===o?void 0:o.stops)&&pt(u.layer.paint,"sample.colorscale.stops",null===(h=null===(l=t.paint.sample)||void 0===l?void 0:l.colorscale)||void 0===h?void 0:h.stops)),he(t.timing)&&(u.layer.timeSeries=lt({},Object.assign({},u.layer.timeSeries),t.timing)),he(t.legend)){u.legend=lt({},Object.assign({},u.legend),t.legend);const e=null===(c=t.legend.points)||void 0===c?void 0:c.values;e&&pt(u.legend,"points.values",e)}if(u.legend&&(u.legend=this.configureLegendForPaint(u.legend,u.layer.paint)),xe(null===(d=t.data)||void 0===d?void 0:d.evaluator)&&(u.evaluator=lt({},u.evaluator||{},t.data.evaluator)),xe(u.query)){const e=u.query;u.query="string"==typeof e?{layerId:e}:e}if(xe(t.mask)){const e=t.mask;u.mask="string"==typeof e?this.getMaskConfig(e):e}return u}getWeatherLayerLegendId(e){const t=this.getConfig(e);if(!1===Array.isArray(t)&&(null==t?void 0:t.legend))return t.legend.id}loadStyles(e){return Promise.all([e.loadSprite("mapsgl","https://cdn.aerisapi.com/sdk/js/mapsgl/assets/sprite@2x.json"),e.loadSprite("mapsgl","https://cdn.aerisapi.com/sdk/js/mapsgl/assets/sprite-sdf.json")]).then((()=>{}))}getConfig(e){const t=this.layers[e];if(t){if(Array.isArray(t))return t;const e=lt({},t);return e.layer=lt({},e.layer),e}}getSourceConfig(e,t,i){var r;if("string"!=typeof e)return e;{const a=this.sources[e];if(a){const e=lt({timeSeries:{operation:{type:"none",period:"none",aggregate:!1}}},Jt(a)?a(t):a,{timeSeries:Object.assign({},null==i?void 0:i.timing)});return xe(null===(r=i.timing)||void 0===r?void 0:r.intervals)&&(e.timeSeries.maxValidTimes=i.timing.intervals),e}}}getMaskConfig(e){switch(e){case"water":return Xr;case"land":return Qr;default:return{layerId:e,overrides:void 0}}}configureLegendForPaint(e,t){var i;const r=null===(i=null==t?void 0:t.sample)||void 0===i?void 0:i.colorscale;if(r&&"object"==typeof r){const t=(e,t)=>{e.stops&&(t.stops=e.stops),e.interval&&(t.interval=e.interval),e.range&&(t.range=Object.assign(Object.assign({},e.range),t.range)),he(e.interpolate)&&(t.interpolate=e.interpolate),he(e.normalized)&&(t.normalized=e.normalized)};if(Array.isArray(e.bar)){if(r.masks){const i=e.bar;r.masks.forEach(((e,r)=>{e.colorscale.stops&&i[r]&&t(e.colorscale,i[r].colorscale)}))}}else xe(e.bar)&&(e.bar=e.bar||{},t(r,e.bar.colorscale))}return e}},Jo=class extends vo{get type(){return ji.raster}parseTile(e,t,i){const r=this.metadata.getValidTimes();return new Promise(((a,s)=>{const n=new Image;n.addEventListener("load",(()=>{var t;if(r.length>0){let s=e.data,o=[];const l=null==i?void 0:i.get("x-aeris-valid-date");if(xe(l)&&(o=At([l],!1)),le(s)){const t=r.map((e=>e.getTime()));s=new vr({},{width:n.width,height:n.height},t),s.id=e.coord.hash,s.useLinearTextureFilter=!0,this.tiles.setStale(e,!1)}const h=null===(t=o[0])||void 0===t?void 0:t.getTime();le(h)?console.warn(`[MapsGL] No valid time found for time series data for tile ${e.coord.hash}`):s.setData(h,new mr(n)),a(s)}else a(n)})),n.addEventListener("error",(()=>{s(n)})),n.crossOrigin="anonymous",n.src=URL.createObjectURL(t)}))}};var el=i("VmRL"),tl=i.n(el);const il=e=>{if(Fe(e))return`#${[e.r,e.g,e.b].map((e=>{const t=e.toString(16);return 1===t.length?`0${t}`:t})).join("")}`};class rl extends wn{get value(){return this._value}get x(){return this.value[0]}set x(e){this.value[0]=e}get y(){return this.value[1]}set y(e){this.value[1]=e}get z(){return this.value[2]}set z(e){this.value[2]=e}get w(){return this.value[3]}set w(e){this.value[3]=e}get elements(){return this.value.length}constructor(e=0,t=0,i=0,r=0){super(),this._value=an(e,t,i,r)}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t+0],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t+0]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromObject(e){let{x:t,y:i,z:r,w:a}=e;return void 0!==t&&(this.x=t),void 0!==i&&(this.y=i),void 0!==r&&(this.z=r),void 0!==a&&(this.w=a),this}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}set(e,t,i,r){return this._value=an(e,t,i,r),this}setScalar(e){return this.set(e,e,e,e)}length(){return hn(this.value)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}clone(){return new rl(this.x,this.y,this.z,this.w)}add(e){return sn(this.value,this.value,e.value),this}addScalar(e){return sn(this.value,this.value,an(e,e,e,e)),this}subtract(e){return nn(this.value,this.value,e.value),this}subtractScalar(e){return nn(this.value,this.value,an(e,e,e,e)),this}multiply(e){return on(this.value,this.value,e.value),this}multiplyScalar(e){return on(this.value,this.value,an(e,e,e,e)),this}divide(e){return ln(this.value,this.value,e.value),this}divideScalar(e){return ln(this.value,this.value,an(e,e,e,e)),this}distanceTo(e){return t=this.value,i=e.value,Math.hypot(i[0]-t[0],i[1]-t[1],i[2]-t[2],i[3]-t[3]);var t,i}dot(e){return dn(this.value,e.value)}equals(e){return un(this.value,e.value)}lerp(e,t){return function(e,t,i,r){var a=t[0],s=t[1],n=t[2],o=t[3];e[0]=a+r*(i[0]-a),e[1]=s+r*(i[1]-s),e[2]=n+r*(i[2]-n),e[3]=o+r*(i[3]-o)}(this.value,this.value,e.value,t),this}normalize(){return cn(this.value,this.value),this}applyMatrix4(e){return function(e,t,i){var r=t[0],a=t[1],s=t[2],n=t[3];e[0]=i[0]*r+i[4]*a+i[8]*s+i[12]*n,e[1]=i[1]*r+i[5]*a+i[9]*s+i[13]*n,e[2]=i[2]*r+i[6]*a+i[10]*s+i[14]*n,e[3]=i[3]*r+i[7]*a+i[11]*s+i[15]*n}(this.value,this.value,e.value),this}}const al=rl,sl={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},nl=e=>qe(e)||ke(e)?new ll(e):e instanceof ll?e:ze(e)&&he(e.r)&&he(e.g)&&he(e.b)&&he(e.a)?new ll(e.r,e.g,e.b,e.a):null,ol={};class ll{constructor(e=0,t,i,r=1){if(this.r=0,this.g=0,this.b=0,this.a=1,void 0===t&&void 0===i)if(qe(e)&&e<=255)this.setRGB(e,e,e);else if(ke(e)&&sl[e])this.fromHex(sl[e]);else{const t=Ge(e);if(t){const{r:e,g:i,b:r,a}=t;this.setRGBA(e,i,r,a)}}else this.setRGBA(e,t,i,r)}fromHex(e){let t=ol[e];return t||(t=De(e),ol[e]=t),this.setRGBA(t.r,t.g,t.b,t.a)}fromHSL(e,t,i){const r=Be({h:e,s:t,l:i,a:arguments.length>3&&void 0!==arguments[3]?arguments[3]:1});return this.setRGBA(r.r,r.g,r.b,r.a)}fromHSV(e,t,i){const r=$e({h:e,s:t,v:i,a:arguments.length>3&&void 0!==arguments[3]?arguments[3]:1});return this.setRGBA(r.r,r.g,r.b,r.a)}setRGB(e,t,i){return this.setRGBA(e,t,i,this.a),this}setRGBA(e,t,i,r){let a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this.r=a?e:Ue(e,0,255),this.g=a?t:Ue(t,0,255),this.b=a?i:Ue(i,0,255),this.setAlpha(r),this}setAlpha(e){return this.a=e>1?Ue(e,0,255):e,this}lighter(e){const t=e<1?e:e/100;let i=this.toHSL().l;return i+=i*t,i=Math.min(1,i),this}darker(e){const t=e<1?e:e/100;let i=this.toHSL().l;return i-=i*t,i=Math.max(0,i),this}equals(e){return this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a}toHex(){return il(this.toObject(!1))}toHSL(){return(e=>{if(!Fe(e))return;let{r:t,g:i,b:r}=e;t=Ue(t,0,255),i=Ue(i,0,255),r=Ue(r,0,255);const a=Math.min(t,i,r),s=Math.max(t,i,r);let n,o;const l=(s+a)/2;if(s===a)n=0,o=0;else{const e=s-a;switch(o=l>.5?e/(2-s-a):e/(s+a),s){case t:n=(i-r)/e+(i<r?6:0);break;case i:n=(r-t)/e+2;break;case r:n=(t-i)/e+4}n/=6}return{h:n,s:o,l}})(this.toObject(!1))}toHSV(){return(e=>{if(!Fe(e))return;let{r:t,g:i,b:r}=e;t=Ue(t,0,255),i=Ue(i,0,255),r=Ue(r,0,255);const a=Math.max(t,i,r),s=Math.min(t,i,r);let n;const o=a,l=a-s,h=0===a?0:l/a;if(a===s)n=0;else{switch(a){case t:n=(i-r)/l+(i<r?6:0);break;case i:n=(r-t)/l+2;break;case r:n=(t-i)/l+4}n/=6}return{h:n,s:h,v:o}})(this.toObject(!1))}toObject(){const e=arguments.length>0&&void 0!==arguments[0]&&!arguments[0]?255:1;return{r:this.r*e,g:this.g*e,b:this.b*e,a:this.a}}toArray(){return[this.r,this.g,this.b,this.a]}toVector(){return(new al).fromArray(this.toArray())}toString(){return`${this.constructor.name}(${this.r}, ${this.g}, ${this.b}, ${this.a}})`}}const hl=ll;class cl{get bytesPerElement(){throw new Error("Subclasses of StructArray must override `bytesPerElement`")}constructor(e=1,t=0){this.capacity=-1,this.length=0,this.stride=1,this.stride=e,this.resize(t)}resize(e){e=Math.ceil(e),this.length=e,this.reserve(e)}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.buffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const t=this.data;this.refresh(),t&&this.data.set(t)}}emplace(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=this.length;this.resize(i+1),this.emplaceAt(i,e,t)}emplaceAt(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=Array.isArray(t)?t:[t],a=e*this.stride;if(i&&console.warn("emplaceAt",e,t,r,this.length,this.data),r.length!==this.stride)throw new Error(`Element length (${r.length}) does not match the stride for the StructArray ${this.stride}`);r.forEach(((e,t)=>{this.data[a+t]=r[t]}))}get(e){const t=e*this.stride;return this.data.slice(t,t+this.stride)}refresh(){throw new Error("Subclasses of StructArray must override `refresh`")}trim(){this.length!==this.capacity&&(this.capacity=this.length,this.buffer=this.buffer.slice(0,this.length*this.bytesPerElement),this.refresh())}clear(){this.length=0}serialize(){return this.trim(),{capacity:this.capacity,length:this.length,stride:this.stride,buffer:this.buffer}}static from(e){const t=Object.create(this.prototype);return t.stride=e.stride,t.buffer=e.buffer,t.length=e.length,t.capacity=e.length,t.refresh(),t}}class dl extends cl{get bytesPerElement(){return 2*this.stride}refresh(){this.data=new Int16Array(this.buffer)}}class ul extends cl{get bytesPerElement(){return 2*this.stride}refresh(){this.data=new Uint16Array(this.buffer)}}class pl extends cl{get bytesPerElement(){return 4*this.stride}refresh(){this.data=new Float32Array(this.buffer)}}const ml=(e,t)=>256*(e=Pe(Math.floor(e),0,255))+Pe(Math.floor(t),0,255),fl=e=>[ml(255*e.r,255*e.g),ml(255*e.b,255*e.a)],gl=Math.pow(2,16)-1,vl=function(e){const t=Co/(arguments.length>1&&void 0!==arguments[1]?arguments[1]:Co);return{x:Math.round(e.x*t),y:Math.round(e.y*t)}},yl=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=[],r=[],a=[];for(const s of e){if(0===s.length)continue;s!==e[0]&&i.push(r.length/2);const n=[];for(let e=0;e<s.length;e++){const t=r.length/2;r.push(s[e].x,s[e].y),n.push(t)}t&&n.push(n[0]),a.push(n)}return{flattened:r,holeIndices:i,lineList:a}},xl=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=ge(e)?void 0:e.at(-1);return(!a||a.vertex.length+t>gl)&&(a={vertex:{offset:i,length:0},index:{offset:r,length:0}},e.push(a)),a},bl=(e,t)=>{const i=t.offset*e.stride;return e.data.subarray(i,i+t.length*e.stride)},wl=(e,t,i)=>{const r=i.offset*t.stride,a=i.length*t.stride;Zt(e.length>=i.length*t.stride,"[MapsGL] Destination array is too small");for(let i=0;i<a;i++)e[i]=t.data[r+i];return e},_l=(e,t)=>{var i;let r;if("string"==typeof e)r=e;else if(e.property){const a=e.property;if(Array.isArray(a)){let e;a.forEach((i=>{e||(e=ut(t,i))})),r=e}else r=ut(t,a);if(he(r)&&Jt(e.transform)){const t=e.transform(r,null===(i=e.measurement)||void 0===i?void 0:i.units);he(t)&&(r=`${t}`)}}return he(r)?`${r}`:void 0},Ml=(e,t)=>t instanceof Float32Array?e.FLOAT:t instanceof Uint16Array?e.UNSIGNED_SHORT:e.UNSIGNED_INT,Al=class{constructor(e,t,i,r=!0,a=0,s=0,n=0){if(this.size=1,this.dynamic=!1,this.instanced=!1,this.stride=0,this.offset=0,this.divisor=0,this.needsUpdate=!1,Array.isArray(t))throw new TypeError("[Aeris GL] BufferAttribute: array should be a typed array");let o=0;void 0!==t&&(o=a?t.byteLength/a:t.length/i),this.data=t,this.size=i,this.type=Ml(e,t),this.normalized=!0===r,this.stride=a,this.offset=s,this.divisor=n,this.instanced=n>0,this.count=o}};var Sl,Tl=function(e,t,i,r){if("a"===i&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?r:"a"===i?r.call(e):r?r.value:t.get(e)};Sl=new WeakMap;const El=class{get type(){return Tl(this,Sl,"f").type}get data(){return Tl(this,Sl,"f").data}set data(e){Tl(this,Sl,"f").data=e}get count(){return Tl(this,Sl,"f").count}get buffer(){return Tl(this,Sl,"f").buffer}set buffer(e){Tl(this,Sl,"f").buffer=e}constructor(e,t,i=!0,r=0,a=0,s){this.size=1,this.dynamic=!1,this.instanced=!1,this.stride=0,this.offset=0,this.divisor=0,this.needsUpdate=!1,Sl.set(this,void 0),function(e,t,i,r,a){if("function"==typeof t||!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");t.set(e,i)}(this,Sl,e),this.size=t,this.normalized=!0===i,this.stride=le(s)?e.stride:s,this.offset=r,this.divisor=a,this.instanced=a>0}};let Ol=1,Cl=1;const Rl=new Mn;class Pl extends ro{get id(){return this._id}get attributes(){return this._attributes}get index(){return this.attributes.get("index")}get bounds(){return this._bounds}constructor(e,t={}){super(e),this.drawRange={start:0,count:0},this.instancedCount=0,this.isInstanced=!1,this._attributes=new Map,this._VAOs={};const i=e.gl;i||console.error("[Aeris GL] GL context not passed as first argument to Geometry"),this._id=Ol,this.drawMode=e.gl.TRIANGLES,Ol+=1,e.bindVertexArray(null),e.state.setActiveGeometry(null),Object.keys(t).forEach((e=>{const r=t[e];if(r instanceof Al||r instanceof El)"index"===e?this.setIndex(r):this.addAttribute(e,r);else{const{size:t,data:a,normalized:s,stride:n,offset:o,divisor:l}=r;if(t&&a){const r=new Al(i,a,t,s,n,o,l);"index"===e?this.setIndex(r):this.addAttribute(e,r)}}}))}addAttribute(e,t){const i=this.context.gl;if(t.id=Cl,t.target="index"===e?i.ELEMENT_ARRAY_BUFFER:i.ARRAY_BUFFER,t.divisor=t.divisor||0,t.needsUpdate=!1,this.attributes.set(e,t),Cl+=1,t.buffer||(t.buffer=i.createBuffer(),this.updateAttribute(t)),t.divisor){if(this.isInstanced=!0,this.instancedCount&&this.instancedCount!==t.count*t.divisor)return console.warn(`[Aeris GL] Geometry has multiple instanced buffers of different length - instancedCount: ${this.instancedCount}, count: ${t.count}, divisor: ${t.divisor}, attribute: ${e}`),this.instancedCount=Math.min(this.instancedCount,t.count*t.divisor),this.instancedCount;this.instancedCount=t.count*t.divisor}else"index"===e?this.drawRange.count=t.count:this.index||(this.drawRange.count=Math.max(this.drawRange.count,t.count))}getAttribute(e){return this.attributes.get(e)}setAttributeData(e,t){const i=this.getAttribute(e);i&&(i.data=t,i.needsUpdate=!0)}updateAttribute(e){const t=this.context.gl;t.bindBuffer(e.target,e.buffer),t.bufferData(e.target,e.data,t.STATIC_DRAW),e.needsUpdate=!1}removeAttribute(e){this.attributes.delete(e)}setIndex(e){if(Array.isArray(e)){const t=e.length>65535?new Uint32Array(e):new Uint16Array(e),i=new Al(this.context.gl,t,1);this.addAttribute("index",i)}else e.size=1,this.addAttribute("index",e);this.drawRange.count=this.index.count}setVertices(e){const t=[];for(let i=0,r=e.length;i<r;i+=1){const r=e[i];t.push(r[0],r[1],r[2])}this.addAttribute("position",new Al(this.context.gl,new Float32Array(t),3))}setNormals(e){this.addAttribute("normal",new Al(this.context.gl,new Float32Array(e),2))}setUVs(e){this.addAttribute("uv",new Al(this.context.gl,new Float32Array(e),2))}setColors(e){const t=[];for(let i=0,r=e.length;i<r;i+=1){let r=e[i];r instanceof hl&&(r=r.toVector().toArray()),t.push(r[0],r[1],r[2],r[3])}this.addAttribute("color",new Al(this.context.gl,new Float32Array(t),4))}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}setInstancedCount(e){this.instancedCount=e}createVAO(e){const t=e.attributeOrder,i=this.context.createVertexArray();this.context.bindVertexArray(i),this._VAOs[t]=i,this.bindAttributes(e),this.context.bindVertexArray(null)}bindAttributes(e){const t=this.context.gl;Object.keys(e.attributes).forEach((i=>{const r=this.attributes.get(i);if(!r)return;const a=e.attributes[i];t.bindBuffer(r.target,r.buffer),this.context.state.opts.boundBuffer=r.buffer;let s=1;35674===r.type&&(s=2),35675===r.type&&(s=3),35676===r.type&&(s=4);for(let e=0;e<s;e++)t.vertexAttribPointer(a+e,r.size,r.type,r.normalized,r.stride,r.offset),t.enableVertexAttribArray(a+e),this.context.vertexAttribDivisor(a+e,r.divisor)}));const i=this.attributes.get("index");i&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,i.buffer)}computeBoundingBox(){const{data:e,offset:t=0,stride:i,size:r}=this.attributes.get("position");this.bounds||(this._bounds={min:new Mn,max:new Mn,center:new Mn,scale:new Mn,radius:Number.POSITIVE_INFINITY});const a=this.bounds,s=a.min,n=a.max,o=a.center,l=a.scale;s.setScalar(+Number.POSITIVE_INFINITY),n.setScalar(Number.NEGATIVE_INFINITY);const h=i||r;for(let i=t,r=e.length;i<r;i+=h){const t=e[i+0],r=e[i+1],a=e[i+2];s.x=Math.min(t,s.x),s.y=Math.min(r,s.y),s.z=Math.min(a,s.z),n.x=Math.max(t,n.x),n.y=Math.max(r,n.y),n.z=Math.max(a,n.z)}return l.subVectors(n,s),o.add(s).add(n).divideScalar(2),a}computeBoundingSphere(){const{data:e,offset:t=0,stride:i,size:r}=this.attributes.get("position");this.bounds||this.computeBoundingBox();let a=0;const s=i||r;for(let i=t,r=e.length;i<r;i+=s)Rl.fromArray([...e],i),a=Math.max(a,this.bounds.center.distanceToSquared(Rl));this.bounds.radius=Math.sqrt(a)}draw(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.drawMode;const i=this.context.gl,{start:r,count:a}=this.drawRange,s=`${this.id}_${e.attributeOrder}`;this.context.state.activeGeometryId!==s&&(this._VAOs[e.attributeOrder]||this.createVAO(e),e.context.bindVertexArray(this._VAOs[e.attributeOrder]),this.context.state.setActiveGeometry(s)),Object.keys(e.attributes).forEach((e=>{const t=this.getAttribute(e);t&&t.needsUpdate&&this.updateAttribute(t)})),this.isInstanced?this.index?this.context.drawElementsInstanced(t,a,this.index.type,this.index.offset+2*r,this.instancedCount):this.context.drawArraysInstanced(t,r,a,this.instancedCount):this.index?i.drawElements(t,a,this.index.type,this.index.offset+2*r):i.drawArrays(t,r,a)}clone(){const e={};this.attributes.forEach(((t,i)=>{e[i]=t}));const t=new Pl(this.context,e);return t.drawMode=this.drawMode,t}dispose(){Object.keys(this._VAOs).forEach((e=>{this.context.deleteVertexArray(this._VAOs[e]),delete this._VAOs[e]})),this.attributes.forEach((e=>{this.gl.deleteBuffer(e.buffer)})),this.attributes.clear()}}const kl=Pl,Dl=class{constructor(){this.layoutVertexArray=new pl(2),this.colorVertexArray=new pl(2),this.indexArray=new ul(3),this.indexArray2=new ul(2),this.segments={line:[],triangle:[]},this._geometry={fill:null,stroke:null}}get geometry(){return this._geometry}prepareGeometry(e,t){if(t&&this._geometry.stroke||!t&&this._geometry.fill)return;const i=t?this.segments.line:this.segments.triangle,r=t?this.indexArray2:this.indexArray,a=[];for(let t=0;t<i.length;t++){const s=i[t],{vertex:n,index:o}=s,l=bl(this.layoutVertexArray,n),h=bl(this.colorVertexArray,n),c=wl(new Uint16Array(o.length*r.stride),r,o),d=new kl(e,{position:{size:2,data:l},color:{size:2,data:h},index:{size:1,data:c}});a.push(d)}t?this._geometry.stroke=a:this._geometry.fill=a}addVertex(e,t){this.layoutVertexArray.emplace([e,t])}trim(){this.layoutVertexArray.trim(),this.indexArray.trim(),this.indexArray2.trim(),this.colorVertexArray.trim()}updateColorArray(e,t,i){const r=fl(i||new hl("#000"));for(let i=e;i<t;i++)this.colorVertexArray.emplaceAt(i,r)}};class zl extends Ro{constructor(){super(...arguments),this.buffers=new Dl}get type(){return"fill"}addFeature(e,t){const i=e.feature.asPolygons(),r=e.feature.extent,a=this.buffers,s=a.layoutVertexArray,n=a.indexArray,o=a.indexArray2,l=a.layoutVertexArray.length;if(!i)return;for(let e=0;e<i.length;e++){const t=i[e];for(let e=0;e<t.length;e++){const i=t[e];if(0!==i.length)for(let e=0;e<i.length;e++){const t=vl({x:i[e].x,y:i[e].y},r);i[e]=t}}const{flattened:l,holeIndices:h,lineList:c}=yl(t,!0),d=l.length/2,u=xl(a.segments.triangle,d,s.length,n.length),p=u.vertex.length,m=tl()(l,h,2);if(m.length%3!=0)throw new Error("Invalid indices count");for(let e=0;e<m.length;e+=3)a.indexArray.emplace([p+m[e+0],p+m[e+1],p+m[e+2]]);u.vertex.length+=d,u.index.length+=m.length/3;const f=xl(a.segments.line,d,s.length,o.length),g=f.vertex.length;f.vertex.length+=d;for(let e=0;e<l.length;e+=2)a.addVertex(l[e],l[e+1]);for(let e=0;e<c.length;e++){const t=c[e],i=[];for(let e=1;e<t.length;e++)i.push(t[e-1],t[e]);for(let e=1;e<i.length;e+=2)o.emplace([g+i[e-1],g+i[e]]);f.index.length+=i.length/2}}const h=fl(new hl("#000"));for(let e=a.colorVertexArray.length;e<a.layoutVertexArray.length;e++)a.colorVertexArray.emplace(h);return{type:e.type,featureIndex:e.featureIndex,sourceId:e.sourceId,sourceLayerIndex:e.sourceLayerIndex,geometry:i,properties:e.properties,vertexRange:{start:l,end:a.layoutVertexArray.length}}}trim(){this.buffers.trim()}serialize(){const e=this.buffers,t=super.serialize();return Object.assign(Object.assign({},t),{layoutVertexArray:e.layoutVertexArray.serialize(),colorVertexArray:e.colorVertexArray.serialize(),indexArray:e.indexArray.serialize(),index2Array:e.indexArray2.serialize(),segments:{line:e.segments.line,triangle:e.segments.triangle}})}static from(e){const t=new zl(e.options);return ge(e)?console.warn("[MapsGL] Cannot create FillStore from invalid serialized data."):(t.features=e.features,t.buffers.segments.line=e.segments.line,t.buffers.segments.triangle=e.segments.triangle,t.buffers.layoutVertexArray=pl.from(e.layoutVertexArray),t.buffers.colorVertexArray=pl.from(e.colorVertexArray),t.buffers.indexArray=ul.from(e.indexArray),t.buffers.indexArray2=ul.from(e.index2Array)),t}}const Il=zl,Fl=[0,1,2,0,2,3],Ll=new Float32Array([0,-.5,1,-.5,1,.5,0,.5]),jl=class{constructor(){this.layoutVertexArray=new pl(2),this.colorVertexArray=new pl(2),this.indexArray=new ul(2),this.uvArray=new pl(2),this.previousVertexArray=new pl(2),this.nextVertexArray=new pl(2),this.sideArray=new dl(1),this.widthArray=new pl(1),this.lengthArray=new pl(1),this.terminalArray=new pl(1),this.countersArray=new pl(1),this.segments={line:[]}}get geometry(){return this._geometry}prepareGeometry(e,t,i){if(this._geometry)return;const r=!1;let a=0;for(let e=0;e<t.length;e++){const{start:i,end:r}=t[e];a=Math.max(a,r-i)}const s=function(e,t,i,r){let a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=0;for(let e=0;e<i.length;e++){const{start:t,end:r}=i[e];s=Math.max(s,(r-t)/2)}const n=(new Float32Array).BYTES_PER_ELEMENT,o=t.layoutVertexArray.data,l=4*n,h={position:{size:2,data:Ll},color:{size:2,data:t.colorVertexArray.data,stride:4*n,divisor:1},segments:{size:1,data:t.lengthArray.data,divisor:1},terminal:{size:1,data:t.terminalArray.data,divisor:1}};let c=1===s?i.length:t.layoutVertexArray.length/2;if(a&&s>1){const e=1===s?[0,0,2,2]:[0,4,6,10];h.pA={size:2,data:o,stride:l,offset:e[0]*n,divisor:1},h.pB={size:2,data:o,stride:l,offset:e[1]*n,divisor:1},h.pC={size:2,data:o,stride:l,offset:e[2]*n,divisor:1},h.pD={size:2,data:o,stride:l,offset:e[3]*n,divisor:1},c=(t.layoutVertexArray.length-4)/2}else h.pA={size:2,data:o,stride:l,offset:0*n,divisor:1},h.pB={size:2,data:o,stride:l,offset:2*n,divisor:1};const d=new kl(e,h);return d.setIndex(Fl),d.setInstancedCount(c),d}(e,this,t,i,r),n=function(e,t,i,r){const a=t.layoutVertexArray.data,s=t.colorVertexArray.data,n=[],o=[];for(let e=0;e<i.length;e++){const{start:t,end:r}=i[e];if(r-t>2){let e=0;for(;e<3;){const i=t+2*e;n.push(a[i+0],a[i+1]),o.push(s[i+0],s[i+1]),e+=1}for(e=1;e<=3;){const t=r-2*e;n.push(a[t+0],a[t+1]),o.push(s[t+0],s[t+1]),e+=1}}}if(0===n.length)return;const l=new Float32Array(n),h=(new Float32Array).BYTES_PER_ELEMENT,c=new kl(e,{position:{size:2,data:new Float32Array([0,-.5,1,-.5,1,.5,0,.5])},color:{size:2,data:new Float32Array(o),stride:4*h,divisor:1},pA:{size:2,data:l,stride:4*h,offset:0*h,divisor:1},pB:{size:2,data:l,stride:4*h,offset:2*h,divisor:1},pC:{size:2,data:l,stride:4*h,offset:3*h,divisor:1}});return c.setInstancedCount(l.length/16),c.setIndex([0,1,2,0,2,3]),c}(e,this,t),o=a>2?function(e,t,i,r){let a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const s=r.strokeLineJoin(),n=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r={[Ir.Bevel]:{size:3,position:i?[1,0,0,0,1,0,0,0,1]:[0,0,0,1,0,0,0,1,0],index:void 0,id:void 0},[Ir.Miter]:{size:4,position:i?[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]:[0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,1,0],index:[0,1,2,0,2,3],id:void 0},[Ir.Round]:{size:2,position:Array.from({length:t}).reduce(((e,i,r)=>{const a=2*Math.PI*r/t;return e.push(.5*Math.cos(a),.5*Math.sin(a)),e}),[0,0]),index:Array.from({length:t}).reduce(((e,t,i)=>(e.push(0,i+1,i+2),e)),[]),id:Array.from({length:t+2}).reduce(((e,t,i)=>(e.push(i),e)),[])}};return r[e]}(s,12),o=(new Float32Array).BYTES_PER_ELEMENT,l=2*o,h=t.layoutVertexArray.data,c=t.colorVertexArray.data,d={position:{size:n.size,data:new Float32Array(n.position)},color:{size:2,data:c,stride:l,divisor:1},pA:{size:2,data:h,stride:l,offset:0*o,divisor:1},pB:{size:2,data:h,stride:l,offset:4*o,divisor:1},pC:{size:2,data:h,stride:l,offset:8*o,divisor:1}};a&&s===Ir.Round&&(d.id={size:1,data:new Float32Array(n.id)});const u=new kl(e,d);return u.setInstancedCount(t.layoutVertexArray.length-4),a&&n.index&&u.setIndex(n.index),u}(e,this,t,i,r):void 0,l=function(e,t,i,r){const a=r.strokeLineCap(),s=function(e,t){return{butt:{},square:{size:2,position:[0,.5,0,-.5,.5,-.5,.5,.5],index:[0,1,2,0,2,3]},round:{size:2,position:(e=>{const t=[0,0];for(let e=0;e<=12;e++){const i=-.5*Math.PI+Math.PI*e/12;t.push(.5*Math.cos(i),.5*Math.sin(i))}return t})(),index:(e=>{const t=[];for(let e=0;e<12;e++)t.push(0,e+1,e+2);return t})()}}[e]}(a);if(a===Fr.Butt)return;const n=t.layoutVertexArray.data,o=t.colorVertexArray.data,l=[],h=[];for(let e=0;e<i.length;e++){const{start:t,end:r}=i[e];let a=0;for(;a<2;){const e=2*t+2*a;l.push(n[e+0],n[e+1]),h.push(o[e+0],o[e+1]),a+=1}for(a=1;a<=2;){const e=2*r-2*a;l.push(n[e+0],n[e+1]),h.push(o[e+0],o[e+1]),a+=1}}const c=(new Float32Array).BYTES_PER_ELEMENT,d=4*c,u=new kl(e,{position:{size:s.size,data:new Float32Array(s.position)},color:{size:2,data:new Float32Array(h),stride:d,divisor:1},pA:{size:2,data:new Float32Array(l),stride:d,offset:0*c,divisor:1},pB:{size:2,data:new Float32Array(l),stride:d,offset:2*c,divisor:1}});return u.setIndex(s.index),u}(e,this,t,i);this._geometry={segments:[s],terminals:[n],joins:[o],caps:[l]}}addVertex(e,t){this.layoutVertexArray.emplace([e,t])}trim(){this.layoutVertexArray.trim(),this.indexArray.trim(),this.colorVertexArray.trim(),this.uvArray.trim(),this.previousVertexArray.trim(),this.nextVertexArray.trim(),this.sideArray.trim(),this.widthArray.trim(),this.lengthArray.trim(),this.terminalArray.trim(),this.countersArray.trim()}updateColorArray(e,t,i){const r=fl(i||new hl("#000"));for(let i=e;i<t;i++)this.colorVertexArray.emplaceAt(i,r)}};class Nl{constructor(e,t,i=0){this.x=e,this.y=t,this.z=i}equals(e){return this.x===e.x&&this.y===e.y&&this.z===e.z}}class Ul extends Ro{constructor(){super(...arguments),this.buffers=new jl}get type(){return"line"}addFeature(e,t){const i=this.buffers.layoutVertexArray,r=this.buffers.colorVertexArray,a=i.length;let s;if(2===e.type?s=this.addLines(e):3===e.type&&(s=this.addPolygons(e)),i.length===a)return;const n=fl(new hl("#000"));for(let e=r.length;e<i.length;e++)r.emplace(n);const o=(i.length-a)/2;for(let e=0;e<o;e++)this.buffers.lengthArray.emplace(o);return{type:e.type,featureIndex:e.featureIndex,sourceId:e.sourceId,sourceLayerIndex:e.sourceLayerIndex,geometry:s,properties:e.properties,vertexRange:{start:a,end:i.length}}}addLines(e){const t=e.feature.asLines(),i=e.feature.extent;for(let r=0;r<t.length;r++){const a=t[r].map((e=>vl(e,i))).map((e=>new Nl(e.x,e.y)));this.addLine(a,e,Ir.Miter,Fr.Butt,0,0)}return t}addPolygons(e){const t=this.buffers,i=e.feature.asPolygons(),r=t.layoutVertexArray,a=t.indexArray;for(let s=0;s<i.length;s++){const n=i[s];for(let t=0;t<n.length;t++){const i=n[t];if(0!==i.length)for(let t=0;t<i.length;t++){const r=vl({x:i[t].x,y:i[t].y},e.feature.extent);i[t]=r}}const{flattened:o,lineList:l}=yl(n),h=o.length/2,c=r.length;xl(t.segments.line,h,r.length,a.length).vertex.length+=h;for(let e=0;e<l.length;e++){const i=l[e];for(let e=0;e<i.length;e++){const r=i[e],a=o[2*r+0],s=o[2*r+1];t.addVertex(a,s),e>0&&e<i.length-1&&t.addVertex(a,s)}}const d=(r.length-c)/2;for(let e=0;e<d;e++){let i=0;0===e?i=1:e===d-1&&(i=2),t.terminalArray.emplace(i)}}return i}addLine(e,t,i,r,a,s){const n=this.buffers,o=3===t.feature.type;let l=e.length;for(;l>=2&&e[l-1].equals(e[l-2]);)l-=1;let h=0;for(;h<l-1&&e[h].equals(e[h+1]);)h+=1;if(l<(o?3:2))return;const c=xl(n.segments.line,10*l,n.layoutVertexArray.length,n.indexArray.length),d=n.layoutVertexArray.length;for(let t=h;t<l;t++){const i=e[t];let r,a;t<l-1&&(r=e[t-1]),t>0&&(a=e[t+1]),this.addVertex(c,t,i,r,a,l),t>h&&t<l-1&&this.addVertex(c,t,i,r,a,l)}c.vertex.length+=e.length,c.index.length+=e.length;const u=(n.layoutVertexArray.length-d)/2;for(let e=0;e<u;e++){let t=0;1===u?t=3:0===e?t=1:e===u-1&&(t=2),n.terminalArray.emplace(t)}}addVertex(e,t,i,r,a,s){this.buffers.layoutVertexArray.emplace([i.x,i.y]),e.vertex.length+=1,e.index.length+=1}serialize(){const e=this.buffers,t=super.serialize();return Object.assign(Object.assign({},t),{layoutVertexArray:e.layoutVertexArray.serialize(),colorVertexArray:e.colorVertexArray.serialize(),indexArray:e.indexArray.serialize(),uvArray:e.uvArray.serialize(),previousVertexArray:e.previousVertexArray.serialize(),nextVertexArray:e.nextVertexArray.serialize(),sideArray:e.sideArray.serialize(),widthArray:e.widthArray.serialize(),lengthArray:e.lengthArray.serialize(),terminalArray:e.terminalArray.serialize(),countersArray:e.countersArray.serialize(),segments:{line:e.segments.line}})}static from(e){const t=new Ul(e.options);return ge(e)?console.warn("[MapsGL] Cannot create LineStore from invalid serialized data."):(t.features=e.features,t.buffers.segments.line=e.segments.line,t.buffers.layoutVertexArray=pl.from(e.layoutVertexArray),t.buffers.colorVertexArray=pl.from(e.colorVertexArray),t.buffers.indexArray=ul.from(e.indexArray),t.buffers.uvArray=pl.from(e.uvArray),t.buffers.previousVertexArray=pl.from(e.previousVertexArray),t.buffers.nextVertexArray=pl.from(e.nextVertexArray),t.buffers.sideArray=dl.from(e.sideArray),t.buffers.widthArray=pl.from(e.widthArray),t.buffers.lengthArray=pl.from(e.lengthArray),t.buffers.terminalArray=pl.from(e.terminalArray),t.buffers.countersArray=pl.from(e.countersArray)),t}}const Vl=Ul,Bl=class{constructor(e,t,i){if(Array.isArray(t))throw new TypeError("[Aeris GL] InterleavedBuffer: data should be a typed array");let r=0;void 0!==t&&(r=t.byteLength/i),this.data=t,this.type=Ml(e,t),this.stride=i,this.count=r}},$l=class{constructor(){this.layoutVertexArray=new pl(2),this.colorVertexArray=new pl(2),this.indexArray=new ul(3),this.radiusArray=new pl(1),this.strokeWidthArray=new pl(1),this.segments={point:[]}}get geometry(){return this._geometry}prepareGeometry(e){if(this._geometry)return;const t=(new Float32Array).BYTES_PER_ELEMENT,i=new Bl(e.gl,this.layoutVertexArray.data,2*t),r=new Bl(e.gl,this.colorVertexArray.data,4*t),a=new Bl(e.gl,this.radiusArray.data,1*t),s=new Bl(e.gl,this.strokeWidthArray.data,1*t),n=new kl(e,{position:{size:2,data:new Float32Array([0,1,0,0,1,0,1,1])},uv:{size:2,data:new Float32Array([0,1,0,0,1,0,1,1])},anchor:new El(i,2,!1,0,1),fillColor:new El(r,2,!1,0,1),strokeColor:new El(r,2,!1,2*t,1),strokeWidth:new El(s,1,!1,0,1,1*t),radius:new El(a,1,!1,0,1,1*t)});n.setIndex([0,1,2,0,2,3]),this._geometry=n}trim(){this.layoutVertexArray.trim(),this.indexArray.trim(),this.colorVertexArray.trim(),this.radiusArray.trim(),this.strokeWidthArray.trim()}updateColorArray(e,t,i){const r=fl(i||new hl("#000"));for(let i=e;i<t;i++)this.colorVertexArray.emplaceAt(i,r)}updateRadiusArray(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;for(let r=e;r<t;r++)this.radiusArray.emplaceAt(r,i)}updateStrokeWidthArray(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(let r=e;r<t;r++)this.strokeWidthArray.emplaceAt(r,i)}};class ql extends Ro{constructor(){super(...arguments),this.buffers=new $l}get type(){return"circle"}addFeature(e,t){const i=this.buffers,r=e.feature.asPoints(),a=e.feature.extent;if(!r)return;const s=i.layoutVertexArray.length;for(let e=0;e<r.length;e++){const t=r[e],s=vl({x:t.x,y:t.y},a);if(r[e]=s,s.x<0||s.x>=Co||s.y<0||s.y>=Co)continue;const n=xl(i.segments.point,2,i.layoutVertexArray.length,i.indexArray.length);i.layoutVertexArray.emplace([s.x,s.y]),n.vertex.length+=2,n.index.length+=1}if(i.layoutVertexArray.length===s)return;const n=fl(new hl("#000"));for(let e=i.colorVertexArray.length;e<2*i.layoutVertexArray.length;e++)i.colorVertexArray.emplace(n);for(let e=s;e<i.layoutVertexArray.length;e++)i.radiusArray.emplace(10),i.strokeWidthArray.emplace(1);return{type:e.type,featureIndex:e.featureIndex,sourceId:e.sourceId,sourceLayerIndex:e.sourceLayerIndex,geometry:r,properties:e.properties,vertexRange:{start:s,end:i.layoutVertexArray.length},radius:10,strokeWidth:1}}trim(){this.buffers.trim()}serialize(){const e=this.buffers,t=super.serialize();return Object.assign(Object.assign({},t),{layoutVertexArray:e.layoutVertexArray.serialize(),colorVertexArray:e.colorVertexArray.serialize(),indexArray:e.indexArray.serialize(),radiusArray:e.radiusArray.serialize(),strokeWidthArray:e.strokeWidthArray.serialize(),segments:{point:e.segments.point}})}static from(e){const t=new ql(e.options);return ge(e)?console.warn("[MapsGL] Cannot create CircleStore from invalid serialized data."):(t.features=e.features,t.buffers.segments.point=e.segments.point,t.buffers.layoutVertexArray=pl.from(e.layoutVertexArray),t.buffers.colorVertexArray=pl.from(e.colorVertexArray),t.buffers.indexArray=ul.from(e.indexArray),t.buffers.radiusArray=pl.from(e.radiusArray),t.buffers.strokeWidthArray=pl.from(e.strokeWidthArray)),t}}const Gl=ql,Hl=(e,t,i)=>{for(let r=0;r<e.kernings[r];r++){const a=e.kernings[r];if(!(a.first<t||a.second<i))return a.first>t||a.first===t&&a.second>i?0:a.amount}return 0},Wl=class{get font(){return this._config.font}constructor(e={}){this._config=Object.freeze(Object.assign({width:Number.POSITIVE_INFINITY,size:1,align:"left",letterSpacing:0,lineHeight:1.4,wordSpacing:0,wordBreak:!1},e))}generateLayout(e){const t=this.font,i=t.common.base,r=this._config.size,a=this._config.lineHeight,s=e.replaceAll(/[\n ]/g,"").length,n={position:{size:3,data:new Float32Array(4*s*3)},uv:{size:2,data:new Float32Array(4*s*2)},id:{size:4,data:new Float32Array(4*s)},index:{size:6,data:new Float32Array(6*s)}},o={position:[],uv:[],id:[],index:[],layout:[]};for(let e=0;e<s;e++)n.id.data[e]=e,n.index.data.set([4*e,4*e+2,4*e+1,4*e+1,4*e+2,4*e+3],6*e),o.id.push(e),o.index.push([4*e,4*e+2,4*e+1,4*e+1,4*e+2,4*e+3]);const l=r/i,h=t.chars.reduce(((e,t)=>(e[t.char]=t,e)),{}),c=[];let d=0,u=0,p=0;const m=()=>{const e={width:0,glyphs:[]};return c.push(e),u=d,p=0,e};let f=m();const g=/\s/,v=/\n/;let y=0;for(;d<e.length&&y<100;){y+=1;const i=e[d];if(!f.width&&g.test(i)){d+=1,u=d,p=0;continue}if(v.test(i)){d+=1,f=m();continue}const a=h[i]||h[" "];if(f.glyphs.length>0){const e=f.glyphs.at(-1)[0],i=Hl(t,a.id,e.id)*l;f.width+=i,p+=i}f.glyphs.push([a,f.width]);let s=0;if(g.test(i)?(u=d,p=0,s+=this._config.wordSpacing*r):s+=this._config.letterSpacing*r,s+=a.xadvance*l,f.width+=s,p+=s,f.width>this._config.width){if(this._config.wordBreak&&f.glyphs.length>1){f.width-=s,f.glyphs.pop(),f=m();continue}if(!this._config.wordBreak&&p!==f.width){const e=d-u+1;f.glyphs.splice(-e,e),d=u,f.width-=p,f=m();continue}}d+=1,y=0}f.width||c.pop();const x={width:Math.max(...c.map((e=>e.width))),height:c.length*r*this._config.lineHeight},{positions:b,uvs:w,layout:_}=this._populateBuffers(n,c,r,a,l,x);return o.position=b,o.uv=w,o.layout=_,{text:e,buffers:n,data:o,layout:_,numChars:s,numLines:c.length,size:x}}_populateBuffers(e,t,i,r,a,s){const n=this.font,o=n.common.scaleW,l=n.common.scaleH,h=this._config.align,c=/\s/,d=[],u=[],p=[];let m=.14*i,f=0;switch(h){case"bottom-left":case"bottom":case"bottom-right":m+=s.height;break;case"left":case"center":case"right":m+=.5*s.height}for(let s=0;s<t.length;s++){const n=t[s];let g=m;for(let t=0;t<n.glyphs.length;t++){const i=n.glyphs[t][0],r={anchor:null,offset:null,uv:null};let s=n.glyphs[t][1];switch(h){case"right":case"top-right":case"bottom-right":s-=n.width;break;case"center":case"top":case"bottom":s-=.5*n.width}if(c.test(i.char))continue;s+=i.xoffset*a,g-=i.yoffset*a;const v=i.width*a,y=i.height*a;e.position.data.set([s,g-y,0,s,g,0,s+v,g-y,0,s+v,g,0],4*f*3),d.push([s,g-y,0,s,g,0,s+v,g-y,0,s+v,g,0]),r.anchor=[s,1-g],r.offset=[v,y];const x=i.x/o,b=i.width/o,w=1-i.y/l,_=i.height/l;e.uv.data.set([x,w-_,x,w,x+b,w-_,x+b,w],4*f*2),u.push([x,w-_,x,w,x+b,w-_,x+b,w]),r.uv=[x,1-w,b,_],g=m,f+=1,p.push(r)}m-=i*r}return{positions:d,uvs:u,layout:p}}};function Yl(e,t){var i=new $s(2);return i[0]=e,i[1]=t,i}function Zl(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e}function Xl(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e}function Ql(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e}function Kl(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e}!function(){var e;e=new $s(2),$s!=Float32Array&&(e[0]=0,e[1]=0)}();class Jl extends wn{get value(){return this._value}get elements(){return this.value.length}get x(){return this.value[0]}set x(e){this.value[0]=e}get y(){return this.value[1]}set y(e){this.value[1]=e}constructor(e=0,t=0){super(),this._value=Yl(e,t)}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}fromObject(e){let{x:t,y:i}=e;return void 0!==t&&(this.x=t),void 0!==i&&(this.y=i),this}toObject(){return{x:this.x,y:this.y}}set(e,t){return this._value=Yl(e,t),this}setScalar(e){return this.set(e,e)}length(){return e=this.value,Math.hypot(e[0],e[1]);var e}angle(){const e=Yl(1,0);return r=(t=this.value)[0],a=t[1],s=(i=e)[0],n=i[1],o=Math.sqrt(r*r+a*a)*Math.sqrt(s*s+n*n),Math.acos(Math.min(Math.max(o&&(r*s+a*n)/o,-1),1));var t,i,r,a,s,n,o}copy(e){return this.x=e.x,this.y=e.y,this}clone(){return new Jl(this.x,this.y)}add(e){return Zl(this.value,this.value,e.value),this}addScalar(e){return Zl(this.value,this.value,Yl(e,e)),this}subtract(e){return Xl(this.value,this.value,e.value),this}subtractScalar(e){return Xl(this.value,this.value,Yl(e,e)),this}multiply(e){return Ql(this.value,this.value,e.value),this}multiplyScalar(e){return Ql(this.value,this.value,Yl(e,e)),this}divide(e){return Kl(this.value,this.value,e.value),this}divideScalar(e){return Kl(this.value,this.value,Yl(e,e)),this}distanceTo(e){return t=this.value,i=e.value,Math.hypot(i[0]-t[0],i[1]-t[1]);var t,i}dot(e){return(t=this.value)[0]*(i=e.value)[0]+t[1]*i[1];var t,i}equals(e){return r=(t=this.value)[0],a=t[1],s=(i=e.value)[0],n=i[1],Math.abs(r-s)<=Bs*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(a-n)<=Bs*Math.max(1,Math.abs(a),Math.abs(n));var t,i,r,a,s,n}lerp(e,t){var i,r,a,s,n,o;return o=(r=this.value)[1],(i=this.value)[0]=(n=r[0])+(s=t)*((a=e.value)[0]-n),i[1]=o+s*(a[1]-o),this}normalize(){return function(e,t){var i=t[0],r=t[1],a=i*i+r*r;a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a}(this.value,this.value),this}scale(e){var t,i,r;return(t=this.value)[0]=(i=this.value)[0]*(r=e),t[1]=i[1]*r,this}applyMatrix3(e){return function(e,t,i){var r=t[0],a=t[1];e[0]=i[0]*r+i[3]*a+i[6],e[1]=i[1]*r+i[4]*a+i[7]}(this.value,this.value,e.value),this}applyMatrix4(e){return function(e,t,i){var r=t[0],a=t[1];e[0]=i[0]*r+i[4]*a+i[12],e[1]=i[1]*r+i[5]*a+i[13]}(this.value,this.value,e.value),this}}const eh=Jl,th=e=>{const t={x:0,y:0};switch(e){case"right":case"top-right":case"bottom-right":t.x=-.5;break;case"left":case"top-left":case"bottom-left":t.x=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":t.y=-.5;break;case"top":case"top-right":case"top-left":t.y=.5}return new eh(t.x,t.y)},ih=class{constructor(){this.layoutVertexArray=new pl(10),this.indexArray=new ul(3),this.opacityVertexArray=new pl(1),this.styleVertexArray=new pl(10),this.segments=[]}get geometry(){return this._geometry}prepareGeometry(e){if(this._geometry)return;const t=this.layoutVertexArray,i=this.opacityVertexArray,r=this.styleVertexArray,a=(new Float32Array).BYTES_PER_ELEMENT,s=new Bl(e.gl,t.data,t.stride*a),n=new Bl(e.gl,i.data,i.stride*a),o=new Bl(e.gl,r.data,r.stride*a),l=new kl(e,{position:{size:2,data:new Float32Array([0,1,0,0,1,0,1,1])},uv:{size:2,data:new Float32Array([0,1,0,0,1,0,1,1])},anchor:new El(s,2,!1,0,1),glyph:new El(s,4,!1,2*a,1),texCoordOffset:new El(s,4,!1,6*a,1),fillColor:new El(o,2,!1,0,1),strokeColor:new El(o,2,!1,2*a,1),strokeWidth:new El(o,1,!1,4*a,1),size:new El(o,1,!1,5*a,1),rotation:new El(o,1,!1,6*a,1),factor:new El(o,1,!1,7*a,1),random:new El(o,1,!1,8*a,1),atlasIndex:new El(o,1,!1,9*a,1),opacity:new El(n,1,!1,0,1)});l.setIndex([0,1,2,0,2,3]),this._geometry=l}trim(){this.layoutVertexArray.trim(),this.indexArray.trim(),this.opacityVertexArray.trim(),this.styleVertexArray.trim()}updateTexturePositionArray(e,t,i){for(let r=e;r<t;r++){const e=r*this.layoutVertexArray.stride+6;for(let t=0;t<4;t++)this.layoutVertexArray.data[e+t]=i[t]}}updateOpacityArray(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];var a;for(let r=e;r<t;r++)this.opacityVertexArray.emplaceAt(r,i);r&&(null===(a=this.geometry)||void 0===a||a.setAttributeData("opacity",this.opacityVertexArray.data))}updateStyleArray(e,t,i,r,a,s,n,o,l,h){const c=fl(i||new hl(0,0,0,1)),d=fl(r||new hl(0,0,0,0));for(let i=e;i<t;i++)this.styleVertexArray.emplaceAt(i,[...c,...d,a,s,n,o,l,h])}};class rh extends Ro{get type(){return"symbol"}constructor(e){super(e),this.includesSDFIcons=!1,this.text=new ih,this.icon=new ih,this.collisionArrays=[]}addFeature(e,t){var i;t=Object.assign({glyphDependencies:{},iconDependencies:{}},t);const r=e.feature.asPoints(),a=e.feature.extent,s=null==t?void 0:t.paint,n=null===(i=null==t?void 0:t.paint)||void 0===i?void 0:i.config,o=[];let l;const h=null==s?void 0:s.textLineCount();for(let t=0;t<h;t++){const i=null==s?void 0:s.textValue(e.properties,t);i&&o.push(_l(i,e.properties))}if((null==n?void 0:n.icon)&&(l=n.icon.type||n.icon.image||n.icon.shader||n.icon.atlas,Jt(l)&&(l=l(e.properties))),!r||!0!==t.includeEmptySymbolData&&0===(null==o?void 0:o.length)&&!l)return;let c,d,u;const p=t.glyphDependencies,m=t.iconDependencies;for(let i=0;i<r.length;i++){const s=r[i],n=vl({x:s.x,y:s.y},a);if(r[i]=n,n.x<0||n.x>=Co||n.y<0||n.y>=Co)continue;u={x:n.x,y:n.y};const h=this.features.find((e=>{var t;return e.anchor.x===u.x&&e.anchor.y===u.y&&(null===(t=e.text)||void 0===t?void 0:t.length)>0&&e.text[0].value===o[0]}));if((null==o?void 0:o.length)>0&&!h){const{symbol:i,glyphDependencies:a}=this.addSymbolAtAnchor(u,Object.assign(Object.assign({},e),{anchor:u,geometry:r,paint:t.paint,text:o.map(((e,t)=>({value:e,index:t,anchor:u,padding:[0,0],offset:[0,0],vertexRange:void 0,atlasIndex:void 0,collisionBox:void 0}))),icon:null}),t);c=i.text,a&&Object.assign(p,a)}if(xe(l)){const{symbol:i,iconDependencies:a}=this.addSymbolAtAnchor(u,Object.assign(Object.assign({},e),{anchor:u,geometry:r,paint:t.paint,text:void 0,icon:{image:l,anchor:u,padding:[0,0],offset:[0,0],vertexRange:void 0,atlasIndex:void 0,collisionBox:void 0},collisionBox:void 0}),t);d=i.icon,a&&Object.assign(m,a)}}return!0===t.includeEmptySymbolData||c||d?{key:s.symbolKey(e.properties),type:e.type,featureIndex:e.featureIndex,sourceId:e.sourceId,sourceLayerIndex:e.sourceLayerIndex,geometry:r,anchor:u,properties:e.properties,vertexRange:void 0,paint:t.paint,text:c,icon:d,dependencies:{glyphs:p,icons:m}}:void 0}addSymbolAtAnchor(e,t,i){if(!(e.x<0||e.x>=Co||e.y<0||e.y>=Co))return t.icon?this.addIcon(e,t,i.iconDependencies):t.text?this.addText(e,t,i.glyphDependencies):void 0}addSymbols(e,t,i){const r=t.layoutVertexArray,a=t.opacityVertexArray,s=t.styleVertexArray,n=xl(t.segments,4*i.length,r.length,t.indexArray.length);for(let t=0;t<i.length;t++){const{offset:o,texture:l,style:h}=i[t],{strokeWidth:c,size:d,opacity:u,rotation:p,factor:m}=h;r.emplace([e.x,e.y,o.x,o.y,o.w,o.h,l.x,l.y,l.w,l.h]),a.emplace(u),s.emplace([0,0,0,0,c,d,p,m,Math.random(),h.atlasIndex]),n.vertex.length+=2,n.index.length+=1}}addIcon(e,t,i){const r=t.properties,a=t.paint,s=a.iconImage(r),n=a.iconShader(r);if(xe(s)){const e="string"==typeof s?s:s.id;Zt(xe(e),`[MapsGL] Icon image id was not provided for symbol: ${JSON.stringify(s)}`),i[e]="string"==typeof s||s,t.icon.image=e}return t.icon.vertexRange={start:0,end:0},xe(n)&&this.layoutIcon(t,{}),{symbol:t,iconDependencies:i}}addText(e,t,i){const r=t.properties,a=t.paint;for(let e=0;e<t.text.length;e++){const s=t.text[e].value||"",n=a.textFont(r,e)||"Inter-Regular",o=a.textTransform(r,e)||"none";let l=s;"none"!==o&&("uppercase"===o?l=l.toUpperCase():"lowercase"===o?l=l.toLowerCase():"capitalize"===o&&(l=l.replaceAll(/\b\w/g,(e=>e.toUpperCase())))),void 0===i[n]&&(i[n]=[]);const h=i[n];for(let e=0;e<l.length;e++)s.charAt(e),h.push(s.charCodeAt(e));t.text[e].value=l,t.text[e].vertexRange={start:0,end:0}}return{symbol:t,glyphDependencies:i}}layoutSymbols(e,t){for(let i=0;i<this.features.length;i++){const r=this.features[i],a=r.text,s=r.icon,n={x1:Number.POSITIVE_INFINITY,y1:Number.POSITIVE_INFINITY,x2:Number.NEGATIVE_INFINITY,y2:Number.NEGATIVE_INFINITY,anchorPointX:r.anchor.x,anchorPointY:r.anchor.y};if(a){this.layoutText(r,t);for(let e=0;e<a.length;e++){const t=a[e];t.collisionBox&&(n.x1=Math.min(n.x1,t.collisionBox.x1),n.y1=Math.min(n.y1,t.collisionBox.y1),n.x2=Math.max(n.x2,t.collisionBox.x2),n.y2=Math.max(n.y2,t.collisionBox.y2))}}((null==s?void 0:s.image)||(null==s?void 0:s.shader))&&(this.layoutIcon(r,e),s.collisionBox&&(n.x1=Math.min(n.x1,s.collisionBox.x1),n.y1=Math.min(n.y1,s.collisionBox.y1),n.x2=Math.max(n.x2,s.collisionBox.x2),n.y2=Math.max(n.y2,s.collisionBox.y2))),r.collisionBox=n}}layoutText(e,t){var i;const r=e.properties,a=this.text;for(let s=0;s<e.text.length;s++){const n=e.text[s].value,o=e.paint,l=e.text[s].anchor,h=Co/Fn,c=o.textFont(r,s)||"Inter-Regular",d=o.textSize(r,s)||12,u=o.textAlign(r,s)||"center",p=th(o.textAnchor(r,s)||"center"),m=o.textLineHeight(r,s)||1,f=o.textLetterSpacing(r,s)||0,g=o.textMaxWidth(r,s)||100,v=o.textOffset(r,s),y=o.textRotation(r,s)||0,x=o.symbolAllowOverlap()||!1,b=(o.symbolFadeOpacity(r),o.iconFactor(r)),w=t[c].ranges[0];if(ye(w))return;const _=w.spec;if(!_)throw new Error(`[MapsGL] Missing font spec for font "${c}"`);const M=new Wl({font:_,size:d,width:g,align:u,lineHeight:Math.max(0,m),letterSpacing:f}).generateLayout(`${n}`),{position:A,layout:S}=M.data,T=[],E={x1:Number.POSITIVE_INFINITY,y1:Number.POSITIVE_INFINITY,x2:Number.NEGATIVE_INFINITY,y2:Number.NEGATIVE_INFINITY,anchorPointX:l.x,anchorPointY:l.y};for(let e=0;e<A.length;e++){const t=S[e],i={box:{tl:{x:t.anchor[0],y:t.anchor[1]},tr:{x:t.anchor[0]+t.offset[0],y:t.anchor[1]},bl:{x:t.anchor[0],y:t.anchor[1]+t.offset[1]},br:{x:t.anchor[0]+t.offset[0],y:t.anchor[1]+t.offset[1]}},offset:{x:t.anchor[0]+v.x,y:t.anchor[1]+v.y,w:t.offset[0],h:t.offset[1]},texture:{x:t.uv[0],y:t.uv[1],w:t.uv[2],h:t.uv[3]},style:{fillColor:o.fillColor(r)||new hl("#000"),strokeColor:o.strokeColor(r)||new hl("#000"),strokeWidth:o.strokeThickness(r)||0,size:d,opacity:x?1:0,rotation:y||0,factor:he(b)?b:0,atlasIndex:0}};E.x1=Math.min(E.x1,t.anchor[0]),E.y1=Math.min(E.y1,t.anchor[1]),E.x2=Math.max(E.x2,t.anchor[0]+t.offset[0]),E.y2=Math.max(E.y2,t.anchor[1]+t.offset[1]),T.push(i)}const O=E.x2-E.x1,C=E.y2-E.y1;T.forEach((e=>{e.offset.x+=O*p.x,e.offset.y+=C*p.y,E.x1=Math.min(E.x1,e.offset.x),E.y1=Math.min(E.y1,e.offset.y),E.x2=Math.max(E.x2,e.offset.x+e.offset.w),E.y2=Math.max(E.y2,e.offset.y+e.offset.h)}));const R=a.layoutVertexArray.length;this.addSymbols(l,a,T),e.text[s].vertexRange={start:R,end:a.layoutVertexArray.length},e.text[s].atlasIndex=null===(i=w.atlas)||void 0===i?void 0:i.index,E.x1*=h,E.y1*=h,E.x2*=h,E.y2*=h,e.text[s].collisionBox=E}this.collisionArrays.push({textBox:e.text[0].collisionBox,textFeatureIndex:e.featureIndex})}layoutIcon(e,t){const i=e.properties,r=this.icon,a=t[e.icon.image]||{size:{width:20,height:20},position:{x:0,y:0,w:1,h:1},pixelRatio:1,sdf:!1},s=Co/Fn,n=a.pixelRatio||1,o=e.paint,l=e.icon.anchor,h=o.iconSize(i)||{width:a.size.width/n,height:a.size.height/n},c=o.iconRotation(i),d=o.iconOffset(i),u=th(o.iconAnchor(i)||"center"),p=o.iconFactor(i),m=[],f=h.width,g=h.height,v=h.width/(a.size.width/n),y={x1:Number.POSITIVE_INFINITY,y1:Number.POSITIVE_INFINITY,x2:Number.NEGATIVE_INFINITY,y2:Number.NEGATIVE_INFINITY,anchorPointX:l.x,anchorPointY:l.y};a.position||console.warn("[MapsGL] Missing icon position for icon:",e.icon.image,t),a.sdf&&(this.includesSDFIcons=!0);const x={box:{tl:{x:l.x,y:l.y},tr:{x:l.x+f,y:l.y},bl:{x:l.x,y:l.y+g},br:{x:l.x+f,y:l.y+g}},offset:{x:-f/2+d.x,y:-g/2+d.y,w:f,h:g},texture:a.position?{x:a.position.x,y:a.position.y,w:a.position.w,h:a.position.h}:{x:0,y:0,w:1,h:1},style:{fillColor:o.fillColor(i)||new hl("#000"),strokeColor:o.strokeColor(i)||new hl("#000"),strokeWidth:o.strokeThickness(i)||0,size:v,opacity:1,rotation:c||0,factor:he(p)?p:0,atlasIndex:0}};x.offset.x+=f*u.x,x.offset.y+=g*u.y,m.push(x),y.x1=Math.min(y.x1,x.offset.x),y.y1=Math.min(y.y1,x.offset.y),y.x2=Math.max(y.x2,x.offset.x+x.offset.w),y.y2=Math.max(y.y2,x.offset.y+x.offset.h);const b=r.layoutVertexArray.length;this.addSymbols(l,r,m),e.icon.vertexRange={start:b,end:r.layoutVertexArray.length},y.x1*=s,y.y1*=s,y.x2*=s,y.y2*=s,e.icon.collisionBox=y,this.collisionArrays.push({iconBox:y,iconFeatureIndex:e.featureIndex})}trim(){this.text.trim(),this.icon.trim()}serialize(){const e=super.serialize();return Object.assign({features:this.features.map((e=>(e.paint=void 0,e))),text:{layoutVertexArray:this.text.layoutVertexArray.serialize(),indexArray:this.text.indexArray.serialize(),opacityVertexArray:this.text.opacityVertexArray.serialize(),styleVertexArray:this.text.styleVertexArray.serialize(),segments:[...this.text.segments]},icon:{layoutVertexArray:this.icon.layoutVertexArray.serialize(),indexArray:this.icon.indexArray.serialize(),opacityVertexArray:this.icon.opacityVertexArray.serialize(),styleVertexArray:this.icon.styleVertexArray.serialize(),segments:[...this.icon.segments]},collisionArrays:[...this.collisionArrays],includesSDFIcons:this.includesSDFIcons},e)}static from(e){const t=new rh(e.options);if(t.id=e.id,t.includesSDFIcons=e.includesSDFIcons,ge(e))console.warn("[MapsGL] Cannot create SymbolStore from invalid serialized data.");else{const i=new ih;i.layoutVertexArray=pl.from(e.text.layoutVertexArray),i.indexArray=ul.from(e.text.indexArray),i.opacityVertexArray=pl.from(e.text.opacityVertexArray),i.styleVertexArray=pl.from(e.text.styleVertexArray),i.segments=e.text.segments,t.text=i;const r=new ih;r.layoutVertexArray=pl.from(e.icon.layoutVertexArray),r.indexArray=ul.from(e.icon.indexArray),r.opacityVertexArray=pl.from(e.icon.opacityVertexArray),r.styleVertexArray=pl.from(e.icon.styleVertexArray),r.segments=e.icon.segments,t.icon=r,t.collisionArrays=e.collisionArrays,t.features=e.features}return t}}const ah=rh,sh=class{get size(){return{width:this.right-this.left,height:this.bottom-this.top}}get center(){const e=this.size;return{x:this.left+e.width/2,y:this.top+e.height/2}}constructor(e,t,i,r){this.left=0,this.right=0,this.top=0,this.bottom=0,this.left=e,this.right=t,this.top=i,this.bottom=r}};var nh;!function(e){e.never="never",e.always="always",e.cooperative="cooperative"}(nh||(nh={}));const oh=class{constructor(e){this.boxes={},this.circles={},this._debug=!0,this._debugInfo=[],this.transform=e,this.tree=new(_o()),this.screenBounds=new sh(0,0,e.state.size.width+0,e.state.size.height+0)}insertBox(e,t,i,r,a,s){const n=Fn/Co,o=this.projectAndGetPerspectiveRatio(r,e.anchorPointX,e.anchorPointY),l=n*o.perspectiveRatio,h=`${s}-${a}-${i}`,c=Math.ceil(e.x1*l+o.point.x-t[0]),d=Math.ceil(e.y1*l+o.point.y-t[1]),u=Math.ceil(e.x2*l+o.point.x+t[0]),p=Math.ceil(e.y2*l+o.point.y+t[1]),m={key:h,minX:c,minY:d,maxX:u,maxY:p},f=this.tree.collides(m);return f||this.tree.insert(m),!0===f?(this._debug&&this._debugInfo.push({key:h,bbox:{x1:c,y1:d,x2:u,y2:p},hidden:!0}),!1):(this.boxes[h]=m,this._debug&&this._debugInfo.push({key:h,bbox:{x1:c,y1:d,x2:u,y2:p},hidden:!1}),!0)}insertCircle(e,t,i,r){const a=`${i}-${r}-${t}`,s={key:a,x:e.x,y:e.y,radius:e.radius};return this.tree.insert(s),this.circles[a]=s,!0}collides(e){return this.tree.collides(e)}clear(){this.tree.clear(),this.boxes={},this.circles={},this._debugInfo=[]}debugBody(e,t){t.strokeStyle=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"black",t.lineWidth=1,t.beginPath(),t.rect(e.minX,e.minY,e.maxX-e.minX,e.maxY-e.minY),t.stroke()}debug(e){this._debug&&this._debugInfo.forEach((t=>{e.strokeStyle=t.hidden?"rgba(255,0,0,0.3)":"green",e.lineWidth=1,e.beginPath(),e.rect(t.bbox.x1,t.bbox.y1,t.bbox.x2-t.bbox.x1,t.bbox.y2-t.bbox.y1),e.stroke()}))}projectAndGetPerspectiveRatio(e,t,i){const r=new al(t,i,0,1).applyMatrix4(e),a=this.transform.state.size;return{point:{x:(r.x/r.z+1)/2*a.width+0,y:(-r.y/r.z+1)/2*a.height+0},perspectiveRatio:.5+this.transform.cameraToCenterDistance/r.z*.5}}},lh=class{get isHidden(){return 0===this.opacity&&!this.placed}constructor(e,t,i,r){this.opacity=e?r?i?1:0:Math.max(0,Math.min(1,e.opacity+(e.placed?t:-t))):r&&i?1:0,this.placed=i}increment(e){this.opacity=Math.max(0,Math.min(1,this.opacity+e*(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)))}};function hh(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=0,a=null;return function(){for(var s=arguments.length,n=new Array(s),o=0;o<s;o++)n[o]=arguments[o];if(i){const i=Date.now();i-r>t&&(e.apply(this,n),r=i)}else a||(a=setTimeout((()=>{a=null,e.apply(this,n)}),t))}}const ch=(e,t,i)=>{const r=Ln(e.z)*Co,a=xe(i)?`-${i.replaceAll(/\s/g,"_")}`:"",s={x:(e.x*Co+t.anchorPointX)/r*Co,y:(e.y*Co+t.anchorPointY)/r*Co};return s.x=Math.floor(s.x),s.y=Math.floor(s.y),`${s.x}-${s.y}${a}`},dh=e=>{var t,i;const r=(null===(t=e.text)||void 0===t?void 0:t.length)>0?e.text[0].value:null===(i=e.icon)||void 0===i?void 0:i.image;return e.key||r},uh=class{constructor(e){if(this.fadeDuration=250,this.isDirty=!1,this.opacityState={},this.symbolsByLayer={},this.collisionIndexByLayer={},this.commitTime={},this.fadeDurationByLayer={},this.debug=!1,this.placeSymbolsThrottled=hh((e=>{this.placeSymbols(e)}),20),this.transform=e,this.collisionIndex=new oh(e),this.debug){const e=document.createElement("canvas");e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.pointerEvents="none",e.style.zIndex="1000",document.body.append(e),this.debugCanvas=e}}getOpacityState(e){return this.opacityState[e]}placeSymbols(e){let t=!1;this.collisionIndex.clear(),e.forEach((e=>{this.placeLayerSymbols(e.id,e.tiles,e.paint)&&(t=!0)})),this.collisionIndex.clear(),this.isDirty=t}placeLayerSymbols(e,t,i){var r;let a;this.debugCanvas&&(a=this.debugCanvas.getContext("2d"),this.debugCanvas.width=window.innerWidth,this.debugCanvas.height=window.innerHeight,a.clearRect(0,0,this.debugCanvas.width,this.debugCanvas.height)),this.collisionIndexByLayer[e]||(this.collisionIndexByLayer[e]=new oh(this.transform)),this.collisionIndexByLayer[e].clear(),this.opacityState[e]||(this.opacityState[e]={}),this.symbolsByLayer[e]||(this.symbolsByLayer[e]={});let s=!1;const n=i.symbolRank(),o="object"==typeof n?n.property:n,l="object"==typeof n?n.direction:"asc",h=[],c={};for(const i of t){const t=null===(r=i.data)||void 0===r?void 0:r.getStore("symbol",e);if(t instanceof ah){const r=i.coord.normalize(),a=this.transform.calculateTilePos(i.coord),s=Co/(Fn*Math.pow(2,this.transform.state.zoom-i.coord.z))*1;t.features.forEach(((n,l)=>{const d=n.collisionBox;if(ye(d))return;const u=dh(n),p=ch(r,d,u),m=xe(o)?ut(n.properties,o):-1,f={crossTileId:p,tileCoord:i.coord,feature:n,featureIndex:n.featureIndex,rank:m,store:t,posMatrix:a.matrix,pixelsToTiles:s};this.symbolsByLayer[e][p]={zoom:i.coord.z,symbol:f},c[p]||(h.push(f),c[p]=!0)}))}}const d=h.sort(((e,t)=>"desc"===l?t.rank-e.rank:e.rank-t.rank));return d.length>0&&(s=this.placeSymbolFeatures(e,d,i)),this.debugCanvas&&(Object.values(this.collisionIndexByLayer).forEach((e=>{e.debug(a)})),this.collisionIndex.debug(a)),s}placeSymbolFeatures(e,t,i){let r=!1;const a=i.symbolAllowOverlap(),s=(i.symbolRotateWithMap(),i.symbolPitchWithMap(),i.textPadding()||[6,6]),n=i.symbolFadeOpacity(),o=(null===performance||void 0===performance?void 0:performance.now)?performance.now():Date.now(),l=this.opacityState[e],h="layer"===i.symbolOverlapMode()?this.collisionIndexByLayer[e]:this.collisionIndex,c=new lh(null,0,!0),d={};this.fadeDurationByLayer[e]=!0===i.symbolFadeOpacity()?this.fadeDuration:0;for(let e=0;e<t.length;e++){const i=t[e],o=i.feature,u=i.crossTileId,{store:p,posMatrix:m}=t[e],f=o.collisionBox;if(f){const e=l[u];let t=!0;a||(t=h.insertBox(f,s,nh.never,m,u,p.id)),e||(r=!0),l[u]=new lh(e||c,0,t,!n),d[u]=!0}}return n||Object.keys(d).forEach((t=>{const i=this.symbolsByLayer[e][t],r=l[t];i&&r&&this.updateSymbolOpacityBuffer(i.symbol,r.opacity,!0)})),Object.keys(l).forEach((t=>{if(!0!==d[t]){delete l[t];const i=this.symbolsByLayer[e][t];i&&this.updateSymbolOpacityBuffer(i.symbol,0,!0)}})),this.commitTime[e]=o,this.prevZoomAdjustment=this.zoomAdjustment(this.transform.state.zoom),r}updateLayerOpacities(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var r;const a=(null===performance||void 0===performance?void 0:performance.now)?performance.now():Date.now(),s=this.symbolFadeChange(e,a),n=this.opacityState[e];let o=!1;if(!n)return!1;for(const a of t){const t=null===(r=a.data)||void 0===r?void 0:r.getStore("symbol",e);if(t instanceof ah){const r=a.coord.normalize();for(const a of t.features){const t=a.collisionBox;if(ye(t))continue;const l=dh(a),h=ch(r,t,l),c=n[h],d=this.symbolsByLayer[e][h];if(c){const e=c.placed,t=c.opacity;i?c.increment(1,-1):(e&&t<1||!1===e&&t>0)&&(c.increment(s,c.placed?1:-1),o=!0),this.updateSymbolOpacityBuffer(d.symbol,c.opacity)}}}}return o&&this.commit(e,t),this.commitTime[e]=a,this.prevZoomAdjustment=this.zoomAdjustment(this.transform.state.zoom),o}updateSymbolOpacityBuffer(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=e.store;if(xe(e.feature.text))for(const a of e.feature.text){const{start:e,end:s}=a.vertexRange;r.text.updateOpacityArray(e,s,t,i)}if(xe(e.feature.icon)){const{start:a,end:s}=e.feature.icon.vertexRange;r.icon.updateOpacityArray(a,s,t,i)}}commit(e,t){var i,r,a;for(const s of t){const t=null===(i=s.data)||void 0===i?void 0:i.getStore("symbol",e);t instanceof ah&&(null===(r=t.text.geometry)||void 0===r||r.setAttributeData("opacity",t.text.opacityVertexArray.data),null===(a=t.icon.geometry)||void 0===a||a.setAttributeData("opacity",t.icon.opacityVertexArray.data))}}symbolFadeChange(e,t){const i=this.fadeDurationByLayer[e];return 0===i?1:(t-this.commitTime[e])/(i+this.prevZoomAdjustment)}zoomAdjustment(e){return Math.max(0,(this.transform.state.zoom-e)/1.5)}};class ph extends Ro{get type(){return"data"}addFeature(e,t){const i=e.feature.asPoints(),r=(e.feature.asPolygons(),e.feature.extent);for(let e=0;e<i.length;e++){const t=i[e],a=vl({x:t.x,y:t.y},r);i[e]=a}return{type:e.type,featureIndex:e.featureIndex,sourceId:e.sourceId,sourceLayerIndex:e.sourceLayerIndex,geometry:i,properties:e.properties,vertexRange:{start:null,end:null}}}static from(e){const t=new ph(e.options);return ge(e)?console.warn("[MapsGL] Cannot create FeatureStore from invalid serialized data."):t.features=e.features,t}}const mh=ph,fh=class{constructor(e){this.stores={},this.drawData={},this.dependencies={glyphs:{},icons:{}},this.stale=!1,this.id=Math.round(1e18*Math.random()).toString(36).slice(0,10),this.addStores(e)}addStores(e,t){Object.keys(e).forEach((t=>{const i=e[t];i instanceof Ro?this.stores[t]=i:"fill"===i.type?this.stores[t]=Il.from(i):"line"===i.type?this.stores[t]=Vl.from(i):"circle"===i.type?this.stores[t]=Gl.from(i):"symbol"===i.type?this.stores[t]=ah.from(i):"data"===i.type&&(this.stores[t]=mh.from(i));const r=`${t}::${i.type}`;this.drawData[r]&&delete this.drawData[r]}))}getStore(e,t){return this.stores[t]}updateSymbolOpacity(e,t,i){var r;const a=this.stores[e];if(a&&!t.symbolAllowOverlap()&&a instanceof ah){const e=a.options.tile,s=new Xn(e.z,e.x,e.y);for(let e=0;e<a.features.length;e++){const n=a.features[e];if(xe(n.text))for(let e=0;e<n.text.length;e++){const o=n.text[e],{start:l,end:h}=o.vertexRange,c=t.symbolAllowOverlap()||!1;t.symbolFadeOpacity();let d=c?1:0;if(i){const e=o.collisionBox;if(e){const t=dh(n);d=(null===(r=i[ch(s,e,t)])||void 0===r?void 0:r.opacity)||0,a.text.updateOpacityArray(l,h,d,!0)}}}}}}getDrawData(e,t,i,r){var a,s,n;const o=`${i}::${t}`,l=this.stores[i],h=this.drawData[o],{paint:c,opacityState:d}=r;if(h)return h;if(l&&e){if("fill"===t||"fill-outline"===t){if(l instanceof Il){const i=l.buffers;if(0===l.buffers.layoutVertexArray.length)return;const r="fill-outline"===t,a=r?i.segments.line:i.segments.triangle;for(let e=0;e<l.features.length;e++){const t=l.features[e],a=t.properties,{start:s,end:n}=t.vertexRange,o=r?c.strokeColor(a):c.fillColor(a);o&&(o.a*=r?c.strokeOpacity(a):c.fillOpacity(a)),i.updateColorArray(s,n,o)}i.layoutVertexArray.length>0&&i.prepareGeometry(e,r),this.drawData[o]={primary:{store:l,geometry:r?i.geometry.stroke:i.geometry.fill,segments:a,size:r?2:3}}}}else if("line"===t){if(l instanceof Vl){const t=l.buffers;if(0===l.buffers.layoutVertexArray.length)return;const i=l.features.map((e=>e.vertexRange));for(let e=0;e<l.features.length;e++){const t=l.features[e],i=t.properties,{start:r,end:a}=t.vertexRange,s=c.strokeColor(i);l.buffers.updateColorArray(r,a,s)}t.layoutVertexArray.length>0&&t.prepareGeometry(e,i,c),this.drawData[o]={primary:{store:l,geometry:t.geometry.segments,segments:void 0,size:2},terminals:{store:l,geometry:t.geometry.terminals,segments:void 0,size:2},joins:{store:l,geometry:t.geometry.joins,segments:void 0,size:2},caps:{store:l,geometry:t.geometry.caps,segments:void 0,size:2}}}}else if("circle"===t||"point"===t){if(l instanceof Gl){if(0===l.buffers.layoutVertexArray.length)return;if(c)for(let e=0;e<l.features.length;e++){const t=l.features[e],i=t.properties||{},{start:r}=t.vertexRange,a=c.fillColor(i),s=c.strokeColor(i),n=c.strokeThickness(i),o=c.radius(i)||60,h=2*r,d=h+1;l.buffers.updateColorArray(h,h+1,a),l.buffers.updateColorArray(d,d+1,s),l.buffers.updateStrokeWidthArray(e,e+1,n),l.buffers.updateRadiusArray(e,e+1,o),i.radius=o,t.properties=i}l.buffers.layoutVertexArray.length>0&&l.buffers.prepareGeometry(e),this.drawData[o]={primary:{store:l,geometry:[l.buffers.geometry],segments:void 0,size:2}}}}else if(("symbol"===t||"text"===t)&&l instanceof ah){if(0===l.text.layoutVertexArray.length&&0===l.icon.layoutVertexArray.length)return;const t=l.options.tile,i=new Xn(t.z,t.x,t.y),h=Object.keys(this.dependencies.icons);if(h.length>0&&(this.imageAtlas=r.mapStyle.createImageAtlas(h)),l.text.layoutVertexArray.length>0){for(let e=0;e<l.features.length;e++){const t=l.features[e],r=t.properties;if(t.text){for(let e=0;e<t.text.length;e++){const s=t.text[e],{start:n,end:o}=s.vertexRange,h=c.textSize(r,e),u=c.textColor(r,e),p=c.textOutlineColor(r,e),m=c.textRotation(r,e);let f=c.symbolAllowOverlap()?1:0;if(d){const e=t.collisionBox;if(e){const r=dh(t);f=(null===(a=d[ch(i,e,r)])||void 0===a?void 0:a.opacity)||0}}l.text.updateStyleArray(n,o,u,p,0,h,js(m),0,0,s.atlasIndex),l.text.updateOpacityArray(n,o,f)}r.collisionBox=t.collisionBox}}l.text.prepareGeometry(e)}if(l.icon.layoutVertexArray.length>0){for(let e=0;e<l.features.length;e++){const t=l.features[e],r=t.properties;if(!t.icon)continue;const a=t.icon,{start:o,end:h}=a.vertexRange,u=(c.iconSize(r),c.fillColor(r)),p=c.strokeColor(r),m=c.strokeThickness(r),f=c.iconRotation(r),g=c.iconFactor(r);let v=c.symbolAllowOverlap()?1:0;if(d){const e=t.collisionBox;if(e){const r=dh(t);v=(null===(s=d[ch(i,e,r)])||void 0===s?void 0:s.opacity)||0}}const y=null===(n=this.imageAtlas)||void 0===n?void 0:n.texturePosition(a.image);y&&l.icon.updateTexturePositionArray(o,h,[y.x,y.y,y.w,y.h]);const x=l.icon.styleVertexArray.get(o);l.icon.updateStyleArray(o,h,u,p,m,x[5],js(f),g,0,a.atlasIndex||0),l.icon.updateOpacityArray(o,h,v),r.collisionBox=t.collisionBox}l.icon.prepareGeometry(e)}this.drawData[o]={primary:{store:l,geometry:void 0,buffer:{icon:l.icon.geometry,text:l.text.geometry},segments:void 0,size:2}}}return this.drawData[o]}}clear(){Object.keys(this.drawData).forEach((e=>{delete this.drawData[e]}))}};var gh=function(e,t,i,r){return new(i||(i=Promise))((function(a,s){function n(e){try{l(r.next(e))}catch(e){s(e)}}function o(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,o)}l((r=r.apply(e,t||[])).next())}))};const vh=class extends vo{get type(){return ji.vector}get worker(){if(!this._worker){let e=Vo.getWorker("vector");le(e)&&(e="https://cdn.aerisapi.com/sdk/js/mapsgl/latest/mapsgl.vector.worker.js",Vo.addWorker("vector",e));const t=new Lo(e);this._worker=new Uo(t),this._worker.registerMessageHandler("getGlyphs",(e=>gh(this,void 0,void 0,(function*(){return this.style.getGlyphs(e)})))),this._worker.registerMessageHandler("getImages",(e=>gh(this,void 0,void 0,(function*(){return this.style.getImages(Object.keys(e))})))),this._worker.registerMessageHandler("loadImages",(e=>gh(this,void 0,void 0,(function*(){return this.style.loadImages(e)}))))}return this._worker}constructor(e,t){super(e,t),this.tileManager.setTileFetcher(((e,t,i)=>{const{body:r,headers:a,params:s,reload:n}=i;let o=[...this.consumingLayers];const l=this.tiles.get(e);if(!l)throw new Error(`[MapsGL] Tile not found in cache: ${e}`);const h=null==l?void 0:l.data;if(h&&!0!==h.stale){const e=Object.keys(h.stores);o=o.filter((t=>!1===e.includes(t.layerId)))}return this.worker.send({id:this.id,layers:o.map((e=>Object.assign(Object.assign({},e),{paint:e.paint.serialized()}))),tile:{uid:l.uid,info:{x:l.coord.x,y:l.coord.y,z:l.coord.z}},request:{url:this.getTileUrl(l.coord,i.params),body:r,headers:a,params:s,reload:n}})}))}hasTile(e,t){var i;const r=this.tiles.get(e);return!(!r||!(null===(i=r.data)||void 0===i?void 0:i.stores[t]))}hasTileData(e,t){var i;const r=this.tiles.get(e);return!(!r||!(null===(i=r.data)||void 0===i?void 0:i.stores[t]))}expireAllTiles(){super.expireAllTiles(),this.tiles.forEach((e=>{const t=e.data;t&&(t.stale=!0)}))}parseTile(e,t,i){return new Promise((i=>{const r=this.tiles.get(e.coord);if(!r)return;r.state=Ls.Processing;let a=r.data;a?(a.stale&&a.clear(),a.stale=!1,a.addStores(t.stores,this.consumingLayers)):a=new fh(t.stores),t.dependencies&&(a.dependencies=Object.assign(Object.assign({},a.dependencies),t.dependencies)),i(a)}))}};var yh=function(e,t,i,r){return new(i||(i=Promise))((function(a,s){function n(e){try{l(r.next(e))}catch(e){s(e)}}function o(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,o)}l((r=r.apply(e,t||[])).next())}))};const xh=class extends vh{get type(){return ji.geojson}get url(){return this.tileUrl}get data(){return this._data}constructor(e,t){super(e,Object.assign({},t)),this.setUrl=Ni((e=>{e!==this.tileUrl&&(this._data=void 0,this.setTileUrl(e))}),250);let i=Vo.getWorker("vector");le(i)&&(i="https://cdn.aerisapi.com/sdk/js/mapsgl/latest/mapsgl.vector.worker.js",Vo.addWorker("vector",i));const r=new Lo(i);this._worker=new Uo(r),this._worker.registerMessageHandler("getGlyphs",(e=>yh(this,void 0,void 0,(function*(){return this.style.getGlyphs(e)})))),this._worker.registerMessageHandler("getImages",(e=>yh(this,void 0,void 0,(function*(){return this.style.getImages(Object.keys(e))})))),this._worker.registerMessageHandler("loadImages",(e=>yh(this,void 0,void 0,(function*(){return this.style.loadImages(e)})))),this._worker.registerMessageHandler("transformGeoJSON",(e=>(e.data&&Jt(t.transformGeoJSON)&&(e.data=t.transformGeoJSON(this,e.data)),e.data))),this.shouldTriggerLoadEvents=!1,this.tileManager.setTileFetcher(((e,t,i)=>{const{body:r,headers:a,reload:s}=i,n=this.getTileUrl(e,i.params);let o=[...this.consumingLayers];const l=this.tiles.get(e);if((null==l?void 0:l.data)&&!1===s){const e=Object.keys(l.data.stores);o=o.filter((t=>!1===e.includes(t.layerId)))}let h=!1;return le(this.data)&&xe(n)&&(this.trigger(Ms,{sourceId:this.id}),h=!0),this._worker.send({id:this.id,type:"geojson",action:"reloadTile",layers:o.map((e=>Object.assign(Object.assign({},e),{paint:e.paint.serialized()}))),tile:{uid:null==l?void 0:l.uid,info:{x:e.x,y:e.y,z:e.z}},request:{url:n,body:r,headers:a,reload:s}}).then((e=>(this.data||(this._data=e.geojson,h&&this.trigger(As,{sourceId:this.id})),e)))})),!1===ke(t.data)&&this.setData(t.data)}getUrl(e){return Ct(this.tileUrl,e)}setData(e){this._data=e,this._worker.send({type:"geojson",action:"setData",data:this.data}).then((e=>{this.trigger(vs,{source:this}),this.trigger(ys,{source:this})}))}},bh=class extends or{get animations(){return this._animations}get info(){return{isActive:this.isActive,currentDate:this.currentDate,startDate:this.startDate,endDate:this.endDate,deltaTime:this.deltaTime}}constructor(e){super(e),this._animations=[],this.config.on(rr.Events.UPDATE,(()=>{this._each((e=>{e.delay=this.delay,e.duration=this.duration,e.endDelay=this.endDelay}))})),this.on(Ui.RANGE_CHANGE,(e=>{let{start:t,end:i}=e;this._each((e=>{e instanceof or&&(e.startDate=t,e.endDate=i)}))})),this.advanceToStopPosition()}add(e){e&&(this.animations.includes(e)||(e.timeline=this,e.delay=this.delay,e.duration=this.duration,e.endDelay=this.endDelay,e instanceof or&&(e.startDate=this.startDate,e.endDate=this.endDate,e.goTo(this.position)),e.config.setState({manualAdvance:this.config.value.manualAdvance}),this.animations.push(e),e.trigger(Ui.TIMELINE_CHANGE),this.isActive&&!1===this.config.value.manualAdvance&&e.play()))}remove(e){if(!e)return;const t=this.animations.indexOf(e);t>=0&&(e.timeline=void 0,this._animations.splice(t,1),e.trigger(Ui.TIMELINE_CHANGE))}removeById(e){const t=this.animations.filter((t=>t.id===e));t.length>0&&this.remove(t[0])}clear(){this.stop(),this._animations=[]}play(){this._each((e=>e.play())),super.play()}pause(){this._each((e=>e.pause())),super.pause()}resume(){this._each((e=>e.resume())),super.resume()}stop(){this._each((e=>e.stop())),super.stop(),this.advanceToStopPosition()}restart(){this._each((e=>e.restart())),super.restart()}advance(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._each((i=>i.advance(e,t))),super.advance(e,t)}goToDate(e){this._each((t=>{t instanceof or&&t.goToDate(e)})),super.goToDate(e)}goTo(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._each((i=>i.goTo(e,t))),super.goTo(e,t)}_each(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._animations.filter((e=>!1===t||t&&e.enabled)).forEach((t=>e(t)))}advanceToStopPosition(){this.alwaysStopAtStart?this.advance(0):this.startDate.getTime()<this.referenceDate.getTime()&&this.endDate.getTime()>this.referenceDate.getTime()?this.goToDate(this.referenceDate):this.advance(this.isPast?1:0)}},wh=class{get fps(){return this._fps}constructor(){this._frame=0,this._fps=0,this._running=!1,this._time=Date.now(),this._frame=0}start(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._running||(this._running=!0,this.tick(),e>0&&(this._timout=setTimeout((()=>{this.stop()}),e)))}stop(){this._running=!1,this._handle&&window.cancelAnimationFrame(this._handle),this._timout&&clearTimeout(this._timout)}tick(){const e=Date.now();this._frame+=1,e-this._time>1e3&&(this._fps=this._frame/((e-this._time)/1e3),this._time=e,this._frame=0),this._handle=window.requestAnimationFrame(this.tick.bind(this))}},_h=class{constructor(e){this.map=e}query(e){const t=this.map.layers.filter((e=>e.enabled&&e.visible)),i={};let r=!1;for(let a=0;a<t.length;a++){const s=t[a],n=s.queryFeatures(e,this.map.getZoom(),!0);n&&(i[s.id]=n,r=!0)}return r?i:void 0}queryPromise(e){return new Promise((t=>{const i=this.map.layers.filter((e=>e.enabled&&e.visible)),r={},a=[];for(let t=0;t<i.length;t++){const s=i[t],n=s.queryFeaturesPromise(e,this.map.getZoom(),!0).then((e=>{e&&(r[s.id]=e)})).catch((e=>{console.error(`[MapsGL] Failed to query features for layer '${s.id}'`,e)}));a.push(n)}Promise.all(a).then((()=>{t(ge(r)?void 0:r)})).catch((e=>{console.error(e)}))}))}};class Mh{get width(){return this.right-this.left+1}get height(){return this.top-this.bottom+1}get center(){return{x:this.left+this.width/2,y:this.bottom+this.height/2}}get info(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}constructor(e,t,i,r){this.top=i,this.bottom=r,this.left=e,this.right=t}equals(e){return this.left===e.left&&this.right===e.right&&this.top===e.top&&this.bottom===e.bottom}overlaps(e){return!(this.left>e.right||this.right<e.left||this.top<e.bottom||this.bottom>e.top)}intersection(e){if(this.overlaps(e))return new Mh(Math.max(this.left,e.left),Math.min(this.right,e.right),Math.max(this.bottom,e.bottom),Math.min(this.top,e.top))}contains(e){return e.x>=this.left&&e.x<=this.right&&e.y>=this.bottom&&e.y<=this.top}clone(){return new Mh(this.left,this.right,this.top,this.bottom)}static fromCoords(e){let t=Number.POSITIVE_INFINITY,i=-Number.POSITIVE_INFINITY,r=-Number.POSITIVE_INFINITY,a=Number.POSITIVE_INFINITY;return e.forEach((e=>{t=Math.min(t,e.x),i=Math.max(i,e.x),r=Math.max(r,e.y),a=Math.min(a,e.y)})),new Mh(t,i,r,a)}}const Ah=Mh;class Sh{constructor(){this._zoom=0,this.center={x:.5,y:.5,z:0},this.size={width:1,height:1},this.pitchRange={min:0,max:60}}getPosition(){return this.getCenterOffset()}getCenter(){return this.center}getCenterOffset(){const e=this.getCenter(),t=this.getSize();return{x:e.x-t.width/2,y:e.y-t.height/2,z:0}}getSize(){return this.size}getBounds(){const e=this.getCenter(),t=this.getSize();return new sh(e.x-t.width/2,e.x+t.width/2,e.y-t.height/2,e.y+t.height/2)}getVisibleTileBounds(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._zoom,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=Math.floor(e),r=this.getBounds(),a=Ln(i)-1,s=qn({x:r.left,y:r.top},e),n=qn({x:r.right,y:r.bottom},e),o=new Ah(s.x,n.x,s.y,n.y),l=t?o.left:Math.max(0,o.left),h=t?o.right:Math.min(a,o.right),c=Math.max(0,o.top),d=Math.min(a,o.bottom);return new Ah(l,h,c,d)}getVisibleTileCoords(){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const t=Math.floor(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._zoom),i=this.getVisibleTileBounds(t,e),r=[];if(!i)return[];for(let e=i.left;e<=i.right;e++)for(let a=i.top;a<=i.bottom;a++)r.push(new Xn(t,e,a));return r}getVisibleTileOffset(){const e=Math.floor(this._zoom),t=this.getVisibleTileBounds();return Bn({x:t.left,y:t.top,z:e})}isTileCoordInView(e){const t=this.getVisibleTileBounds(this._zoom,!(arguments.length>1&&void 0!==arguments[1])||arguments[1]);if(!t)return!1;const i=Ln(e.z);return Ke(t.left,t.right,i,e.x)&&Ke(t.top,t.bottom,i,e.y)}updateFromMapViewState(e,t){const i=t.projection,r=e.bounds,{lat:a,lon:s}=e.center,n=i.project(a,s);this._zoom=e.zoom;const o=i.project(r.north,r.west),l=i.project(r.south,r.east);this.center.x=n.x,this.center.y=n.y,this.size.width=l.x-o.x,this.size.height=l.y-o.y}getNormalizedOffset(){const e=Math.floor(this._zoom),t=this.getVisibleTileBounds(),{x:i,y:r}=Bn({x:t.left,y:t.top,z:e});return{x:i,y:r,z:0}}centerOn(e){this.center.x=e.x,this.center.y=e.y}zoomedTo(e,t,i){let r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const a=Math.pow(2,t-e),s=new Sh;return s.centerOn({x:i.x-(i.x-this.center.x)/a,y:i.y-(i.y-this.center.y)/a}),s.size={width:this.size.width/a,height:this.size.height/a},r||s.centerOn(i),s}apply(e){this.center=Object.assign({},e.center),this.size=Object.assign({},e.size)}copy(){const e=new Sh;return e.center=Object.assign({},this.center),e.size=Object.assign({},this.size),e}}const Th=Sh,Eh="ready",Oh="show",Ch="hide",Rh="tile:load",Ph="paint:change",kh="tile:bounds:change",Dh="load",zh="click",Ih="mouseout",Fh="mousemove",Lh="zoom:start",jh="zoom:end",Nh="move",Uh="move:start",Vh="move:end",Bh="tilebounds:change",$h="units:change",qh=class extends dt{get context(){return this._context}get gl(){return this.context.gl}get viewport(){var e;return null===(e=this.map)||void 0===e?void 0:e.viewport}get paint(){return this._renderer.paint}get renderer(){return this._renderer}get animator(){return this._animator}set animator(e){this._animator=e}get mask(){return this._layerMask}set mask(e){this._layerMask=e,this.onMaskLayerChange()}get visible(){return this._visible}get enabled(){return this._enabled}set enabled(e){var t;e!==this._enabled&&(this._enabled=e,null===(t=this.map)||void 0===t||t.redraw())}get metadata(){return{layerId:this.id,type:this.type,sourceLayerId:void 0,sourceLayerType:void 0,filter:void 0,paint:void 0,options:void 0}}get isDirty(){return this._isDirty}constructor(e,{source:t,renderer:i}){if(super(),this.invertMaskLayer=!1,this._needsSetup=!0,this._isDirty=!1,this._visible=!0,this._enabled=!1,this._sourceEventHandlers=[],!t)throw new Error(`[MapsGL] No source provided for layer {${e}}`);if(t instanceof Os==0)throw new TypeError(`[MapsGL] Invalid source provided for layer {${e}}`);if(!i)throw new Error(`[MapsGL] No renderer provided for layer {${e}}`);this.id=e,this.source=t,this._renderer=i,i.layer=this,this.timing={mode:br.none,clamp:wr.none,range:void 0,intervals:void 0,interleaved:!0,operation:void 0}}show(){!1===this._visible&&(this._visible=!0,this.onVisible(),this.trigger(Oh))}hide(){!0===this._visible&&(this._visible=!1,this.onHidden(),this.trigger(Ch))}setNeedsUpdate(){var e,t;(this.visible||arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&(this._isDirty=!0,null===(e=this._renderer)||void 0===e||e.setNeedsUpdate(),null===(t=this.map)||void 0===t||t.redraw())}prerender(){this.visible&&this._renderer.prerender(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)}render(e,t){this.visible&&this.enabled&&(this._isDirty=!1,this._renderer.draw(e||0))}setPaintProperty(e,t){if(le(e))throw new Error("[MapsGL] Invalid paint property provided.");he(t)&&(this.paint.setProperty(e,t),this.trigger(Ph,{property:e,value:t}),this.setNeedsUpdate())}queryFeatures(e,t,i){}queryFeaturesPromise(e,t,i){return new Promise((e=>{e(null)}))}refresh(){}refreshPromise(){return new Promise((e=>{e()}))}createTimeSeriesDataProvider(){}_setTimeSeriesFromMetadata(){const e=this.source.metadata.getValidTimes();if(xe(e)&&this.timeSeries){const t=e.reduce(((e,t)=>{const i=t.getTime(),r=this.timeSeries.dataForTimeInterval(i);return e[i]=r||{loading:!1,valid:!1},e}),Object.create(null));this.timeSeries.setData(t)}}_setupTimeSeriesAnimator(){const{clamp:e,range:t,interleaved:i}=this.timing,r=this.createTimeSeriesDataProvider();r&&(r.interleaveRequests=i);const a=new Mr(this.timeSeries,r,{id:this.id,mode:e});this.animator=a,xe(t)&&(a.timeRange=t),this.source instanceof vo&&this.addSourceEventHandler(xs,(()=>{var e;null===(e=this.animator)||void 0===e||e.updateEntryState()})),[Vi.DATA_ADVANCE,Vi.LOAD_COMPLETE].forEach((e=>{a.on(e,(()=>{this.visible&&this.setNeedsUpdate()}))})),a.on(Vi.ADVANCE,(e=>{this.visible&&(this.setNeedsUpdate(),this.enabled=this.animator.canShowForDate(e.date))})),this.timing.mode===br.interval?(a.on(Vi.ADVANCE,(e=>{a.provider?a.isActive&&a.loadDataIfNeeded():this.refresh(!0)})),a.on(Vi.INTERVAL_ADVANCE,(e=>{!1===a.isActive&&a.loadDataForIntervals([e.interval])}))):this.timing.mode===br.any&&a.on(Vi.ADVANCE,(e=>{this.refresh(!0)}))}addSourceEventHandler(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this.source.once(e,t,void 0,this):this.source.on(e,t,void 0,this),this._sourceEventHandlers.push({event:e,handler:t})}onSourceMetadata(){this.timeSeries&&this._setTimeSeriesFromMetadata()}onReady(){var e,t;this.animator&&-1===(null===(e=this.animator)||void 0===e?void 0:e.currentInterval.index)?null===(t=this.animator)||void 0===t||t.once(Vi.DATA_ADVANCE,(()=>{this.trigger(Eh)})):this.trigger(Eh)}onAdd(e){var t;if(this._context=e,this._needsSetup){const i=this.source;this.addSourceEventHandler(fs,this.onSourceMetadata),i.isReady?(this.onSourceMetadata(),this.onReady()):this.addSourceEventHandler(fs,(()=>{this.onAdd(e),this.onReady()}),!0),this.timing.mode!==br.none&&(this.timeSeries=new ur,this._setupTimeSeriesAnimator(),null===(t=this.map)||void 0===t||t.on(Bh,this.onTileBoundsChange,void 0,this)),this._renderer.onAdd(this),this._needsSetup=!1}this._setTimeSeriesFromMetadata(),this.enabled=!0}onRemove(){var e,t;this.enabled=!1,null===(e=this._renderer)||void 0===e||e.onRemove(this),null===(t=this.map)||void 0===t||t.off(Bh,this.onTileBoundsChange)}onMove(){}onMoveStart(){var e;null===(e=this._renderer)||void 0===e||e.onMoveStart(this)}onMoveEnd(){var e;null===(e=this._renderer)||void 0===e||e.onMoveEnd(this)}onZoom(){}onZoomStart(){var e;null===(e=this._renderer)||void 0===e||e.onZoomStart(this)}onZoomEnd(){var e;null===(e=this._renderer)||void 0===e||e.onZoomEnd(this)}onResize(){var e;null===(e=this._renderer)||void 0===e||e.onResize(this)}onClick(e){}onMouseMove(e){}onVisible(){var e;null===(e=this.animator)||void 0===e||e.animation.enable(),this.setNeedsUpdate()}onHidden(){var e;null===(e=this.animator)||void 0===e||e.animation.disable(),this.setNeedsUpdate(!0)}onTileBoundsChange(){var e;null===(e=this._animator)||void 0===e||e.loadDataIfNeeded(!0)}onMaskLayerChange(){}dispose(){var e,t;this._sourceEventHandlers.forEach((e=>{let{event:t,handler:i}=e;this.source.off(t,i)})),this._sourceEventHandlers=[],this._animator&&this._animator.animation.timeline&&this._animator.animation.timeline.remove(this._animator.animation),null===(e=this._renderer)||void 0===e||e.dispose(),null===(t=this._animator)||void 0===t||t.dispose(),this._animator=void 0,this._renderer=void 0,this._context=void 0}},Gh="remove",Hh={[ji.raster]:Jo,[ji.vector]:vh,[ji.geojson]:xh,[ji.encoded]:Wo},Wh=class extends dt{constructor(){super(...arguments),this.cache=new Map}get count(){return this.cache.size}has(e){return he(this.get(e))}get(e){return this.cache.get(e)}find(e){let t;return this.each((i=>{t||i.id!==e&&!new RegExp(e).test(i.id)||(t=i)})),t}add(e,t){let i;if(le(t))throw new Error("[MapsGL] Cannot add data source, an invalid source configuration was provided");if(t instanceof Os?(i=t,e=i.id):t=Object.assign({},t),this.has(e))throw new Error(`[MapsGL] A data source with id ${e} already exists.`);if(le(i)){if(le(t.type))throw new Error("[MapsGL] A data source type must be provided.");i=((e,t)=>{if("debug"===t.type)return new Es(e,t);if(le(Hh[t.type]))throw new Error(`[MapsGL] Invalid source type ${t.type} specified. Type must be one of the \n            following: ${Object.keys(Hh)}`);const i=new Hh[t.type](e,t);if(i.id!==e)throw new Error(`[MapsGL] Expected source ID to be ${e} but got ${i.id} instead.`);return i})(e,Object.assign({},t))}return this.cache.set(e,i),this.trigger("add",{source:i}),i}remove(e){const t=this.get(e);return t&&(t.dispose(),this.cache.delete(e),this.trigger(Gh,{source:t})),t}each(e){this.cache.forEach(((t,i)=>{e(t)}))}};var Yh;!function(e){e.circle="circle",e.line="line",e.fill="fill",e.symbol="symbol",e.text="text"}(Yh||(Yh={}));const Zh=(e,t)=>{let i="";for(let r=0;r<t.length;r++)if((e[r+3]||e[r+2]||e[r+1])&&(i+=`${t[r]}\n`,e[r+1])){const t=e[r+1],a=t.split(":",3),s=a[0],n=Number.parseInt(a[1],10)||0,o=t.slice(Math.max(0,a.join(":").length+1)).trim();i+=Qh(`^^^ ${s}: ${o}\n\n`,n)}return i},Xh=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:": ";const r=e.split(/\r?\n/),a=String(r.length+t-1).length;return r.map(((e,r)=>{const s=r+t,n=String(s).length;return Qh(String(s),a-n)+i+e}))},Qh=(e,t)=>{let i="";for(let e=0;e<t;++e)i+=" ";return`${i}${e}`};var Kh,Jh,ec=function(e,t,i,r){if("a"===i&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?r:"a"===i?r.call(e):r?r.value:t.get(e)},tc=function(e,t,i,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,i):a?a.value=i:t.set(e,i),i};Kh=new WeakMap,Jh=new WeakMap;const ic=class extends oo{get size(){return ec(this,Kh,"f")}constructor(e,t){super(e,Object.assign({format:e.gl.DEPTH_COMPONENT16,size:{width:0,height:0}},t)),Kh.set(this,void 0),Jh.set(this,void 0),Zt(t.size.width>0&&t.size.height>0,"[Aeris] Renderbuffer object requires valid width and height greater than zero"),tc(this,Kh,t.size,"f"),tc(this,Jh,t.format,"f");const i=e.gl;this.bind(),i.renderbufferStorage(i.RENDERBUFFER,ec(this,Jh,"f"),ec(this,Kh,"f").width,ec(this,Kh,"f").height)}resize(e,t){if(e===ec(this,Kh,"f").width&&t===ec(this,Kh,"f").height)return;const i=this.gl;tc(this,Kh,{width:e,height:t},"f"),this.bind(),i.renderbufferStorage(i.RENDERBUFFER,ec(this,Jh,"f"),e,t),this.unbind()}bind(){const e=this.gl;e.bindRenderbuffer(e.RENDERBUFFER,this.handle)}unbind(){const e=this.gl;e.bindRenderbuffer(e.RENDERBUFFER,null)}createHandle(){return this.incrementResourceCount(),this.gl.createRenderbuffer()}deleteHandle(){this.handle&&(this.gl.deleteRenderbuffer(this.handle),this.decrementResourceCount()),this._handle=void 0}dispose(){this.unbind(),this.deleteHandle()}},rc=class extends lo{constructor(e,t,i,r,a={}){super(e,Object.assign(Object.assign({},a),{image:t,size:{width:i,height:r},premultiplyAlpha:!0,flipY:!1,unpackAlignment:1})),this.needsUpdate=!0}},ac=class extends oo{get size(){return this._size}get texture(){return this._texturesByAttachment.values().next().value}get depth(){return this.opts.depth}constructor(e,t={}){super(e,Object.assign({color:1,depth:!0,depthTexture:!1,stencil:!1},t)),this._texturesByAttachment=new Map,this._buffersByAttachment=new Map,this.drawBuffers=new Array,this.drawBuffersChanged=!1,this._size=he(t.size)?t.size:{width:1,height:1},this.viewport=new al(0,0,this.size.width,this.size.height),this.name=t.name;const i=this.gl,r=t.attachments||[];if(ge(r)){for(let a=0;a<this.opts.color;a++){const s=Object.assign(Object.assign({wrapS:i.CLAMP_TO_EDGE,wrapT:i.CLAMP_TO_EDGE,minFilter:i.LINEAR,magFilter:i.LINEAR,type:i.UNSIGNED_BYTE,format:i.RGBA},t),{size:this.size});let n;if(s.data){const{width:t,height:i}=s.size;n=new rc(e,s.data,t,i,s)}else n=new lo(e,s);r.push([i.COLOR_ATTACHMENT0+a,n])}if(t.depthTexture&&(e.isWebGL2||e.renderer.getExtension("WEBGL_depth_texture"))){const t=new lo(e,{size:this.size,minFilter:this.gl.NEAREST,magFilter:this.gl.NEAREST,format:this.gl.DEPTH_COMPONENT,internalFormat:e.isWebGL2?i.DEPTH_COMPONENT16:i.DEPTH_COMPONENT,type:this.gl.UNSIGNED_INT});r.push([i.DEPTH_ATTACHMENT,t])}else{const{depth:a,stencil:s}=t,{width:n,height:o}=this.size;if(a&&!s){const t=new ic(e,{format:i.DEPTH_COMPONENT16,size:{width:n,height:o}});r.push([i.DEPTH_ATTACHMENT,t])}else if(s&&!a){const t=new ic(e,{format:i.STENCIL_INDEX8,size:{width:n,height:o}});r.push([i.STENCIL_ATTACHMENT,t])}else if(a&&s){const t=new ic(e,{format:i.DEPTH_STENCIL,size:{width:n,height:o}});r.push([i.DEPTH_STENCIL_ATTACHMENT,t])}}}this.create(r)}create(e){const t=this.gl;this.clearColors=[],this.clearDepth=1,this.clearStencil=0;for(let i=0;i<e.length;i++){const[r,a]=e[i];a instanceof ic?this._buffersByAttachment.set(r,a):a instanceof lo&&this._texturesByAttachment.set(r,a),this.drawBuffers.push(r),this.clearColors[r-t.COLOR_ATTACHMENT0]=[0,0,0,0]}this.drawBuffersChanged=!0,this.bind(),this._buffersByAttachment.forEach(((e,i)=>{t.framebufferRenderbuffer(t.FRAMEBUFFER,i,t.RENDERBUFFER,e.handle)})),this._texturesByAttachment.forEach(((e,i)=>{t.framebufferTexture2D(t.FRAMEBUFFER,i,t.TEXTURE_2D,e.handle,0)})),this.unbind();const i=t.checkFramebufferStatus(t.FRAMEBUFFER);return i!==t.FRAMEBUFFER_COMPLETE&&console.warn(`[Aeris] ${((e,t)=>{switch(t){case e.FRAMEBUFFER_COMPLETE:return"Framebuffer is ready to display (COMPLETE)";case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"Attachment types are mismatched or not all framebuffer attachment points are \n                framebuffer attachment complete (INCOMPLETE_ATTACHMENT)";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"There is no attachment (INCOMPLETE_MISSING_ATTACHMENT)";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"The height and width of the attachment are not the same (INCOMPLETE_DIMENSIONS)";case e.FRAMEBUFFER_UNSUPPORTED:return"Format of the attachment is not supported or if depth and stencil attachments \n                are not the same renderbuffer (UNSUPPORTED)";case e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:return"Values of gl.RENDERBUFFER_SAMPLES are different among attached renderbuffers, \n                or are non-zero if the attached images are a mix of renderbuffers and textures (INCOMPLETE_MULTISAMPLE)";default:return Zt(!1,`Expected known framebuffer status, given ${t}`),""}})(t,i)}`),this.handle}clear(e){const t=this.gl,i=Kt(e,t.DEPTH_BUFFER_BIT),r=Kt(e,t.STENCIL_BUFFER_BIT),a=Kt(e,t.COLOR_BUFFER_BIT);if(a||i||r){if(this.bind(),a&&void 0!==this.clearColors[0]){const e=this.clearColors[0];t.clearColor(e[0],e[1],e[2],e[3])}i&&void 0!==this.clearDepth&&t.clearDepth(this.clearDepth),r&&void 0!==this.clearStencil&&t.clearStencil(this.clearStencil),t.clear(e),this.unbind()}}getTexture(e){return this._texturesByAttachment.get(e)}resize(e,t){this.size.width===e&&this.size.height===t||(this._size={width:e,height:t},this._texturesByAttachment.forEach((i=>{i.size.width===e&&i.size.height===t||(i.size={width:e,height:t},i.needsUpdate=!0,i.update())})),this._buffersByAttachment.forEach((i=>{i.resize(e,t)})),this.viewport.set(0,0,e,t))}bind(){this.context.state.bindFramebuffer({target:arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.gl.FRAMEBUFFER,buffer:this.handle})}unbind(){this.context.state.bindFramebuffer({target:arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.gl.FRAMEBUFFER,buffer:null})}createHandle(){return this.incrementResourceCount(),this.gl.createFramebuffer()}deleteHandle(){this.handle&&(this.gl.deleteFramebuffer(this.handle),this.decrementResourceCount()),this._handle=void 0}dispose(){this._texturesByAttachment.forEach((e=>{e.dispose()})),this._buffersByAttachment.forEach((e=>{e.dispose()})),this._texturesByAttachment.clear(),this._buffersByAttachment.clear(),this.deleteHandle()}toString(){return`${this.constructor.name}:${this.name} (${this.id})`}},sc=(e,t,i,r)=>{let a=r;if(i=i||{},le(t))return a;if(ze(t)){if("object"===e||"any"===e)return t;if("color"===e&&t instanceof hl)return t;if(t.property)if(t.mapping){const e=ut(i,t.property);a=t.mapping[e]}else a=ut(i,t.property)}else a=Jt(t)?t(i):t;return"color"===e&&(a=nl(a)),a},nc=(e,t)=>{if(null==e?void 0:e.text)return Array.isArray(e.text)?e.text[t]:e.text},oc=e=>(null==e?void 0:e.icon)||(null==e?void 0:e.symbol);class lc{constructor(e={}){if(this._cachedSerialized=null,e.symbol){const t=new Set(["key","rank","fadeOpacity","pitchWithMap","rotateWithMap","sizeAttenuation","allowOverlap"]),i=Object.keys(e.symbol);e.icon||(e.icon={}),i.forEach((i=>{!0!==t.has(i)&&("icon"!==i&&(e.icon[i]=e.symbol[i]),delete e.symbol[i])}))}this.config=e}opacity(e){const t=sc("number",this.provider(e).opacity,e,1);return le(t)?1:t}rasterMeld(e){var t;return sc("boolean",null===(t=this.provider(e).raster)||void 0===t?void 0:t.meld,e,!1)}rasterOpacity(e){var t;const i=sc("number",null===(t=this.provider(e).raster)||void 0===t?void 0:t.opacity,e);return le(i)?this.opacity(e):i}fillColor(e){var t;const i=sc("color",null===(t=this.provider(e).fill)||void 0===t?void 0:t.color,e);return i&&(i.a=this.fillOpacity(e)),i}fillOpacity(e){var t;const i=sc("number",null===(t=this.provider(e).fill)||void 0===t?void 0:t.opacity,e,1);return le(i)?1:i}strokeColor(e){var t;const i=sc("color",null===(t=this.provider(e).stroke)||void 0===t?void 0:t.color,e);return i&&(i.a=this.strokeOpacity(e)),i}strokeOpacity(e){var t;const i=sc("number",null===(t=this.provider(e).stroke)||void 0===t?void 0:t.opacity,e,1);return le(i)?1:i}strokeThickness(e){var t;const i=sc("number",null===(t=this.provider(e).stroke)||void 0===t?void 0:t.thickness,e);return le(i)?0:i}strokeLineJoin(e){var t;const i=sc("string",null===(t=this.provider(e).stroke)||void 0===t?void 0:t.lineJoin,e);return le(i)?Ir.Round:i}strokeLineCap(e){var t;const i=sc("string",null===(t=this.provider(e).stroke)||void 0===t?void 0:t.lineCap,e);return le(i)?Fr.Round:i}radius(e){var t,i;const r=(null===(t=this.provider(e).circle)||void 0===t?void 0:t.radius)||(null===(i=this.provider(e).heatmap)||void 0===i?void 0:i.radius);return sc("number",r,e,10)}sampleExpression(e){var t;const i=null===(t=this.provider(e).sample)||void 0===t?void 0:t.expression;return sc("string",i,e,Tr.number)}sampleExpressionOperation(e){var t;return sc("object",null===(t=this.provider(e).sample)||void 0===t?void 0:t.expressionOperation,e)}sampleChannel(e){var t;return sc("string",null===(t=this.provider(e).sample)||void 0===t?void 0:t.channel,e)}sampleColorScale(e){var t;return sc("object",null===(t=this.provider(e).sample)||void 0===t?void 0:t.colorscale,e)}sampleInterpolation(e){var t;const i=null===(t=this.provider(e).sample)||void 0===t?void 0:t.interpolation;return sc("string",i,e)}sampleOpacity(e){return console.warn("[MapsGL] `sample.opacity` is deprecated. Use `opacity` instead."),1}sampleSmoothing(e){var t;return sc("number",null===(t=this.provider(e).sample)||void 0===t?void 0:t.smoothing,e,0)}sampleOffset(e){var t;return sc("number",null===(t=this.provider(e).sample)||void 0===t?void 0:t.offset,e,0)}sampleMeld(e){var t;return sc("boolean",null===(t=this.provider(e).sample)||void 0===t?void 0:t.meld,e,!0)}sampleDataRange(e){var t;return sc("object",null===(t=this.provider(e).sample)||void 0===t?void 0:t.dataRange,e)}sampleDrawRange(e){var t;return sc("object",null===(t=this.provider(e).sample)||void 0===t?void 0:t.drawRange,e)}gridSpacing(e){var t;return sc("number",null===(t=this.provider(e).grid)||void 0===t?void 0:t.spacing,e,30)}particleType(e){var t;return sc("string",null===(t=this.provider(e).particle)||void 0===t?void 0:t.type,e)}particleCount(e){var t;return sc("number",null===(t=this.provider(e).particle)||void 0===t?void 0:t.count,e)}particleDensity(e){var t;return sc("number",null===(t=this.provider(e).particle)||void 0===t?void 0:t.density,e,0)}particleSpeed(e){var t,i;const r=(null===(t=this.provider(e).particle)||void 0===t?void 0:t.speedFactor)||(null===(i=this.provider(e).particle)||void 0===i?void 0:i.speed);return sc("number",r,e,1)}particleSize(e){var t,i,r;if(qe(null===(t=this.config.particle)||void 0===t?void 0:t.size)){const t=sc("number",null===(i=this.provider(e).particle)||void 0===i?void 0:i.size,e,0);return{width:t,height:t}}return sc("object",null===(r=this.provider(e).particle)||void 0===r?void 0:r.size,e,{width:2,height:2})}particleTrails(e){var t;return sc("boolean",null===(t=this.provider(e).particle)||void 0===t?void 0:t.trails,e)}particleTrailsFade(e){var t,i;const r=(null===(t=this.provider(e).particle)||void 0===t?void 0:t.trailsFadeFactor)||(null===(i=this.provider(e).particle)||void 0===i?void 0:i.trailsFade);return sc("number",r,e)}particleDropRate(e){var t;return sc("number",null===(t=this.provider(e).particle)||void 0===t?void 0:t.dropRate,e)}particleDropRateBump(e){var t;return sc("number",null===(t=this.provider(e).particle)||void 0===t?void 0:t.dropRateBump,e)}heatmapColor(e){var t;return sc("colorscale",null===(t=this.provider(e).heatmap)||void 0===t?void 0:t.color,e)}heatmapRadius(e){var t;return sc("number",null===(t=this.provider(e).heatmap)||void 0===t?void 0:t.radius,e,10)}heatmapBlur(e){var t;return sc("number",null===(t=this.provider(e).heatmap)||void 0===t?void 0:t.blur,e,1)}heatmapIntensity(e){var t;return sc("number",null===(t=this.provider(e).heatmap)||void 0===t?void 0:t.intensity,e)}heatmapWeight(e){var t;return sc("number",null===(t=this.provider(e).heatmap)||void 0===t?void 0:t.weight,e,1)}heatmapOpacity(e){return console.warn("[MapsGL] `heatmap.opacity` is deprecated. Use `opacity` instead."),1}contourInterval(e){var t;return sc("number",null===(t=this.provider(e).contour)||void 0===t?void 0:t.interval,e,1)}contourMajorInterval(e){var t;return sc("number",null===(t=this.provider(e).contour)||void 0===t?void 0:t.majorInterval,e,0)}contourWidth(e){var t;return sc("number",null===(t=this.provider(e).contour)||void 0===t?void 0:t.width,e,1)}contourMajorWidth(e){var t;return sc("number",null===(t=this.provider(e).contour)||void 0===t?void 0:t.majorWidth,e,3)}contourScale(e){var t;return sc("number",null===(t=this.provider(e).contour)||void 0===t?void 0:t.scale,e,1)}contourOffset(e){var t;return sc("number",null===(t=this.provider(e).contour)||void 0===t?void 0:t.offset,e,0)}symbolKey(e){var t;return sc("string",null===(t=this.provider(e).symbol)||void 0===t?void 0:t.key,e)}symbolRank(e){var t;return null===(t=this.provider(e).symbol)||void 0===t?void 0:t.rank}symbolRotateWithMap(e){var t;return sc("boolean",null===(t=this.provider(e).symbol)||void 0===t?void 0:t.rotateWithMap,e,!0)}symbolPitchWithMap(e){var t;return sc("boolean",null===(t=this.provider(e).symbol)||void 0===t?void 0:t.pitchWithMap,e,!0)}symbolSizeAttenuation(e){var t;return sc("boolean",null===(t=this.provider(e).symbol)||void 0===t?void 0:t.sizeAttenuation,e,!0)}symbolAllowOverlap(e){var t;return sc("boolean",null===(t=this.provider(e).symbol)||void 0===t?void 0:t.allowOverlap,e,!0)}symbolOverlapMode(e){var t;return sc("string",null===(t=this.provider(e).symbol)||void 0===t?void 0:t.overlapMode,e,"layer")}symbolFadeOpacity(e){var t;return sc("boolean",null===(t=this.provider(e).symbol)||void 0===t?void 0:t.fadeOpacity,e,!0)}iconType(e){var t;return sc("string",null===(t=oc(this.provider(e)))||void 0===t?void 0:t.type,e)}iconImage(e){var t,i;const r=null===(t=this.provider(e).icon)||void 0===t?void 0:t.image,a="function"==typeof r?r(e):r;if("string"==typeof a&&/^https?:\/\//.test(a))throw new Error(`[MapsGL] Remote icon images must contain a unique id and provided as { id: string; url: string; }, not ${a}.`);const s=this.iconAtlas(e);return!a&&(null===(i=null==s?void 0:s.ids)||void 0===i?void 0:i.length)>0?s.ids[0]:a}iconShader(e){var t;return sc("string",null===(t=oc(this.provider(e)))||void 0===t?void 0:t.shader,e)}iconUniforms(e){var t;return sc("object",null===(t=oc(this.provider(e)))||void 0===t?void 0:t.uniforms,e)}iconSize(e){var t;return sc("object",null===(t=oc(this.provider(e)))||void 0===t?void 0:t.size,e)}iconAnchor(e){var t;return sc("string",null===(t=oc(this.provider(e)))||void 0===t?void 0:t.anchor,e,"center")}iconOffset(e){var t;return sc("object",null===(t=oc(this.provider(e)))||void 0===t?void 0:t.offset,e,{x:0,y:0})}iconPadding(e){var t;const i=sc("object",null===(t=oc(this.provider(e)))||void 0===t?void 0:t.padding,e,6);return Array.isArray(i)?i:[i,i]}iconRotation(e){var t;return sc("number",null===(t=oc(this.provider(e)))||void 0===t?void 0:t.rotation,e,0)}iconBlending(e){var t;return sc("number",null===(t=oc(this.provider(e)))||void 0===t?void 0:t.blending,e)}iconAnimated(e){var t;return sc("boolean",null===(t=oc(this.provider(e)))||void 0===t?void 0:t.animated,e,!1)}iconFactor(e){var t;return sc("number",null===(t=oc(this.provider(e)))||void 0===t?void 0:t.factor,e,1)}iconAtlas(e){var t;return sc("object",null===(t=oc(this.provider(e)))||void 0===t?void 0:t.atlas,e)}textValue(e){var t;const i=null===(t=nc(this.config,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0))||void 0===t?void 0:t.value;return"function"==typeof i?i(e):i}textTransform(e){var t;return sc("string",null===(t=nc(this.config,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0))||void 0===t?void 0:t.transform,e,"none")}textFont(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;var i,r;const a=sc("string",null===(i=nc(this.config,t))||void 0===i?void 0:i.font,e,"Inter");let s=sc("string",null===(r=nc(this.config,t))||void 0===r?void 0:r.weight,e,"normal");return"normal"===s&&(s="regular"),`${ea(a)}-${ea(s)}`}textSize(e){var t;return sc("object",null===(t=nc(this.config,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0))||void 0===t?void 0:t.size,e,12)}textColor(e){var t;const i=sc("color",null===(t=nc(this.config,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0))||void 0===t?void 0:t.color,e,new hl("#000"));return i&&(i.a=this.textOpacity(e)),i}textOutlineColor(e){var t;const i=sc("color",null===(t=nc(this.config,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0))||void 0===t?void 0:t.outlineColor,e);return i&&(i.a=this.textOpacity(e)),i}textOpacity(e){var t;const i=sc("number",null===(t=nc(this.config,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0))||void 0===t?void 0:t.opacity,e,1);return le(i)?1:i}textAlign(e){var t;return sc("string",null===(t=nc(this.config,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0))||void 0===t?void 0:t.align,e,"center")}textAnchor(e){var t;return sc("string",null===(t=nc(this.config,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0))||void 0===t?void 0:t.anchor,e,"center")}textOffset(e){var t;return sc("object",null===(t=nc(this.config,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0))||void 0===t?void 0:t.offset,e,{x:0,y:0})}textPadding(e){var t;const i=sc("object",null===(t=nc(this.config,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0))||void 0===t?void 0:t.padding,e,6);return Array.isArray(i)?i:[i,i]}textRotation(e){var t;return sc("number",null===(t=nc(this.config,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0))||void 0===t?void 0:t.rotation,e,0)}textLetterSpacing(e){var t;return sc("number",null===(t=nc(this.config,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0))||void 0===t?void 0:t.letterSpacing,e,0)}textLineHeight(e){var t;return sc("number",null===(t=nc(this.config,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0))||void 0===t?void 0:t.lineHeight,e,1)}textMaxWidth(e){var t;return sc("number",null===(t=nc(this.config,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0))||void 0===t?void 0:t.maxWidth,e,140)}textLineCount(e){var t;const i=null===(t=this.config)||void 0===t?void 0:t.text;return i?Array.isArray(i)?i.length:1:0}getProperty(e){return ut(this.config,e)}setProperty(e,t){const i=e.match(/\[\d+]/);if((null==i?void 0:i.length)>0){const r=Number.parseInt(i[0].replaceAll(/\D/g,""),10),a=e.split(i[0]),s=ut(this.config,a[0]),n=a[1].replace(/^\./,"");Array.isArray(s)&&pt(s[r],n,t)}else pt(this.config,e,t);this._cachedSerialized=null}serialized(){if(this._cachedSerialized)return this._cachedSerialized;const e={};return qo(e,this.config),this._cachedSerialized=e,e}provider(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(Jt(this.config)?this.config(e):this.config)||{}}static fromSerialized(e){const t={};return Go(t,e),new lc(t)}}const hc=lc;function cc(e,t){var i=t[0],r=t[1],a=t[2],s=t[3],n=t[4],o=t[5],l=t[6],h=t[7],c=t[8],d=t[9],u=t[10],p=t[11],m=t[12],f=t[13],g=t[14],v=t[15],y=i*o-r*n,x=i*l-a*n,b=i*h-s*n,w=r*l-a*o,_=r*h-s*o,M=a*h-s*l,A=c*f-d*m,S=c*g-u*m,T=c*v-p*m,E=d*g-u*f,O=d*v-p*f,C=u*v-p*g,R=y*C-x*O+b*E+w*T-_*S+M*A;return R?(e[0]=(o*C-l*O+h*E)*(R=1/R),e[1]=(a*O-r*C-s*E)*R,e[2]=(f*M-g*_+v*w)*R,e[3]=(u*_-d*M-p*w)*R,e[4]=(l*T-n*C-h*S)*R,e[5]=(i*C-a*T+s*S)*R,e[6]=(g*b-m*M-v*x)*R,e[7]=(c*M-u*b+p*x)*R,e[8]=(n*O-o*T+h*A)*R,e[9]=(r*T-i*O-s*A)*R,e[10]=(m*_-f*b+v*y)*R,e[11]=(d*b-c*_-p*y)*R,e[12]=(o*S-n*E-l*A)*R,e[13]=(i*E-r*S+a*A)*R,e[14]=(f*x-m*w-g*y)*R,e[15]=(c*w-d*x+u*y)*R,e):null}function dc(e,t,i){var r=t[0],a=t[1],s=t[2],n=t[3],o=t[4],l=t[5],h=t[6],c=t[7],d=t[8],u=t[9],p=t[10],m=t[11],f=t[12],g=t[13],v=t[14],y=t[15],x=i[0],b=i[1],w=i[2],_=i[3];return e[0]=x*r+b*o+w*d+_*f,e[1]=x*a+b*l+w*u+_*g,e[2]=x*s+b*h+w*p+_*v,e[3]=x*n+b*c+w*m+_*y,e[4]=(x=i[4])*r+(b=i[5])*o+(w=i[6])*d+(_=i[7])*f,e[5]=x*a+b*l+w*u+_*g,e[6]=x*s+b*h+w*p+_*v,e[7]=x*n+b*c+w*m+_*y,e[8]=(x=i[8])*r+(b=i[9])*o+(w=i[10])*d+(_=i[11])*f,e[9]=x*a+b*l+w*u+_*g,e[10]=x*s+b*h+w*p+_*v,e[11]=x*n+b*c+w*m+_*y,e[12]=(x=i[12])*r+(b=i[13])*o+(w=i[14])*d+(_=i[15])*f,e[13]=x*a+b*l+w*u+_*g,e[14]=x*s+b*h+w*p+_*v,e[15]=x*n+b*c+w*m+_*y,e}function uc(e,t,i){var r=i[0],a=i[1],s=i[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*a,e[5]=t[5]*a,e[6]=t[6]*a,e[7]=t[7]*a,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function pc(e,t){var i=t[4],r=t[5],a=t[6],s=t[8],n=t[9],o=t[10];return e[0]=Math.hypot(t[0],t[1],t[2]),e[1]=Math.hypot(i,r,a),e[2]=Math.hypot(s,n,o),e}var mc=function(e,t,i,r,a){var s,n=1/Math.tan(t/2);return e[0]=n/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=a&&a!==1/0?(e[10]=(a+r)*(s=1/(r-a)),e[14]=2*a*r*s):(e[10]=-1,e[14]=-2*r),e},fc=function(e,t,i,r,a,s,n){var o=1/(t-i),l=1/(r-a),h=1/(s-n);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*h,e[11]=0,e[12]=(t+i)*o,e[13]=(a+r)*l,e[14]=(n+s)*h,e[15]=1,e};const gc=class{get value(){return null}fromArray(e){return this}toArray(){return[]}},vc=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),yc=Object.freeze([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);class xc extends gc{constructor(){var e;super(...arguments),this._value=(e=new $s(16),$s!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e)}get value(){return this._value}get elements(){return this.value.length}get x(){return this.value[12]}get y(){return this.value[13]}get z(){return this.value[14]}get w(){return this.value[15]}static get identity(){return(new xc).fromArray([...vc])}static get zero(){return(new xc).fromArray([...yc])}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=0;for(;i<this.elements;)this.value[i]=e[t+i],i+=1;return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=0;for(;i<this.elements;)e[t+i]=this.value[i],i+=1;return e}fromRotationX(e){var t,i,r,a;return t=this.value,i=e,r=Math.sin(i),a=Math.cos(i),t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}fromRotationY(e){var t,i,r,a;return t=this.value,i=e,r=Math.sin(i),a=Math.cos(i),t[0]=a,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}fromRotationZ(e){var t,i,r,a;return t=this.value,i=e,r=Math.sin(i),a=Math.cos(i),t[0]=a,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}fromScale(e){return function(e,t){e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1}(this.value,e.value),this}fromTranslation(e){return function(e,t){e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1}(this.value,e.value),this}fromPerspective(e,t,i,r){return mc(this.value,e,t,i,r),this}fromOrthogonal(e,t,i,r,a,s){return fc(this.value,e,t,r,i,a,s),this}fromQuaternion(e){return function(e,t){var i=t[0],r=t[1],a=t[2],s=t[3],n=i+i,o=r+r,l=a+a,h=i*n,c=r*n,d=r*o,u=a*n,p=a*o,m=a*l,f=s*n,g=s*o,v=s*l;e[0]=1-d-m,e[1]=c+v,e[2]=u-g,e[3]=0,e[4]=c-v,e[5]=1-h-m,e[6]=p+f,e[7]=0,e[8]=u+g,e[9]=p-f,e[10]=1-h-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1}(this.value,e.value),this}clone(){return(new xc).copy(this)}copy(e){let t=0;for(;t<this.value.length;)this.value[t]=e.value[t],t+=1;return this}determinant(){return((t=(e=this.value)[0])*(n=e[5])-(i=e[1])*(s=e[4]))*((d=e[10])*(g=e[15])-(u=e[11])*(f=e[14]))-(t*(o=e[6])-(r=e[2])*s)*((c=e[9])*g-u*(m=e[13]))+(t*(l=e[7])-(a=e[3])*s)*(c*f-d*m)+(i*o-r*n)*((h=e[8])*g-u*(p=e[12]))-(i*l-a*n)*(h*f-d*p)+(r*l-a*o)*(h*m-c*p);var e,t,i,r,a,s,n,o,l,h,c,d,u,p,m,f,g}equals(e){return r=(t=this.value)[0],a=t[1],s=t[2],n=t[3],o=t[4],l=t[5],h=t[6],c=t[7],d=t[8],u=t[9],p=t[10],m=t[11],f=t[12],g=t[13],v=t[14],y=t[15],x=(i=e.value)[0],b=i[1],w=i[2],_=i[3],M=i[4],A=i[5],S=i[6],T=i[7],E=i[8],O=i[9],C=i[10],R=i[11],P=i[12],k=i[13],D=i[14],z=i[15],Math.abs(r-x)<=Bs*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(a-b)<=Bs*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(s-w)<=Bs*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(n-_)<=Bs*Math.max(1,Math.abs(n),Math.abs(_))&&Math.abs(o-M)<=Bs*Math.max(1,Math.abs(o),Math.abs(M))&&Math.abs(l-A)<=Bs*Math.max(1,Math.abs(l),Math.abs(A))&&Math.abs(h-S)<=Bs*Math.max(1,Math.abs(h),Math.abs(S))&&Math.abs(c-T)<=Bs*Math.max(1,Math.abs(c),Math.abs(T))&&Math.abs(d-E)<=Bs*Math.max(1,Math.abs(d),Math.abs(E))&&Math.abs(u-O)<=Bs*Math.max(1,Math.abs(u),Math.abs(O))&&Math.abs(p-C)<=Bs*Math.max(1,Math.abs(p),Math.abs(C))&&Math.abs(m-R)<=Bs*Math.max(1,Math.abs(m),Math.abs(R))&&Math.abs(f-P)<=Bs*Math.max(1,Math.abs(f),Math.abs(P))&&Math.abs(g-k)<=Bs*Math.max(1,Math.abs(g),Math.abs(k))&&Math.abs(v-D)<=Bs*Math.max(1,Math.abs(v),Math.abs(D))&&Math.abs(y-z)<=Bs*Math.max(1,Math.abs(y),Math.abs(z));var t,i,r,a,s,n,o,l,h,c,d,u,p,m,f,g,v,y,x,b,w,_,M,A,S,T,E,O,C,R,P,k,D,z}getRotation(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new bn;return function(e,t){var i=new $s(3);pc(i,t);var r=1/i[0],a=1/i[1],s=1/i[2],n=t[0]*r,o=t[1]*a,l=t[2]*s,h=t[4]*r,c=t[5]*a,d=t[6]*s,u=t[8]*r,p=t[9]*a,m=t[10]*s,f=n+c+m,g=0;f>0?(g=2*Math.sqrt(f+1),e[3]=.25*g,e[0]=(d-p)/g,e[1]=(u-l)/g,e[2]=(o-h)/g):n>c&&n>m?(g=2*Math.sqrt(1+n-c-m),e[3]=(d-p)/g,e[0]=.25*g,e[1]=(o+h)/g,e[2]=(u+l)/g):c>m?(g=2*Math.sqrt(1+c-n-m),e[3]=(u-l)/g,e[0]=(o+h)/g,e[1]=.25*g,e[2]=(d+p)/g):(g=2*Math.sqrt(1+m-n-c),e[3]=(o-h)/g,e[0]=(u+l)/g,e[1]=(d+p)/g,e[2]=.25*g)}(e.value,this.value),e}getScale(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Mn;return pc(e.value,this.value),e}getTranslation(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Mn;var t,i;return(t=e.value)[0]=(i=this.value)[12],t[1]=i[13],t[2]=i[14],e}identity(){return function(e){e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1}(this.value),this}invert(){return cc(this.value,this.value),this}inverse(e){return cc(this.value,e.value),this}transpose(){return function(e,t){if(e===t){var i=t[1],r=t[2],a=t[3],s=t[6],n=t[7],o=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=i,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=s,e[11]=t[14],e[12]=a,e[13]=n,e[14]=o}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15]}(this.value,this.value),this}multiply(e,t){return t?dc(this.value,e.value,t.value):dc(this.value,this.value,e.value),this}multiplyScalar(e){var t,i,r;return(t=this.value)[0]=(i=this.value)[0]*(r=e),t[1]=i[1]*r,t[2]=i[2]*r,t[3]=i[3]*r,t[4]=i[4]*r,t[5]=i[5]*r,t[6]=i[6]*r,t[7]=i[7]*r,t[8]=i[8]*r,t[9]=i[9]*r,t[10]=i[10]*r,t[11]=i[11]*r,t[12]=i[12]*r,t[13]=i[13]*r,t[14]=i[14]*r,t[15]=i[15]*r,this}premultiply(e){return dc(this.value,e.value,this.value),this}rotateX(e){var t,i,r,a,s,n,o,l,h,c,d,u,p;return t=this.value,i=this.value,r=e,a=Math.sin(r),s=Math.cos(r),n=i[4],o=i[5],l=i[6],h=i[7],c=i[8],d=i[9],u=i[10],p=i[11],i!==t&&(t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15]),t[4]=n*s+c*a,t[5]=o*s+d*a,t[6]=l*s+u*a,t[7]=h*s+p*a,t[8]=c*s-n*a,t[9]=d*s-o*a,t[10]=u*s-l*a,t[11]=p*s-h*a,this}rotateY(e){var t,i,r,a,s,n,o,l,h,c,d,u,p;return t=this.value,i=this.value,r=e,a=Math.sin(r),s=Math.cos(r),n=i[0],o=i[1],l=i[2],h=i[3],c=i[8],d=i[9],u=i[10],p=i[11],i!==t&&(t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15]),t[0]=n*s-c*a,t[1]=o*s-d*a,t[2]=l*s-u*a,t[3]=h*s-p*a,t[8]=n*a+c*s,t[9]=o*a+d*s,t[10]=l*a+u*s,t[11]=h*a+p*s,this}rotateZ(e){var t,i,r,a,s,n,o,l,h,c,d,u,p;return t=this.value,i=this.value,r=e,a=Math.sin(r),s=Math.cos(r),n=i[0],o=i[1],l=i[2],h=i[3],c=i[4],d=i[5],u=i[6],p=i[7],i!==t&&(t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15]),t[0]=n*s+c*a,t[1]=o*s+d*a,t[2]=l*s+u*a,t[3]=h*s+p*a,t[4]=c*s-n*a,t[5]=d*s-o*a,t[6]=u*s-l*a,t[7]=p*s-h*a,this}scale(e){return uc(this.value,this.value,e.value),this}scaleScalar(e){return uc(this.value,this.value,Gs(e,e,e)),this}translate(e){return function(e,t,i){var r,a,s,n,o,l,h,c,d,u,p,m,f=i[0],g=i[1],v=i[2];t===e?(e[12]=t[0]*f+t[4]*g+t[8]*v+t[12],e[13]=t[1]*f+t[5]*g+t[9]*v+t[13],e[14]=t[2]*f+t[6]*g+t[10]*v+t[14],e[15]=t[3]*f+t[7]*g+t[11]*v+t[15]):(a=t[1],s=t[2],n=t[3],o=t[4],l=t[5],h=t[6],c=t[7],d=t[8],u=t[9],p=t[10],m=t[11],e[0]=r=t[0],e[1]=a,e[2]=s,e[3]=n,e[4]=o,e[5]=l,e[6]=h,e[7]=c,e[8]=d,e[9]=u,e[10]=p,e[11]=m,e[12]=r*f+o*g+d*v+t[12],e[13]=a*f+l*g+u*v+t[13],e[14]=s*f+h*g+p*v+t[14],e[15]=n*f+c*g+m*v+t[15])}(this.value,this.value,e.value),this}compose(e,t,i){var r,a,s,n,o,l,h,c,d,u,p,m,f,g,v,y,x,b,w,_,M,A,S;return s=e.value,m=(o=(a=t.value)[0])*(d=o+o),f=o*(u=(l=a[1])+l),g=o*(p=(h=a[2])+h),y=l*p,b=(c=a[3])*d,w=c*u,_=c*p,A=(n=i.value)[1],S=n[2],(r=this.value)[0]=(1-((v=l*u)+(x=h*p)))*(M=n[0]),r[1]=(f+_)*M,r[2]=(g-w)*M,r[3]=0,r[4]=(f-_)*A,r[5]=(1-(m+x))*A,r[6]=(y+b)*A,r[7]=0,r[8]=(g+w)*S,r[9]=(y-b)*S,r[10]=(1-(m+v))*S,r[11]=0,r[12]=s[0],r[13]=s[1],r[14]=s[2],r[15]=1,this}decompose(){return{rotation:this.getRotation(),scale:this.getScale(),translation:this.getTranslation()}}toString(){return"mat4("+(e=this.value)[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")";var e}}const bc=xc,wc=class extends bc{frustum(e,t,i,r,a,s){return function(e,t,i,r,a,s,n){var o=1/(i-t),l=1/(a-r),h=1/(s-n);e[0]=2*s*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*s*l,e[6]=0,e[7]=0,e[8]=(i+t)*o,e[9]=(a+r)*l,e[10]=(n+s)*h,e[11]=-1,e[12]=0,e[13]=0,e[14]=n*s*2*h,e[15]=0}(this.value,e,t,r,i,a,s),this}orthographic(e,t,i,r,a,s){return fc(this.value,e,t,r,i,a,s),this}perspective(e,t,i,r){return mc(this.value,e,t,i,r),this}lookAt(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Mn(0,0,0),i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Mn(0,1,0);return function(e,t,i,r){var a=t[0],s=t[1],n=t[2],o=r[0],l=r[1],h=r[2],c=a-i[0],d=s-i[1],u=n-i[2],p=c*c+d*d+u*u;p>0&&(c*=p=1/Math.sqrt(p),d*=p,u*=p);var m=l*u-h*d,f=h*c-o*u,g=o*d-l*c;(p=m*m+f*f+g*g)>0&&(m*=p=1/Math.sqrt(p),f*=p,g*=p),e[0]=m,e[1]=f,e[2]=g,e[3]=0,e[4]=d*g-u*f,e[5]=u*m-c*g,e[6]=c*f-d*m,e[7]=0,e[8]=c,e[9]=d,e[10]=u,e[11]=0,e[12]=a,e[13]=s,e[14]=n,e[15]=1}(this.value,e.value,t.value,i.value),this}};class _c{get hash(){return this.tile.coord.hash}constructor(e,t,i,r=[0,0,1,1]){this.partialScale=1,this.tile=e,this.scale=new Mn(t.x,t.y,1),this.offset=new Mn(i.x,i.y,0),this.uvOffset=r}getViewMatrix(){const e=new wc;return e.scale(this.scale),e.translate(this.offset),e}static fromTile(e,t){const i=jn(t.z),r=Bn(t.normalize()),a=new _c(e,{x:i,y:i},{x:r.x+t.wrap,y:r.y});return a.coord=t,a}static fromAncestorPartial(e,t){const i=e.tile,r=e.target,a=jn(r.z),s=Bn(r),n=new _c(i,{x:a,y:a},s,((e,t)=>{const i=1/Math.pow(2,t.z-e.z);return[t.x*i-e.x,t.y*i-e.y,i,i]})(i.coord,r.normalize()));return n.partialScale=1/Math.pow(2,i.coord.z-r.z),n.coord=t,n}static fromDescendantPartial(e,t){const i=e.tile,r=e.target,a=jn(i.coord.z),s=Bn(i.coord),n=new _c(i,{x:a,y:a},s,[0,0,1,1]);return n.partialScale=1/Math.pow(2,i.coord.z-r.z),n.coord=t,n}}const Mc=_c;class Ac{get span(){return{x:this.bounds.right-this.bounds.left+1,y:this.bounds.bottom-this.bounds.top+1}}get offset(){return Bn({x:this.bounds.left,y:this.bounds.top,z:this.zoom})}get scale(){const e=Math.pow(2,this.zoom);return{x:e/this.clampedSpan().x,y:e/this.clampedSpan().y}}get offsetNormalized(){const e=this.topLeftCoord(!0);return{x:e.x,y:e.y}}get spanNormalized(){const e=this.topLeftCoord(!0),t=this.bottomRightCoord(!0);return{x:t.x-e.x,y:t.y-e.y}}constructor(e,t){this.zoom=e,this.bounds=t}resolution(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Fn;const t=arguments.length>1&&void 0!==arguments[1]&&arguments[1]?this.clampedSpan():this.span;return{width:t.x*e,height:t.y*e}}clampedSpan(){return{x:Math.max(1,Math.abs(this.span.x)),y:Math.max(1,Math.abs(this.span.y))}}topLeftCoord(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=new Xn(this.zoom,this.bounds.left,this.bounds.top);return e?Bn(t):t}bottomRightCoord(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=new Xn(this.zoom,this.bounds.right+1,this.bounds.bottom+1);return e?Bn(t):t}visibleTileRegion(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?{offset:this.offsetNormalized,scale:this.spanNormalized}:{offset:this.offset,scale:this.span}}equals(e){const t=this.bounds,i=e.bounds;return e.zoom===this.zoom&&i.left===t.left&&i.right===t.right&&i.top===t.top&&i.bottom===t.bottom}convertedToZoom(e){if(e===this.zoom)return this;const t=Math.pow(2,e-this.zoom),i=Math.floor(this.bounds.left*t),r=Math.floor(this.bounds.top*t),a=Math.floor(i+this.span.x*t-1),s=Math.floor(r+this.span.y*t-1);return new Ac(e,new Ah(i,Math.max(0,a),r,Math.max(0,s)))}}const Sc=Ac;class Tc extends dt{constructor(){super(...arguments),this.elapsedTime=0,this._renderRegion={offset:{x:0,y:0},scale:{x:1,y:1},diff:{offset:{x:0,y:0},scale:{x:1,y:1}}},this._tileLayout={size:{width:Fn,height:Fn},columns:1,rows:1},this._renderedTiles=new Set,this._renderables=[],this._glState={}}get dataRegion(){return this._dataTileRegion}get visibleRegion(){return this._mapTileRegion}get renderRegion(){return this._renderRegion}get tileLayout(){return this._tileLayout}get renderables(){return this._renderables}get renderedTiles(){return[...this._renderedTiles.values()]}get gl(){return this._glState}updateRenderables(e){this._renderables=e}updateState(e){var t,i;const{map:r,data:a,layout:s,renderables:n,elapsedTime:o,gl:l}=e;let h=!1;if(he(o)&&(this.elapsedTime=o),s){const e=s.columns!==(null===(t=this.tileLayout)||void 0===t?void 0:t.columns)||s.rows!==(null===(i=this.tileLayout)||void 0===i?void 0:i.rows);this._tileLayout=Object.assign({},s),e&&this.trigger(Tc.Events.LAYOUT_CHANGE,{layout:s})}if(l&&(this._glState=Object.assign(Object.assign({},this._glState),l)),!a||!r)return;this._renderables=n;const c=new Sc(a.zoom,a.bounds),d=new Sc(r.zoom,r.bounds);if(this._dataTileRegion?this._dataTileRegion.equals(c)||(this._dataTileRegion=c,this._renderedTiles.clear(),h=!0):(this._dataTileRegion=c,h=!0),h||!this._mapTileRegion||!this._mapTileRegion.equals(d)){this._mapTileRegion=d;const e=d.offsetNormalized,t=d.spanNormalized,i=this.dataRegion.visibleTileRegion(!0);this._renderRegion={offset:e,scale:t,diff:{offset:{x:(e.x-i.offset.x)/i.scale.x,y:(e.y-i.offset.y)/i.scale.y},scale:{x:t.x/i.scale.x,y:t.y/i.scale.y}}},h=!0}h&&this.trigger(Tc.Events.DIRTY)}}Tc.Events={DIRTY:"dirty",LAYOUT_CHANGE:"layout:change"};const Ec=Tc,Oc=class{get passes(){return this._passes}get count(){return this.passes.length}constructor(e,t={}){this.enabled=!0,this._passes=[],this.context=e,this.drawContext=t,this._size=e.size}setSize(e,t){const i=this.context.renderer.dpr,r=e*i,a=t*i;this._size={width:e,height:t};for(let e=0,t=this._passes.length;e<t;e++)this._passes[e].setSize(r,a)}addPass(e){this.prepareDrawContext(e),this._passes.push(e)}insertPass(e,t){this.prepareDrawContext(e),this._passes.splice(t,0,e)}removePass(e){const t=this._passes.indexOf(e);-1!==t&&(this._passes.splice(t,1),e.dispose())}removeAllPasses(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this._passes.filter((t=>!t.id||!1===e.includes(t.id))).forEach((e=>{e.dispose()})),this._passes=[]}getPass(e){let t;return this._passes.forEach((i=>{i.id===e&&(t=i)})),t}enablePass(e,t){const i=this.getPass(e);i&&(i.enabled=t)}withPass(e,t){const i=this.getPass(e);i&&t(i)}prerender(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=this.context,r=Object.assign(Object.assign({},this.drawContext),e),a=this._passes.filter((e=>e.enabled&&(!0===e.prerender||this.drawContext.renderTarget)));if(0!==a.length){for(let e=0,s=a.length;e<s;e++){const s=e===a.length-1,n=a[e],o=r.renderTarget;s&&o&&(o.bind(),i.state.clear(!0)),n.render(r,t),s&&o&&o.unbind()}this.resetState()}}render(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=this.context,r=this._passes.filter((e=>e.enabled&&!0!==e.prerender)),a=Object.assign(Object.assign({},this.drawContext),e);if(0!==r.length){for(let e=0,s=r.length;e<s;e++){const s=r[e],n=a.renderTarget;e===r.length-1&&n&&(n.bind(),i.state.clear(!0)),s.render(a,t)}this.resetState()}}prepareDrawContext(e){e.drawContext=Object.assign(Object.assign({},this.drawContext),e.drawContext)}resetState(){const e=this.context;e.state.opts.currentProgram=-1,e.state.opts.activeTextureUnit=-1,e.state.opts.premultiplyAlpha=!1,e.state.opts.flipY=!1,e.state.setActiveGeometry(null),e.state.bindFramebuffer({buffer:null})}dispose(){this.passes.forEach((e=>e.dispose()))}},Cc=class extends dt{get context(){return this.layer.context}get layer(){return this._layer}set layer(e){this._layer=e}get progress(){var e;return(null===(e=this.layer.animator)||void 0===e?void 0:e.relativePosition)||0}get passes(){return this._passes}get timeState(){return Object.assign({},this._timeState)}get renderState(){return this._renderState}constructor(e={}){super(),this.isAnimated=!1,this.cachesTextures=!0,this.eventHandlers={},this._renderState=new Ec,this._timeState={position:0,index:0,nextIndex:0},this.config=Object.assign({},e),this.paint=new hc(e.paint),this._renderState.on(Ec.Events.DIRTY,(()=>{this.onDirty()}))}setNeedsUpdate(){this.onDirty()}onAdd(e){if(!e)throw new Error("[Aeris] Invalid layer provided to `onAdd`.");const t=e.context.gl;this._layer=e,this._passes=new Oc(this.context,{configurator:this}),this.passes.drawContext.renderTarget=this.renderTarget,this.setup(),this.prepareDrawPasses(),this.setupEvents(),this.cachesTextures&&e.source instanceof vo&&e.source.tiles.prepareTextureArray(e.context,{capacity:e.source.tiles.capacity,size:{width:e.source.tileSize.width,height:e.source.tileSize.height},minFilter:t.LINEAR,magFilter:t.LINEAR,generateMipmaps:!1}),this.prerender(0),this.draw(0)}onRemove(e){if(!e)throw new Error("[Aeris] Invalid layer provided to `onRemove`.")}onMoveStart(e){}onMoveEnd(e){}onZoomStart(e){}onZoomEnd(e){}onResize(e){}onDirty(){const e=this.getRenderablesLOD();this.renderState.updateRenderables(e)}setup(){}setupEvents(){const e=this.layer.source,t=this.layer.animator;if(e instanceof vo&&this.addEventHandler(e,xs,(e=>{this.onDirty()})),t){const{position:e,dataInterval:i,nextDataInterval:r,dataIndex:a,nextDataIndex:s}=t.info;this._timeState={position:e,index:a,nextIndex:s,interval:i,nextInterval:r},t.on([Ui.PLAY,Ui.STOP,Vi.DATA_ADVANCE].join(" "),(e=>{const{position:t,dataInterval:i,nextDataInterval:r,dataIndex:a,nextDataIndex:s}=e;this._timeState={position:t,index:a,nextIndex:s,interval:i,nextInterval:r}}))}}addEventHandler(e,t,i){this.eventHandlers[t]={target:e,handler:i},e.on(t,i)}prepareRenderState(){var e,t;const i=this.renderState.renderables,r=this.layer,a=r.getDataZoom(),s=r.viewport.getVisibleTileBounds(a),n=Math.floor(r.map.getZoom()),o=r.viewport.getVisibleTileBounds(n);this.renderState.updateState({data:{zoom:a,bounds:s},map:{zoom:n,bounds:o},renderables:i,gl:{}}),(null===(e=this.layer.mask)||void 0===e?void 0:e.layer)&&(null===(t=this.layer.mask.layer.renderer)||void 0===t||t.prepareForOffscreenRender()),this.passes.drawContext.renderTarget=this.renderTarget}prerender(e){this.passes&&(this.prepareRenderState(),this.renderState.updateState({elapsedTime:e}),this.passes.prerender({scene:this.layer.scene},{gl:this.renderState.gl}))}draw(e){this.passes&&!this.renderTarget&&0!==this.renderState.renderables.length&&(this.renderState.updateState({elapsedTime:e}),this.passes.render({scene:this.layer.scene},{gl:this.renderState.gl}),this.isAnimated&&this.layer.setNeedsUpdate())}prepareDrawPasses(){}stateForDrawPass(e,t){var i,r,a,s;const n=this.layer.map.getBounds(),o=1/Math.pow(2,this.layer.map.getZoom()),l=Gn({lat:n.north,lon:n.west});return{interval:this.timeState.index,nextInterval:this.timeState.nextIndex,dataRegion:this.renderState.dataRegion,visibleRegion:{offset:l,scale:{x:o,y:o}},renderRegion:this.renderState.renderRegion,maskTexture:null===(s=null===(a=null===(r=null===(i=this.layer.mask)||void 0===i?void 0:i.layer)||void 0===r?void 0:r.renderer)||void 0===a?void 0:a.renderTarget)||void 0===s?void 0:s.texture}}prepareDrawPass(e,t){}prepareForOffscreenRender(){const e=this.context,t=e.gl;this.renderTarget||(this.renderTarget=new ac(e,{size:{width:e.resolution.width,height:e.resolution.height},minFilter:t.LINEAR,magFilter:t.LINEAR,format:t.RGBA}),e.on("resize",(e=>{let{width:t,height:i}=e;this.renderTarget.resize(t,i)})),this.passes.passes.forEach((e=>{e.prerender=!0})))}getInfoForStyles(){return{zoom:this.layer.map.getZoom()}}getVisibleTiles(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.layer.map.getZoom();const t=this.layer.viewport.getVisibleTileCoords(e),i=[];for(let e=0,r=t.length;e<r;e++)i.push(new Kn(t[e]));return i}getRenderables(){const e=this.layer.getDataZoom(),t=this.layer.viewport.getVisibleTileCoords(e),i=[];for(let e=0,r=t.length;e<r;e++){const r=t[e],a=r.normalize(),s=this.layer.pyramid.get(a);if(s){const e=Mc.fromTile(s,r);i.push(e)}}return i}getRenderablesLOD(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.layer.getDataZoom();const t=this.layer.viewport.getVisibleTileCoords(e);let i=[];for(let e=0,r=t.length;e<r;e++){const r=this.getRenderablesForTile(t[e]);i=[...i,...r]}return i}getRenderablesForTile(e){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.layer.map.transform.tileSize;const i=[];t=t||Fn;const r=this.layer.pyramid.getAvailableLOD(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.POSITIVE_INFINITY);if(r)for(let t=0,a=r.length;t<a;t++){const a=r[t];let s;s=a.tile.coord.z===e.z?Mc.fromTile(a.tile,e):a.tile.coord.z<e.z?Mc.fromAncestorPartial(a,e):Mc.fromDescendantPartial(a,e),i.push(s)}return i}dispose(){this.passes.dispose(),Object.keys(this.eventHandlers).forEach((e=>{const{target:t,handler:i}=this.eventHandlers[e];t.off(e,i)}))}};var Rc,Pc,kc,Dc,zc,Ic,Fc,Lc=function(e,t,i,r){if("a"===i&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?r:"a"===i?r.call(e):r?r.value:t.get(e)},jc=function(e,t,i,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,i):a?a.value=i:t.set(e,i),i};class Nc extends oo{get source(){return Lc(this,kc,"f")}get type(){return Lc(this,Pc,"f")}constructor(e,t,i,r={}){super(e,{name:Xt(t)||Yt(Qt(e.gl,Bc(e.gl,i)))}),Rc.add(this),Pc.set(this,void 0),kc.set(this,void 0),Dc.set(this,void 0),Zt("string"==typeof t,"Shader: GLSL source code must be a JavaScript string"),jc(this,Pc,Bc(e.gl,i),"f"),jc(this,Dc,Object.assign(r),"f"),t=Lc(this,Rc,"m",Ic).call(this,t,Lc(this,Dc,"f")||{}).replaceAll(/\n\n+/gm,"\n\n"),jc(this,kc,t,"f"),Lc(this,Rc,"m",zc).call(this,t)}getSource(){return this.gl.getShaderSource(this.handle)}setSource(e){const t=Xt(e);t&&(this.name=Yt(t)),Lc(this,Rc,"m",zc).call(this,e)}createHandle(){return this.incrementResourceCount(),this.gl.createShader(this.type)}deleteHandle(){this.handle&&(this.gl.deleteShader(this.handle),this.decrementResourceCount()),this._handle=void 0}dispose(){this.deleteHandle()}toString(){return`${Qt(this.gl,this.type)}:${this.id}`}}Pc=new WeakMap,kc=new WeakMap,Dc=new WeakMap,Rc=new WeakSet,zc=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.source;if(jc(this,kc,e,"f"),e=e.replaceAll("#include <","#glsl_include <"),e=Lc(this,Rc,"m",Ic).call(this,e,Lc(this,Dc,"f")||{}).replaceAll(/\n\n+/gm,"\n\n"),this.context.isWebGL2&&(e=Lc(this,Rc,"m",Fc).call(this,e)),this.gl.shaderSource(this.handle,e),this.gl.compileShader(this.handle),!this.gl.getShaderParameter(this.handle,this.gl.COMPILE_STATUS)){const t=this.gl.getShaderInfoLog(this.handle),{name:i,errors:r,warnings:a}=((e,t,i,r)=>{const a=t.split(/\r?\n/),s={},n={},o=Xt(i)||"(unnamed)",l=`${Qt(e,r)} shader ${o}`;for(let e=0;e<a.length;e++){const i=a[e];if(i.length<=1)continue;const r=i.split(":"),o=r[0],h=Number.parseInt(r[2],10);if(Number.isNaN(h))throw new TypeError(`GLSL compilation error in ${l}: ${t}`);"WARNING"===o?n[h]=i:s[h]=i}const h=Xh(i);return{name:l,errors:Zh(s,h),warnings:Zh(n,h)}})(this.gl,t,this.source,this.type);if(r){const t=Xh(e).join("\n");console.error(`GLSL compilation errors in ${i}\n${r}\n----------------------\n${t}`)}throw a&&console.warn(`GLSL compilation warnings in ${i}\n${a}`),new Error(`GLSL compilation errors in ${i}`)}},Ic=function e(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.replaceAll(/^[\t ]*#glsl_include +<([\w.]+)>/gm,((t,r)=>{let a=i[r];if(void 0===a)throw new Error(`Cannot resolve #include <${r}>`);return a=a.replaceAll("#include <","#glsl_include <"),Lc(this,Rc,"m",e).call(this,a,i)}))},Fc=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.source;const t=this.context.gl;if(this.context.isWebGL2){const i=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];!1===e.startsWith("#version 300 es")&&(e=`#version 300 es\n\n${e}`),i.forEach((t=>{e=e.replaceAll(new RegExp(`#extension ${t}.+\n`,"g"),"")})),e=e.replaceAll(/texture(2D|Cube|EXT)/g,"texture"),this.type===t.VERTEX_SHADER?(e=e.replaceAll("attribute ","in "),e=e.replaceAll("varying ","out ")):(e=e.replaceAll("varying ","in "),e=e.replaceAll(/void main\(\)\s*{\s*/g,"out vec4 outColor;\n\nvoid main() {"),e=e.replaceAll("gl_FragColor","outColor"))}return e};class Uc extends Nc{constructor(e,t,i={}){super(e,t,"vertex",i)}get type(){return this.gl.VERTEX_SHADER}}class Vc extends Nc{constructor(e,t,i={}){super(e,t,"fragment",i)}get type(){return this.gl.FRAGMENT_SHADER}}const Bc=(e,t)=>{switch(t){case"vertex":return e.VERTEX_SHADER;case"fragment":return e.FRAGMENT_SHADER;default:return}};var $c;!function(e){e[e.None=0]="None",e[e.Normal=1]="Normal",e[e.Additive=2]="Additive",e[e.Subtractive=3]="Subtractive",e[e.Multiply=4]="Multiply"}($c||($c={}));const qc=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{viewport:{width:null,height:null},transparent:!1,cullFace:void 0,frontFace:e.CCW,depthTest:!1,depthWrite:!0,depthMask:!0,depthFunc:e.LESS,blending:$c.Normal,blendEnabled:!0,blendFunc:{src:e.ONE,dst:e.ZERO},blendEquation:{modeRGB:e.FUNC_ADD},premultiplyAlpha:!1,unpackAlignment:4,flipY:!1,clearAlpha:1,clearColor:new hl(0),framebuffer:null,boundBuffer:null,currentProgram:null,textureUnits:[],activeTextureUnit:-1,currentRenderTarget:null,activeGeometryId:null}},Gc=class{get gl(){return this._gl}get opts(){return this._state}get textureUnits(){return this.opts.textureUnits}get activeTextureUnit(){return this.opts.activeTextureUnit}get activeGeometryId(){return this.opts.activeGeometryId}constructor(e,t){this._gl=e,this._state={},this.apply(t||qc(e))}apply(e){const t=this.gl;if(e.blending)this.setBlending(e.blending);else{if(e.blendFunc){const{src:i,dst:r,srcAlpha:a,dstAlpha:s}=e.blendFunc;he(i)&&he(r)&&(this.setBlendFunc(i,r,a,s),this.enable(t.BLEND))}else this.disable(t.BLEND);if(e.blendEquation){const{modeRGB:t,modeAlpha:i}=e.blendEquation;he(t)&&this.setBlendEquation(t,i)}}this.setCullFace(e.cullFace),he(e.frontFace)&&this.setFrontFace(e.frontFace),e.depthTest?this.enable(t.DEPTH_TEST):this.disable(t.DEPTH_TEST),he(e.depthMask)&&this.setDepthMask(e.depthMask),e.depthFunc&&this.setDepthFunc(e.depthFunc),this._state=Object.assign(Object.assign({},this._state),e)}enable(e){const t=this.opts;!0!==t[e]&&(this.gl.enable(e),t[e]=!0)}disable(e){const t=this.opts;!1!==t[e]&&(this.gl.disable(e),t[e]=!1)}clear(){const e=this.gl;e.clear((arguments.length>0&&void 0!==arguments[0]&&!arguments[0]?0:e.COLOR_BUFFER_BIT)|(arguments.length>1&&void 0!==arguments[1]&&!arguments[1]?0:e.DEPTH_BUFFER_BIT)|(arguments.length>2&&void 0!==arguments[2]&&!arguments[2]?0:e.STENCIL_BUFFER_BIT))}setBlendEnabled(e){this.opts.blendEnabled!==e&&(e?this.enable(this.gl.BLEND):this.disable(this.gl.BLEND),this.opts.blendEnabled=e)}setBlending(e){const t=this.gl,i=this.opts.premultiplyAlpha;if(this.opts.blending!==e)switch(this.opts.blending=e,this.setBlendEnabled(e!==$c.None),e){case $c.Additive:i?(this.setBlendEquation(t.FUNC_ADD,t.FUNC_ADD),this.setBlendFunc(t.ONE,t.ONE,t.ONE,t.ONE)):(this.setBlendEquation(t.FUNC_ADD),this.setBlendFunc(t.SRC_ALPHA,t.ONE));break;case $c.Subtractive:i?(this.setBlendEquation(t.FUNC_ADD,t.FUNC_ADD),this.setBlendFunc(t.ZERO,t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ONE_MINUS_SRC_ALPHA)):(this.setBlendEquation(t.FUNC_ADD),this.setBlendFunc(t.ZERO,t.ONE_MINUS_SRC_COLOR));break;case $c.Multiply:i?(this.setBlendEquation(t.FUNC_ADD,t.FUNC_ADD),this.setBlendFunc(t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA)):(this.setBlendEquation(t.FUNC_ADD),this.setBlendFunc(t.ZERO,t.SRC_COLOR));break;default:i?(this.setBlendEquation(t.FUNC_ADD,t.FUNC_ADD),this.setBlendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA)):(this.setBlendEquation(t.FUNC_ADD,t.FUNC_ADD),this.setBlendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA))}}setBlendFunc(e,t,i,r){var a,s,n,o;(null===(a=this.opts.blendFunc)||void 0===a?void 0:a.src)===e&&(null===(s=this.opts.blendFunc)||void 0===s?void 0:s.dst)===t&&(null===(n=this.opts.blendFunc)||void 0===n?void 0:n.srcAlpha)===i&&(null===(o=this.opts.blendFunc)||void 0===o?void 0:o.dstAlpha)===r||(this.opts.blendFunc={src:e,dst:t,srcAlpha:i,dstAlpha:r},void 0===i?this.gl.blendFunc(e,t):this.gl.blendFuncSeparate(e,t,i,r))}setBlendEquation(e,t){var i,r;(null===(i=this.opts.blendEquation)||void 0===i?void 0:i.modeRGB)===e&&(null===(r=this.opts.blendEquation)||void 0===r?void 0:r.modeAlpha)===t||(this.opts.blendEquation={modeRGB:e,modeAlpha:t},void 0===t?this.gl.blendEquation(e):this.gl.blendEquationSeparate(e,t))}setClearAlpha(e){this.opts.clearAlpha=e}setClearColor(e,t){var i;const r=t||e.a;(null===(i=this.opts.clearColor)||void 0===i?void 0:i.equals(e))&&this.opts.clearAlpha===r||(this.opts.clearColor=e,this.opts.clearAlpha=r,this.gl.clearColor(e.r,e.g,e.b,r))}setCullFace(e){this.opts.cullFace!==e&&(e?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this.opts.cullFace=e,this.gl.cullFace(e))}setFrontFace(e){this.opts.frontFace!==e&&(this.opts.frontFace=e,this.gl.frontFace(e))}setDepthMask(e){this.opts.depthMask!==e&&(this.opts.depthMask=e,this.gl.depthMask(e))}setDepthFunc(e){this.opts.depthFunc!==e&&(this.opts.depthFunc=e,this.gl.depthFunc(e))}setDepthTest(e){this.opts.depthTest!==e&&(this.opts.depthTest=e,e?this.enable(this.gl.DEPTH_TEST):this.disable(this.gl.DEPTH_TEST))}setPixelStoreUnpackAlignment(e){this.opts.unpackAlignment!==e&&(this.opts.unpackAlignment=e,this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,e))}setPixelStoreUnpackPremultiplyAlpha(e){this.opts.premultiplyAlpha!==e&&(this.opts.premultiplyAlpha=e,this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e))}setPixelStoreFlipY(e){this.opts.flipY!==e&&(this.opts.flipY=e,this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,e))}setActiveTexture(e){this.opts.activeTextureUnit!==e&&(this.opts.activeTextureUnit=e,this.gl.activeTexture(this.gl.TEXTURE0+e))}bindFramebuffer(){let{target:e=this.gl.FRAMEBUFFER,buffer:t=null}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.opts.framebuffer!==t&&(this.opts.framebuffer=t,this.gl.bindFramebuffer(e,t))}setActiveGeometry(e){this.opts.activeGeometryId=e}setRenderTarget(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.opts.framebuffer!==(null==e?void 0:e.handle)&&(e?(this.bindFramebuffer({target:this.gl.FRAMEBUFFER,buffer:e.handle}),this.setViewport(e.size.width,e.size.height)):(this.bindFramebuffer({target:this.gl.FRAMEBUFFER,buffer:null}),this.setViewport(this.gl.canvas.width,this.gl.canvas.height)))}setViewport(e,t){this.opts.viewport.width===e&&this.opts.viewport.height===t||(this.opts.viewport={width:e,height:t},this.gl.viewport(0,0,e,t))}reset(){const e=this.gl;if(e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),!0===(e=>Boolean(e&&(e instanceof WebGLRenderingContext||34962===e.ARRAY_BUFFER)))(e)){const t=e;he(t.DRAW_FRAMEBUFFER)&&(e.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(t.READ_FRAMEBUFFER,null))}e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),this.apply(qc(e))}},Hc=(e,t)=>ze(e)?he(e.value)&&(le(t)||e.value===t):he(e)&&(le(t)||e===t),Wc=e=>{const t=[];return Hc(e.color)&&t.push("USE_COLOR"),Hc(e.map)&&t.push("USE_MAP"),Hc(e.bumpMap)&&t.push("USE_BUMPMAP"),Hc(e.specularMap)&&t.push("USE_SPECULARMAP"),Hc(e.sizeAttenuation,!0)&&t.push("USE_SIZEATTENUATION"),t.map((e=>`#define ${e}`))},Yc=(e,t,i,r,a)=>{if(r=r.length>0?Qc(r):r,a){const e=a.get(i);if(r.length>0)if(void 0===e)a.set(i,[...r]);else{if(Kc(e,r))return;e.set?e.set(r):Jc(e,r),a.set(i,e)}else{if(e===r)return;a.set(i,r)}}switch(t){case 5126:return r.length>0?e.uniform1fv(i,r):e.uniform1f(i,r);case 35664:return e.uniform2fv(i,r);case 35665:return e.uniform3fv(i,r);case 35666:return e.uniform4fv(i,r);case 35670:case 5124:case 35678:case 35680:return r.length>0?e.uniform1iv(i,r):e.uniform1i(i,r);case 35671:case 35667:return e.uniform2iv(i,r);case 35672:case 35668:return e.uniform3iv(i,r);case 35673:case 35669:return e.uniform4iv(i,r);case 35674:return e.uniformMatrix2fv(i,!1,r);case 35675:return e.uniformMatrix3fv(i,!1,r);case 35676:return e.uniformMatrix4fv(i,!1,r);default:throw new Error(`[AerisGL] Program::setUniform: Unknown uniform type ${t}`)}},Zc=function(e){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return(e=e.replace(/<#defines>/,(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).join("\n"))).replace(/<#includes>/,t.join("\n"))},Xc={},Qc=e=>{const t=e.length,i=e[0].length;if(void 0===i)return e;const r=t*i;let a=Xc[r];a||(Xc[r]=a=new Float32Array(r));for(let r=0;r<t;r++)a.set(e[r],r*i);return a},Kc=(e,t)=>{if(e.length!==t.length)return!1;for(let i=0,r=e.length;i<r;i++)if(e[i]!==t[i])return!1;return!0},Jc=(e,t)=>{for(let i=0,r=e.length;i<r;i++)e[i]=t[i]},ed=class extends oo{get uniforms(){return this._uniforms}get attributes(){return this._attributes}get vertexShader(){return this._vs}get fragmentShader(){return this._fs}get renderState(){return this._renderState}constructor(e,t={}){super(e,t),this._textureBindings={};const{vertexShader:i,fragmentShader:r,uniforms:a={},transparent:s=!1,defines:n=new Array,includes:o={}}=t;this._uniforms={},this._attributes={},this._renderState=new Gc(e.gl),this._uniformState=new Map;const l=[...Wc(Object.assign(Object.assign({},t),a)),...n].map((e=>!1===e.startsWith("#define ")?`#define ${e}`:e)),h=this.gl;let c=i,d=r;if("string"==typeof c&&"string"==typeof d&&Jt(t.onBeforeCompile)){const e={vertex:c,fragment:d};t.onBeforeCompile(e),c=e.vertex,d=e.fragment}if(this._vs="string"==typeof c?new Uc(e,Zc(c,l),o):c,this._fs="string"==typeof d?new Vc(e,Zc(d,l),o):d,Zt(this.vertexShader instanceof Uc,`[AerisGL] Program::${this.id}: bad vertex shader`),Zt(this.fragmentShader instanceof Vc,`[AerisGL] Program::${this.id}: bad fragment shader`),h.attachShader(this.handle,this.vertexShader.handle),h.attachShader(this.handle,this.fragmentShader.handle),h.linkProgram(this.handle),h.validateProgram(this.handle),!h.getProgramParameter(this.handle,h.LINK_STATUS))throw new Error(`[AerisGL] Program::${this.id}: Error linking ${h.getProgramInfoLog(this.handle)}`);this.vertexShader.dispose(),this.fragmentShader.dispose(),this._assignAttributes(),this._assignUniforms(a),this.attributeOrder=Object.values(this.attributes).join(""),s&&(this.renderState.opts.transparent=!0,this.renderState.setBlendFunc(h.SRC_ALPHA,h.ONE_MINUS_SRC_ALPHA),this.renderState.setBlendEquation(h.FUNC_ADD),this.renderState.setDepthMask(!1))}use(){const e=this.gl;let t=-1;this.context.state.opts.currentProgram===this.id||(this.bind(),this.context.state.opts.currentProgram=this.id,this._textureBindings={}),Object.keys(this.uniforms).forEach((i=>{const r=this.uniforms[i];if(!r)return void console.warn(`[AerisGL] Program::${this.id}: Active uniform ${i} has not been supplied`);if(r&&le(r.value))return void console.warn(`[AerisGL] Program::${this.id}: Uniform ${i} is missing a value parameter`);const{type:a,location:s}=r;let n=r.value;if(n instanceof lo)return t+=1,this._textureBindings[t]=n.id,n.update(t),Yc(e,a,s,t,this._uniformState);if(n instanceof wn||n instanceof gc?n=n.value:n instanceof hl&&(n=n.toVector().toArray()),he(n)&&n.length>0&&n[0]instanceof lo){const i=[];for(let e=0,r=n.length;e<r;e++)t+=1,n[e].update(t),i.push(t);return Yc(e,a,s,i,this._uniformState)}Yc(e,a,s,n,this._uniformState)}))}setUniform(e,t){he(this.uniforms[e])&&(this.uniforms[e].value=t)}bind(){this.gl.useProgram(this.handle)}unbind(){this.gl.useProgram(null)}createHandle(){return this.incrementResourceCount(),this.gl.createProgram()}deleteHandle(){this.handle&&(this.gl.deleteProgram(this.handle),this.decrementResourceCount()),this._handle=void 0}_assignUniforms(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var t;const i=this.gl,r=i.getProgramParameter(this.handle,i.ACTIVE_UNIFORMS);for(let a=0;a<r;a++){const r=i.getActiveUniform(this.handle,a),s=r.name,n={location:this.gl.getUniformLocation(this.handle,s),type:r.type},o=r.name.match(/(\w+)/g);n.name=o[0],3===o.length?(n.isStructArray=!0,n.structIndex=Number(o[1]),n.structProperty=o[2]):2===o.length&&Number.isNaN(Number(o[1]))&&(n.isStruct=!0,n.structProperty=o[1]),he(null===(t=e[s])||void 0===t?void 0:t.value)&&(n.value=e[s].value),this.uniforms[s]=n}}_assignAttributes(){const e=this.gl,t=e.getProgramParameter(this.handle,e.ACTIVE_ATTRIBUTES);for(let i=0;i<t;i++){const t=e.getActiveAttrib(this.handle,i).name,r=this.gl.getAttribLocation(this.handle,t);this.attributes[t]=r}}dispose(){this.unbind(),this.deleteHandle(),this._vs.dispose(),this._fs.dispose()}},td=Object.freeze([1,0,0,0,1,0,0,0,1]),id=Object.freeze([0,0,0,0,0,0,0,0,0]);class rd extends gc{constructor(){super(...arguments),this._value=en()}get value(){return this._value}get elements(){return this.value.length}static get identity(){return(new rd).fromArray([...td])}static get zero(){return(new rd).fromArray([...id])}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=0;for(;i<this.elements;)this.value[i]=e[t+i],i+=1;return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=0;for(;i<this.elements;)e[t+i]=this.value[i],i+=1;return e}clone(){return(new rd).copy(this)}copy(e){let t=0;for(;t<this.value.length;)this.value[t]=e.value[t],t+=1;return this}set(e,t,i,r,a,s,n,o,l){return function(e,t,i,r,a,s,n,o,l,h){e[0]=t,e[1]=i,e[2]=r,e[3]=a,e[4]=s,e[5]=n,e[6]=o,e[7]=l,e[8]=h}(this.value,e,t,i,r,a,s,n,o,l),this}determinant(){return(e=this.value)[0]*((n=e[8])*(i=e[4])-(r=e[5])*(s=e[7]))+e[1]*(-n*(t=e[3])+r*(a=e[6]))+e[2]*(s*t-i*a);var e,t,i,r,a,s,n}equals(e){return r=(t=this.value)[0],a=t[1],s=t[2],n=t[3],o=t[4],l=t[5],h=t[6],c=t[7],d=t[8],u=(i=e.value)[0],p=i[1],m=i[2],f=i[3],g=i[4],v=i[5],y=i[6],x=i[7],b=i[8],Math.abs(r-u)<=Bs*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(a-p)<=Bs*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(s-m)<=Bs*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(n-f)<=Bs*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(o-g)<=Bs*Math.max(1,Math.abs(o),Math.abs(g))&&Math.abs(l-v)<=Bs*Math.max(1,Math.abs(l),Math.abs(v))&&Math.abs(h-y)<=Bs*Math.max(1,Math.abs(h),Math.abs(y))&&Math.abs(c-x)<=Bs*Math.max(1,Math.abs(c),Math.abs(x))&&Math.abs(d-b)<=Bs*Math.max(1,Math.abs(d),Math.abs(b));var t,i,r,a,s,n,o,l,h,c,d,u,p,m,f,g,v,y,x,b}getNormalMatrix(e){var t,i,r,a,s,n,o,l,h,c,d,u,p,m,f,g,v,y,x,b,w,_,M,A,S,T,E,O,C,R,P;t=this.value,(P=(x=(r=(i=e.value)[0])*(l=i[5])-(a=i[1])*(o=i[4]))*(R=(p=i[10])*(y=i[15])-(m=i[11])*(v=i[14]))-(b=r*(h=i[6])-(s=i[2])*o)*(C=(u=i[9])*y-m*(g=i[13]))+(w=r*(c=i[7])-(n=i[3])*o)*(O=u*v-p*g)+(_=a*h-s*l)*(E=(d=i[8])*y-m*(f=i[12]))-(M=a*c-n*l)*(T=d*v-p*f)+(A=s*c-n*h)*(S=d*g-u*f))&&(t[0]=(l*R-h*C+c*O)*(P=1/P),t[1]=(h*E-o*R-c*T)*P,t[2]=(o*C-l*E+c*S)*P,t[3]=(s*C-a*R-n*O)*P,t[4]=(r*R-s*E+n*T)*P,t[5]=(a*E-r*C-n*S)*P,t[6]=(g*A-v*M+y*_)*P,t[7]=(v*w-f*A-y*b)*P,t[8]=(f*M-g*w+y*x)*P)}identity(){var e;return(e=this.value)[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,this}invert(){return tn(this.value,this.value),this}inverse(e){return tn(this.value,e.value),this}rotate(e){var t,i,r,a,s,n,o,l,h,c,d,u,p,m;return t=this.value,r=e,a=(i=this.value)[0],s=i[1],n=i[2],o=i[3],l=i[4],h=i[5],c=i[6],d=i[7],u=i[8],p=Math.sin(r),m=Math.cos(r),t[0]=m*a+p*o,t[1]=m*s+p*l,t[2]=m*n+p*h,t[3]=m*o-p*a,t[4]=m*l-p*s,t[5]=m*h-p*n,t[6]=c,t[7]=d,t[8]=u,this}scale(e){return rn(this.value,this.value,e.value),this}scaleScalar(e){return rn(this.value,this.value,Yl(e,e)),this}translate(e){return function(e,t,i){var r=t[0],a=t[1],s=t[2],n=t[3],o=t[4],l=t[5],h=t[6],c=t[7],d=t[8],u=i[0],p=i[1];e[0]=r,e[1]=a,e[2]=s,e[3]=n,e[4]=o,e[5]=l,e[6]=u*r+p*n+h,e[7]=u*a+p*o+c,e[8]=u*s+p*l+d}(this.value,this.value,e.value),this}transpose(){return function(e,t){if(e===t){var i=t[1],r=t[2],a=t[5];e[1]=t[3],e[2]=t[6],e[3]=i,e[5]=t[7],e[6]=r,e[7]=a}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8]}(this.value,this.value),this}multiply(e){return function(e,t,i){var r=t[0],a=t[1],s=t[2],n=t[3],o=t[4],l=t[5],h=t[6],c=t[7],d=t[8],u=i[0],p=i[1],m=i[2],f=i[3],g=i[4],v=i[5],y=i[6],x=i[7],b=i[8];e[0]=u*r+p*n+m*h,e[1]=u*a+p*o+m*c,e[2]=u*s+p*l+m*d,e[3]=f*r+g*n+v*h,e[4]=f*a+g*o+v*c,e[5]=f*s+g*l+v*d,e[6]=y*r+x*n+b*h,e[7]=y*a+x*o+b*c,e[8]=y*s+x*l+b*d}(this.value,this.value,e.value),this}multiplyScalar(e){var t,i,r;return(t=this.value)[0]=(i=this.value)[0]*(r=e),t[1]=i[1]*r,t[2]=i[2]*r,t[3]=i[3]*r,t[4]=i[4]*r,t[5]=i[5]*r,t[6]=i[6]*r,t[7]=i[7]*r,t[8]=i[8]*r,this}toString(){return"mat3("+(e=this.value)[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")";var e}}const ad=rd,sd=class extends ed{get color(){return this.uniforms.color.value}set color(e){const t="string"==typeof e?new hl(e):e;this.uniforms.color.value=t}get map(){return this.opts.map}set map(e){this.opts.map=e}get wireframe(){return this.opts.wireframe}set wireframe(e){this.opts.wireframe=e}constructor(e,t={}){(t=Object.assign({color:new hl(255,255,255,1)},t)).uniforms=Object.assign({color:{value:nl(t.color)},map:{value:t.map}},t.uniforms),super(e,Object.assign(Object.assign({},t),{vertexShader:t.vertexShader||"\nprecision mediump float;\n\n<#defines>\n<#includes>\n\nattribute vec3 position;\nattribute vec2 uv;\nattribute vec3 normal;\n\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat3 normalMatrix;\n\nvarying vec2 vUv;\nvarying vec3 vNormal;\nvarying vec3 vSurfaceToLight;\nvarying vec3 vSurfaceToView;\n\nvoid main() {\n    vUv = uv;\n    vNormal = normal;\n\n    // compute the world position of the surface\n    vec3 surfaceWorldPosition = mat3(modelMatrix) * position;\n    // vector from the surface to the light\n\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n",fragmentShader:t.fragmentShader||"\nprecision mediump float;\n\n<#defines>\n<#includes>\n\nuniform vec4 color;\n#ifdef USE_MAP\n    uniform sampler2D map;\n#endif\n#ifdef USE_SPECULARMAP\nuniform sampler2D specularMap;\n#endif\n\nvarying vec2 vUv;\n\nvoid main() {\n    vec4 outputColor = color;\n\n#ifdef USE_MAP\n    outputColor = texture2D(map, vUv);\n#endif\n\n    float specularStrength;\n#ifdef USE_SPECULARMAP\n    vec4 texelSpecular = texture2D(specularMap, vUv);\n    specularStrength = texelSpecular.r;\n#else\n    specularStrength = 1.;\n#endif\n\n    gl_FragColor = outputColor;\n}\n"}))}};var nd;!function(e){e[e.ZYX=0]="ZYX",e[e.YXZ=1]="YXZ",e[e.XZY=2]="XZY",e[e.ZXY=3]="ZXY",e[e.YZX=4]="YZX",e[e.XYZ=5]="XYZ",e[e.RollPitchYaw=0]="RollPitchYaw"}(nd||(nd={}));const od=nd.ZYX,ld=.99999;class hd{get x(){return this._value[0]}set x(e){this._value[0]=e,this.triggerChange()}get y(){return this._value[1]}set y(e){this._value[1]=e,this.triggerChange()}get z(){return this._value[2]}set z(e){this._value[2]=e,this.triggerChange()}get order(){return this._value[3]}set order(e){this._value[3]=e,this.triggerChange()}get roll(){return this.x}set roll(e){this.x=e}get pitch(){return this.y}set pitch(e){this.y=e}get yaw(){return this.z}set yaw(e){this.z=e}get value(){return this._value}get elements(){return this.value.length}constructor(e=0,t=0,i=0,r=0){this._changeCallbacks=[],this._value=an(e,t,i,r)}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t+0],this.y=e[t+1],this.z=e[t+2],this.order=e[t+3],this.triggerChange(),this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t+0]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.order,e}fromObject(e){let{x:t,y:i,z:r,order:a}=e;return void 0!==t&&(this.x=t),void 0!==i&&(this.y=i),void 0!==r&&(this.z=r),void 0!==a&&(this.order=a),this.triggerChange(),this}toObject(){return{x:this.x,y:this.y,z:this.z,order:this.order}}fromRotationMatrix(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:od;const i=e.toArray(),r=i[0],a=i[4],s=i[8],n=i[1],o=i[5],l=i[9],h=i[2],c=i[6],d=i[10];switch(t=t||this.order,t){case nd.XYZ:this.y=Math.asin(Pe(s,-1,1)),Math.abs(s)<ld?(this.x=Math.atan2(-l,d),this.z=Math.atan2(-a,r)):(this.x=Math.atan2(c,o),this.z=0);break;case nd.YXZ:this.x=Math.asin(-Pe(l,-1,1)),Math.abs(l)<ld?(this.y=Math.atan2(s,d),this.z=Math.atan2(n,o)):(this.y=Math.atan2(-h,r),this.z=0);break;case nd.ZXY:this.x=Math.asin(Pe(c,-1,1)),Math.abs(c)<ld?(this.y=Math.atan2(-h,d),this.z=Math.atan2(-a,o)):(this.y=0,this.z=Math.atan2(n,r));break;case nd.ZYX:this.y=Math.asin(-Pe(h,-1,1)),Math.abs(h)<ld?(this.x=Math.atan2(c,d),this.z=Math.atan2(n,r)):(this.x=0,this.z=Math.atan2(-a,o));break;case nd.YZX:this.z=Math.asin(Pe(n,-1,1)),Math.abs(n)<ld?(this.x=Math.atan2(-l,o),this.y=Math.atan2(-h,r)):(this.x=0,this.y=Math.atan2(s,d));break;case nd.XZY:this.z=Math.asin(-Pe(a,-1,1)),Math.abs(a)<ld?(this.x=Math.atan2(c,o),this.y=Math.atan2(s,r)):(this.x=Math.atan2(-l,d),this.y=0);break;default:throw new Error("Unknown Euler angle order")}return this.triggerChange(),this}fromQuaternion(e){const[t,i,r,a]=e.toArray(),s=i*i,n=-2*(s+r*r)+1,o=2*(t*i+a*r);let l=-2*(t*r-a*i);l=l>1?1:l,l=l<-1?-1:l;const h=Math.atan2(2*(i*r+a*t),-2*(t*t+s)+1),c=Math.asin(l),d=Math.atan2(o,n);return new hd(h,c,d,nd.RollPitchYaw)}toQuaternion(){const e=Math.cos(.5*this.yaw),t=Math.sin(.5*this.yaw),i=Math.cos(.5*this.roll),r=Math.sin(.5*this.roll),a=Math.cos(.5*this.pitch),s=Math.sin(.5*this.pitch);return new bn(e*r*a-t*i*s,e*i*s+t*r*a,t*i*a-e*r*s,e*i*a+t*r*s)}fromVector3(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.order;return this.set(e.x,e.y,e.z,Number.isFinite(t)?t:this.order)}toVector3(){return new Mn(this.x,this.y,this.z)}set(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.order;return this._value=an(e,t,i,Number.isFinite(r)?r:this.order),this.triggerChange(),this}clone(){return(new hd).copy(this)}copy(e){let t=0;for(;t<this.value.length;)this.value[t]=e.value[t],t+=1;return this.triggerChange(),this}equals(e){return un(this.value,e.value)}onChange(e){this._changeCallbacks.includes(e)||this._changeCallbacks.push(e)}triggerChange(){this._changeCallbacks.forEach((e=>e()))}}const cd=hd;class dd extends ro{get parent(){return this._parent}get children(){return this._children}constructor(e){super(e),this.visible=!0,this.localMatrix=new wc,this.worldMatrix=new wc,this.matrixAutoUpdate=!0,this.position=new Mn,this.scale=new Mn(1,1,1),this.rotation=new cd,this.quaternion=new bn,this.up=new Mn(0,1,0),this._parent=null,this._children=[],this._worldMatrixNeedsUpdate=!1,this.rotation.onChange((()=>{this.quaternion.fromEuler(this.rotation)})),this.quaternion.onChange((()=>{this.rotation.fromQuaternion(this.quaternion)}))}add(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!1===this.contains(e)&&this.children.push(e),t&&e.setParent(this,!1)}remove(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!0===this.contains(e)&&this.children.splice(this.children.indexOf(e),1),t&&e.setParent(null,!1)}contains(e){return this.children.includes(e)}setParent(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t&&this.parent&&e!==this.parent&&this.parent.remove(this,!1),this._parent=e,t&&e&&e.add(this,!1)}traverse(e){if(!e(this))for(let t=0,i=this.children.length;t<i;t++)this.children[t].traverse(e)}lookAt(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]?this.localMatrix.lookAt(this.position,e,this.up):this.localMatrix.lookAt(e,this.position,this.up),this.quaternion=this.localMatrix.getRotation(),this.rotation.fromQuaternion(this.quaternion)}updateMatrixWorld(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.matrixAutoUpdate&&this.updateMatrix(),(this._worldMatrixNeedsUpdate||e)&&(null===this.parent?this.worldMatrix.copy(this.localMatrix):this.worldMatrix.multiply(this.parent.worldMatrix,this.localMatrix),this._worldMatrixNeedsUpdate=!1,e=!0);for(let t=0,i=this.children.length;t<i;t++)this.children[t].updateMatrixWorld(e)}updateMatrix(){this.localMatrix.compose(this.position,this.quaternion,this.scale),this._worldMatrixNeedsUpdate=!0}decompose(){this.localMatrix.getTranslation(this.position),this.localMatrix.getRotation(this.quaternion),this.localMatrix.getScale(this.scale),this.rotation.fromQuaternion(this.quaternion)}clone(){return new dd(this.context).copy(this)}copy(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.visible=e.visible,this.position.copy(e.position),this.scale.copy(e.scale),this.rotation.copy(e.rotation),this.quaternion.copy(e.quaternion),this.up.copy(e.up),this.localMatrix.copy(e.localMatrix),this.worldMatrix.copy(e.worldMatrix),this.matrixAutoUpdate=e.matrixAutoUpdate,!0===t)for(let t=0,i=e.children.length;t<i;t++)this.add(e.children[t].clone());return this}}class ud extends dd{}const pd=dd;let md=1;class fd extends pd{get id(){return this._id}get geometry(){return this._geometry}get program(){return this._program}set wireframe(e){this.drawMode=e?this.gl.LINE_STRIP:this.gl.TRIANGLES}constructor(e,t,i){super(e),this.modelViewMatrix=new bc,this.normalMatrix=new ad,this.renderOrder=0,this.zDepth=0,this._id=md,this._geometry=t,this._program=i,this.drawMode=e.gl.TRIANGLES,md+=1}draw(){let{renderer:e,camera:t,target:i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const r=this.program,a={};let s=this.drawMode;r instanceof sd&&r.wireframe&&(s=this.gl.LINE_STRIP),e&&e.state.apply(r.renderState.opts),t?(Object.assign(a,{projectionMatrix:t.projectionMatrix,cameraPosition:t.worldPosition,viewMatrix:t.viewMatrix}),this.modelViewMatrix.multiply(t.viewMatrix,this.worldMatrix),this.normalMatrix.getNormalMatrix(this.modelViewMatrix)):this.modelViewMatrix.copy(this.worldMatrix),Object.assign(a,Object.assign(Object.assign({},this.getDrawUniforms()),{resolution:new eh(this.context.canvas.width,this.context.canvas.height),modelMatrix:this.worldMatrix,modelViewMatrix:this.modelViewMatrix,normalMatrix:this.normalMatrix})),Object.keys(a).forEach((e=>{r.uniforms[e]&&(r.uniforms[e].value=a[e])})),i&&i.bind(),r.use(),this.geometry.draw(r,s),i&&i.unbind()}updateGeometry(e){var t;arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&(null===(t=this._geometry)||void 0===t||t.dispose()),this._geometry=e}dispose(){this.program.dispose(),this.geometry.dispose()}clone(){return new fd(this.context,this.geometry,this.program).copy(this)}copy(e){return super.copy(e,!(arguments.length>1&&void 0!==arguments[1])||arguments[1]),this.modelViewMatrix.copy(e.modelViewMatrix),this.normalMatrix.copy(e.normalMatrix),this.drawMode=e.drawMode,this.renderOrder=e.renderOrder,this.zDepth=e.zDepth,this}getDrawUniforms(){return{}}}const gd=fd;var vd;!function(e){e.render="render",e.prerender="prerender",e.state="state"}(vd||(vd={}));const yd=class{get renderTarget(){return this._renderTarget}set renderTarget(e){var t;null===(t=this._renderTarget)||void 0===t||t.dispose(),this._renderTarget=e}constructor(e,t={}){this.enabled=!0,this.clear=!1,this.clearColor=new hl(0,0,0,0),this.enableBlend=!1,this.fullscreen=!1,this.offscreen=!1,this.prerender=!1,this.shouldUpdateViewport=!0,this.phase=vd.render,this.needsSwap=!0,this._enableBlendAfterRender=!1,this.context=e,this.drawContext=t}setSize(e,t){}configureRenderTarget(e){var t;this.offscreen=!0,null===(t=this._renderTarget)||void 0===t||t.dispose();const i=this.context,r=i.gl;this._renderTarget=i.createFramebuffer(Object.assign({size:{width:i.resolution.width,height:i.resolution.height},minFilter:r.NEAREST,magFilter:r.NEAREST,format:r.RGBA},e)),i.on("resize",(e=>{let{width:t,height:i}=e;var r;null===(r=this.renderTarget)||void 0===r||r.resize(t,i)}))}draw(e){throw new Error("[MapsGL] Pass subclass must implement render()")}render(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var i,r;const a=Object.assign(Object.assign({},this.drawContext),e),{scene:s}=a;s&&(a.scene=s),null===(i=a.configurator)||void 0===i||i.prepareDrawPass(this,a);const n=null===(r=a.configurator)||void 0===r?void 0:r.stateForDrawPass(this,a);a.state=Object.assign(Object.assign(Object.assign({},this.drawContext.state),t),n),this.beforeRender(a),this.draw(a),this.afterRender(a)}beforeRender(e){var t;const i=this.context,r=null===(t=e.state.gl)||void 0===t?void 0:t.blendingEnabled;if(this._previousRenderTarget=i.state.opts.framebuffer,this.renderTarget){const e=this.renderTarget;this.renderTarget.bind(),i.state.setViewport(e.viewport.z,e.viewport.w)}else if(this.shouldUpdateViewport){const e=this.context.resolution;i.state.setViewport(e.width,e.height)}i.state.setBlendEnabled(this.enableBlend),this.clear&&(i.state.setClearColor(this.clearColor),i.state.clear(!0,!1,!1)),this._enableBlendAfterRender=r}afterRender(e){var t;null===(t=this.renderTarget)||void 0===t||t.unbind(),this.context.state.setBlendEnabled(!0)}dispose(){this.program&&!this.context.cache.hasProgram(this.program)&&this.program.dispose()}};class xd{constructor(){this.scale={x:1,y:1,z:1},this.offset={x:0,y:0,z:0},this.uvOffset=[0,0,1,1],this.partialScale=1}static fromTileRenderable(e,t){let i=e.offset.toObject(),r=e.scale.toObject();if(t){const a=t.scale,s=t.offset;i={x:(e.offset.x-s.x)*a.x,y:(e.offset.y-s.y)*a.y,z:0},r={x:e.scale.x*a.x,y:e.scale.y*a.y,z:1}}const a=new xd;if(a.scale=Object.assign(Object.assign({},r),{z:1}),a.offset=Object.assign(Object.assign({},i),{z:0}),a.uvOffset=[...e.uvOffset],a.partialScale=e.partialScale,e.tile.data instanceof xr){const t=e.tile.data,i=a.uvOffset,r=((e,t,i)=>{const r=1/t.width*i,a=1/t.height*i,s=1-2*r,n=1-2*a;return[Qe(e[0],0,1,r,r+s),Qe(e[1],0,1,a,a+n),Qe(e[2],0,1,0,s),Qe(e[3],0,1,0,n)]})(i,{width:t.size.width+2*t.padding,height:t.size.height+2*t.padding},t.padding||0);i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3]}return a}}const bd=xd,wd=e=>{let t="",i={};if("string"==typeof e)t=e;else{const{sourceCode:r,uniforms:a}=e;t=r,i=a}return ve(i)&&Object.keys(i).forEach((e=>{const r=new RegExp(`([^\\w\\d\\.])${i[e].variableName}([,\\.;\\)\\*\\+\\-\\/\\[=])`,"g");t=t.replace(r,`$1${e}$2`)})),t=t.replaceAll("<\n","\n<"),t=t.replaceAll(/#endif\s*}/g,"#endif\n}"),t=t.replaceAll(/#else\s*([\\w])/g,"#else\n$1"),t},_d=wd("precision mediump float;attribute vec3 position;attribute vec2 uv;uniform mat4 modelViewMatrix;uniform mat4 viewMatrix;uniform mat4 modelMatrix;uniform mat4 projectionMatrix;uniform vec4 dataCoordOffset;varying vec2 vUv;varying vec2 vRef;void main(){vUv=uv;vUv=vec2(dataCoordOffset.x+(uv.x*dataCoordOffset.z),dataCoordOffset.y+(uv.y*dataCoordOffset.w));gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"),Md=wd("precision mediump float;<\n#defines>\n<\n#includes>\nuniform sampler2D dataTexture;uniform sampler2D dataTextureNext;uniform vec2 dataResolution;uniform float dataMeld;uniform float opacity;varying vec2 vUv;varying vec2 vUvNext;void main(){vec2 pos=vUv;vec4 texel=texture2D(dataTexture,vUv);vec4 texel2=texture2D(dataTextureNext,vUv);vec4 color=mix(texel,texel2,dataMeld);color.a*=opacity;gl_FragColor=color;gl_FragColor.rgb*=gl_FragColor.a;}"),Ad={dataTexture:{value:void 0},opacity:{value:1}},Sd=wd("vec4 colorLookup(float value,float size,sampler2D ramp){float x=value;float s=1./size;x=value+0.001;return texture2D(ramp,vec2(x,0.5));}"),Td=wd("struct ValueRange{float min;float max;};float sampleColorValue(vec4 color,float channel){float value=color.r;if(channel==1.){value=color.g;}else if(channel==2.){value=color.b;}else if(channel==3.){value=color.a;}else if(channel==4.){value=(color.r+color.g)/2.;}else if(channel==5.){value=(color.g+color.b)/2.;}else if(channel==6.){value=(color.r+color.b)/2.;}else if(channel==7.){value=(color.r+color.a)/2.;}else if(channel==8.){value=(color.g+color.a)/2.;}else if(channel==9.){value=(color.b+color.a)/2.;}else if(channel==10.){value=(color.r+color.g+color.b)/3.;}else if(channel==11.){value=(color.g+color.b+color.a)/3.;}else if(channel==12.){value=(color.r+color.g+color.b+color.a)/4.;}return clamp(value,0.,1.);}float sampleDataValue(ValueRange dataRange,float p){return dataRange.min+(dataRange.max-dataRange.min)*p;}"),Ed=wd("uniform sampler2D tDataTL;uniform sampler2D tDataTC;uniform sampler2D tDataTR;uniform sampler2D tDataML;uniform sampler2D tDataMC;uniform sampler2D tDataMR;uniform sampler2D tDataBL;uniform sampler2D tDataBC;uniform sampler2D tDataBR;vec4 textureLookup(const vec2 uv){if(uv.x>1.&&uv.y>1.){return texture2D(tDataBR,uv-vec2(1.,1.));}else if(uv.x>0.&&uv.y>1.){return texture2D(tDataBC,uv-vec2(0.,1.));}else if(uv.y>1.){return texture2D(tDataBL,uv-vec2(-1.,1.));}else if(uv.x>1.&&uv.y>0.){return texture2D(tDataMR,uv-vec2(1.,0.));}else if(uv.x>0.&&uv.y>0.){return texture2D(tDataMC,uv-vec2(0.,0.));}else if(uv.y>0.){return texture2D(tDataML,uv-vec2(-1.,0.));}else if(uv.x>1.){return texture2D(tDataTR,uv-vec2(1.,-1.));}else if(uv.x>0.){return texture2D(tDataTC,uv-vec2(0.,-1.));}else{return texture2D(tDataTL,uv-vec2(-1.,-1.));}}"),Od=wd("vec4 bilinear(sampler2D tex,vec2 uv,vec2 res){vec2 px=1./res;vec2 vc=(floor(uv*res))*px;vec2 f=fract(uv*res);vec4 tl=texture2D(tex,vc);vec4 tr=texture2D(tex,vc+vec2(px.x,0));vec4 bl=texture2D(tex,vc+vec2(0,px.y));vec4 br=texture2D(tex,vc+px);vec4 tx=mix(tl,tr,f.x);vec4 bx=mix(bl,br,f.x);return mix(tx,bx,f.y);}vec4 bilinear_nodata(sampler2D tex,vec2 uv,vec2 res,float channel,float nodata){vec2 px=1./res;vec2 vc=(floor(uv*res))*px;vec2 f=fract(uv*res);vec4 tl=texture2D(tex,vc);vec4 tr=texture2D(tex,vc+vec2(px.x,0));vec4 bl=texture2D(tex,vc+vec2(0,px.y));vec4 br=texture2D(tex,vc+px);if(tr.r==nodata)tr=tl;if(bl.r==nodata)bl=tl;if(br.r==nodata)br=tl;vec4 tx=mix(tl,tr,f.x);vec4 bx=mix(bl,br,f.x);return mix(tx,bx,f.y);}"),Cd=wd("const vec4 BS_A=vec4(3.,-6.,0.,4.)/6.;const vec4 BS_B=vec4(-1.,6.,-12.,8.)/6.;const vec4 RE_A=vec4(21.,-36.,0.,16.)/18.;const vec4 RE_B=vec4(-7.,36.,-60.,32.)/18.;const vec4 CR_A=vec4(3.,-5.,0.,2.)/2.;const vec4 CR_B=vec4(-1.,5.,-8.,4.)/2.;const vec4 CA=BS_A;const vec4 CB=BS_B;vec4 powers(float x){return vec4(x*x*x,x*x,x,1.);}vec4 spline(float x,vec4 c0,vec4 c1,vec4 c2,vec4 c3){return c0*dot(CB,powers(x+1.))+c1*dot(CA,powers(x))+c2*dot(CA,powers(1.-x))+c3*dot(CB,powers(2.-x));}vec4 SAM2(sampler2D tex,int a,int b,vec2 res,vec2 i){return texture2D(tex,(i+vec2(a,b)+0.5)/res);}vec4 bicubic(sampler2D tex,vec2 uv,vec2 res){vec2 tuv=uv*res-0.5;vec2 f=fract(tuv);vec2 i=floor(tuv);vec4 s[16];for(int y=-1;y<=2;y++){for(int x=-1;x<=2;x++){s[(y+1)*4+(x+1)]=SAM2(tex,x,y,res,i);}}vec4 rows[4];for(int y=0;y<4;y++){rows[y]=spline(f.x,s[y*4],s[y*4+1],s[y*4+2],s[y*4+3]);}return spline(f.y,rows[0],rows[1],rows[2],rows[3]);}vec4 bicubic_nodata(sampler2D tex,vec2 uv,vec2 res,float channel,float nodata){vec2 tuv=uv*res-0.5;vec2 f=fract(tuv);vec2 i=floor(tuv);vec4 s[16];for(int y=-1;y<=2;y++){for(int x=-1;x<=2;x++){s[(y+1)*4+(x+1)]=SAM2(tex,x,y,res,i);}}vec4 c=s[5];if(c.r==nodata){vec4 neighbors[8];neighbors[0]=s[1];neighbors[1]=s[4];neighbors[2]=s[6];neighbors[3]=s[9];neighbors[4]=s[0];neighbors[5]=s[2];neighbors[6]=s[8];neighbors[7]=s[10];for(int i=0;i<8;i++){if(neighbors[i].r!=nodata){c=neighbors[i];break;}}}for(int k=0;k<16;k++){if(s[k].r==nodata){s[k]=c;}}for(int x=0;x<4;x++){if(s[12+x].r==nodata){s[12+x]=s[8+x];}}vec4 rows[4];for(int y=0;y<4;y++){rows[y]=spline(f.x,s[y*4],s[y*4+1],s[y*4+2],s[y*4+3]);}return spline(f.y,rows[0],rows[1],rows[2],rows[3]);}"),Rd=wd("vec4 biquadratic(sampler2D tex,vec2 uv,vec2 res){float texSize=max(res.x,res.y);vec2 p=uv;\n#if 0\np=p*texSize;vec2 i=floor(p);vec2 f=fract(p);p=i+f*0.5;p=p/texSize;float w=0.5/texSize;return mix(mix(texture2D(tex,p+vec2(0,0)),texture2D(tex,p+vec2(w,0)),f.x),mix(texture2D(tex,p+vec2(0,w)),texture2D(tex,p+vec2(w,w)),f.x),f.y);\n#else\nvec2 f=fract(p*texSize);vec2 c=(f*(f-1.)+0.5)/texSize;vec2 w0=p-c;vec2 w1=p+c;return(texture2D(tex,vec2(w0.x,w0.y))+texture2D(tex,vec2(w0.x,w1.y))+texture2D(tex,vec2(w1.x,w1.y))+texture2D(tex,vec2(w1.x,w0.y)))/4.;\n#endif    \n}"),Pd=wd("#include <operators>\n#include <sample_color_value>\nfloat isEdge(sampler2D tex,vec2 uv,vec2 res,float nodata,float channel){vec2 px=1./res;vec2 vc=floor(uv*res)*px;float a=0.;vec2 offsets[4];offsets[0]=vec2(0.,-px.y);offsets[1]=vec2(0.,px.y);offsets[2]=vec2(-px.x,0.);offsets[3]=vec2(px.x,0.);for(int i=0;i<4;i++){vec4 s=texture2D(tex,vc+offsets[i]);a+=float(sampleColorValue(s,channel)==nodata);}return float(a>0.&&a<4.);}\n#include <interpolate_bilinear>\n#include <interpolate_bicubic>\n#include <interpolate_biquadratic>\nvec4 interpolatedTexel(int type,sampler2D tex,vec2 uv,vec2 res){if(type==1)return bilinear(tex,uv,res);else if(type==2)return bicubic(tex,uv,res);else if(type==3)return biquadratic(tex,uv,res);return texture2D(tex,uv);}vec4 interpolatedNoDataTexel(int type,sampler2D tex,vec2 uv,vec2 res,float nodata){if(type==1)return bilinear_nodata(tex,uv,res,0.,nodata);else if(type==2)return bicubic_nodata(tex,uv,res,0.,nodata);else if(type==3)return biquadratic(tex,uv,res);return texture2D(tex,uv);}vec4 interpolatedScaledTexel(int type,sampler2D tex,vec2 uv,vec2 res,float scale){return interpolatedTexel(type,tex,uv,res*scale);}vec4 interpolatedScaledNoDataTexel(int type,sampler2D tex,vec2 uv,vec2 res,float scale,float nodata){return interpolatedNoDataTexel(type,tex,uv,res*scale,nodata);}"),kd=wd("vec4 encodeFloatRGBA(highp float val){if(val==0.){return vec4(0.,0.,0.,0.);}float mag=abs(val);float exponent=floor(log2(mag));exponent+=float(exp2(exponent)<=mag/2.);exponent-=float(exp2(exponent)>mag);float mantissa;if(exponent>100.){mantissa=mag/1024./exp2(exponent-10.)-1.;}else{mantissa=mag/float(exp2(exponent))-1.;}float a=exponent+127.;mantissa*=256.;float b=floor(mantissa);mantissa-=b;mantissa*=256.;float c=floor(mantissa);mantissa-=c;mantissa*=128.;float d=floor(mantissa)*2.+float(val<0.);return vec4(a,b,c,d)/255.;}"),Dd=wd("highp float decodeFloatRGBA(vec4 v){float a=floor(v.r*255.+0.5);float b=floor(v.g*255.+0.5);float c=floor(v.b*255.+0.5);float d=floor(v.a*255.+0.5);float exponent=a-127.;float sign=1.-mod(d,2.)*2.;float mantissa=float(a>0.)+b/256.+c/65536.+floor(d/2.)/8388608.;return sign*mantissa*exp2(exponent);}"),zd=wd("vec2 unpack_float(const float value){int packedIntValue=int(value);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec4 decode_color(const vec2 value){return vec4(unpack_float(value[0])/255.,unpack_float(value[1])/255.);}"),Id=wd("mat3 scale(vec2 v){return mat3(1./v.x,0.,0.,0.,1./v.y,0.,0.,0.,1.);}mat3 translate(vec2 v){return mat3(1.,0.,v.x,0.,1.,v.y,0.,0.,1.);}vec2 rotate(vec2 v,float a){float s=sin(a);float c=cos(a);mat2 m=mat2(c,-s,s,c);return m*v;}vec3 rotateX(vec3 v,float angle){float s=sin(angle);float c=cos(angle);mat3 m=mat3(1.,0.,0.,0.,c,s,0.,-s,c);return m*v;}"),Fd=wd("vec4 stroked(float dist,float linewidth,float antialias,vec4 stroke){float t=linewidth/2.-antialias;float sdist=dist;float borderDist=abs(sdist)-t;float alpha=borderDist/antialias;alpha=exp(-alpha*alpha);if(borderDist<0.){return stroke;}return vec4(stroke.rgb,stroke.a*alpha);}vec4 filled(float dist,float linewidth,float antialias,vec4 fill){float t=linewidth/2.-antialias;float sdist=dist;float borderDist=abs(sdist)-t;float alpha=borderDist/antialias;alpha=exp(-alpha*alpha);if(borderDist<0.){return fill;}else if(sdist<0.){return fill;}return vec4(0.);}vec4 outline(float dist,float linewidth,float antialias,vec4 fill,vec4 stroke){float t=linewidth/2.-antialias;float sdist=dist;float borderDist=abs(sdist)-t;float alpha=borderDist/antialias;alpha=exp(-alpha*alpha);if(borderDist<0.){return stroke;}else if(sdist<0.){return mix(fill,stroke,sqrt(alpha));}return vec4(stroke.rgb,stroke.a*alpha);}float disc(vec2 pos,float size){return length(pos)-size/2.;}"),Ld=wd("float line_distance(vec2 p,vec2 p1,vec2 p2){vec2 center=(p1+p2)*0.5;float len=length(p2-p1);vec2 dir=(p2-p1)/len;vec2 rel_p=p-center;return dot(rel_p,vec2(dir.y,-dir.x));}float segment_distance(vec2 p,vec2 p1,vec2 p2){vec2 center=(p1+p2)*0.5;float len=length(p2-p1);vec2 dir=(p2-p1)/len;vec2 rel_p=p-center;float dist1=abs(dot(rel_p,vec2(dir.y,-dir.x)));float dist2=abs(dot(rel_p,dir))-0.5*len;return max(dist1,dist2);}float arrow_stealth(vec2 texcoord,float body,float head,float height,float linewidth,float antialias){vec2 start=vec2(0.,0.);vec2 end=vec2(body-0.005,0.);float d1=line_distance(texcoord,end-head*vec2(1.,-height),end);float d2=line_distance(texcoord,end-head*vec2(1.,-height),end-vec2(3.*head/4.,0.));float d3=line_distance(texcoord,end-head*vec2(1.,height),end);float d4=line_distance(texcoord,end-head*vec2(1.,height),end-vec2(3.*head/4.,0.));float d5=segment_distance(texcoord,start,end-vec2(linewidth,0.));return min(d5,max(max(-d1,d3),-max(-d2,d4)));}float arrow_triangle(vec2 texcoord,float body,float head,float height,float linewidth,float antialias){vec2 start=-vec2(body/2.,0.);vec2 end=vec2(body/2.,0.);float d1=line_distance(texcoord,end,end-head*vec2(1.,-height));float d2=line_distance(texcoord,end-head*vec2(1.,height),end);float d3=texcoord.x-end.x+head;float d4=segment_distance(texcoord,start,end-vec2(linewidth,0.));float d=min(max(max(d1,d2),-d3),d4);return d;}float arrow_triangle_30(vec2 texcoord,float body,float head,float height,float linewidth,float antialias){return arrow_triangle(texcoord,body,head,0.25,linewidth,antialias);}float arrow_triangle_60(vec2 texcoord,float body,float head,float height,float linewidth,float antialias){return arrow_triangle(texcoord,body,head,0.5,linewidth,antialias);}float arrow_triangle_90(vec2 texcoord,float body,float head,float height,float linewidth,float antialias){return arrow_triangle(texcoord,body,head,1.,linewidth,antialias);}float arrow_angle(vec2 texcoord,float body,float head,float height,float linewidth,float antialias){float d;float w=linewidth/2.+antialias;vec2 start=-vec2(body/2.,0.);vec2 end=vec2(body/2.,0.);if(texcoord.x>body/2.){float d1=line_distance(texcoord,end,end-head*vec2(1.,-height));float d2=line_distance(texcoord,end-head*vec2(1.,height),end);float d3=end.x-texcoord.x;d=max(max(d1,d2),d3);}else{float d1=segment_distance(texcoord,end-head*vec2(1.,-height),end);float d2=segment_distance(texcoord,end-head*vec2(1.,height),end);float d3=segment_distance(texcoord,start,end-vec2(linewidth,0.));d=min(min(d1,d2),d3);}return d;}float arrow_angle_30(vec2 texcoord,float body,float head,float height,float linewidth,float antialias){return arrow_angle(texcoord,body,head,0.25,linewidth,antialias);}float arrow_angle_60(vec2 texcoord,float body,float head,float height,float linewidth,float antialias){return arrow_angle(texcoord,body,head,0.5,linewidth,antialias);}float arrow_angle_90(vec2 texcoord,float body,float head,float height,float linewidth,float antialias){return arrow_angle(texcoord,body,head,1.,linewidth,antialias);}"),jd=wd("float eval(float value,float range){float interval=1.;float factor=range/interval;return factor*value;}float distance_estimation(float val,float len,float px,float thickness){float de=abs(val)/len;float eps=px;return smoothstep((thickness-1.)*eps,thickness*eps,de);}float isoline(float val,float len,float ref,float pas,float thickness){float v=abs(mod(val-ref+pas*.5,pas)-pas*.5)/len-.2*thickness;return smoothstep(.2,.8,v);}float isoline2(float val,float len,float px,float thickness){return 1.-distance_estimation(val,len,px,thickness);}float delta(float v,float fallback){return 2.*length(vec2(dFdx(v),dFdy(v)));}float isoline3(float val,float scale,float thickness,float fallback){float deltaVal=delta(val,fallback);float scaledVal=mod(val,scale);float finalVal=abs(scaledVal)/max(deltaVal,0.001)-thickness;return 1.-smoothstep(0.1,0.9,finalVal);}"),Nd=wd("vec2 hash(vec2 p){p=vec2(dot(p,vec2(127.1,311.7)),dot(p,vec2(269.5,183.3)));return-1.+2.*fract(sin(p)*43758.5453123);}float noise(in vec2 p){const float K1=0.366025404;const float K2=0.211324865;vec2 i=floor(p+(p.x+p.y)*K1);vec2 a=p-i+(i.x+i.y)*K2;vec2 o=(a.x>a.y)?vec2(1.,0.):vec2(0.,1.);vec2 b=a-o+K2;vec2 c=a-1.+2.*K2;vec3 h=max(0.5-vec3(dot(a,a),dot(b,b),dot(c,c)),0.);vec3 n=h*h*h*h*vec3(dot(a,hash(i+0.)),dot(b,hash(i+o)),dot(c,hash(i+1.)));return dot(n,vec3(70.));}float fbm(vec2 uv){float f;mat2 m=mat2(1.6,1.2,-1.2,1.6);f=0.5000*noise(uv);uv=m*uv;f+=0.2500*noise(uv);uv=m*uv;f+=0.1250*noise(uv);uv=m*uv;f+=0.0625*noise(uv);uv=m*uv;f=0.5+0.5*f;return f;}"),Ud=wd("vec4 projectPosition(vec4 position){vec4 worldPosition=modelMatrix*position;return projectionMatrix*viewMatrix*worldPosition;}vec2 projectPixelSizeToClipspace(vec2 pixels){vec2 offset=((pixels/viewportSize)*dpr)*2.;return offset;}vec2 projectPixelSize(vec2 pixels){return pixels*pixelToUnit;}"),Vd=wd("vec4 op_when_eq(vec4 x,vec4 y){return 1.-abs(sign(x-y));}float op_when_eq_f(float x,float y){return 1.-abs(sign(x-y));}vec4 op_when_neq(vec4 x,vec4 y){return abs(sign(x-y));}float op_when_neq_f(float x,float y){return abs(sign(x-y));}vec4 op_when_gt(vec4 x,vec4 y){return max(sign(x-y),0.);}float op_when_gt_f(float x,float y){return max(sign(x-y),0.);}vec4 op_when_lt(vec4 x,vec4 y){return max(sign(y-x),0.);}vec4 op_when_ge(vec4 x,vec4 y){return 1.-op_when_lt(x,y);}vec4 op_when_le(vec4 x,vec4 y){return 1.-op_when_gt(x,y);}vec4 op_and(vec4 a,vec4 b){return a*b;}vec4 op_not(vec4 a){return 1.-a;}"),Bd=wd("float scale=1.-(0.8*smoothing);vec4 texel1;vec4 texel2;\n#ifdef NODATA\ntexel1=interpolatedScaledNoDataTexel(interpolation,dataTexture,tuv,dataResolution,scale,noData);texel2=interpolatedScaledNoDataTexel(interpolation,dataTextureNext,tuv2,dataResolution,scale,noData);\n#else\ntexel1=interpolatedScaledTexel(interpolation,dataTexture,tuv,dataResolution,scale);texel2=interpolatedScaledTexel(interpolation,dataTextureNext,tuv2,dataResolution,scale);\n#endif\nvec4 texel=mix(texel1,texel2,dataMeld);"),$d=wd("#ifdef NODATA\nvec4 tex=texture2D(dataTexture,tuv);float dd=sampleColorValue(tex,dataChannel[0]);if(dd==noData)discard;\n#endif\n"),qd=wd("float value;vec2 velocity=vec2(0.);float angle=0.;\n#ifdef EXPRESSION_VECTOR\nfloat valueU=sampleColorValue(texel,dataChannel[0]);float valueV=sampleColorValue(texel,dataChannel[1]);vec2 vector=vec2(valueU,valueV);velocity=mix(vec2(dataRange.x),vec2(dataRange.y),vector);value=length(velocity)/dataRange.y;\n#ifdef IS_SYMBOL\nangle=atan(velocity.x,velocity.y);\n#else\nangle=atan(velocity.x,-velocity.y);\n#endif\nangle-=PI/2.;if(angle<0.)angle+=PI*2.;\n#else\n#ifdef EXPRESSION_ANGLE  \nfloat deg=sampleColorValue(texel,dataChannel[0])*360.-180.;if(deg<0.)deg+=360.;float rad=deg*(PI/180.);float valueU=sin(rad);float valueV=cos(rad);vec2 vector=vec2(valueU,valueV);velocity=vector;value=0.1;\n#ifdef IS_SYMBOL\nangle=atan(velocity.x,velocity.y);\n#else\nangle=atan(velocity.x,-velocity.y);\n#endif\nangle-=PI/2.;if(angle<0.)angle+=PI*2.;\n#else\nvalue=sampleColorValue(texel,dataChannel[0]);\n#endif\n#endif\n#ifdef EXPRESSION_SUM\nfloat value2=sampleColorValue(texel,dataChannel[1]);float delta=(value+value2)*colorRangeFactor;value=delta+colorSampleOffset;\n#endif\n#ifdef EXPRESSION_DIFF\nfloat value2=sampleColorValue(texel,dataChannel[1]);float delta=(value-value2)*colorRangeFactor;value=delta+colorSampleOffset;\n#endif\n#ifdef NODATA\nvec2 mapFrom=outputRange;vec2 mapTo=vec2(0.,1.);\n#endif\n"),Gd=wd("#ifdef SIZE_ATTENUATION\nfloat cameraToAnchorDistance=projectedAnchor.w;float distanceRatio=cameraToCenterDistance/cameraToAnchorDistance;highp float perspectiveRatio=clamp(0.5+0.5*distanceRatio,0.,4.);symbolScale*=perspectiveRatio;\n#endif\nvec2 glyphOffset=(glyph.xy+position.xy*glyph.zw)*symbolScale;highp float symbolRotation=0.;\n#ifdef ROTATE_WITH_MAP\nvec4 offsetProjectedAnchor=projectionMatrix*modelViewMatrix*vec4(adjustedAnchor.xy+vec2(1.,0.),0.,1.);vec2 a=projectedAnchor.xy/projectedAnchor.w;vec2 b=offsetProjectedAnchor.xy/offsetProjectedAnchor.w;float aspectRatio=resolution.x/resolution.y;aspectRatio=mix(1.,aspectRatio,PI*0.333-pitch);symbolRotation=atan((b.y-a.y)/aspectRatio,b.x-a.x)*-1.;\n#endif\nhighp float angleSin=sin(symbolAngle+symbolRotation);highp float angleCos=cos(symbolAngle+symbolRotation);mat2 rotationMatrix=mat2(angleCos,-angleSin,angleSin,angleCos);highp vec4 projectedPosition=labelPlaneMatrix*projectedAnchor;float z=0.;vec3 pointPosition=vec3(glyphOffset,0.);pointPosition.xy*=rotationMatrix;\n#ifdef PITCH_WITH_MAP\nz=projectedAnchor.z/projectedAnchor.w;pointPosition=rotateX(pointPosition,pitch);\n#endif\nvec4 finalPosition=glCoordMatrix*vec4((projectedPosition.xy/projectedPosition.w+pointPosition.xy),z,1.);gl_Position=finalPosition;"),Hd=class extends yd{constructor(e,t){super(e),this._tileCache=t,this.program=e.cache.getProgram("draw-raster",[],(()=>new ed(this.context,{vertexShader:_d,fragmentShader:Md,uniforms:Object.assign({},Ad),includes:a}))),this.mesh=new gd(e,e.cache.getFullscreenQuad().geometry,this.program)}draw(e){const{renderables:t,interval:i,nextInterval:r}=e.state;for(let a=0,s=t.length;a<s;a++){const s=t[a],n=s.tile;let o={current:null,next:null};if(n.data instanceof vr)n.data.updateTextures(this.context,i,r),o=n.data.textures;else if(n.data instanceof HTMLImageElement){const e=this._tileCache.textures.get(n.coord.hash);o.current=null==e?void 0:e.texture}this.canDrawTile(n)&&this.drawTile(e,s,o)}}canDrawTile(e){var t,i;if((null==e?void 0:e.data)instanceof vr)return he(null===(i=null===(t=e.data)||void 0===t?void 0:t.textures.current)||void 0===i?void 0:i.image);if((null==e?void 0:e.data)instanceof HTMLImageElement){const t=this._tileCache.textures.get(e.coord.hash);return he(null==t?void 0:t.texture)}return!1}drawTile(e,t,i){var r;const a=this.context,{region:s}=(null===(r=e.configurator)||void 0===r?void 0:r.stateForDrawPass(this,e))||{},n=this.mesh,o=n.program,l=e.renderTarget?a.cache.getFullscreenQuad().camera:void 0,h=bd.fromTileRenderable(t,l?s:void 0),c=h.scale,d=h.offset,u=h.uvOffset,p=a.resolution,m=i.current,f=i.next;o.setUniform("resolution",new eh(p.width,p.height)),o.setUniform("dataResolution",new eh(m.size.width,m.size.height)),o.setUniform("dataTextureCoordOffset",(new al).fromArray(u)),o.setUniform("dataCoordOffset",(new al).fromArray(u)),o.setUniform("dataTexture",m),o.setUniform("dataTextureNext",f),n.scale.set(c.x,c.y,1),n.position.set(d.x,d.y,0),e.scene&&!e.renderTarget?e.scene.render(n,l):(n.updateMatrixWorld(),n.draw({camera:l}))}dispose(){super.dispose(),this.context.cache.hasProgram(this.mesh.program)||this.mesh.program.dispose()}},Wd={autoResize:!0},Yd=class extends yd{constructor(e,t,i=Wd){super(e),this._passes=[],this.id="save",this._passes=t,t.forEach((e=>{e.prerender=!0}));const r=e.gl,a=new ac(e,Object.assign({size:e.resolution,minFilter:r.LINEAR,magFilter:r.LINEAR,format:r.RGBA},i));a.name="SavePass.rt",i.autoResize&&e.on("resize",(e=>{let{width:t,height:i}=e;a.resize(t,i)})),this.renderTarget=a,this.needsSwap=!1}setSize(e,t){this.renderTarget.resize(e,t)}getPass(e){let t;return this._passes.forEach((i=>{i.id===e&&(t=i)})),t}enablePass(e,t){const i=this.getPass(e);i&&(i.enabled=t)}draw(e){const t=this.context,i=this._passes.filter((e=>e.enabled)),r=this.renderTarget;for(let a=0;a<i.length;a++){const s=i[a];s.shouldUpdateViewport=!1,s.renderTarget||(r.bind(),t.state.setViewport(r.viewport.z,r.viewport.w)),s.render(e)}r.unbind()}dispose(){var e;super.dispose(),null===(e=this.renderTarget)||void 0===e||e.dispose()}},Zd=wd("precision mediump float;<\n#defines>\n<\n#includes>\nattribute vec3 position;attribute vec2 uv;attribute vec3 normal;varying vec2 vUv;void main(){vUv=uv;gl_Position=vec4(position.xy*2.-1.,position.z,1.);}"),Xd=wd("precision mediump float;<\n#defines>\n<\n#includes>\nuniform sampler2D tOutput;uniform sampler2D tMask;uniform float opacity;varying vec2 vUv;void main(){vec4 color=texture2D(tOutput,vUv);\n#ifdef USE_MASK\nfloat alpha=1.;vec4 mask=texture2D(tMask,vUv);alpha=mask.r;\n#ifdef INVERT_MASK\nalpha=clamp(1.-alpha,0.,1.);\n#endif\n#ifdef DEBUG_MASK\ncolor=vec4(vec3(alpha),1.);\n#else\nif(alpha<1.||color.a==0.)discard;\n#endif\n#endif\n#ifdef PREMULTIPLIED_ALPHA\nvec4 preMultipliedColor=vec4(color.rgb*color.a,color.a);color=premultipliedAlpha;\n#endif\ngl_FragColor=color*opacity;}"),Qd={opacity:{value:1}},Kd=class extends yd{get renderTarget(){if(this.fbo&&this.offscreen)return this.fbo.write}constructor(e,t,i={}){super(e,i),this.textureId="dataTexture",this.needsSwap=!1,this.program=t||new ed(e,{vertexShader:Zd,fragmentShader:Xd,defines:[],includes:a,uniforms:Object.assign(Object.assign({},Qd),{tMask:{value:void 0}})}),this.mesh=new gd(e,e.cache.getFullscreenQuad().geometry,this.program)}draw(e){const t=this.program,i=this.mesh,r=this.fbo?this.fbo.read.texture:this.texture,a=e.renderTarget||this.fullscreen?this.context.cache.getFullscreenQuad().camera:e.camera;r?(t.setUniform(this.textureId,r),t.setUniform("dataResolution",new eh(r.size.width,r.size.height)),e.scene&&!this.fullscreen?e.scene.render(i,a):i.draw({camera:a}),this.needsSwap&&this.fbo.swap()):console.warn(`[MapsGL] No texture resource provided for TexturePass with textureId '${this.textureId}' in draw pass '${this.id}'`)}dispose(){super.dispose(),this.texture=void 0,this.fbo=void 0}},Jd=class extends Kd{constructor(e,t={},i={}){const r=["USE_MASK"];t.invert&&r.push("INVERT_MASK"),t.debug&&r.push("DEBUG_MASK"),super(e,new ed(e,{vertexShader:Zd,fragmentShader:Xd,defines:r,includes:a,uniforms:Object.assign(Object.assign({},Qd),{tMask:{value:void 0}})}),i),this.id="mask"}draw(e){this.program.setUniform("tMask",this.mask),super.draw(e)}},eu=class extends Cc{prepareDrawPasses(){var e;const t=new Hd(this.context,this.layer.source.tiles);if(t.id="draw-tiles",t.enableBlend=!0,this.layer.mask){const i=new Yd(this.context,[t]);i.clear=!0,i.prerender=!0,this.passes.addPass(i);const r=new Jd(this.context,{invert:this.layer.mask.inverted});r.enableBlend=!0,r.fullscreen=!0,r.texture=null===(e=i.renderTarget)||void 0===e?void 0:e.texture,r.textureId="tOutput",this.passes.addPass(r)}else this.passes.addPass(t)}stateForDrawPass(e,t){var i;const r=super.stateForDrawPass(e,t),a=this.renderState.renderables;if("mask"===e.id&&e instanceof Jd){const t=this.layer.mask;e.mask=t?null===(i=null==t?void 0:t.layer.renderer.renderTarget)||void 0===i?void 0:i.texture:new lo(this.context)}return Object.assign(Object.assign({},r),{renderables:a})}prepareDrawPass(e,t){if(e instanceof Hd){const t=e.program;t.setUniform("opacity",this.paint.rasterOpacity()),t.setUniform("dataMeld",this.paint.rasterMeld()?this.progress:0)}}};class tu{constructor(e,t){this.target=e,this.tile=t}static fromTile(e){return new tu(e.coord,e)}static fromAncestor(e,t){return new tu(e,t)}static fromDescendant(e,t){return new tu(e,t)}}const iu=tu,ru=class{get source(){return this.layer.source}get tiles(){return this.layer.source.tiles}get keys(){return this.tiles.keys}constructor(e,t={}){if(!e)throw new Error("[Aeris] `layer` parameter is invalid.");this.layer=e}has(e){return this.source.hasTile(e,this.layer.id)}get(e){return this.tiles.get(e)}clear(){this.tiles.clear()}getAncestor(e,t){const i=e.getAncestor(t);return this.get(i)}getDescendants(e,t){const i=e.getDescendants(t);let r=!1;for(let e=0,t=i.length;e<t;e++)if(this.has(i[e])){r=!0;break}if(r){const e=Array.from({length:i.length});for(let t=0,r=i.length;t<r;t++){const r=i[t];e[t]=this.get(r)||r}return e}}forEach(e){this.tiles.forEach((t=>e(t)))}isPending(e){return this.tiles.isPending(e)}filterTiles(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=e.map((e=>({coord:e,ncoord:e.normalize()})));return i=(e=>{const t=new Map;return e.filter((e=>{const i=e.ncoord.hash;return!t.has(i)&&t.set(i,!0)}))})(i),t&&(i=((e,t)=>t.filter((t=>!e.has(t.ncoord)&&!e.isPending(t.ncoord))))(this,i)),xe(this.source.bounds)&&(i=((e,t)=>t.filter((t=>{const i=Vn(t.ncoord);return!(i.east<e.west||i.west>e.east||i.south>e.north||i.north<e.south)})))(this.source.bounds,i)),i=((e,t)=>(t.sort(((t,i)=>{const r=t.coord.getCenter(),a=i.coord.getCenter(),s=e.x-r.x,n=e.y-r.y,o=e.x-a.x,l=e.y-a.y;return s*s+n*n-(o*o+l*l)})),t))(this.layer.viewport.getCenter(),i),i.length<e.length&&this.layer.setNeedsUpdate(),i.map((e=>e.ncoord))}requestTiles(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{reload:i=!1}=t,r=this.filterTiles(e,!0!==i).map((e=>({coord:e,ncoord:e.normalize()}))).map((e=>e.ncoord)).map((e=>this.source.requestTile(e,t)));return Promise.all(r).then((()=>{}))}getAvailableLOD(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.POSITIVE_INFINITY;const i=e.normalize(),r=this.get(i);if(null==r?void 0:r.data)return[iu.fromTile(r)];const a=i.z,s=[];this.tiles.levels.forEach(((e,t)=>{t!==a&&s.push(t)})),s.sort(((e,t)=>(e>a?e-a:a-e-.5)-(t>a?t-a:a-t-.5)));const n=[],o=[];let l=i,h=s.shift();for(;void 0!==l&&void 0!==h;){if(h<l.z){const i=this.getAncestor(l,l.z-h);if((null==i?void 0:i.data)&&h<=t){n.push(iu.fromAncestor(e,i)),l=o.shift();continue}}else if(h-a<4){const t=this.getDescendants(l,h-l.z);if(t){for(let i=0;i<t.length;i++){const r=t[i];r instanceof Kn?n.push(iu.fromDescendant(e,r)):r instanceof Xn&&o.push(r)}l=o.shift()}}h=s.shift()}return n.length>0?n:void 0}},au={[ki.exact]:1,[ki.high]:.75,[ki.medium]:.5,[ki.low]:.25};class su extends qh{get quality(){return this.dataQuality}set quality(e){e!==this.quality&&(this.dataQuality=e,this.map&&this.requestVisibleTiles())}constructor(e,t){var i,{quality:r=ki.exact}=t,a=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(i[r[a]]=e[r[a]])}return i}(t,["quality"]);super(e,a),i=this,this.zoomOffset=0,this.dataQuality=ki.exact,this.upgradeDataQuality=!1,this._refresh=Ni((function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&i.source.expireAllTiles(),i.requestVisibleTiles(!0)}),100),this.onDataStale=()=>{this.requestVisibleTiles(!0)},this.onDataChange=()=>{this.setNeedsUpdate()},this.onTileLoad=e=>{this.trigger(Rh,{tile:e.tile}),this.setNeedsUpdate()},this.onTileError=e=>{this.trigger("tile:error",{tile:e.tile})},this.onLoadStart=e=>{this.trigger("load:start")},this.onLoadComplete=e=>{this.trigger("load:complete")},this.addSourceEventHandler(vs,this.onDataChange),this.addSourceEventHandler(ys,this.onDataStale),this.addSourceEventHandler(Ms,this.onLoadStart),this.addSourceEventHandler(As,this.onLoadComplete),this.addSourceEventHandler(xs,this.onTileLoad),this.addSourceEventHandler(_s,this.onTileError),this.pyramid=new ru(this),this.dataQuality=r,this.zoomOffset=he(a.zoomOffset)?a.zoomOffset:0}refresh(){this._refresh(arguments.length>0&&void 0!==arguments[0]&&arguments[0])}refreshPromise(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this.source.expireAllTiles(),this.requestVisibleTiles(!0)}getDataZoom(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.map.getZoom(),t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=e+this.zoomOffset-(1/this.map.transform.worldSizeScale-1),r=Math.min(Math.floor(i),22);let a=this.dataQuality;a===ki.normal?a=ki.medium:a===ki.minimal&&(a=ki.low);const s=Math.floor(i*au[a]*(t?.5:1));return a===ki.exact?Math.max(Math.min(this.source.maxZoom,r),this.source.minZoom):Math.max(Math.min(this.source.maxZoom,s),this.source.minZoom)}preloadWorldTile(){const e=()=>{const e=this.viewport.getVisibleTileCoords(0,!0);this.requestTiles(e,!1)};this.source.metadata.hasLoaded?e():this.addSourceEventHandler(fs,(()=>{e()}))}getTile(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getDataZoom(),i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r={lat:e.lat,lon:(a=e.lon,(a%360+360+180)%360-180)};var a;if(this.source instanceof vo){const a=$n(e,t);let s=new Xn(a.z,a.x,a.y),n=this.source.tiles.get(s.normalize());if(!n&&this.renderer instanceof Cc&&i){const e=this.renderer.getRenderablesForTile(s);for(let t=0;t<e.length;t++){const i=e[t],a=i.tile.coord,o=Vn({x:a.x,y:a.y,z:a.z});Wn(r,o)&&(s=i.tile.coord,n=this.source.tiles.get(s.normalize()))}}const o=s.normalize();if(n&&n.data){const e=Bn({x:o.x,y:o.y,z:o.z}),t=Bn({x:o.x+1,y:o.y+1,z:o.z}),i=Gn(r);return{tile:n,position:{x:(i.x-e.x)/(t.x-e.x),y:(i.y-e.y)/(t.y-e.y)}}}}}getVisibleTileCoords(){const e=this.viewport.getVisibleTileCoords(this.getDataZoom());return this.pyramid.filterTiles(e,!1)}requestVisibleTiles(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.visible)return;const t=this.getDataZoom(),i=this.viewport.getVisibleTileBounds(t);return this.source.getMetadata().then((()=>{const r=this.source;if(le(this.viewport))return;if(t<r.minZoom||t>r.maxZoom)return this.requestVisibleTiles(e);const a=!this.tileBounds||!1===this.tileBounds.equals(i);if(a&&this.trigger(kh,{bounds:i}),e||a){const r=this.viewport.getVisibleTileCoords(t);return this.tileBounds=i,this.requestTiles(r,e).catch((e=>{console.error(e)}))}}))}requestTiles(e){var t;const i=null===(t=this.animator)||void 0===t?void 0:t.animation.currentDate;return this.pyramid.requestTiles(e,{intervals:this.timing.mode===br.any&&i?[i]:void 0,params:{time:i},reload:arguments.length>1&&void 0!==arguments[1]&&arguments[1]})}onAdd(e){var t;super.onAdd(e),this.onMove(),(null===(t=this.mask)||void 0===t?void 0:t.layer)instanceof su&&this.mask.layer.preloadWorldTile()}onMove(){super.onMove(),this.map&&(this.setNeedsUpdate(),this.requestVisibleTiles())}onVisible(){super.onVisible(),(!this.lastHiddenTime||Date.now()-this.lastHiddenTime>1e3)&&this.refresh()}onHidden(){super.onHidden(),this.lastHiddenTime=Date.now()}onSourceMetadata(){super.onSourceMetadata(),this.timing.mode===br.interval&&(this.source.cancelAllRequests(),this.onDataStale())}onMaskLayerChange(){var e;(null===(e=this.mask)||void 0===e?void 0:e.layer)instanceof su&&this.mask.layer.preloadWorldTile()}dispose(){var e;super.dispose(),null===(e=this.animator)||void 0===e||e.dispose()}}const nu=su,ou=class extends dt{get isLoading(){return this._loading}get hasLoaded(){return this._loaded}get isReady(){return!this.isLoading&&this.hasLoaded}get isDirty(){return this._isDirty}constructor(e){super(),this.maxIntervalsPerRequest=1,this.interleaveRequests=!0,this._isDirty=!0,this._loading=!1,this._loaded=!1,this.layer=e}setNeedsUpdate(){this._isDirty=!0}dataStateForIntervals(e){throw new Error("Subclasses of TimeSeriesDataProvider must implement `dataStateForIntervals`.")}loadData(){throw new Error("Subclasses of TimeSeriesDataProvider must implement `loadData`.")}invalidate(){this._isDirty=!1,this._loading=!1,this._loaded=!1}onLoadStart(e){this._loading=!0,this.trigger(Vi.LOAD_START,{intervals:e})}onLoadProgress(e){this.trigger(Vi.LOAD_INTERVAL,{intervals:e})}onLoadComplete(){this._loading=!1,this._loaded=!0,this.trigger(Vi.LOAD_COMPLETE)}onReady(){this._isDirty=!1,this.trigger(Vi.DATA_READY)}dispose(){}};class lu extends ht{constructor(e,t={}){super(e,t)}}const hu=class extends dt{constructor({concurrency:e=Number.POSITIVE_INFINITY,autostart:t=!1}={}){super(),this.tasks=[],this.concurrency=Number.POSITIVE_INFINITY,this.autostart=!1,this.running=!1,this.pending=0,this.index=-1,this.concurrency=e,this.autostart=t}get length(){return this.tasks.length}get isRunning(){return this.running}get currentIndex(){return this.index}get currentTask(){return this.tasks[this.currentIndex]}get last(){return this.peek()}enqueue(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.tasks.push(...t),this.autostart&&this.start(),this}dequeue(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];const r=t[0];if("number"==typeof r)return this.dequeueByIndex(r);if("function"==typeof r||!r)return this.dequeueByTask(r);throw new TypeError("Argument's type must either by number, function or undefined.")}peek(){return this.tasks.at(-1)}start(){this.running||this.run()}pause(){this.stop()}resume(){this.start()}stop(){this.running=!1}cancel(){const e=this.running;this.clear(),e&&this.trigger(new lu("cancel"))}clear(){this.stop(),this.pending=0,this.index=-1,this.tasks.splice(0)}dequeueByIndex(e){if(e>-1&&this.tasks[e]){const t=this.tasks[e];return this.tasks.splice(e,1),t}}dequeueByTask(e){const t=e?this.tasks.indexOf(e):this.length-1;return this.dequeueByIndex(t)}run(){const e=!this.running;if(this.running=!0,this.pending>=this.concurrency)return;if(0===this.length)return void(0===this.pending&&this.done());e&&this.trigger(new lu("start"));const t=this.tasks.shift(),i=(e,i)=>{this.pending-=1,this.trigger(e?new lu("error",{error:e,task:t}):new lu("task:complete",{result:i,task:t})),0===this.pending&&0===this.length?this.done():this.running&&this.run()};this.pending+=1,this.trigger(new lu("task:start",{task:t})),t().then((e=>{this.isRunning&&i(void 0,e)}),(e=>{console.error("[MapsGL] Queue task failed",e),i(e||new Error("Queue task failed"))})),this.running&&this.length>0&&this.run()}done(){this.running&&(this.running=!1,this.trigger(new lu("complete")))}},cu=class extends dt{constructor(){super(...arguments),this.queues=[],this.running=!1,this._index=-1}get length(){return this.queues.length}get isRunning(){return this.running}push(e){this.queues.push(e)}unshift(e){this.queues.unshift(e)}start(){this.running||this.run()}pause(){this.running=!1}resume(){this.start()}stop(){this.pause()}cancel(){const e=this.running;this.clear(),e&&this.trigger(new lu("cancel"))}clear(){this._index=-1,this.stop(),this.queues.forEach((e=>{e.clear()})),this.queues.splice(0)}run(){const e=!this.running;if(this.running=!0,0===this.queues.length)return void this.done();this._index+=1,e&&this.trigger(new lu("start",{index:this._index}));const t=this.queues.shift();t.on("start",this.onQueueStart,null,this),t.on("complete",this.onQueueComplete,null,this),t.on("error",this.onQueueError,null,this),t.start()}onQueueStart(e){this.trigger(new lu("queue:start",{queue:e.target,index:this._index}))}onQueueComplete(e){if(!this.running)return;const t=e.target;t.off("start",this.onQueueStart),t.off("complete",this.onQueueComplete),t.off("error",this.onQueueError),this.trigger(new lu("queue:complete",{queue:t,index:this._index})),this.next()}onQueueError(e){this.trigger(new lu("queue:error",{queue:e.target,index:this._index}))}next(){0===this.queues.length?this.done():this.running&&this.run()}done(){this.stop(),this.trigger(new lu("complete"))}},du=class extends ou{constructor(e){super(e),this._visibleTileCoords=[],this._lastIntervals=[],this.queues={primary:new hu,background:new cu},this._enqueueTileRequestIfNeeded=(e,t,i)=>{const r=this.layer.source.tileManager.pending.get(t),a=i.filter((e=>!0!==(null==r?void 0:r.has(e))));a.length>0&&e.enqueue((()=>this.layer.source.requestTile(t,{intervals:a.map((e=>new Date(e))),reload:!0,checkPending:!1,params:{time:1===i.length?Mt(i[0]):void 0}}).then((()=>{this.onLoadProgress(a.map((e=>new Date(e))))}))))},this.queues.primary.on("start",(()=>{this.onLoadStart([])})),this.queues.primary.on("complete",(()=>{this.onReady(),this.queues.background.length>0?setTimeout((()=>{this.queues.background.start()}),250):this.onLoadComplete()})),this.queues.primary.on("cancel",(()=>{this.onReady()})),this.queues.background.on("complete",(()=>{this.onLoadComplete()}));const t=e.source;t.on(Ms,this.onSourceLoadStart,void 0,this),t.on(As,this.onSourceLoadComplete,void 0,this),t.on(bs,this.onSourceTileLoadStart,void 0,this),t.on(xs,this.onSourceTileLoad,void 0,this)}dataStateForIntervals(e){const t=this._visibleTileCoords,i={},r={};return t.length>0&&e.forEach((e=>{let a=!1;t.forEach((t=>{var i;const s=this.layer.source.getTileData(t);(s instanceof xr||s instanceof vr)&&!1===(null===(i=s.series)||void 0===i?void 0:i.hasDataForInterval(e))&&(a=!0,r[t.hash]||(r[t.hash]=[]),r[t.hash].push(e))})),i[e]=!a})),i}loadData(e){if(e.length!==this._lastIntervals.length&&this.setNeedsUpdate(),!this.isDirty||ye(e))return;this._updateVisibleTileCoordsState(),this._lastIntervals=[...e];const t=this._calculateMissingTileIntervals(e);if(0===t.length)return;this.trigger(Vi.DATA_REQUEST,{intervals:e}),this.invalidate(),this._isDirty=!1;const i=((e,t,i)=>{const r=[];return e.forEach((e=>{let{coord:a,intervals:s}=e;const n=t||s.length,o=[],l=Math.ceil(s.length/n);if(l>1){let e=0;for(let t=0;t<s.length;t++)o[e]||(o[e]=[]),o[e].push(s[t]),i?(e+=1,e===l&&(e=0)):o[e].length===n&&(e+=1)}else o.push([...s]);o.forEach(((e,t)=>{r[t]||(r[t]=[]),r[t].push({coord:a,intervals:e})}))})),r})(t,this.maxIntervalsPerRequest,this.interleaveRequests);if(0===i.length)return;i.shift().forEach((e=>{let{coord:t,intervals:i}=e;this._enqueueTileRequestIfNeeded(this.queues.primary,t,i)}));const r=this.interleaveRequests?(e=>{let t=e.map(((e,t)=>t));if(e.length>2){const e=(t,i)=>{if(i.length<3)return void i.forEach((e=>t.push(e)));const r=Math.floor(i.length/2);t.push(i[r]),e(t,i.slice(0,r)),e(t,i.slice(r+1))},i=[];e(i,t),t=i}return t.map((t=>e[t]))})(i):i;r.forEach((e=>{const t=new hu;e.forEach((e=>{let{coord:i,intervals:r}=e;this._enqueueTileRequestIfNeeded(t,i,r)})),this.queues.background.push(t)})),this.queues.primary.start()}invalidate(){super.invalidate(),this.queues.primary.cancel(),this.queues.background.cancel()}_updateVisibleTileCoordsState(){this._visibleTileCoords=this.layer.getVisibleTileCoords().map((e=>e.normalize())),this._visibleTileBounds=Ah.fromCoords(this._visibleTileCoords)}_calculateMissingTileIntervals(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.layer.source,i=e,r=this._visibleTileCoords,a=[];return r.forEach((s=>{const n=this.layer.source.getTileData(s);if(this._intervalTileCache||this.setupCache(1.25*r.length),this._intervalTileCache.get(s.hash),le(n))a.push({coord:s,intervals:i});else if(n instanceof xr||n instanceof vr){const e=n.series.intervalsNeedingData(i).filter((e=>!t.tileManager.pending.isPending(s,e)));e.length>0&&a.push({coord:s,intervals:e})}else a.push({coord:s,intervals:e.map((e=>e))})})),a}setupCache(e){this._intervalTileCache=new to({capacity:Math.ceil(e),onRemove:(e,t)=>{!1===this._visibleTileBounds.contains(t.coord)&&this.trigger(Vi.DATA_REMOVE,{tile:t})}})}onSourceLoadStart(){}onSourceLoadComplete(){}onSourceTileLoadStart(e){let{tile:t}=e;this._visibleTileBounds||this._updateVisibleTileCoordsState(),this._intervalTileCache||this.setupCache(1.25*this._visibleTileCoords.length),this._visibleTileBounds.contains(t.coord)&&this._intervalTileCache.set(t.coord.hash,t)}onSourceTileLoad(e){}dispose(){this.invalidate();const e=this.layer.source;e.off(Ms,this.onSourceLoadStart),e.off(As,this.onSourceLoadComplete),e.off(bs,this.onSourceTileLoadStart),e.off(xs,this.onSourceTileLoad)}},uu=class extends nu{constructor(e,t){super(e,Object.assign({quality:ki.exact,zoomOffset:0},t)),this.sourceType=t.sourceType,this.sourceLayer=t.sourceLayer,this.filter=t.filter}get metadata(){return{layerId:this.id,type:this.type,sourceLayerId:this.sourceLayer,sourceLayerType:this.sourceType,filter:this.filter,paint:this.paint}}getVisibleFeatures(){const e=this.getVisibleTileCoords().reduce(((e,t)=>{var i;const r=null===(i=this.source.getTileData(t))||void 0===i?void 0:i.stores;return r&&Object.values(r).forEach((t=>{e=[...e,...t.features]})),e}),[]);return e}queryFeatures(e,t,i){const{tile:r,position:a}=this.getTile(e,t,i)||{};if(r&&r.data instanceof fh){let e=[];const i=Object.keys(r.data.stores);for(let s=0;s<i.length;s++){const n=r.data.stores[i[s]].query(a.x,a.y,t);(null==n?void 0:n.length)>0&&(e=n)}return{value:e,nodata:!1}}}queryFeaturesPromise(e,t,i){return new Promise((r=>{r({value:this.queryFeatures(e,t,i),nodata:!1})}))}},pu=(e,t,i)=>{const r=Math.max(0,Math.min(1,(i-e)/(t-e)));return r*r*(3-2*r)},mu=(e,t,i,r)=>{if(e)return e[Math.trunc(i)%t.width+Math.trunc(r)%t.height*t.height]},fu=(e,t,i,r)=>{if(!e)return;const a=t.width,s=t.height;i-=.5,r-=.5,i=Math.max(0,i),r=Math.max(0,r);const n=Math.floor(i),o=Math.floor(r),l=i-n,h=r-o,c=n%a,d=Math.min(c+1,a-1),u=o%s,p=Math.min(u+1,s-1),m=e[u*s+c],f=e[u*s+d],g=e[p*s+c],v=e[p*s+d],y=pu(0,1,l),x=pu(0,1,h),b=be(m,f,y),w=be(g,v,y);return be(b,w,x)},gu=class{get values(){return this._values}get size(){return this._size}constructor(e){this.padding=0,this._values={},this._evaluator=e}initialize(e,t){return this._values=e||{},this._size=t,this}setValueExpression(e){this._expression=e}query(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Sr.none;const r=Object.assign({},this.size);let a=t.position||0;const s=this.values[t.current.timestamp],n=this.values[t.next.timestamp];if(le(s))return;a>0&&le(n)&&(a=0);let o=e.x*r.width;const l=e.y*r.height;let h;o<0&&(o+=r.width);const c=i===Sr.none?mu:fu,d=this._expression;if(s instanceof Float32Array==0){const e=s,t=n;if(h=Object.keys(e).reduce(((i,s)=>{if(mu(e[s],r,o,l)===Ii)i[s]=void 0;else if(i[s]=c(e[s],r,o,l),a>0&&he(t)){const e=i[s],n=c(t[s],r,o,l);i[s]=be(e,n,a)}return i}),{}),d)return d(h);le(h.value)&&(h=void 0)}else{const e=s,t=n;if(he(e)){if(h=c(e,r,o,l),a>0){const e=h,i=c(t,r,o,l);h=be(e,i,a)}h===Ii&&(h=void 0)}}return h}},vu=class{get min(){return this.range.min}get max(){return this.range.max}get delta(){return this.range.max-this.range.min}constructor(e){this.range=e}getRange(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=Math.max(this.range.min,e.min),r=Math.min(this.range.max,e.max);return t?{min:this.position(i),max:this.position(r)}:{min:i,max:r}}position(e){return(e-this.range.min)/this.delta}},yu=class{get scale(){return this._scale}get texture(){return this._texture}constructor(e){var t,i,r;this.interval=0,this.interpolate=!1,this.normalized=!1,this._getBreaks=()=>[],this._stops=[...e.stops],this.interval=null!==(t=e.interval)&&void 0!==t?t:0,this.interpolate=null===(i=e.interpolate)||void 0===i||i,this.normalized=null!==(r=e.normalized)&&void 0!==r&&r,this.range=e.range,this.normalized&&(this.range={min:0,max:1}),e.breaks&&(this._getBreaks=Array.isArray(e.breaks)?()=>e.breaks:e.breaks)}setColorStops(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._stops=[...e],this.interval=t,this.normalized=i,this._updateScale(),this._texture&&this.createLookupTexture(this._texture.context)}setValueRange(e){this.range&&this.range.min===e.min&&this.range.max===e.max||(this.range=this.normalized?{min:0,max:1}:e,this._updateScale())}createLookupTexture(e){const t=e.gl,i=this.interval,r=this._getBreaks(this.range.min,this.range.max,i),a=0===this.interval&&this.interpolate&&ye(r),s=a?t.LINEAR:t.NEAREST;this.scale||this._updateScale(),a||this.scale.setBreaks(this.scale.domain);const n=this.scale.getRamp({range:this.range,totalColors:this.interval>0?500:256,interval:i,breaks:r,interpolate:this.interpolate}).stops.map((e=>e.color)),o=new Uint8Array(4*n.length);for(let e=0,t=n.length;e<t;e++){const{r:t,g:i,b:r,a}=n[e];o[4*e+0]=t,o[4*e+1]=i,o[4*e+2]=r,o[4*e+3]=Math.round(255*a)}this._texture?(this.texture.image=o,this.texture.size={width:o.length/4,height:1},this.texture.minFilter=s,this.texture.magFilter=s,this.texture.needsUpdate=!0):this._texture=new lo(e,{image:o,size:{width:o.length/4,height:1},minFilter:s,magFilter:s})}_updateScale(){this._scale=st(this._stops,this.range,this.normalized)}_debug(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;const a=zs({width:t,height:i});a.width=t*r,a.height=i*r,a.style.width=`${t}px`,a.style.height=`${i}px`,a.style.position="absolute",a.style.bottom="5px",a.style.left="5px",a.style.zIndex="1000";const s=a.getContext("2d",{alpha:!0});s.scale(r,r);let n=0;const o=t/e.length;for(let t=0;t<e.length;t++){const r=e[t],a={r:Math.round(r.r),g:Math.round(r.g),b:Math.round(r.b),a:r.a},l=il(a);s.beginPath(),s.fillStyle=l,s.globalAlpha=a.a,s.rect(Math.floor(n),Math.floor(0),Math.ceil(o),i),s.fill(),s.closePath(),n+=o}document.body.append(a)}dispose(){var e;null===(e=this.texture)||void 0===e||e.dispose(),this._texture=void 0}};var xu=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(i[r[a]]=e[r[a]])}return i};const bu=class extends Cc{get channel(){return this._channel}get interpolation(){const e=this.paint.sampleInterpolation();return he(e)?e:Sr.bilinear}get smoothing(){return this.paint.sampleSmoothing()||0}get drawRange(){var e;return Object.assign(Object.assign({},this.dataRange),null===(e=this.paint)||void 0===e?void 0:e.sampleDrawRange())}get dataRange(){return Object.assign({},this._dataRange.range)}get valueRanges(){return this._memoizedValueRange()}get outputRange(){return Object.assign({},this._outputRange)}get noDataValue(){var e;const t=null===(e=this.sourceMetadata)||void 0===e?void 0:e.noData;return he(t)?this.sourceMetadata.noData:-1}get colorValueRange(){return this._memoizedColorValueRange()}get colorLookupTables(){return this._colorLookupTables}constructor(e={}){super(lt({channel:"r",interpolation:Sr.none,smoothing:0,drawRange:void 0,paint:{sample:{expression:Tr.number}}},e)),this.sourceMetadata={},this._colorLookupTables=[],this._debugEnabled=!1,this._memoizedValueRange=Ot((()=>{const e=this.layer.source;let t=[];return e instanceof Wo&&ke(this.channel)&&(t=[...this.channel].map((t=>e.getDataRange(t)))),t})),this._memoizedColorValueRange=Ot((()=>{const e=Array.isArray(this.config.channel)?this.config.channel:[...this.config.channel],t=this.getColorLookupTable(e.join(""));return t?t.range:this.drawRange})),this.cachesTextures=!1}onAdd(e){super.onAdd(e)}setup(){const e=this.context,t=this.paint.sampleColorScale(),i=this.paint.sampleChannel();this._channel=i,e.gl.getExtension("OES_standard_derivatives"),this.createColorLookupTables(t||{range:{min:0,max:1},stops:[0,"#000",1,"#ff0000"],interval:1});const r=this.layer.source,a={min:0,max:255};let s,n;const o=this.paint.sampleDataRange();if(o&&(s=o),r instanceof Wo){if(ke(this.channel)){const e=this.channel;n=r.getMetadataForBand(e),le(s)&&(s=r.getDataRange(e)),he(null==n?void 0:n.noData)&&(a.min=n.noData+1)}this.colorLookupTables.forEach((t=>{var i;const a=t.channel,n=null===(i=this.paint.sampleExpressionOperation())||void 0===i?void 0:i.dataRange,o=n||r.getDataRange(a);(le(s)||he(n))&&(s=o),t.range||t.setValueRange({min:s.min,max:s.max}),t.createLookupTexture(e)}))}this._outputRange=a,this._dataRange=new vu(s),this.sourceMetadata=lt({noData:-1},n||{})}setupEvents(){super.setupEvents(),this.layer.on(Ph,(e=>{let{property:t}=e;if(t.includes("sample.colorscale")){const e=this.paint.sampleColorScale();if(e)if(e.masks){const{masks:t}=e,i=xu(e,["masks"]);t.forEach(((e,t)=>{const r=Object.assign(Object.assign({},e.colorscale),i),a=this.colorLookupTables[t];if(a&&e.colorscale){const e=he(r.interval)?r.interval:a.interval;a.setColorStops(r.stops,e,r.normalized)}}))}else Object.values(this.colorLookupTables).forEach((t=>{const i=he(e.interval)?e.interval:t.interval;t.setColorStops(e.stops,i,e.normalized)}))}}))}prepareDrawPasses(){}stateForDrawPass(e,t){var i,r,a;const s=this.renderState.renderables,n=(null===(i=s[0])||void 0===i?void 0:i.tile.size)||{width:Fn,height:Fn};return{renderables:s,interpolation:this.interpolation,interval:this.timeState.index,nextInterval:this.timeState.nextIndex,progress:this.progress,sampleType:this.paint.sampleExpression(),dataRange:this.dataRange,drawRange:this.drawRange,tileSize:{width:n.width,height:n.height},tileSpan:{x:null===(r=this.renderState.dataRegion)||void 0===r?void 0:r.clampedSpan().x,y:null===(a=this.renderState.dataRegion)||void 0===a?void 0:a.clampedSpan().y},dataRegion:this.renderState.dataRegion,renderRegion:this.renderState.renderRegion,visibleRegion:this.renderState.visibleRegion}}prepareDrawPass(e,t){}setColorScaleUniforms(e){if(!e)return;const t=this.paint.sampleExpression(),i=Array.isArray(this.channel)?this.channel[0]:this.channel,r=this.getChannels(t),a=this.getColorLookupTable(i),s=this.colorLookupTables,n=this.dataRange,o=this.drawRange,l=Object.assign({},n);let h=1;if(this.colorLookupTables.length>0){const e=this.colorLookupTables[0];l.min=e.range.min,l.max=e.range.max}if(this.colorLookupTables.length>1)e.setUniform("colorScale[0]",s.map((e=>e.texture))),e.setUniform("colorScaleRes[0]",s.map((e=>e.texture.size.width))),e.setUniform("colorMaskValue[0]",s.map((e=>e.value/255))),e.setUniform("colorMaskChannel[0]",s.map((e=>Ar.indexOf(e.channel))));else if(a){const t=a.scale;h=(this.dataRange.max-this.dataRange.min)/(t.range.max-t.range.min),e.setUniform("colorScale",a.texture),e.setUniform("colorScaleRes",a.texture.size.width)}e.setUniform("colorRangeFactor",h),e.setUniform("colorSampleOffset",this.paint.sampleOffset()),e.setUniform("dataChannel[0]",r.map((e=>Ar.indexOf(e)))),e.setUniform("interpolation",this.interpolation),e.setUniform("smoothing",this.paint.sampleSmoothing()),e.setUniform("dataMeld",!1===this.paint.sampleMeld()?0:this.progress),e.setUniform("outputRange",new eh(this.outputRange.min/255,this.outputRange.max/255)),e.setUniform("dataRange",new eh(n.min,n.max)),e.setUniform("dataMin",new eh(n.min,n.min)),e.setUniform("dataMax",new eh(n.max,n.max)),e.setUniform("sampleDataRange",new eh(l.min,l.max)),e.setUniform("drawRange",new eh(o.min,o.max)),e.setUniform("noData",this.noDataValue/255)}getProgramDefines(){const e=[],t=this.config.channel;return this.noDataValue>=0&&e.push("NODATA"),ke(t)&&("r"===t?e.push("BAND_R"):"g"===t?e.push("BAND_G"):"b"===t?e.push("BAND_B"):"a"===t?e.push("BAND_A"):"rg"===t?e.push("BAND_RG"):"gb"===t?e.push("BAND_GB"):"rb"===t?e.push("BAND_RB"):"ra"===t?e.push("BAND_RA"):"ga"===t?e.push("BAND_GA"):"ba"===t?e.push("BAND_BA"):"rgb"===t?e.push("BAND_RGB"):"gba"===t?e.push("BAND_GBA"):"rgba"===t&&e.push("BAND_RGBA")),e}getChannels(e){const t=this.channel;return Array.isArray(t)?t:e!==Tr.number?[...t]:[t]}getColorLookupTable(e){return this.colorLookupTables.find((t=>t.channel===e))}createColorLookupTables(e){this._colorLookupTables=[];const t=this.channel;if(Array.isArray(t)){const t=[...Object.keys(e)].filter((e=>!1===Ar.includes(e)));if(t.length>0)throw new Error(`[MapsGL] Invalid sample colorscale configuration for {${this.layer.id}}. Value for \n                    'colorscale' must be an object keyed by each value in 'channel' but found the following invalid\n                    key(s): ${t.join(", ")}`);Object.keys(e).forEach((t=>{if(!1===Ar.includes(t))throw new Error(`[MapsGL] Color channel ${t} is invalid, must be one of \n                        ${Ar.join(", ")}`);const i=new yu(e[t]);i.channel=t,this._colorLookupTables.push(i)}))}else{if(!Ar.includes(t))throw new Error(`[MapsGL] Invalid sample channel '${t}' defined for layer {${this.layer.id}}. Sample \n                channel value must be one of ${Ar.join(", ")} or an array of valid channel \n                values.`);{const{masks:i}=e,r=xu(e,["masks"]);if(i&&Array.isArray(i))i.forEach((e=>{const t=e.channel;if(!1===Ar.includes(t))throw new Error(`[MapsGL] Color channel ${t} is invalid, must be one of \n                            ${Ar.join(", ")}`);const i=new yu(Object.assign(Object.assign({},r),e.colorscale));i.channel=t,i.value=e.value,this._colorLookupTables.push(i)}));else{const e=new yu(r);e.channel=t,this._colorLookupTables.push(e)}}}}removeColorLookupTables(){this.colorLookupTables.forEach((e=>{e.dispose()})),this._colorLookupTables=[]}dispose(){var e,t;this.removeColorLookupTables(),null===(t=null===(e=this.layer)||void 0===e?void 0:e.animator)||void 0===t||t.clearListeners(),super.dispose()}},wu=class extends nu{constructor(e,t){t.zoomOffset=he(t.zoomOffset)?t.zoomOffset:-1,super(e,Object.assign({quality:ki.exact},t)),this.prepareTileFeatures=e=>{const t=e.tile;t&&!this.processing[t.coord.hash]&&this.prepareTileFeature(t.coord)},this.processing={}}onAdd(e){super.onAdd(e),this.addSourceEventHandler(xs,this.prepareTileFeatures)}queryFeaturesPromise(e,t,i){return new Promise(((r,a)=>{const{tile:s,position:n}=this.getTile(e,t,i)||{},o=Array.isArray(null==s?void 0:s.data)?null==s?void 0:s.data[0]:null==s?void 0:s.data;o instanceof xr?this.getTileFeature(s.coord,o,(e=>{if(e){const t=this.interpolateValue(e,n);xe(t)?r({value:t,nodata:t===Ii}):r(null)}else a()})):r(null)}))}queryFeatures(e,t,i){const{tile:r,position:a}=this.getTile(e,t,i)||{},s=Array.isArray(null==r?void 0:r.data)?null==r?void 0:r.data[0]:null==r?void 0:r.data;if(s instanceof xr){const e=this.getTileFeature(r.coord,s);if(e){const t=this.interpolateValue(e,a);if(xe(t))return{value:t,nodata:t===Ii}}}}createTimeSeriesDataProvider(){const e=new du(this),t=this.source;return t instanceof Wo&&(e.maxIntervalsPerRequest=Math.min(6,Math.floor(t.maxTextureSize/t.tileSize.width))),e}prepareTileFeature(e){const t=this.source.tiles.get(e),i=Array.isArray(null==t?void 0:t.data)?null==t?void 0:t.data[0]:null==t?void 0:t.data;i instanceof xr&&this.getTileFeature(t.coord,i)}getTileFeature(e,t,i){let r;if(t instanceof xr){const a=t.validCount,s=e.hash;if(this.renderer instanceof bu)return this.features||(this.features=new to({capacity:30})),r=this.features.get(s),r&&Object.keys(r.values||{}).length===a?i&&i(r):he(this.processing[s])?i&&this.processing[s].push(i):(this.processing[s]=i?[i]:[],this.createFeature(s,t,this.renderer).then((e=>{this.processing[s].forEach((t=>t(e))),delete this.processing[s]}))),r}}interpolateValue(e,t){const i=this.renderer,r=i.interpolation,{min:a,max:s}=i.dataRange,{min:n,max:o}=i.drawRange,l={current:{column:i.timeState.index,row:0,timestamp:i.timeState.interval},next:{column:i.timeState.nextIndex,row:0,timestamp:i.timeState.nextInterval},position:i.paint.sampleMeld()?i.progress:0},h=e.query(t,l,r);let c=ze(h)?h.value:h;return c=Pe(c,a,s),c<n||c>o?Ii:h}createFeature(e,t,i){if(!this.worker){let e=Vo.getWorker("encoded");le(e)&&(e="https://cdn.aerisapi.com/sdk/js/mapsgl/latest/mapsgl.encoded.worker.js",Vo.addWorker("encoded",e));const t=new Lo(e);this.worker=new Uo(t)}let r=-1;return this.renderer instanceof bu&&(r=this.renderer.noDataValue),this.worker.send({command:"getValues",encoded:t.serialized(),config:{expression:this.paint.sampleExpression(),channels:Array.isArray(i.channel)?i.channel:[...i.channel],dataRange:i.dataRange,drawRange:i.colorValueRange,valueRanges:i.valueRanges,sampleOffset:this.paint.sampleOffset(),noDataValue:r}}).then((i=>{let{values:r,size:a}=i;var s;if(!this.renderer)return;const n=(new gu).initialize(r,a),o=null===(s=this.paint.sampleExpressionOperation())||void 0===s?void 0:s.value;return Jt(o)&&n.setValueExpression((e=>o(e))),n.padding=t.padding,this.features.set(e,n),n}))}},_u=e=>{const t=Gn(e);return`${Math.round(t.x*Co)}_${Math.round(t.y*Co)}`},Mu=class extends uu{constructor(e,t){const i=t.source instanceof xh?t.source:new xh(`${e}-geojson`,{data:{type:"FeatureCollection",features:[]}}),r=Object.assign({},t);delete t.sourceLayer;const a=t.source;t.source=i,super(e,Object.assign({quality:ki.exact,zoomOffset:0},t)),this._aggregatedFeatures=[],this._currentIndex=0,this._seriesDataByCoord={},this.aggregateVectorTileFeatures=Ni((()=>{if(!this.map||!this.valuePropertyName||!this._aggregator)return;const e=this._aggregator.source,t=this._aggregator.layer,i=this.valuePropertyName,r=this.getVisibleTileCoords(),a=[];r.forEach((r=>{const s=e.getTileData(r),n=null==s?void 0:s.stores[t.id];n instanceof mh&&(n.features||[]).forEach((e=>{var t;const s=null===(t=this.map)||void 0===t?void 0:t.transform.tilePointToLocation(e.geometry[0],r),n=_u(s),o=this._seriesDataByCoord[n];xe(null==o?void 0:o.values[this._currentIndex])&&(e.properties[i]={value:o.values[this._currentIndex]}),a.push({type:"Feature",geometry:{type:"Point",coordinates:[s.lon,s.lat]},properties:e.properties})}))})),this._aggregatedFeatures=a,this._throttleUpdate()}),100),this._throttleUpdate=hh((()=>{this.update()}),150),this._origConfig=Object.freeze(r),a.type===ji.vector&&a instanceof vh&&(this._aggregator={source:a,layer:null})}get geojsonSource(){return this.source}get queryLayer(){return this._queryLayer}set queryLayer(e){this._queryLayer&&(this._queryLayer.off(Rh,this.onNeedsDataUpdate),this._queryLayer.off(kh,this.onNeedsDataUpdate)),this._queryLayer=e}get valuePropertyName(){return this.queryLayer.id.replaceAll(".","-")}onAdd(e){var t,i,r,a,s;if(Zt(this.source instanceof xh,"[MapsGL] DataQueryTileLayer requires a GeoJSONSource"),Zt(xe(this.queryLayer),"[MapsGL] DataQueryTileLayer requires a query layer"),null===(t=this._aggregator)||void 0===t?void 0:t.source){this.map.hasSource(this.source.id)||this.map.addSource(this.source.id,this.source),this._aggregator.source.on(xs,this.aggregateVectorTileFeatures,null,this);const e=this._origConfig,t=this.map.addLayer(`${this.id}::data-points`,{type:Pi.data,source:this._aggregator.source,sourceLayer:e.sourceLayer,sourceType:e.sourceType,filter:e.filter,zoomOffset:e.zoomOffset,paint:this.paint.config});t instanceof uu&&(this._aggregator.layer=t,this.map.on(Nh,this.aggregateVectorTileFeatures,null,this)),this.aggregateVectorTileFeatures()}else this.map.on(Nh,this._throttleUpdate,null,this);this.map.on($h,this.onMapUnitsChange,null,this),this.on(Ph,(e=>{let{property:t}=e;/^text.*\.value/.test(t)&&this.update(!0)})),this.enableQueryLayerAnimation(),this.queryLayer.on(Ch,this.enableQueryLayerAnimation,null,this),this.queryLayer.on(Rh,this.onNeedsDataUpdate,null,this),this.queryLayer.on(kh,this.onNeedsDataUpdate,null,this),null===(r=null===(i=this.queryLayer.animator)||void 0===i?void 0:i.animation)||void 0===r||r.on(Ui.ADVANCE,this._throttleUpdate,null,this),null===(s=null===(a=this.queryLayer.animator)||void 0===a?void 0:a.animation)||void 0===s||s.on(Ui.END,this.onNeedsDataUpdate,null,this);for(let e=0;e<this.paint.textLineCount();e++){const t=this.paint.textValue(null,e);"string"!=typeof t&&"{dataProp}"===(null==t?void 0:t.property)&&(t.property=`${this.valuePropertyName}.value`)}this.onMapUnitsChange();const n=this.source;n instanceof xh&&(ye(n.data)?n.once(As,(()=>{this.updateFeaturesFromGeoJSONSource(),this.setNeedsUpdate()})):(n.on(vs,this.updateFeaturesFromGeoJSONSource,null,this),this.setNeedsUpdate())),super.onAdd(e)}onRemove(){var e,t,i,r,a;if(super.onRemove(),this.map.off($h,this.onMapUnitsChange),this.queryLayer&&(!1===this.queryLayer.visible&&(null===(e=this.queryLayer.animator)||void 0===e||e.animation.disable()),this.queryLayer.off(Ch,this.enableQueryLayerAnimation),this.queryLayer.off(Rh,this.onNeedsDataUpdate),this.queryLayer.off(kh,this.onNeedsDataUpdate),null===(i=null===(t=this.queryLayer.animator)||void 0===t?void 0:t.animation)||void 0===i||i.off(Ui.ADVANCE,this._throttleUpdate),null===(a=null===(r=this.queryLayer.animator)||void 0===r?void 0:r.animation)||void 0===a||a.off(Ui.END,this.onNeedsDataUpdate)),this.queryLayer=null,this._aggregator){const e=this._aggregator.source,t=this._aggregator.layer;this.map.off(Nh,this.aggregateVectorTileFeatures),this.map.hasSource(this.source.id)&&this.map.removeSource(this.source.id),e&&e.off(xs,this.aggregateVectorTileFeatures),t&&this.map.hasLayer(t.id)&&this.map.removeLayer(t.id)}else this.source.off(vs,this.updateFeaturesFromGeoJSONSource),this.map.off(Nh,this._throttleUpdate)}enableQueryLayerAnimation(){var e;null===(e=this.queryLayer.animator)||void 0===e||e.animation.enable()}onNeedsDataUpdate(){this.update()}onMapUnitsChange(){var e;const t=this.map.getUnits();for(let i=0;i<this.paint.textLineCount();i++){const r=this.paint.textValue(null,i);if("string"!=typeof r){const a=null===(e=null==r?void 0:r.measurement)||void 0===e?void 0:e.type;xe(a)&&t[a]&&(Array.isArray(this.paint.config.text)?this.setPaintProperty(`text[${i}].value.measurement.units`,t[a]):this.setPaintProperty("text.value.measurement.units",t[a]))}}}updateFeaturesFromGeoJSONSource(){var e;this.source instanceof xh&&(this._aggregatedFeatures=(null===(e=this.source.data)||void 0===e?void 0:e.features)||[])}update(){var e,t,i,r,a;const s=this.geojsonSource,n=this.valuePropertyName,o={current:0,next:0};let l=arguments.length>0&&void 0!==arguments[0]&&arguments[0],h=!1;if(!(null===(e=this.queryLayer)||void 0===e?void 0:e.map))throw new Error(`[MapsGL] Required data query layer associated with '${this.id}' does not exist on the map.`);if(this.queryLayer.animator){const e=this.queryLayer.animator.info;o.current=e.dataIndex,o.next=e.nextDataIndex}if(s instanceof xh){const e=s.data;if(!e)return void console.warn("No GeoJSON data to update");const c=this._aggregatedFeatures||[];let d=this.map.getZoom();const u=this.map.getBounds(),p=(null===(i=null===(t=this.queryLayer.animator)||void 0===t?void 0:t.animation)||void 0===i?void 0:i.position)||0,m=(null===(a=null===(r=this.queryLayer.animator)||void 0===r?void 0:r.animation)||void 0===a?void 0:a.duration)||0,f=Math.floor(1e3*m/200),g=Math.floor(p*f);this._currentIndex=g;const v=new Set([]);this.queryLayer instanceof nu&&(d=this.queryLayer.getDataZoom()),c.forEach((e=>{var t,i,r,a,s;if("Point"===(null===(t=e.geometry)||void 0===t?void 0:t.type)&&xe(null===(i=e.geometry)||void 0===i?void 0:i.coordinates)){const t={lat:e.geometry.coordinates[1],lon:e.geometry.coordinates[0]},i=_u(t);if(e.properties||(e.properties={}),((e,t)=>{let i=e.lon;return t.west<-180&&i>t.east?i-=360:t.east>180&&i<t.west&&(i+=360),e.lat<=t.north&&e.lat>=t.south&&i>=t.west&&i<=t.east})(t,u)){const c=this._seriesDataByCoord[i]||{zoom:d,values:[],index:Object.assign({},o)};ye(c.values)&&(c.values=[].fill(f,null)),e.properties[n]||(e.properties[n]={value:null});const u=c.index.current!==o.current||c.index.next!==o.next;if(le(c.values[g])||d>c.zoom||u){const i=this.queryLayer.queryFeatures(t,d,!1);if(xe(i)){if(c.zoom=d,c.index=Object.assign({},o),!1===Array.isArray(i)){const{value:t,nodata:a}=i;!1===a?"number"==typeof t?c.values[g]=t:he(t.value)&&(c.values[g]=t.value):c.values[g]=Ii,v.has(null===(r=e.properties)||void 0===r?void 0:r.place.name)}}else h=!0}const p=c.values[g],m=null===(a=e.properties[n])||void 0===a?void 0:a.value;let y=xe(p)&&p!==m;if(xe(m)&&xe(p)&&(y=Math.abs(m-p)>1e-5),v.has(null===(s=e.properties)||void 0===s?void 0:s.place.name),y||p===Ii){const t=!(Number.isNaN(p)||p===Ii);e.properties[n].value=t?p:void 0,l=!0}this._seriesDataByCoord[i]=c}}})),c.length!==e.features.length&&(l=!0),l&&(c.filter((e=>v.has(e.properties.place.name))).forEach((e=>{})),s.setData({type:"FeatureCollection",features:c})),h&&this._throttleUpdate()}}},Au=class extends yd{constructor(e,t){super(e),this.id="draw-vector-tiles",this.enableBlend=!0}canDrawTile(e,t){var i;return(null===(i=null==e?void 0:e.tile)||void 0===i?void 0:i.data)instanceof fh}beforeRender(e){e.renderTarget&&(this.clear=!0),super.beforeRender(e)}draw(e){const{renderables:t,mapZoom:i}=e.state,r=Math.floor(i);this._lastZoom!==r&&(this.onZoomChange(r,e),this._lastZoom=r);for(let i=0,r=t.length;i<r;i++){const r=t[i],a=r.tile;this.canDrawTile(r,e)&&this.drawTile(e,r,a.data)}}drawTile(e,t,i){throw new Error("[MapsGL] Subclasses must override `drawTile`")}prepareTile(e,t,i){const r=this.context,a=i.program,{elapsedTime:s,transform:n}=e.state,o=t.tile,l=bd.fromTileRenderable(t,void 0),h=l.scale,c=l.offset,d=l.uvOffset,u=r.resolution,p=(new bc).inverse(i.worldMatrix),{matrix:m}=n.calculateTilePos(o.coord);a.setUniform("time",s),a.setUniform("resolution",new eh(u.width,u.height)),a.setUniform("viewportSize",new eh(u.width,u.height)),a.setUniform("dpr",this.context.dpr),a.setUniform("dataResolution",new eh(o.size.width,o.size.height)),a.setUniform("dataScale",d[2]),a.setUniform("tileCoordOffset",(new al).fromArray(d)),a.setUniform("inverseWorldMatrix",p),a.setUniform("labelPlaneMatrix",n.labelPlaneMatrix),a.setUniform("glCoordMatrix",n.glCoordMatrix),a.setUniform("tileMatrix",m),a.setUniform("pitch",js(n.state.pitch)),a.setUniform("cameraToCenterDistance",n.cameraToCenterDistance);const f=1/Ln(n.state.zoom-o.coord.z);a.setUniform("pixelToUnit",1/o.size.width/r.dpr*f*(1/(n.tileSize/512))),i.scale.set(h.x,h.y,1),i.position.set(c.x,c.y,0)}drawMesh(e,t,i,r,a,s,n,o){if(this.prepareTile(e,t,i),a)if(i.updateGeometry(a),i.drawMode=n,o)for(let t=0;t<o.length;t++){const n=o[t];a.drawRange.count=n.index.length*s,a.drawRange.start=n.index.offset*s,e.scene?e.scene.render(i,r):(i.updateMatrixWorld(),i.draw({camera:r}))}else e.scene?e.scene.render(i,r):(i.updateMatrixWorld(),i.draw({camera:r}))}onZoomChange(e,t){}},Su=wd("precision highp float;<\n#defines>\n<\n#includes>\nattribute vec2 position;attribute vec2 uv;attribute vec2 color;uniform mat4 modelViewMatrix;uniform mat4 viewMatrix;uniform mat4 modelMatrix;uniform mat4 projectionMatrix;uniform vec2 resolution;uniform vec4 tileCoordOffset;varying vec2 vPosition;varying vec4 vColor;varying vec2 vPos;\n#include <encoding>\nvec2 transform(const vec2 pos,const vec4 offset){vec2 scale=vec2(1./offset.z,1./offset.w);return vec2((pos.x*scale.x)-offset.x*scale.x,(pos.y*scale.y)-offset.y*scale.y);}void main(){vec2 pos=transform(position/EXTENT,tileCoordOffset);vPosition=pos;vColor=decode_color(color);gl_Position=projectionMatrix*modelViewMatrix*vec4(pos.xy,0.,1.);vPos=(gl_Position.xy/gl_Position.w+1.)/2.*resolution*gl_Position.w;}"),Tu=wd("#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\nprecision highp float;uniform vec4 dataCoordOffset;varying vec2 vPosition;varying vec4 vColor;varying vec2 vPos;void main(){vec2 pos=vPosition;vec2 min=vec2(dataCoordOffset.x,dataCoordOffset.y);vec2 max=vec2(min.x+pos.x*dataCoordOffset.z,min.y+pos.y*dataCoordOffset.w);if(pos.x<0.)discard;if(pos.y<0.)discard;if(pos.x>1.)discard;if(pos.y>1.)discard;vec4 color=vColor;vec4 preMultipliedColor=vec4(color.rgb*color.a,color.a);gl_FragColor=preMultipliedColor;}"),Eu={},Ou=["EPSILON 0.0000001","PI 3.141592653589793",`EXTENT ${Co}.0`,"HALF_PI PI/2.0","QUARTER_PI PI/4.0","RAD_TO_DEG 180.0/PI","DEG_TO_RAD PI/180.0"],Cu=class extends Au{constructor(e,t=[]){super(e),this.program=e.cache.getProgram("draw-fill",t,(()=>new ed(this.context,{vertexShader:Su,fragmentShader:Tu,uniforms:Object.assign({},Eu),defines:[...Ou,...t],includes:a}))),this.mesh=new gd(this.context,e.cache.getFullscreenQuad().geometry,this.program)}drawTile(e,t,i){var r,a;const{style:s}=e.state;this._drawTile(e,"fill",t,i),(null===(a=null===(r=s.config)||void 0===r?void 0:r.stroke)||void 0===a?void 0:a.color)&&this._drawTile(e,"fill-outline",t,i)}_drawTile(e,t,i,r){const a=this.context,s=a.gl,{layerId:n,style:o,mapStyle:l}=e.state,h=r.getDrawData(this.context,t,n,{paint:o,mapStyle:l}),{geometry:c,size:d}=(null==h?void 0:h.primary)||{};if(!c)return;const u=this.mesh,p=e.renderTarget?a.cache.getFullscreenQuad().camera:void 0,m="fill-outline"===t?s.LINES:s.TRIANGLES;c.forEach(((t,r)=>{u.updateGeometry(t),this.drawMesh(e,i,u,p,t,d,m,null)}))}dispose(){var e;super.dispose(),null===(e=this.mesh.geometry)||void 0===e||e.dispose()}},Ru=wd("precision highp float;<\n#defines>\n<\n#includes>\nattribute vec2 position;attribute vec2 pA,pB,pC,pD;attribute vec2 uv;attribute vec2 color;attribute float segments;attribute float terminal;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;uniform mat3 normalMatrix;uniform vec2 resolution;uniform vec4 tileCoordOffset;uniform float dpr;uniform float pixelToUnit;uniform float lineWidth;uniform float opacity;uniform float sizeAttenuation;varying vec2 vUV;varying vec2 vPosition;varying vec4 vColor;\n#include <encoding>\nvec2 transform(const vec2 pos,const vec4 offset){vec2 scale=vec2(1./offset.z,1./offset.w);return vec2((pos.x*scale.x)-offset.x*scale.x,(pos.y*scale.y)-offset.y*scale.y);}void main(){float scale=tileCoordOffset.z;float aspect=resolution.x/resolution.y;float width=lineWidth*pixelToUnit;vec2 finalPosition=position;vColor=decode_color(color);vec2 p0=pA/EXTENT;vec2 p1=pA/EXTENT;vec2 p2=pB/EXTENT;vec2 p3=pB/EXTENT;\n#ifdef LINE_ALPHA\np0=pA;p1=pB;p2=pC;vec2 pos=position;if(position.x==1.){p0=pD;p1=pC;p2=pB;pos=vec2(1.-position.x,-position.y);}vec2 tangent=normalize(normalize(p2-p1)+normalize(p1-p0));vec2 normal=vec2(-tangent.y,tangent.x);vec2 p01=p1-p0;vec2 p21=p1-p2;vec2 p01Norm=normalize(vec2(-p01.y,p01.x));float sigma=sign(dot(p01+p21,normal));if(sign(pos.y)==-sigma&&segments>1.){float dist01=distance(p1,p0);float adjustedWidth=min(width,dist01);vec2 point=0.5*normal*-sigma*adjustedWidth/dot(normal,p01Norm);finalPosition=p1+point;}else{vec2 xBasis=p2-p1;vec2 yBasis=normalize(vec2(-xBasis.y,xBasis.x));vec2 point=p1+xBasis*pos.x+yBasis*width*pos.y;finalPosition=point;}\n#else\nvec2 xBasis=p2-p1;vec2 yBasis=normalize(vec2(-xBasis.y,xBasis.x));vec2 point=p1+xBasis*position.x+yBasis*width*position.y;finalPosition=point;\n#endif\nif(p2.x==p1.x&&(p1.x<0.||p1.x>1.))finalPosition.x=p1.x;if(p2.y==p1.y&&(p1.y<0.||p1.y>1.))finalPosition.y=p1.y;finalPosition=transform(finalPosition,tileCoordOffset);vPosition=finalPosition;gl_Position=projectionMatrix*modelViewMatrix*vec4(finalPosition.xy,0.,1.);}"),Pu=wd("precision highp float;uniform sampler2D map;uniform sampler2D alphaMap;uniform float opacity;uniform float useMap;uniform float useAlphaMap;uniform float useDash;uniform float dashArray;uniform float dashOffset;uniform float dashRatio;uniform float visibility;uniform float alphaTest;uniform vec2 repeat;varying vec2 vUV;varying vec2 vPosition;varying vec4 vColor;void main(){vec4 c=vColor;vec2 pos=vPosition;if(pos.x<0.||pos.y<0.||pos.x>1.||pos.y>1.)discard;c.a*=opacity;gl_FragColor=c;gl_FragColor.rgb*=gl_FragColor.a;}"),ku={lineWidth:{value:2},useMap:{value:0},useAlphaMap:{value:0},color:{value:nl("#000000")},opacity:{value:1},sizeAttenuation:{value:0},dashArray:{value:0},dashOffset:{value:0},dashRatio:{value:0},useDash:{value:0},visibility:{value:1},alphaTest:{value:0},repeat:{value:new eh(1,1)}},Du=wd("precision highp float;<\n#defines>\n<\n#includes>\nattribute vec2 position;attribute vec2 pA,pB,pC;attribute vec2 uv;attribute vec2 color;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;uniform mat3 normalMatrix;uniform vec2 resolution;uniform vec4 tileCoordOffset;uniform float dpr;uniform float pixelToUnit;uniform float lineWidth;uniform float opacity;uniform float sizeAttenuation;varying vec2 vUV;varying vec2 vPosition;varying vec4 vColor;varying float vCounters;\n#include <encoding>\nvec2 transform(const vec2 pos,const vec4 offset){vec2 scale=vec2(1./offset.z,1./offset.w);return vec2((pos.x*scale.x)-offset.x*scale.x,(pos.y*scale.y)-offset.y*scale.y);}void main(){float scale=tileCoordOffset.z;float width=lineWidth*pixelToUnit;vec2 p0=pA/EXTENT;vec2 p1=pB/EXTENT;vec2 p2=pC/EXTENT;vColor=vec4(1.,0.,0.,1.);if(position.x==0.){vec2 xBasis=p1-p0;vec2 yBasis=normalize(vec2(-xBasis.y,xBasis.x));vec2 finalPosition=p0+xBasis*position.x+yBasis*width*position.y;finalPosition=transform(finalPosition,tileCoordOffset);gl_Position=projectionMatrix*modelViewMatrix*vec4(finalPosition.xy,0.,1.);return;}vec2 tangent=normalize(normalize(p2-p1)+normalize(p1-p0));vec2 normal=vec2(-tangent.y,tangent.x);vec2 ab=p1-p0;vec2 cb=p1-p2;vec2 abNorm=normalize(vec2(-ab.y,ab.x));float sigma=sign(dot(ab+cb,normal));vec2 finalPosition;if(sign(position.y)==-sigma){vec2 position=0.5*normal*-sigma*width/dot(normal,abNorm);finalPosition=p1+position;}else{vec2 xBasis=p1-p0;vec2 yBasis=normalize(vec2(-xBasis.y,xBasis.x));vec2 point=p0+xBasis*position.x+yBasis*width*position.y;finalPosition=point;}finalPosition=transform(finalPosition,tileCoordOffset);vPosition=finalPosition;gl_Position=projectionMatrix*modelViewMatrix*vec4(finalPosition.xy,0.,1.);}"),zu=wd("precision highp float;<\n#defines>\n<\n#includes>\nattribute vec4 position;attribute float id;attribute vec2 pA,pB,pC;attribute vec2 uv;attribute vec2 color;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;uniform mat3 normalMatrix;uniform vec2 resolution;uniform vec4 tileCoordOffset;uniform float dpr;uniform float pixelToUnit;uniform float lineWidth;uniform float opacity;uniform float sizeAttenuation;varying vec2 vUV;varying vec2 vPosition;varying vec4 vColor;varying float vCounters;\n#include <encoding>\nvec2 transform(const vec2 pos){vec2 scale=vec2(1./tileCoordOffset.z,1./tileCoordOffset.w);return vec2((pos.x*scale.x)-tileCoordOffset.x*scale.x,(pos.y*scale.y)-tileCoordOffset.y*scale.y);}void main(){float scale=tileCoordOffset.z;float joinResolution=12.;float width=lineWidth*pixelToUnit;vec2 p0=pA/EXTENT;vec2 p1=pB/EXTENT;vec2 p2=pC/EXTENT;vec2 p3;vColor=vec4(0.,1.,0.,1.);vColor=decode_color(color);vec2 xBasis=normalize(normalize(p2-p1)+normalize(p1-p0));vec2 yBasis=vec2(-xBasis.y,xBasis.x);vec2 tangent=normalize(normalize(p2-p1)+normalize(p1-p0));vec2 normal=vec2(-tangent.y,tangent.x);vec2 ab=p1-p0;vec2 cb=p1-p2;vec2 abNorm=normalize(vec2(-ab.y,ab.x));vec2 cbNorm=-normalize(vec2(-cb.y,cb.x));float sigma=sign(dot(ab+cb,normal));vec2 finalPosition;\n#ifdef LINE_ALPHA\n#ifdef JOIN_MITER\np0=0.5*width*sigma*(sigma<0.?abNorm:cbNorm);p1=0.5*normal*sigma*width/dot(normal,abNorm);p2=0.5*width*sigma*(sigma<0.?cbNorm:abNorm);p3=-0.5*normal*sigma*width/dot(normal,abNorm);finalPosition=p1+position.x*p0+position.y*p1+position.z*p2+position.w*p3;\n#else \n#ifdef JOIN_ROUND\nif(id==0.){finalPosition=p1+-0.5*yBasis*sigma*width/dot(yBasis,abNorm);}else{float theta=acos(dot(abNorm,cbNorm));sigma=sign(dot(ab+cb,yBasis));theta=(sigma*0.5*${Math.PI})+-0.5*theta+theta*(id-1.)/joinResolution;vec2 pos=0.5*width*vec2(cos(theta),sin(theta));finalPosition=p1+xBasis*pos.x+yBasis*pos.y;}\n#else \np0=0.5*width*sigma*(sigma<0.?abNorm:cbNorm);p1=0.5*width*sigma*(sigma<0.?cbNorm:abNorm);p2=-0.5*normal*sigma*width/dot(normal,abNorm);finalPosition=p1+position.x*p0+position.y*p1+position.z*p2;\n#endif\n#endif\n#else \n#ifdef JOIN_MITER\np0=0.5*width*sigma*(sigma<0.?abNorm:cbNorm);p1=0.5*normal*sigma*width/dot(normal,abNorm);p2=0.5*width*sigma*(sigma<0.?cbNorm:abNorm);float miterLength=1./dot(normal,abNorm);float miterLimit=2.;if(miterLength>miterLimit){p1=0.5*width*sigma*(sigma<0.?cbNorm:abNorm);p2=p1;}finalPosition=p1+position.x*p0+position.y*p1+position.z*p2;\n#else\n#ifdef JOIN_ROUND\nfinalPosition=width*position.xy+p0;\n#else\np0=0.5*width*sigma*(sigma<0.?abNorm:cbNorm);p1=0.5*width*sigma*(sigma<0.?cbNorm:abNorm);p2=-0.5*normal*sigma*width/dot(normal,abNorm);finalPosition=p1+position.x*p0+position.y*p1+position.z*p2;\n#endif \n#endif \n#endif \nfinalPosition=transform(finalPosition);vPosition=finalPosition;gl_Position=projectionMatrix*modelViewMatrix*vec4(finalPosition.xy,0.,1.);}"),Iu=wd("precision highp float;<\n#defines>\n<\n#includes>\nattribute vec4 position;attribute vec2 pA,pB;attribute vec2 uv;attribute vec2 color;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;uniform mat3 normalMatrix;uniform vec2 resolution;uniform vec4 tileCoordOffset;uniform float dpr;uniform float pixelToUnit;uniform float lineWidth;uniform float opacity;uniform float sizeAttenuation;varying vec2 vUV;varying vec2 vPosition;varying vec4 vColor;varying float vCounters;\n#include <encoding>\nvec2 transform(const vec2 pos,const vec4 offset){vec2 scale=vec2(1./offset.z,1./offset.w);return vec2((pos.x*scale.x)-offset.x*scale.x,(pos.y*scale.y)-offset.y*scale.y);}void main(){float scale=tileCoordOffset.z;float width=lineWidth*pixelToUnit;vec2 p0=pA/EXTENT;vec2 p1=pB/EXTENT;vec2 xBasis=normalize(p0-p1);vec2 yBasis=vec2(-xBasis.y,xBasis.x);vec2 finalPosition=p0+xBasis*width*position.x+yBasis*width*position.y;finalPosition=transform(finalPosition,tileCoordOffset);vColor=decode_color(color);vPosition=finalPosition;gl_Position=projectionMatrix*modelViewMatrix*vec4(finalPosition.xy,0.,1.);}"),Fu=class extends Au{constructor(e,t=[]){super(e),this.enableAlpha=!1,this._meshes={};const i=e.cache.getFullscreenQuad().geometry;this.program=e.cache.getProgram("draw-lines",t,(()=>new ed(this.context,{vertexShader:Ru,fragmentShader:Pu,uniforms:Object.assign({},ku),defines:[...Ou,...t],includes:a}))),this.mesh=new gd(this.context,i,this.program),this._meshes={joins:new gd(e,i,e.cache.getProgram("draw-line-joins",t,(()=>new ed(this.context,{vertexShader:zu,fragmentShader:Pu,uniforms:Object.assign({},ku),defines:[...Ou,...t],includes:a})))),caps:new gd(e,i,e.cache.getProgram("draw-line-caps",t,(()=>new ed(this.context,{vertexShader:Iu,fragmentShader:Pu,uniforms:Object.assign({},ku),defines:[...Ou,...t],includes:a})))),terminals:new gd(e,i,e.cache.getProgram("draw-line-terminals",t,(()=>new ed(this.context,{vertexShader:Du,fragmentShader:Pu,uniforms:Object.assign({},ku),defines:[...Ou,...t],includes:a}))))}}drawTile(e,t,i){var r,a,s,n,o,l;const h=this.context,c=h.gl,{layerId:d,style:u,mapStyle:p}=e.state,m=i.getDrawData(this.context,"line",d,{paint:u,mapStyle:p});if(!m)return;const f=e.renderTarget?h.cache.getFullscreenQuad().camera:void 0,{segments:g,size:v}=(null==m?void 0:m.primary)||{};if(null===(r=m.primary)||void 0===r?void 0:r.geometry){const i=this.mesh;(null===(a=m.primary)||void 0===a?void 0:a.geometry).forEach(((r,a)=>{this.drawMesh(e,t,i,f,r,v,c.TRIANGLES,g)}))}if(null===(s=m.joins)||void 0===s?void 0:s.geometry){const i=this._meshes.joins,r=null===(n=m.joins)||void 0===n?void 0:n.geometry,a=this.enableAlpha?c.TRIANGLES:c.TRIANGLE_FAN;r.forEach(((r,s)=>{this.drawMesh(e,t,i,f,r,v,a,g)}))}if(null===(o=m.caps)||void 0===o?void 0:o.geometry){const i=this._meshes.caps;(null===(l=m.caps)||void 0===l?void 0:l.geometry).forEach(((r,a)=>{this.drawMesh(e,t,i,f,r,v,c.TRIANGLES,g)}))}}prepareTile(e,t,i){super.prepareTile(e,t,i);const r=i.program,{style:a}=e.state;r.setUniform("lineWidth",(a.strokeThickness({zoom:t.coord.z})||2)*this.context.dpr),r.setUniform("opacity",a.strokeOpacity())}dispose(){super.dispose(),[this.mesh,...Object.values(this._meshes)].forEach((e=>{var t;e.geometry!==this.context.cache.getFullscreenQuad().geometry&&(null===(t=e.geometry)||void 0===t||t.dispose())}))}},Lu=wd("precision mediump float;<\n#defines>\n<\n#includes>\nattribute vec2 position;attribute vec2 uv;attribute vec2 anchor;attribute highp float radius;attribute highp vec2 fillColor;attribute highp vec2 strokeColor;attribute highp float strokeWidth;uniform mat4 modelViewMatrix;uniform mat4 viewMatrix;uniform mat4 modelMatrix;uniform mat4 worldMatrix;uniform mat4 projectionMatrix;uniform mat4 cameraPosition;uniform mat4 inverseViewMatrix;uniform mat4 labelPlaneMatrix;uniform mat4 glCoordMatrix;uniform mat4 tileMatrix;uniform float cameraToCenterDistance;uniform vec2 viewportSize;uniform float dpr;uniform float fontSize;uniform float pixelToUnit;uniform float pitch;uniform vec2 dataResolution;uniform vec4 tileCoordOffset;uniform vec2 resolution;varying vec2 vUv;varying vec2 vPosition;varying float vRadius;varying vec4 vFillColor;varying vec4 vStrokeColor;varying float vStrokeWidth;\n#include <encoding>\n#include <transform>\nvec2 transform(const vec2 pos,const vec4 unitSize){vec2 scale=vec2(1./unitSize.z,1./unitSize.w);return vec2((pos.x*scale.x)-unitSize.x*scale.x,(pos.y*scale.y)-unitSize.y*scale.y);}void main(){highp vec2 adjustedAnchor=transform(anchor.xy/EXTENT,tileCoordOffset);highp vec4 projectedAnchor=projectionMatrix*modelViewMatrix*vec4(adjustedAnchor.xy,0.,1.);vec4 glyph=vec4(-radius*0.5,-radius*0.5,radius,radius);float symbolAngle=0.;float symbolScale=dpr;vUv=uv;vRadius=radius;vFillColor=decode_color(fillColor);vStrokeColor=decode_color(strokeColor);vStrokeWidth=strokeWidth;vUv=vec2(uv.x,1.-uv.y);\n#include <symbol_vert_position>\n}"),ju=wd("#extension GL_OES_standard_derivatives : enable\nprecision mediump float;uniform vec2 resolution;uniform float dpr;uniform vec2 dataResolution;varying vec2 vUv;varying vec2 vPosition;varying float vRadius;varying vec4 vFillColor;varying vec4 vStrokeColor;varying float vStrokeWidth;void main(){vec2 pos=vUv;vec2 px=1./resolution;float ratio=px.x;if(pos.x<0.)discard;if(pos.y<0.)discard;if(pos.x>1.)discard;if(pos.y>1.)discard;float dist=length(2.*pos-1.);float aaf=0.008;float delta=fwidth(dist);float alpha=smoothstep(1.-delta,1.,dist);float inner=1.-(vRadius-vStrokeWidth)/vRadius;vec4 color=mix(vStrokeColor,vFillColor,smoothstep(inner-aaf,inner+aaf,1.-dist));color.a-=alpha;color.a=max(0.,color.a);color=mix(color,vec4(0.),alpha);vec4 preMultipliedColor=vec4(color.rgb*color.a,color.a);gl_FragColor=preMultipliedColor;}"),Nu={},Uu=class extends Au{constructor(e,t,i={}){super(e),this.program=t||e.cache.getProgram("draw-circle",i.defines,(()=>new ed(e,{vertexShader:Lu,fragmentShader:ju,uniforms:Object.assign({},Nu),defines:[...Ou,...i.defines],includes:a}))),this.mesh=new gd(this.context,e.cache.getFullscreenQuad().geometry,this.program)}drawTile(e,t,i){const r=this.context,a=r.gl,{layerId:s,style:n,mapStyle:o}=e.state,l=i.getDrawData(this.context,"circle",s,{paint:n,mapStyle:o}),{geometry:h,segments:c,size:d}=(null==l?void 0:l.primary)||{};if(!h)return;const u=this.mesh,p=e.renderTarget?r.cache.getFullscreenQuad().camera:void 0;h.forEach(((i,r)=>{u.updateGeometry(i),this.drawMesh(e,t,u,p,i,d,a.TRIANGLES,c)}))}},Vu="precision mediump float;<\n#defines>\n<\n#includes>\nattribute vec2 position;attribute vec2 uv;attribute vec2 anchor;attribute vec4 glyph;attribute highp vec2 fillColor;attribute highp vec2 strokeColor;attribute highp float strokeWidth;attribute vec4 texCoordOffset;attribute float opacity;attribute float size;attribute float rotation;attribute float factor;attribute float random;uniform mat4 modelViewMatrix;uniform mat4 viewMatrix;uniform mat4 modelMatrix;uniform mat4 worldMatrix;uniform mat4 projectionMatrix;uniform mat4 cameraPosition;uniform mat4 inverseViewMatrix;uniform mat4 labelPlaneMatrix;uniform mat4 glCoordMatrix;uniform mat4 tileMatrix;uniform float cameraToCenterDistance;uniform vec2 viewportSize;uniform float dpr;uniform float fontSize;uniform float pixelToUnit;uniform float pitch;uniform float time;uniform vec2 resolution;uniform vec4 tileCoordOffset;varying vec2 vUv;varying vec2 vPosition;varying vec4 vColor;varying vec4 vStrokeColor;varying float vStrokeWidth;varying float vSize;varying float vOpacity;varying float vFactor;varying float vRandom;varying vec2 vData;\n#include <encoding>\n#include <transform>\nvec2 transform(const vec2 pos,const vec4 unitSize){vec2 scale=vec2(1./unitSize.z,1./unitSize.w);return vec2((pos.x*scale.x)-unitSize.x*scale.x,(pos.y*scale.y)-unitSize.y*scale.y);}void main(){highp vec2 adjustedAnchor=transform(anchor.xy/EXTENT,tileCoordOffset);highp vec4 projectedAnchor=projectionMatrix*modelViewMatrix*vec4(adjustedAnchor.xy,0.,1.);float symbolAngle=rotation;float symbolScale=1.;vUv=vec2(texCoordOffset.x+(uv.x*texCoordOffset.z),texCoordOffset.y+(uv.y*texCoordOffset.w));vOpacity=opacity;vSize=size;vFactor=factor;vRandom=random;vColor=decode_color(fillColor);vStrokeColor=decode_color(strokeColor);vStrokeWidth=strokeWidth;\n#include <symbol_vert_position>\nfloat gammaScale=finalPosition.w;vData=vec2(gammaScale,size);}",Bu=wd(Vu),$u=wd("precision mediump float;<\n#defines>\n<\n#includes>\n#ifdef USE_ATLAS\nuniform sampler2D tAtlas;\n#endif\nvarying vec2 vUv;varying vec2 vPosition;varying float vOpacity;void main(){vec4 color=vec4(vUv.x,vUv.y,0.,1.);\n#ifdef USE_ATLAS\ncolor=texture2D(tAtlas,vUv);\n#endif\ncolor.a*=vOpacity;gl_FragColor=color;}"),qu={},Gu=(wd(Vu),wd("precision mediump float;<\n#defines>\n<\n#includes>\n#define SDF_RADIUS_PX  8.0\n#define SDF_THRESHOLD  192.0 / 256.0\nuniform sampler2D tAtlas;uniform float dpr;uniform bool isHalo;\n#ifdef COLOR_LOOKUP\nuniform sampler2D colorScale;uniform float colorScaleRes;\n#endif\nvarying vec2 vUv;varying vec4 vColor;varying vec4 vStrokeColor;varying float vSize;varying float vStrokeWidth;varying float vSpeedRatio;varying float vOpacity;varying vec2 vData;varying vec2 vPosition;\n#include <color_lookup>\nvoid main(){float haloWidth=vStrokeWidth;float haloBlur=0.;float EDGE_GAMMA=0.105/dpr;float gammaScale=vData.x;float scale=vData.y*dpr;float dist=texture2D(tAtlas,vUv).r;float innerEdge=SDF_THRESHOLD;float gamma=EDGE_GAMMA/(scale*gammaScale);float gammaScaled=gamma*gammaScale;vec4 color=vColor;\n#ifdef COLOR_LOOKUP\nif(!isHalo){color=colorLookup(vSpeedRatio,colorScaleRes,colorScale);}\n#endif\nif(isHalo){color=vStrokeColor;gamma=(haloBlur*1.19/SDF_RADIUS_PX+EDGE_GAMMA)/(gammaScale);innerEdge+=gammaScaled;}float alpha=smoothstep(innerEdge-gammaScaled,innerEdge+gammaScaled,dist);if(isHalo){float haloEdge=(6.-haloWidth/scale)/SDF_RADIUS_PX;alpha=min(smoothstep(haloEdge-gammaScaled,haloEdge+gammaScaled,dist),1.-alpha);}color*=(alpha*vOpacity);gl_FragColor=color;}")),Hu=e=>("string"!=typeof e&&(e=JSON.stringify(e.toString()).replaceAll(/\s+/g," ")),window.btoa(e)),Wu=class extends Au{constructor(e,{program:t,options:i={}}){super(e),this._usesCustomShader=!1;const r={vertexShader:i.vertexShader||Bu,uniforms:Object.assign(Object.assign({},qu),i.uniforms),defines:[...Ou,...i.defines],includes:a,onBeforeCompile:i.onBeforeCompile},s=e.cache.getFullscreenQuad().geometry;let n="draw-symbol";xe(i.onBeforeCompile)?n=`draw-symbol-${Hu(i.onBeforeCompile)}`:xe(i.fragmentShader)&&(n=`draw-symbol-${Hu(i.fragmentShader)}`),this.program=t||e.cache.getProgram(n,i.defines,(()=>new ed(e,Object.assign(Object.assign({},r),{fragmentShader:i.fragmentShader||$u})))),this.mesh=new gd(this.context,s,this.program),this._usesCustomShader=xe(i.fragmentShader);const o=n.replace("-symbol","-sdf-symbol");this.sdfMesh=new gd(this.context,s,e.cache.getProgram(o,i.defines,(()=>new ed(e,Object.assign(Object.assign({},r),{fragmentShader:Gu})))))}beforeRender(e){super.beforeRender(e);const t=e.state.style;this._restoreBlending=this.context.state.opts.blending;const i=t.iconBlending()||this._restoreBlending;this.context.state.setBlending(i)}afterRender(e){super.afterRender(e),this.context.state.setBlending(this._restoreBlending)}drawTile(e,t,i){const r=this.context,a=r.gl,{layerId:s}=e.state,n=e.state.style,o=i.getStore("symbol",s),l=i.getDrawData(this.context,"symbol",s,{paint:n,mapStyle:e.state.mapStyle,opacityState:e.state.opacityState}),{buffer:h,segments:c,size:d}=(null==l?void 0:l.primary)||{},u=null==h?void 0:h.icon;if(!u||o instanceof ah==0)return;const p=o.includesSDFIcons&&!this._usesCustomShader,m=p?this.sdfMesh:this.mesh,f=e.renderTarget?r.cache.getFullscreenQuad().camera:void 0,g=m.program;if(this.program=m.program,m.updateGeometry(u),i.imageAtlas){i.imageAtlas.patchUpdatedImages(e.state.mapStyle.imageManager),i.imageAtlas.prepareTexture(r),g.setUniform("tAtlas",i.imageAtlas.texture);const t=n.iconAtlas();if(t){const e=i.imageAtlas.image,r=i.imageAtlas.iconPositions[t.ids[0]],a=e.height/r.h;g.setUniform("atlasColumns",e.width/r.w),g.setUniform("atlasRows",a),g.setUniform("atlasInterval",t.interval),g.setUniform("atlasRes",new eh(i.imageAtlas.size.width,i.imageAtlas.size.height))}}p&&n.strokeThickness()>0&&(g.setUniform("isHalo",!0),this.drawMesh(e,t,m,f,u,d,a.TRIANGLES,c)),g.setUniform("isHalo",!1),this.drawMesh(e,t,m,f,u,d,a.TRIANGLES,c)}prepareTile(e,t,i){super.prepareTile(e,t,i),i.program.setUniform("rotation",e.state.style.iconRotation())}},Yu=wd("precision mediump float;<\n#defines>\n<\n#includes>\nattribute vec2 position;attribute vec2 uv;attribute vec2 anchor;attribute vec4 glyph;attribute highp vec2 fillColor;attribute highp vec2 strokeColor;attribute highp float strokeWidth;attribute vec4 texCoordOffset;attribute float opacity;attribute float rotation;attribute float size;attribute float atlasIndex;uniform mat4 modelViewMatrix;uniform mat4 viewMatrix;uniform mat4 modelMatrix;uniform mat4 worldMatrix;uniform mat4 projectionMatrix;uniform mat4 cameraPosition;uniform mat4 inverseViewMatrix;uniform mat4 labelPlaneMatrix;uniform mat4 glCoordMatrix;uniform mat4 tileMatrix;uniform float cameraToCenterDistance;uniform vec2 viewportSize;uniform float dpr;uniform float fontSize;uniform float pixelToUnit;uniform float pitch;uniform vec2 dataResolution;uniform vec4 tileCoordOffset;uniform vec2 resolution;varying vec2 vUv;varying float vAtlasIndex;varying vec2 vPosition;varying float vSizeScale;varying vec4 vColor;varying vec4 vStrokeColor;varying float vOpacity;\n#include <encoding>\n#include <transform>\nvec2 transform(const vec2 pos,const vec4 unitSize){vec2 scale=vec2(1./unitSize.z,1./unitSize.w);return vec2((pos.x*scale.x)-unitSize.x*scale.x,(pos.y*scale.y)-unitSize.y*scale.y);}void main(){highp vec2 adjustedAnchor=transform(anchor.xy/EXTENT,tileCoordOffset);highp vec4 projectedAnchor=projectionMatrix*modelViewMatrix*vec4(adjustedAnchor.xy,0.,1.);float symbolAngle=rotation;float symbolScale=1.;vUv=vec2(texCoordOffset.x+(uv.x*texCoordOffset.z),texCoordOffset.y+(uv.y*texCoordOffset.w));vAtlasIndex=atlasIndex;vOpacity=opacity;vColor=decode_color(fillColor);vStrokeColor=decode_color(strokeColor);vSizeScale=size/24.;\n#include <symbol_vert_position>\n}"),Zu=wd("#extension GL_OES_standard_derivatives : enable\nprecision mediump float;\n#define SDF_PX  8.0\n<\n#defines>\n<\n#includes>\nuniform sampler2D tFont[4];uniform float dpr;uniform bool isHalo;varying vec2 vUv;varying float vAtlasIndex;varying vec4 vColor;varying vec4 vStrokeColor;varying float vSizeScale;varying float vOpacity;\n#define GLYPH_EDGE  0.5\nconst float outlineEdgeWidth=0.5;const float shadowBlur=0.8;const vec4 shadowColor=vec4(0.,0.,0.,0.5);float median(float r,float g,float b){return max(min(r,g),min(max(r,g),b));}float screenPxRange(){float sdf_dist_range=6.;vec2 u_unit_range=vec2(sdf_dist_range/512.,sdf_dist_range/256.);vec2 screenTexSize=vec2(1.)/fwidth(vUv);return max(0.5*dot(u_unit_range,screenTexSize),1.);}void main(){vec4 tex;if(vAtlasIndex==0.){tex=texture2D(tFont[0],vUv);}else if(vAtlasIndex==1.){tex=texture2D(tFont[1],vUv);}else if(vAtlasIndex==2.){tex=texture2D(tFont[2],vUv);}else if(vAtlasIndex==3.){tex=texture2D(tFont[3],vUv);}float edge=0.5;if(isHalo){edge=0.01;}float d_msdf=median(tex.r,tex.g,tex.b);float d_sdf=tex.a;float dist=min(d_msdf,d_sdf+0.1);float width=fwidth(dist);float alpha=smoothstep(-width,width,dist);float outerEdge=GLYPH_EDGE;vec4 color=vColor;if(isHalo){color=vStrokeColor;}alpha=clamp(smoothstep(outerEdge-width,outerEdge+width,dist),0.,1.);color=vec4(color.rgb,color.a*alpha);if(isHalo){float outlineScale=vSizeScale;vec4 outlineColor=vStrokeColor;float adjustedWidth=mix(outlineEdgeWidth*1.,outlineEdgeWidth*0.5,vSizeScale);outerEdge-=clamp(adjustedWidth,0.,0.5);float outlineOuterAlpha=clamp(smoothstep(outerEdge-width,outerEdge+width,dist),0.,1.);float outlineAlpha=outlineOuterAlpha-alpha;color.rgb=mix(outlineColor.rgb,color.rgb,alpha);color.a=max(color.a,outlineColor.a*outlineOuterAlpha);float shadowAlpha=clamp(smoothstep(max(outerEdge-shadowBlur,0.05),outerEdge+shadowBlur,dist),0.,1.);vec4 shadow=shadowColor*shadowAlpha;}gl_FragColor=vec4(color.rgb,color.a*vOpacity);gl_FragColor.rgb*=gl_FragColor.a;}"),Xu={tMap:{value:void 0}},Qu=class extends Au{constructor(e,t,i=[]){super(e),this.program=t||e.cache.getProgram("draw-text",i,(()=>new ed(e,{vertexShader:Yu,fragmentShader:Zu,uniforms:Object.assign({},Xu),defines:[...Ou,...i],includes:a}))),this.mesh=new gd(this.context,e.cache.getFullscreenQuad().geometry,this.program)}drawTile(e,t,i){const r=this.context,a=r.gl,{layerId:s}=e.state,n=i.getDrawData(this.context,"symbol",s,{paint:e.state.style,mapStyle:e.state.mapStyle,opacityState:e.state.opacityState}),{buffer:o,segments:l,size:h}=(null==n?void 0:n.primary)||{},c=null==o?void 0:o.text;if(!c)return;const d=this.mesh,u=e.renderTarget?r.cache.getFullscreenQuad().camera:void 0,p=d.program;p.setUniform("isHalo",!0),this.drawMesh(e,t,d,u,c,h,a.TRIANGLES,l),p.setUniform("isHalo",!1),this.drawMesh(e,t,d,u,c,h,a.TRIANGLES,l)}prepareTile(e,t,i){super.prepareTile(e,t,i);const r=i.program,a=(new bc).inverse(i.worldMatrix);r.setUniform("inverseWorldMatrix",a),r.setUniform("inverseViewMatrix",(new bc).inverse(i.worldMatrix))}onZoomChange(e,t){const{layerId:i,renderables:r,style:a,opacityState:s}=t.state;for(let e=0,t=r.length;e<t;e++){const t=r[e].tile;(null==t?void 0:t.data)instanceof fh&&t.data.updateSymbolOpacity(i,a,s)}}dispose(){var e;super.dispose(),null===(e=this.mesh.geometry)||void 0===e||e.dispose()}};let Ku;const Ju=class extends Cc{constructor(e={}){super(Object.assign({type:Yh.fill},e)),this.enableAlpha=!1,this.cachesTextures=!1}prepareDrawPasses(){var e;this.context.gl.getExtension("OES_standard_derivatives");const t=this.config.type,i=[],r=[],a=this.paint.symbolPitchWithMap(),s=this.paint.symbolRotateWithMap(),n=this.paint.symbolSizeAttenuation();switch(a&&i.push("PITCH_WITH_MAP"),s&&i.push("ROTATE_WITH_MAP"),n&&i.push("SIZE_ATTENUATION"),t){case"fill":{const e=new Cu(this.context);r.push(e);break}case"line":{const e=this.paint.strokeLineJoin(),t=this.paint.strokeLineCap();e===Ir.Bevel?i.push("JOIN_BEVEL"):e===Ir.Miter?i.push("JOIN_MITER"):e===Ir.Round&&i.push("JOIN_ROUND"),t===Fr.Butt?i.push("CAP_BUTT"):t===Fr.Square?i.push("CAP_SQUARE"):t===Fr.Round&&i.push("CAP_ROUND"),this.enableAlpha&&i.push("LINE_ALPHA");const a=new Fu(this.context,i);r.push(a);break}case"circle":{const e=new Uu(this.context,void 0,{defines:i});r.push(e);break}case"text":case"symbol":{i.push("USE_ATLAS");const t=new Wu(this.context,{options:{fragmentShader:this.paint.iconShader(),uniforms:Object.assign(Object.assign({},this.paint.iconUniforms({context:this.context})),{time:{value:0}}),defines:i,onBeforeCompile:null===(e=this.paint.config.icon)||void 0===e?void 0:e.shaderOnBeforeCompile}});r.push(t);const a=new Qu(this.context,void 0,i);r.push(a),this.isAnimated=this.paint.iconAnimated();break}}const o=new Yd(this.context,r);o.clear=!0,o.prerender=!0,this.passes.addPass(o);const l=new Kd(this.context);l.id="screen",l.fullscreen=!0,l.texture=o.renderTarget.texture,l.textureId="tOutput",l.enableBlend=!0,this.passes.addPass(l)}stateForDrawPass(e,t){const i=Object.assign(Object.assign({},super.stateForDrawPass(e,t)),{renderables:this.renderState.renderables,layerId:this.layer.id,style:this.paint,mapStyle:this.layer.map.style,elapsedTime:this.renderState.elapsedTime,transform:this.layer.map.transform});return e instanceof Qu&&(i.opacityState=this.layer.map.placement.getOpacityState(this.layer.id)),i}prepareDrawPass(e,t){const i=e.program;if(e instanceof Kd)i.setUniform("opacity",this.paint.opacity());else if(e instanceof Wu);else if(e instanceof Qu){const e=this.layer.map.style.getFontTextures(this.context);(null==e?void 0:e.length)>0?i.setUniform("tFont[0]",e):(Ku||(Ku=new lo(this.context)),i.setUniform("tFont[0]",Ku))}}},ep="precision mediump float;attribute vec3 position;attribute vec2 uv;uniform highp mat4 modelViewMatrix;uniform mat4 viewMatrix;uniform highp mat4 projectionMatrix;uniform vec4 dataCoordOffset;varying vec2 vUv;void main(){vUv=uv;vUv=vec2(dataCoordOffset.x+(uv.x*dataCoordOffset.z),dataCoordOffset.y+(uv.y*dataCoordOffset.w));gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}",tp=wd(ep),ip=wd("precision highp float;<\n#defines>\n<\n#includes>\nuniform int interpolation;uniform float smoothing;uniform float dataChannel[2];uniform vec2 dataResolution;uniform float dataMeld;uniform vec2 dataRange;uniform vec2 drawRange;uniform vec2 sampleDataRange;uniform vec2 outputRange;uniform float noData;uniform float colorScaleRes;uniform float colorRangeFactor;uniform float colorSampleOffset;uniform float opacity;uniform float edgePad;uniform sampler2D dataTexture;uniform sampler2D dataTextureNext;uniform sampler2D colorScale;varying vec2 vUv;const float PI=3.14159265359;\n#include <color_lookup>\n#include <interpolated_texel>\nuniform ValueRange valueRange[VALUE_RANGE_COUNT];void main(){vec2 pos=vUv;vec2 px=1./dataResolution;vec2 tuv=vUv;vec2 tuv2=vUv;\n#include <skip_nodata>\n#include <get_texel>\n#include <get_data_value>\n#ifdef EXPRESSION_CUSTOM\nfloat value1=value;float value2=sampleColorValue(texel,dataChannel[1]);float dataValue1=sampleDataValue(valueRange[0],value1);float dataValue2=sampleDataValue(valueRange[1],value2);\n#include <custom_expression>\n#endif\nfloat dataValue=mix(sampleDataRange.x,sampleDataRange.y,value);\n#ifdef COLOR_LOOKUP\nif(dataValue<drawRange.x||dataValue>drawRange.y)discard;vec4 color=colorLookup(value,colorScaleRes,colorScale);\n#else\nvec4 color=vec4(value,0.,0.,1.);\n#endif\ncolor.a*=opacity;\n#ifdef DEBUG_EDGE\ncolor=texture2D(dataTexture,vUv);float pad=edgePad;vec2 edgeCheck=step(px*pad,tuv)*step(tuv,1.-px*pad);color.a*=edgeCheck.x*edgeCheck.y*0.9+0.1;\n#endif\ngl_FragColor=color;gl_FragColor.rgb*=gl_FragColor.a;}"),rp={dataTexture:{value:void 0},dataChannel:{value:0},interpolation:{value:0},smoothing:{value:0},opacity:{value:1}},ap=function(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[0,0,1,1];const a={x:1/e,y:1/t};return((e,t,i)=>[e.x+t.x*i[0],e.y+t.y*i[1],t.x*i[2],t.y*i[3]])({x:a.x*Math.min(i,e),y:0},a,r)},sp=class extends yd{constructor(e,t,i={}){super(e,i),this.colorLookupTables=[],this.program=t||e.cache.getProgram("colorize",[],(()=>new ed(e,{vertexShader:tp,fragmentShader:ip,uniforms:Object.assign({},rp),includes:a}))),this.mesh=new gd(e,e.cache.getFullscreenQuad().geometry,this.program)}draw(e){var t,i;const{renderables:r,interval:a,nextInterval:s}=e.state;for(let n=0,o=r.length;n<o;n++){const o=r[n],l=o.tile,h=l.data;h instanceof xr&&(h.updateTextures(this.context,a,s),this.canDrawTile(l)&&this.drawTile(e,o,{current:(null===(t=h.renderTargets.current)||void 0===t?void 0:t.texture)||h.textures.current,next:(null===(i=h.renderTargets.next)||void 0===i?void 0:i.texture)||h.textures.next}))}}canDrawTile(e){var t,i;return(null==e?void 0:e.data)instanceof xr&&he(null===(i=null===(t=e.data)||void 0===t?void 0:t.textures.current)||void 0===i?void 0:i.image)}drawTile(e,t,i){const r=i.current,a=i.next,s=this.program,n=this.mesh,o=void 0,l=t.tile,h=bd.fromTileRenderable(t,void 0),c=h.scale,d=h.offset,u=[...h.uvOffset],p=l.data instanceof xr?l.data.padding:0,m=ap(1,1,0,u);s.setUniform("dataResolution",new eh(r.size.width,r.size.height)),s.setUniform("dataCoordOffset",(new al).fromArray(m)),s.setUniform("dataTextureCoordOffset",(new al).fromArray(m)),s.setUniform("dataTexture",r),s.setUniform("dataTextureNext",a),s.setUniform("edgePad",p),n.scale.set(c.x,c.y,1),n.position.set(d.x,d.y,0),e.scene?e.scene.render(n,o):(n.updateMatrixWorld(),n.draw({camera:o}))}dispose(){this.colorLookupTables.forEach((e=>e.dispose())),super.dispose()}getColorLookupTable(e){return this.colorLookupTables.find((t=>t.channel===e))}},np=wd(ep),op=wd("precision mediump float;<\n#defines>\n<\n#includes>\nuniform float dataChannel[4];uniform float colorMaskChannel[4];uniform float colorMaskValue[4];uniform sampler2D dataTexture;varying vec2 vUv;\n#include <sample_color_value>\nvoid main(){vec4 texel=texture2D(dataTexture,vUv);float value=sampleColorValue(texel,dataChannel[0]);float mask1=sampleColorValue(texel,colorMaskChannel[0]);float mask2=sampleColorValue(texel,colorMaskChannel[1]);float mask3=sampleColorValue(texel,colorMaskChannel[2]);vec4 color=vec4(0.,0.,0.,value);if(mask1==colorMaskValue[0]){color.r=1.;}else if(mask2==colorMaskValue[1]){color.g=1.;}else if(mask3==colorMaskValue[2]){color.b=1.;}gl_FragColor=color;}"),lp=class extends yd{constructor(e,t,i={}){super(e),this.program=t||new ed(e,{vertexShader:np,fragmentShader:op,uniforms:Object.assign({},rp),includes:a}),this.mesh=new gd(e,e.cache.getFullscreenQuad().geometry,this.program)}draw(e){const{renderables:t,interval:i,nextInterval:r}=e.state;for(let a=0,s=t.length;a<s;a++){const s=t[a],n=s.tile,o=n.data;o instanceof xr&&(o.updateTextures(this.context,i,r),this.canDrawTile(n)&&this.drawTile(e,s,o.textures))}}canDrawTile(e){var t,i;return(null==e?void 0:e.data)instanceof xr&&he(null===(i=null===(t=e.data)||void 0===t?void 0:t.textures.current)||void 0===i?void 0:i.image)}drawTile(e,t,i){const r=t.tile.data;if(r instanceof xr){r.renderTargets.current||(r.renderTargets.current=this.createRenderTarget()),r.renderTargets.next||(r.renderTargets.next=this.createRenderTarget());const e=new bd;this.drawToRenderTarget(this.mesh,i.current,r.renderTargets.current,r.textures.current.size,e),this.drawToRenderTarget(this.mesh,i.next,r.renderTargets.next,r.textures.next.size,e)}}createRenderTarget(){return this.context.createFramebuffer({size:{width:Fn,height:Fn},minFilter:this.context.gl.NEAREST,magFilter:this.context.gl.NEAREST})}drawToRenderTarget(e,t,i,r,a){const s=this.context.cache.getFullscreenQuad().camera,n=a.scale,o=a.offset;i.resize(r.width,r.height),i.bind(),this.context.state.setViewport(r.width,r.height),e.program.setUniform("dataCoordOffset",(new al).fromArray([0,0,1,1])),e.program.setUniform("dataTexture",t),e.program.setUniform("dataResolution",new eh(t.size.width,t.size.height)),e.scale.set(n.x,n.y,1),e.position.set(o.x,o.y,0),e.updateMatrixWorld(),e.draw({camera:s})}},hp=wd(ep),cp=wd("#extension GL_OES_standard_derivatives : enable\nprecision highp float;<\n#defines>\n<\n#includes>\nuniform int interpolation;uniform float smoothing;uniform float dataChannel[4];uniform vec2 dataResolution;uniform float dataMeld;uniform vec2 dataRange[4];uniform vec2 drawRange[4];uniform float colorScaleRes[4];uniform float colorMaskChannel[4];uniform float colorMaskValue[4];uniform float opacity;uniform sampler2D dataTexture;uniform sampler2D dataTextureNext;uniform sampler2D colorScale[4];varying vec2 vUv;\n#include <color_lookup>\n#include <interpolated_texel>\nfloat interval(float v,float i){return floor(((v+i/2.)/i)+0.5)*i;}void main(){vec2 tuv=vUv;vec2 tuv2=vUv;\n#include <skip_nodata>\n#include <get_texel>\n#include <get_data_value>\nvec4 color=vec4(0.);\n#if defined(COLOR_LOOKUP)\nvec4 mask=texel;float mask1=mask.r;float mask2=mask.g;float mask3=mask.b;float t=0.01;if(mask3>t){color=colorLookup(value,colorScaleRes[2],colorScale[2]);}else if(mask2>t){color=colorLookup(value,colorScaleRes[1],colorScale[1]);}else{color=colorLookup(value,colorScaleRes[0],colorScale[0]);}\n#else\ncolor=vec4(value,0.,0.,1.);\n#endif\ncolor.a*=opacity;gl_FragColor=color;gl_FragColor.rgb*=gl_FragColor.a;}"),dp=class extends bu{prepareDrawPasses(){var e;if(super.prepareDrawPasses(),Object.keys(this.colorLookupTables).length>1){const e=new lp(this.context,void 0);e.prerender=!0,this.passes.addPass(e)}const t=this.getColorizeProgram(),i=new sp(this.context,t,{configurator:this});if(i.id="colorize-tile",i.enableBlend=!0,i.channel=Array.isArray(this.channel)?this.channel[0]:this.channel,i.colorLookupTables=this.colorLookupTables,this.layer.mask){const t=new Yd(this.context,[i]);t.clear=!0,t.prerender=!0,this.passes.addPass(t);const r=new Jd(this.context,{invert:this.layer.mask.inverted});r.enableBlend=!0,r.fullscreen=!0,r.texture=null===(e=t.renderTarget)||void 0===e?void 0:e.texture,r.textureId="tOutput",this.passes.addPass(r)}else this.passes.addPass(i)}stateForDrawPass(e,t){var i;const r=super.stateForDrawPass(e,t);if("mask"===e.id&&e instanceof Jd){const t=this.layer.mask;e.mask=t?null===(i=null==t?void 0:t.layer.renderer.renderTarget)||void 0===i?void 0:i.texture:new lo(this.context)}return r}prepareDrawPass(e,t){const i=e.program,r=Object.keys(this.colorLookupTables).length>1;this.setColorScaleUniforms(i),e instanceof sp&&(i.setUniform("opacity",this.paint.opacity()),this.valueRanges.forEach(((e,t)=>{i.setUniform(`valueRange[${t}].min`,e.min),i.setUniform(`valueRange[${t}].max`,e.max)})),r&&(i.setUniform("dataChannel[0]",Ar.indexOf("a")),i.setUniform("colorMaskChannel[0]",["r","g","b"].map((e=>Ar.indexOf(e))))))}getColorizeProgram(){const e=this.context,t=[...this.getProgramDefines(),"COLOR_LOOKUP",`VALUE_RANGE_COUNT ${this.valueRanges.length}`],i=this.config.channel,r=Object.keys(this.colorLookupTables).length>1,o=r?n:s;let l="";return ke(i)&&(this.addExpressionDefines(t,r),l=this.getCustomExpressionChunk()),e.cache.getProgram("sample-fill",t,(()=>new ed(e,{vertexShader:o.vertexShader,fragmentShader:o.fragmentShader,uniforms:Object.assign({},o.uniforms),defines:t,includes:Object.assign({custom_expression:l},a)})))}addExpressionDefines(e,t){const i=this.paint.sampleExpression(),r={[Tr.custom]:"EXPRESSION_CUSTOM",[Tr.vector]:"EXPRESSION_VECTOR",[Tr.sum]:"EXPRESSION_SUM",[Tr.difference]:"EXPRESSION_DIFF",[Tr.angle]:"EXPRESSION_ANGLE",[Tr.number]:"EXPRESSION_VALUE"};i in r&&e.push(r[i]),t&&e.push("COLOR_MASK_LOOKUP")}getCustomExpressionChunk(){var e;return this.paint.sampleExpression()===Tr.custom&&(null===(e=this.paint.sampleExpressionOperation())||void 0===e?void 0:e.chunk)||""}},up=class extends Wu{canDrawTile(e,t){var i,r;const{dataRenderables:a={},interval:s,nextInterval:n}=t.state,o=e.tile,{renderable:l}=a[o.coord.hash]||{},h=null==l?void 0:l.tile;return!!h&&(h.data.updateTextures(this.context,s,n),he(null===(r=null===(i=h.data)||void 0===i?void 0:i.textures.current)||void 0===r?void 0:r.image))}onDrawTile(e){this._drawTileCallback=e}prepareTile(e,t,i){var r,a,s;super.prepareTile(e,t,i);const n=i.program,o=t.tile,{dataRenderables:l={},interval:h,nextInterval:c}=e.state,{renderable:d,textures:u}=l[o.coord.hash]||{};if(d&&u){const e=d.tile;e.data.updateTextures(this.context,h,c);const t=d.uvOffset;let i=d.uvOffset,o=d.uvOffset;if(e.data){const a=Array.isArray(e.data)?e.data[0]:e.data,{columns:s,rows:n}=(null===(r=a.metadata)||void 0===r?void 0:r.layout)||{};i=ap(s,n,h,t),o=ap(s,n,c,t)}i=ap(1,1,0,t),o=ap(1,1,0,t),n.setUniform("dataTexture",null===(a=e.data)||void 0===a?void 0:a.textures.current),n.setUniform("dataTextureNext",null===(s=e.data)||void 0===s?void 0:s.textures.next),n.setUniform("dataCoordOffset",(new al).fromArray(i)),n.setUniform("dataCoordOffsetNext",(new al).fromArray(o))}}},pp=wd("precision mediump float;<\n#defines>\n<\n#includes>\nattribute vec2 position;attribute vec2 uv;attribute vec2 anchor;attribute vec4 glyph;attribute highp vec2 fillColor;attribute highp vec2 strokeColor;attribute highp float strokeWidth;attribute vec4 texCoordOffset;attribute float size;attribute float opacity;attribute float rotation;uniform mat4 modelViewMatrix;uniform mat4 viewMatrix;uniform mat4 modelMatrix;uniform mat4 worldMatrix;uniform mat4 projectionMatrix;uniform mat4 cameraPosition;uniform mat4 inverseViewMatrix;uniform mat4 labelPlaneMatrix;uniform mat4 glCoordMatrix;uniform mat4 tileMatrix;uniform float cameraToCenterDistance;uniform vec2 viewportSize;uniform float dpr;uniform float fontSize;uniform float pixelToUnit;uniform float pitch;uniform vec2 resolution;uniform vec4 tileCoordOffset;uniform int interpolation;uniform float smoothing;uniform float dataChannel[2];uniform vec2 dataResolution;uniform vec4 dataCoordOffset;uniform float dataMeld;uniform vec2 dataRange;uniform vec2 outputRange;uniform float noData;uniform sampler2D dataTexture;uniform sampler2D dataTextureNext;\n#ifdef USE_ATLAS\nuniform sampler2D tAtlas;uniform vec2 atlasRes;uniform float atlasColumns;uniform float atlasRows;uniform float atlasInterval;uniform vec2 atlasGlyphSize;\n#endif\nvarying vec2 vUv;varying vec2 vPosition;varying vec4 vColor;varying vec4 vStrokeColor;varying float vStrokeWidth;varying float vOpacity;varying float vSpeed;varying float vSpeedRatio;varying float vSize;varying float vRotation;varying vec2 vTuv;varying vec2 vData;\n#include <encoding>\n#include <transform>\n#include <interpolated_texel>\nvec2 transform(const vec2 pos,const vec4 unitSize){vec2 scale=vec2(1./unitSize.z,1./unitSize.w);return vec2((pos.x*scale.x)-unitSize.x*scale.x,(pos.y*scale.y)-unitSize.y*scale.y);}vec2 transform2(const vec2 uv,const vec4 offset){return vec2(offset.x+(uv.x*offset.z),offset.y+(uv.y*offset.w));}void main(){vec2 adjustedAnchor=transform(anchor.xy/EXTENT,tileCoordOffset);vec4 projectedAnchor=projectionMatrix*modelViewMatrix*vec4(adjustedAnchor.xy,0.,1.);float symbolScale=1.;vec2 tuv=vec2(dataCoordOffset.x+(adjustedAnchor.x*dataCoordOffset.z),dataCoordOffset.y+(adjustedAnchor.y*dataCoordOffset.w));vec2 tuv2=tuv;\n#include <get_texel>\n#include <get_data_value>\nangle+=rotation;float symbolAngle=angle;vUv=vec2(texCoordOffset.x+(uv.x*texCoordOffset.z),texCoordOffset.y+(uv.y*texCoordOffset.w));vRotation=angle;vSpeed=length(dataRange.y)*value;vSpeedRatio=value;vSize=value*0.5;vTuv=tuv;vColor=decode_color(fillColor);vStrokeColor=decode_color(strokeColor);vStrokeWidth=strokeWidth;vOpacity=opacity;vPosition=position;\n#ifdef NODATA\nvec4 tex=texture2D(dataTexture,tuv);float dd=sampleColorValue(tex,dataChannel[0]);float edge=isEdge(dataTexture,tuv,dataResolution,noData,dataChannel[0]);if(dd==noData)vSpeed=-1.;if(edge==1.)vSpeed=-1.;\n#endif\n#ifdef USE_ATLAS\nvec2 glyphSize=vec2(1./atlasColumns,1./atlasRows);float v=length(dataRange.y)*value;float vi=floor(v/atlasInterval);float gc=fract(vi/atlasColumns)*atlasColumns;float gr=floor(vi/atlasColumns);vec2 atlasPos=vec2(gc*glyphSize.x,gr*glyphSize.y);vUv=transform2(uv,vec4(atlasPos.x,atlasPos.y,glyphSize.x,glyphSize.y));\n#endif\n#include <symbol_vert_position>\nfloat gammaScale=finalPosition.w;vData=vec2(gammaScale,size);}"),mp=wd("precision mediump float;<\n#defines>\n<\n#includes>\nuniform float dpr;\n#ifdef COLOR_LOOKUP\nuniform sampler2D colorScale;uniform float colorScaleRes;\n#else\nuniform vec4 fillColor;uniform vec4 strokeColor;\n#endif\nvarying vec2 vUv;varying float vSpeed;varying float vSpeedRatio;varying float vSize;varying float vRotation;varying vec2 vTuv;\n#include <color_lookup>\n#include <sdf_draw>\n#include <sdf_arrows>\nvoid main(){if(vSpeed<0.)discard;vec2 pos=vUv-vec2(0.,0.5);float bodySize=mix(0.3,2.,vSize);float headSize=0.1;float lineWidth=mix(0.18,0.12,vSize);float height=1.;vec4 fill=vec4(1.);vec4 stroke=vec4(0.,0.,0.,1.);vec4 color;\n#ifdef COLOR_LOOKUP\nfill=colorLookup(vSpeedRatio,colorScaleRes,colorScale);\n#else\nfill=fillColor;stroke=strokeColor;\n#endif\nif(vSpeed>=1.){float d=arrow_stealth(pos.xy,bodySize,headSize,height,lineWidth,1.);color=filled(d,0.15,0.01,fill);}else{float d=disc(pos,0.15);color=filled(d,0.01,0.01,fill);}gl_FragColor=color;}");new eh(10,10);class fp{constructor(e){this.extent=Co,this.type=1,this._points=[],this._points=e}asPoints(){return this._points}asLines(){throw new Error("Method not implemented.")}asPolygons(){throw new Error("Method not implemented.")}}const gp=wd("#extension GL_OES_standard_derivatives : enable\nprecision mediump float;<\n#defines>\n<\n#includes>\nuniform float intensity;uniform float blur;uniform float weight;uniform vec4 tileCoordOffset;varying vec2 vUv;varying vec2 vPosition;void main(){vec2 pos=vUv;float dist=length(2.*pos-1.);vec2 maxPosition=vec2(tileCoordOffset.x+(vPosition.x*tileCoordOffset.z),tileCoordOffset.y+(vPosition.y*tileCoordOffset.w));if(vPosition.x<maxPosition.x||vPosition.y<maxPosition.y)discard;if(dist>=1.)discard;float alpha=(intensity*weight)*blur*(1.-sqrt(dist));vec4 color=vec4(0.,0.,0.,alpha);gl_FragColor=color;gl_FragColor.rgb*=gl_FragColor.a;}"),vp={pointSize:{value:20},intensity:{value:10},blur:{value:1},weight:{value:20}},yp=wd("precision mediump float;attribute vec3 position;attribute vec2 uv;uniform mat4 modelViewMatrix;uniform mat4 viewMatrix;uniform mat4 modelMatrix;uniform mat4 projectionMatrix;varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"),xp=wd("precision mediump float;<\n#defines>\n<\n#includes>\nuniform sampler2D dataTexture;uniform sampler2D colorScale;uniform float colorScaleRes;uniform float opacity;varying vec2 vUv;\n#include <color_lookup>\nvoid main(){vec4 texel=texture2D(dataTexture,vUv);vec4 color=colorLookup(texel.a,colorScaleRes,colorScale);gl_FragColor=color;gl_FragColor=vec4(floor(255.*color*opacity)/255.);}"),bp={opacity:{value:1}},wp=(wd("precision mediump float;attribute vec3 position;attribute vec2 uv;uniform mat4 modelViewMatrix;uniform mat4 viewMatrix;uniform mat4 modelMatrix;uniform mat4 projectionMatrix;varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"),wd("#extension GL_OES_standard_derivatives : enable\nprecision highp float;<\n#defines>\n<\n#includes>\nuniform float opacity;uniform vec2 resolution;uniform int interpolation;uniform float smoothing;uniform vec2 dataResolution;uniform float dataMeld;uniform vec2 dataRange;uniform vec2 drawRange;uniform vec2 outputRange;uniform float noData;uniform float dataChannel[2];uniform float colorScaleRes;uniform float valueInterval;uniform float majorValueInterval;uniform float width;uniform float majorWidth;uniform float valueScale;uniform float valueOffset;uniform sampler2D dataTexture;uniform sampler2D dataTextureNext;uniform sampler2D colorScale;varying vec2 vUv;\n#include <color_lookup>\n#include <interpolated_texel>\n#include <isolines>\nconst float PI=3.14159265359;float eval2(vec2 uv,sampler2D tex){vec4 texel=interpolatedTexel(interpolation,tex,vec2(1.,0.)+uv*.04,dataResolution);return 5.+100.*texel.r;}vec3 desaturate(vec3 color,float amount){vec3 gray=vec3(dot(vec3(0.2126,0.7152,0.0722),color));return vec3(mix(color,gray,amount));}float contourFunction(float parameter,float lineWidth,float lineFeather){float f=parameter*2.;float w1=lineWidth-lineFeather*0.5;float d=length(vec2(dFdx(f),dFdy(f)));float looped=0.5-abs(mod(f,1.)-0.5);return smoothstep(d*w1,d*(w1+lineFeather),looped);}float logStripesColormap(float f,float spacing){return 2.*(0.5-abs(fract(log2(abs(f))/spacing)-0.5));}float random(vec3 scale,float seed){return fract(sin(dot(gl_FragCoord.xyz+seed,scale))*43758.5453+seed);}void main(){vec2 pos=vUv;vec4 color=vec4(vec3(0.),1.);float dmin=dataRange.x;float dmax=dataRange.y;float drange=abs(dmax-dmin);vec2 uv=vUv;vec2 px=1./resolution.xy;vec2 tuv=vUv;vec2 tuv2=vUv;\n#include <skip_nodata>\n#include <get_texel>\n#include <get_data_value>\n#ifdef EXPRESSION_VECTOR\ndmin=0.;drange=dmax;\n#endif\nfloat val=eval(value,drange*valueScale);val+=valueOffset;vec4 pallete=vec4(vec3(0.),1.);\n#ifdef COLOR_LOOKUP\npallete=colorLookup(value,colorScaleRes,colorScale);\n#endif\nfloat contour=1.;float interval=valueInterval;float minOffset=mod(dmin,interval);float maxOffset=mod(dmax,interval);float offset=minOffset+maxOffset;float thickness=width;float ncontours=floor(drange/interval);ncontours+=1.+op_when_neq_f(offset,0.)*1.;ncontours*=0.5;float scaledVal=max(0.001,min(1.,value))+0.0007+minOffset;float minorContour=contourFunction(scaledVal*ncontours,thickness,1.);if(width>0.)contour*=minorContour;interval=majorValueInterval;thickness=majorWidth;ncontours*=(valueInterval/majorValueInterval);float majorContour=contourFunction(scaledVal*ncontours,thickness,1.);if(majorWidth>0.)contour*=majorContour;color=mix(vec4(0.),pallete,1.-contour);gl_FragColor=color*opacity;}")),_p=(e,t,i)=>{if(0==e)return t[i+0]=0,t[i+1]=0,t[i+2]=0,void(t[i+3]=0);const r=Math.abs(e);let a,s=Math.floor(Math.log2(r));s+=Mp(s)<=r/2?1:0,s-=Mp(s)>r?1:0,a=s>100?r/1024/Mp(s-10)-1:r/Mp(s)-1;const n=s+127;a*=256;const o=Math.floor(a);a-=o,a*=256;const l=Math.floor(a);a-=l,a*=128;const h=2*Math.floor(a)+(e<0?1:0);t[i+0]=n,t[i+1]=o,t[i+2]=l,t[i+3]=h},Mp=e=>Math.exp(e*Math.LN2),Ap=class extends ro{get read(){return this._read}get write(){return this._write}constructor(e,t={}){super(e),this._onSwap=t.onSwap||(()=>{}),this.reset(t)}setSize(e,t){this.read.resize(e,t),this.write.resize(e,t)}render(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.write.bind(),e(this.read,this.write),this.write.unbind(),t&&this.swap()}swap(){const e=this._read;this._read=this._write,this._write=e,this._onSwap(this.read,this.write)}clear(){const e=this.context.gl;this.read.clear(e.COLOR_BUFFER_BIT),this.write.clear(e.COLOR_BUFFER_BIT)}reset(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.dispose(),this._read=new ac(this.context,e),this._write=new ac(this.context,e),this._read.name="FBO.a",this._write.name="FBO.b"}dispose(){var e,t;null===(e=this.read)||void 0===e||e.dispose(),null===(t=this.write)||void 0===t||t.dispose()}};var Sp;let Tp=null;const Ep=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(Tp&&Tp.count===e)return Tp.data;const i={x:new Uint8Array(4*e),y:new Uint8Array(4*e),a:new Uint8Array(4*e)};for(let r=0;r<e;r++)_p(Math.random(),i.x,4*r),_p(Math.random(),i.y,4*r),i.a[4*r+0]=255*(t?Math.random():1),i.a[4*r+1]=0,i.a[4*r+2]=0,i.a[4*r+3]=0;return Tp={data:i,count:e},i};Sp=new WeakMap;const Op=class{get resolution(){return Math.sqrt(this.count)}constructor(e={}){this.needsInitialize=!1,this.needsUpdate=!0,Sp.set(this,void 0),function(e,t,i,r,a){if("function"==typeof t||!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");t.set(e,i)}(this,Sp,Object.assign({},e))}initialize(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.count=t;const r=e.gl,a=Ep(t,i),s=Object.assign({size:{width:this.resolution,height:this.resolution},minFilter:r.NEAREST,magFilter:r.NEAREST},function(e,t,i,r){if("function"==typeof t||!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t.get(e)}(this,Sp));this.x&&this.x.dispose(),this.y&&this.y.dispose(),this.a&&this.a.dispose(),this.x=new Ap(e,Object.assign({data:a.x},s)),this.y=new Ap(e,Object.assign({data:a.y},s)),this.a=new Ap(e,Object.assign({data:a.a},s))}reset(){const e=Ep(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.count,!(arguments.length>1&&void 0!==arguments[1])||arguments[1]);this.x.reset({data:e.x}),this.y.reset({data:e.y}),this.a.reset({data:e.a})}each(e){[this.x,this.y,this.a].forEach(((t,i)=>e(t,i)))}dispose(){this.x.dispose(),this.y.dispose(),this.a.dispose()}},Cp=class extends yd{constructor(){super(...arguments),this.dataTextures=[]}draw(e){throw new Error("[MapsGL] Subclasses must override `draw`")}setDataUniforms(e,t){const i=this.program,r=t.uvOffset,a=t.uvOffset;i.setUniform("dataCoordOffset",(new al).fromArray(r)),i.setUniform("dataCoordOffsetNext",(new al).fromArray(a));for(let e=0;e<this.dataTextures.length;e++){const{id:t,texture:r}=this.dataTextures[e];i.setUniform(t,r),i.setUniform("dataResolution",new eh(r.size.width,r.size.height))}}dispose(){super.dispose(),this.dataTextures.forEach((e=>{let{texture:t}=e;return t.dispose()}))}},Rp=wd("precision highp float;attribute vec2 position;attribute vec2 uv;uniform mat4 modelViewMatrix;uniform mat4 viewMatrix;uniform mat4 modelMatrix;uniform mat4 projectionMatrix;varying vec2 vUv;void main(){vUv=position;gl_Position=projectionMatrix*modelViewMatrix*vec4(position.xy,0.,1.);}"),Pp=wd("precision highp float;<\n#defines>\n<\n#includes>\nuniform int interpolation;uniform float smoothing;uniform vec2 resolution;uniform float dataChannel[2];uniform vec2 dataResolution;uniform vec4 dataCoordOffset;uniform mat4 dataMatrix;uniform float dataMeld;uniform vec2 dataMin;uniform vec2 dataMax;uniform vec2 dataRange;uniform vec2 drawRange;uniform vec2 outputRange;uniform float noData;uniform float colorScaleRes;uniform bool initialize;uniform float speedFactor;uniform float fadeInIncrement;uniform float randomSeed;uniform float dropRate;uniform float dropRateBump;uniform int positionOutCoord;uniform sampler2D dataTexture;uniform sampler2D dataTextureNext;uniform sampler2D tPositionX;uniform sampler2D tPositionY;uniform sampler2D tAlpha;varying vec2 vUv;\n#include <texture_lookup_3x3>\n#include <color_lookup>\n#include <interpolated_texel>\n#include <decode_float_rgba>\n#include <encode_float_rgba>\nfloat rand(const vec2 co){float t=dot(vec2(12.9898,78.233),co);return fract(sin(t)*(4375.85453+t));}vec2 transformData(vec2 pos,mat4 matrix){vec4 transformed=matrix*vec4(pos.xy,1.,1.);return transformed.xy/transformed.w;}const float PI=3.14159265359;vec4 update(vec4 data){vec2 pos=data.xy;float alpha=data.z;float rotation=data.w;vec2 uv=pos;uv=transformData(uv,dataMatrix);uv=vec2(dataCoordOffset.x+(uv.x*dataCoordOffset.z),dataCoordOffset.y+(uv.y*dataCoordOffset.w));vec2 tuv=uv;vec2 tuv2=uv;\n#include <get_texel>\n#include <get_data_value>\nfloat speed=value;rotation=angle;vec2 offset=vec2(velocity.x,-velocity.y)*0.0001*speedFactor;pos+=offset;vec2 seed=(pos+vUv)*randomSeed;float rate=dropRate+speed*dropRateBump;rate+=smoothstep(0.24,0.5,length(pos-vec2(0.5,0.5))*0.7);float drop=step(1.-rate,rand(seed));vec2 randomPos=vec2(0.5*rand(seed+1.3)+0.25,0.5*rand(seed+2.1)+0.25);alpha+=fadeInIncrement;alpha=mix(min(alpha,1.),0.,drop);vec2 nextPos=mix(pos,randomPos,drop);return vec4(nextPos,alpha,rotation);}void main(){vec4 state=texture2D(tAlpha,vUv);vec4 data=vec4(decodeFloatRGBA(texture2D(tPositionX,vUv)),decodeFloatRGBA(texture2D(tPositionY,vUv)),state.r,state.g);data=update(data);if(initialize){for(int i=0;i<100;i++){data=update(data);}}if(positionOutCoord==0){gl_FragColor=vec4(encodeFloatRGBA(data.x));}else if(positionOutCoord==1){gl_FragColor=vec4(encodeFloatRGBA(data.y));}else if(positionOutCoord==2){gl_FragColor=vec4(data.z,data.w/(PI*2.),0.,1.);}}"),kp={},Dp=class extends Cp{constructor(e,t=[]){super(e),this.dataMatrix=new bc,this.program=e.cache.getProgram("update-particles",t,(()=>new ed(e,{vertexShader:Rp,fragmentShader:Pp,uniforms:Object.assign({},kp),defines:t,includes:a}))),this.mesh=new gd(this.context,e.cache.getFullscreenQuad().geometry,this.program)}draw(e){const t=this.context,{renderables:i,dataRange:r}=e.state,a=this.mesh,s=a.program;for(let n=0,o=i.length;n<o;n++){const o=i[n],l=o.tile.data;if(!l||l instanceof Op==0)return void console.warn("[MapsGL] Invalid particle state");if(!0!==l.needsUpdate)continue;this.setDataUniforms(e,o),s.setUniform("dataMin",new eh(r.min,r.min)),s.setUniform("dataMax",new eh(r.max,r.max)),s.setUniform("dataMatrix",this.dataMatrix),s.setUniform("initialize",+l.needsInitialize),s.setUniform("tPositionX",l.x.read.texture),s.setUniform("tPositionY",l.y.read.texture),s.setUniform("tAlpha",l.a.read.texture);const h=l.resolution;t.state.setViewport(h,h),l.each(((e,i)=>{s.setUniform("positionOutCoord",i),e.write.bind(),a.draw({camera:t.cache.getFullscreenQuad().camera}),e.swap()})),l.needsInitialize=!1,l.needsUpdate=!1}}},zp=wd("precision highp float;<\n#defines>\n<\n#includes>\nattribute vec2 position;attribute vec2 uv;attribute float particleIndex;attribute vec2 reference;uniform sampler2D particles;uniform sampler2D tPositionX;uniform sampler2D tPositionY;uniform sampler2D tAlpha;uniform vec2 particleSize;uniform mat4 dataMatrix;uniform vec2 resolution;uniform float dpr;uniform float pitch;uniform float cameraToCenterDistance;uniform mat4 modelViewMatrix;uniform mat4 viewMatrix;uniform mat4 modelMatrix;uniform mat4 projectionMatrix;uniform mat4 labelPlaneMatrix;uniform mat4 glCoordMatrix;varying vec2 vUv;varying vec2 vParticlePos;varying vec4 vColor;varying float vAlpha;varying float vRotation;varying float vDegrees;const float PI=3.14159265359;vec2 transformData(vec2 pos,mat4 matrix){vec4 transformed=matrix*vec4(pos.xy,1.,1.);return transformed.xy/transformed.w;}\n#include <decode_float_rgba>\n#include <transform>\nvoid main(){vec2 fuv=reference;vec2 anchor=vec2(decodeFloatRGBA(texture2D(tPositionX,fuv)),decodeFloatRGBA(texture2D(tPositionY,fuv)));anchor=transformData(anchor,dataMatrix);vec4 state=texture2D(tAlpha,fuv);highp vec4 projectedAnchor=projectionMatrix*modelViewMatrix*vec4(anchor,0.,1.);vec2 size=particleSize;vec4 glyph=vec4(-size.x*0.5,-size.y*0.5,size.x,size.y);float symbolScale=1.;float angle=0.;float deg=state.g*360.;float rad=deg*(PI/180.);float valueU=sin(rad);float valueV=cos(rad);vec2 vector=vec2(valueU,valueV);vec2 velocity=vector;\n#ifdef EXPRESSION_ANGLE\nangle=atan(velocity.x,-velocity.y);\n#else\nangle=atan(velocity.x,-velocity.y);\n#endif\nangle-=PI/2.;\n#ifdef STYLE_ARROW\nangle-=PI/2.;\n#endif\nif(angle<0.)angle+=PI*2.;float symbolAngle=angle;\n#include <symbol_vert_position>\nvUv=uv;vAlpha=state.r;vRotation=state.g;vParticlePos=anchor;vDegrees=deg;}"),Ip=wd("precision highp float;<\n#defines>\n<\n#includes>\nuniform int interpolation;uniform float smoothing;uniform float dataChannel[2];uniform vec2 dataResolution;uniform vec4 dataCoordOffset;uniform mat4 dataMatrix;uniform float dataMeld;uniform vec2 dataMin;uniform vec2 dataMax;uniform vec2 dataRange;uniform vec2 drawRange;uniform vec2 sampleDataRange;uniform vec2 outputRange;uniform float noData;uniform float colorScaleRes;uniform sampler2D dataTexture;uniform sampler2D dataTextureNext;uniform sampler2D colorScale;varying vec2 vUv;varying vec2 vParticlePos;varying float vAlpha;varying float vRotation;varying float vDegrees;\n#include <texture_lookup_3x3>\n#include <color_lookup>\n#include <interpolated_texel>\n#include <transform>\n#include <sdf_draw>\n#include <sdf_arrows>\nconst float PI=3.14159265359;vec2 transformData(vec2 pos,mat4 matrix){vec4 transformed=matrix*vec4(pos.xy,1.,1.);return transformed.xy/transformed.w;}void main(){vec2 pos=vParticlePos;vec2 uv=pos;uv=vec2(dataCoordOffset.x+(uv.x*dataCoordOffset.z),dataCoordOffset.y+(uv.y*dataCoordOffset.w));vec2 tuv=uv;vec2 tuv2=uv;\n#include <skip_nodata>\n#if defined(TEXTURE_3X3_LOOKUP)\nvec4 texel1=textureLookup(tuv);vec4 texel2=textureLookup(tuv2);vec4 texel=mix(texel1,texel2,dataMeld);\n#else\n#include <get_texel>\n#endif\nif(texel.a<1.)discard;\n#include <get_data_value>\nfloat dataValue=sampleDataRange.x+(sampleDataRange.y-sampleDataRange.x)*value;if(dataValue<drawRange.x)discard;if(dataValue>drawRange.y)discard;vec4 color=colorLookup(value,colorScaleRes,colorScale);float alpha=1.;\n#ifdef STYLE_BAR\n#endif\n#ifdef STYLE_ARROW\nfloat size=0.3;pos=vUv-vec2(0.,0.5);float bodySize=mix(0.3,2.,size);float headSize=0.1;float lineWidth=mix(0.18,0.12,size);float height=1.;vec4 fill=vec4(1.);float d=arrow_stealth(pos.xy,bodySize,headSize,height,lineWidth,1.);color=filled(d,0.15,0.01,color);\n#endif\n#ifdef STYLE_POINT\nfloat distance=length(2.*vUv-1.);if(distance>1.)discard;\n#endif\nalpha*=vAlpha;gl_FragColor=color;gl_FragColor.a=alpha*color.a;gl_FragColor.rgb*=gl_FragColor.a;}"),Fp={},Lp=class extends Cp{get fbo(){return this._fbo}get renderTarget(){if(this.fbo&&this.offscreen)return this.fbo.write}constructor(e,t,i=[]){super(e),this.dataMatrix=new bc;const r=e.gl;this.program=e.cache.getProgram("draw-particles",i,(()=>new ed(this.context,{vertexShader:zp,fragmentShader:Ip,uniforms:Object.assign({},Fp),defines:i,includes:a})));const{interleaved:s}=this.generateParticleData(t),n=(new Float32Array).BYTES_PER_ELEMENT,o=new Bl(e.gl,s,3*n),l=new kl(e,{position:{size:2,data:new Float32Array([0,1,0,0,1,0,1,1])},uv:{size:2,data:new Float32Array([0,1,0,0,1,0,1,1])},particleIndex:new El(o,1,!1,0,1),reference:new El(o,2,!1,1*n,1)});l.setIndex([0,1,2,0,2,3]),this.mesh=new gd(this.context,l,this.program),this.mesh.drawMode=e.gl.TRIANGLES,this._fbo=new Ap(e,{size:e.resolution,minFilter:r.LINEAR,magFilter:r.LINEAR}),e.on("resize",(e=>{let{width:t,height:i}=e;this._fbo.read.resize(t,i),this._fbo.write.resize(t,i)}))}draw(e){const t=this.context,{renderables:i,dataRange:r,drawRange:a,transform:s}=e.state,n=this.mesh,o=n.program,l=e.renderTarget?t.cache.getFullscreenQuad().camera:void 0,h=t.resolution;for(let t=0,c=i.length;t<c;t++){const c=i[t],d=c.tile.data;if(!d||d instanceof Op==0)return;const u=bd.fromTileRenderable(c),p=u.scale,m=u.offset;this.setDataUniforms(e,c),o.setUniform("resolution",new eh(h.width,h.height)),o.setUniform("labelPlaneMatrix",s.labelPlaneMatrix),o.setUniform("glCoordMatrix",s.glCoordMatrix),o.setUniform("dataMatrix",this.dataMatrix),o.setUniform("dataMin",new eh(r.min,r.min)),o.setUniform("dataMax",new eh(r.max,r.max)),o.setUniform("drawRange",new eh(a.min,a.max)),o.setUniform("tPositionX",d.x.read.texture),o.setUniform("tPositionY",d.y.read.texture),o.setUniform("tAlpha",d.a.read.texture),n.scale.set(p.x,p.y,1),n.position.set(m.x,m.y,0),e.scene&&!e.renderTarget?e.scene.render(n,l):(n.updateMatrixWorld(),n.draw({camera:l}))}}resetParticles(){this.fbo.clear()}dispose(){var e;super.dispose(),this._fbo.dispose(),null===(e=this.mesh.geometry)||void 0===e||e.dispose()}generateParticleData(e){const t=Math.sqrt(e),i=new Float32Array(e),r=new Float32Array(2*e),a=new Float32Array(3*e);for(let s=0;s<e;s++){const e=s%t/t,n=Math.trunc(s/t)/t;r.set([e,n],2*s),i[s]=s,a.set([s,e,n],3*s)}return{indexes:i,references:r,interleaved:a}}},jp=class extends Hd{constructor(e,t){super(e,t),this.renderTargets={};const i={size:{width:Fn,height:Fn},minFilter:e.gl.NEAREST,magFilter:e.gl.NEAREST};this.renderTargets.current=new ac(e,i),this.renderTargets.next=new ac(e,i)}draw(e){var t;const{renderables:i,interval:r,nextInterval:a}=e.state;this.renderTargets.current.clear(this.context.gl.COLOR_BUFFER_BIT),this.renderTargets.next.clear(this.context.gl.COLOR_BUFFER_BIT);for(let s=0,n=i.length;s<n;s++){const n=i[s],o=n.tile;if(o.data instanceof xr)o.data&&o.data.updateTextures(this.context,r,a),this.canDrawTile(o)&&this.drawEncodedTile(e,n,o.data.textures);else{const i=null===(t=this._tileCache.textures)||void 0===t?void 0:t.get(o.coord.hash);i&&this.drawTile(e,n,{current:i.texture,next:void 0})}}}canDrawTile(e){var t,i;return(null==e?void 0:e.data)instanceof xr?he(null===(i=null===(t=e.data)||void 0===t?void 0:t.textures.current)||void 0===i?void 0:i.image):super.canDrawTile(e)}drawEncodedTile(e,t,i){var r;const{tileSize:a,tileSpan:s,dataRegion:n}=(null===(r=e.configurator)||void 0===r?void 0:r.stateForDrawPass(this,e))||{},o=this.mesh,l=o.program,h=e.renderTarget?this.context.cache.getFullscreenQuad().camera:void 0,c=bd.fromTileRenderable(t,h?n:void 0),d=c.scale,u=c.offset,p=[...c.uvOffset];let m=p,f=p;m=ap(1,1,0,p),f=ap(1,1,0,p),l.setUniform("dataResolution",new eh(i.current.size.width,i.current.size.height)),l.setUniform("dataCoordOffset",(new al).fromArray(m)),l.setUniform("dataTextureCoordOffset",(new al).fromArray(m)),l.setUniform("dataTexture",i.current),l.setUniform("dataTextureNext",i.current);const g={width:a.width*s.x,height:a.width*s.y},v=new bd;v.scale={x:d.x,y:d.y,z:1},v.offset={x:u.x,y:u.y,z:0};const y=new bd;y.scale={x:n.scale.x,y:n.scale.y,z:1},y.offset={x:n.offset.x,y:n.offset.y,z:0};const x=((e,t)=>{const i=t.scale,r=t.offset,a={x:(e.offset.x-r.x)*i.x,y:(e.offset.y-r.y)*i.y,z:0},s={x:e.scale.x*i.x,y:e.scale.y*i.y,z:1},n=new bd;return n.offset=a,n.scale=s,n.uvOffset=e.uvOffset,n})(v,y);l.setUniform("dataTexture",i.current),this.drawTileToRenderTarget(o,this.renderTargets.current,g,m,x,!1),l.setUniform("dataTexture",i.next),this.drawTileToRenderTarget(o,this.renderTargets.next,g,f,x,!1)}drawTileToRenderTarget(e,t,i,r,a){let s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const n=this.context,o=a.scale,l=a.offset;e.program.setUniform("dataCoordOffset",(new al).fromArray(r)),e.program.setUniform("dataTextureCoordOffset",(new al).fromArray(r)),t.resize(i.width,i.height),t.bind(),s&&n.state.clear(!0),n.state.setViewport(i.width,i.height),e.scale.set(o.x,o.y,1),e.position.set(l.x,l.y,0),e.updateMatrixWorld(),e.draw({camera:this.context.cache.getFullscreenQuad().camera}),t.unbind()}calculateTextureCoordOffset(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;var i;const r=e.tile;let a=e.uvOffset;if(r.data){const e=Array.isArray(r.data)?r.data[0]:r.data,{columns:s,rows:n}=(null===(i=e.metadata)||void 0===i?void 0:i.layout)||{};a=ap(s,n,t,a)}return a}dispose(){super.dispose(),this.context.cache.hasProgram(this.mesh.program)||this.mesh.program.dispose(),Object.values(this.renderTargets).forEach((e=>e.dispose()))}},Np="precision mediump float;attribute vec2 position;attribute vec2 uv;uniform mat4 modelViewMatrix;uniform mat4 viewMatrix;uniform mat4 modelMatrix;uniform mat4 projectionMatrix;varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position.xy,0.,1.);}",Up=wd(Np),Vp=wd("precision mediump float;uniform float opacity;uniform sampler2D tOutput;varying vec2 vUv;void main(){vec4 color=texture2D(tOutput,vUv);gl_FragColor=vec4(floor(255.*color*opacity)/255.);}"),Bp={dataTexture:{value:void 0}},$p=class extends bu{constructor(e={}){super(lt({paint:{particle:{count:0,density:Vr.normal,size:2,speed:1,trails:!0,trailsFade:.97,dropRate:.01,dropRateBump:.01}}},e)),this._particleZoomOffset=-2,this._renderTrails=!1,this._memoizedTotalParticles=new Map,this.paint.particleCount()>0&&this.paint.setProperty("particle.density",Vr.count),this._renderTrails=this.paint.particleTrails()}onRemove(e){super.onRemove(e);const t=this.passes.getPass("draw-particles");t&&t.resetParticles()}onMoveStart(e){this.updateParticleDrawPasses(!1)}onMoveEnd(e){this.updateParticleDrawPasses(this.paint.particleTrails())}setNeedsUpdate(){}setup(){super.setup(),this._particleState=new to({capacity:100,onRemove:(e,t)=>{}}),this.isAnimated=!0}prepareDrawPasses(){var e;const t=this.context,i=this.layer.source;this.passes.removeAllPasses();const r=new jp(t,i.tiles);r.id="draw-tiles",r.prerender=!0,this.passes.addPass(r);const s=this.paint.sampleExpression(),n=this.paint.particleType(),o=[...this.getProgramDefines()];o.push(s===Tr.angle?"EXPRESSION_ANGLE":"EXPRESSION_VECTOR"),o.push("bar"===n?"STYLE_BAR":"arrow"===n?"STYLE_ARROW":"STYLE_POINT");const l=new bc;l.translate(new Mn(-.5,-.5,0)),l.scale(new Mn(2,2,1));const h=new Dp(t,o);h.id="update-particles",h.prerender=!0,h.dataMatrix=l,this.passes.addPass(h);const c=Math.pow(256,2),d=new Lp(t,c,o);d.id="draw-particles",d.prerender=this._renderTrails,d.enableBlend=!0,d.dataMatrix=l,this._renderTrails&&d.configureRenderTarget(),r.configureRenderTarget(),r.prerender=!0,h.dataTextures=[{id:"dataTexture",texture:r.renderTargets.current.texture},{id:"dataTextureNext",texture:r.renderTargets.next.texture}],d.dataTextures=[{id:"dataTexture",texture:r.renderTargets.current.texture},{id:"dataTextureNext",texture:r.renderTargets.next.texture}];const u=t.cache.getProgram("output-particles",[],(()=>new ed(t,{vertexShader:Up,fragmentShader:Vp,uniforms:Object.assign({opacity:1},Bp),includes:a}))),p=new Kd(t,u);p.id="draw-trails",p.fullscreen=!0,p.offscreen=!0,p.prerender=!0,p.textureId="tOutput",p.fbo=d.fbo,this.passes.addPass(p);const m=new Kd(t,u);if(m.id="draw-screen",m.fullscreen=!0,m.textureId="tOutput",m.enableBlend=!0,m.fbo=d.fbo,m.needsSwap=!0,this.layer.mask){const i=new Yd(t,[d,m]);i.clear=!0,this.passes.addPass(i);const r=new Jd(t,{invert:this.layer.mask.inverted});r.enableBlend=!0,r.fullscreen=!0,r.texture=null===(e=i.renderTarget)||void 0===e?void 0:e.texture,r.textureId="tOutput",this.passes.addPass(r)}else this.passes.addPass(d),this.passes.addPass(m)}updateParticleDrawPasses(e){this._renderTrails=e,this.layer.mask?(this.passes.withPass("save",(t=>{const i=t.getPass("draw-particles");i instanceof Lp&&(i.prerender=e,i.offscreen=e,e||i.fbo.clear());const r=t.getPass("draw-screen");r&&(r.enabled=e)})),this.passes.enablePass("draw-trails",e)):(this.passes.withPass("draw-particles",(t=>{t.prerender=e,t.offscreen=e,e||t.fbo.clear()})),this.passes.enablePass("draw-trails",e),this.passes.enablePass("draw-screen",e))}stateForDrawPass(e,t){var i,r;if("mask"===e.id&&e instanceof Jd){const t=this.layer.mask;e.mask=t?null===(r=null===(i=t.layer)||void 0===i?void 0:i.renderer.renderTarget)||void 0===r?void 0:r.texture:new lo(this.context)}else if("draw-tiles"===e.id)return super.stateForDrawPass(e,t);return{renderables:this._getParticleRenderables(),dataRange:this.dataRange,drawRange:this.drawRange,dataRegion:this.renderState.dataRegion,renderRegion:this.renderState.renderRegion,gridded:!1,interval:this.timeState.index,nextInterval:this.timeState.nextIndex,layerId:this.layer.id,style:this.paint,elapsedTime:this.renderState.elapsedTime,mapZoom:this.layer.map.getZoom(),transform:this.layer.map.transform}}prepareDrawPass(e,t){const i=e.program,r=this.context,a=r.resolution,s=this.layer.map.getZoom(),n=Math.min(1,60/this.layer.map.fps);if(i&&this.setColorScaleUniforms(i),e instanceof Lp){const e=this.paint.particleSize();i.setUniform("cameraToCenterDistance",this.layer.map.transform.cameraToCenterDistance),i.setUniform("particleSize",[e.width,e.height]),i.setUniform("noData",this.noDataValue/255)}else if(e instanceof Dp){const e=1-s%1*.5,t=r.dpr/2*(1/this.layer.map.transform.worldSizeScale);let o=this.paint.particleSpeed()*e*t;const l=Math.floor(this.layer.map.getZoom()),h=Math.floor(this._getParticleZoom());o/=Math.abs(l-h)+1,o*=.5,o*=Math.min(1,.3+s/3*.5),i.setUniform("resolution",new eh(a.width,a.height)),i.setUniform("speedFactor",o*n),i.setUniform("fadeInIncrement",.01*n),i.setUniform("fpsFactor",n),i.setUniform("randomSeed",Math.random()),i.setUniform("dropRate",this.paint.particleDropRate()*n),i.setUniform("dropRateBump",this.paint.particleDropRateBump()*n)}else if(e instanceof Kd){const t="draw-trails"===e.id?this.paint.particleTrailsFade():this.paint.opacity();i.setUniform("opacity",1-(1-t)*n)}}_getParticleZoom(){const e=this.layer.getDataZoom(),t=Math.floor(this.layer.map.getZoom()+this._particleZoomOffset);return Math.max(t,e)}_getParticleRenderables(){const e=this._getParticleZoom(),t=this.renderState.dataRegion.convertedToZoom(Math.floor(e)),i=this.getVisibleTiles(e),r=[],a=Ln(Math.floor(e)),s=t.span.x>a;for(let e=0;e<i.length;e++){const n=i[e],o=n.coord.normalize(),l=this._calculateTotalParticles(n.coord.z);if(0===this.getRenderablesForTile(n.coord,this.layer.getDataZoom()).length)continue;let h=this._particleState.get(o.hash);h&&h.count===l||(h=new Op,h.initialize(this.context,l),h.needsInitialize=!0,this._particleState.set(o.hash,h)),h.needsUpdate=!0,n.data=h;const c=Mc.fromTile(n,n.coord),d=this._calculateUVOffset(n,t,s,a);c.uvOffset=d,r.push(c)}return r}_calculateUVOffset(e,t,i,r){let a=e.coord;return 0===t.zoom?a=e.coord.normalize():i&&(a=e.coord.x<0||e.coord.x>r?e.coord:e.coord.normalize()),[(a.x-t.bounds.left)/t.span.x,(a.y-t.bounds.top)/t.span.y,1/t.span.x,1/t.span.y]}_calculateTotalParticles(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.layer.map.getZoom();const t=Math.floor(e);if(!this._memoizedTotalParticles.has(t)){let e=this.paint.particleCount();const i=this.paint.particleDensity();i>0&&(e=i);const r=Math.floor(this.layer.map.getZoom());e*=Math.max(1,Math.abs(r-t)+1),e*=this.layer.map.transform.tileSize/512,e=Math.min(Math.pow(256,2),Math.pow(e,2)),this._memoizedTotalParticles.set(t,e)}return this._memoizedTotalParticles.get(t)}setupEvents(){var e;super.setupEvents(),this.layer.on(Ph,(e=>{let{property:t,value:i}=e;(t.includes("particle.density")||t.includes("particle.count"))&&(t.includes("particle.count")&&i>0&&this.paint.setProperty("particle.density",Vr.count),this._memoizedTotalParticles.clear())})),null===(e=this.layer.animator)||void 0===e||e.on([Ui.RESTART,Ui.STOP].join(" "),(()=>{this._renderTrails&&this.passes.withPass("draw-particles",(e=>{e.fbo.clear()})),this.onDirty()}))}dispose(){this._particleState.clear(),super.dispose()}},qp=wd("precision mediump float;<\n#defines>\n<\n#includes>\nattribute vec3 position;attribute vec2 anchor;attribute vec4 color;uniform mat4 modelViewMatrix;uniform mat4 viewMatrix;uniform mat4 modelMatrix;uniform mat4 projectionMatrix;uniform vec4 tileCoordOffset;varying vec4 vColor;vec2 transform(const vec2 pos,const vec4 unitSize){vec2 scale=vec2(1./unitSize.z,1./unitSize.w);return vec2((pos.x*scale.x)-unitSize.x*scale.x,(pos.y*scale.y)-unitSize.y*scale.y);}vec4 projectPosition(vec4 position){vec4 worldPosition=modelMatrix*position;return projectionMatrix*viewMatrix*worldPosition;}void main(){vec2 adjustedAnchor=transform(anchor.xy,tileCoordOffset);vec3 offset=vec3(adjustedAnchor,0.);vec4 finalPosition=vec4(position+offset,1.);vColor=color;gl_Position=projectionMatrix*modelViewMatrix*vec4(finalPosition.xyz,1.);gl_Position.z=position.z;}"),Gp=wd("precision mediump float;<\n#defines>\n<\n#includes>\nvarying vec4 vColor;void main(){vec4 color=vColor;gl_FragColor=color;gl_FragColor.rgb*=gl_FragColor.a;}"),Hp={},Wp=class extends yd{constructor(e,t=[]){super(e),this.program=e.cache.getProgram("draw-voronoi",t,(()=>new ed(e,{vertexShader:qp,fragmentShader:Gp,uniforms:Object.assign({},Hp),defines:[...Ou,...t],includes:a}))),this.mesh=new gd(this.context,new kl(e),this.program),this.mesh.drawMode=e.gl.TRIANGLE_FAN}draw(e){const t=this.program,i=this.mesh,r=void 0,a=this.context.gl,{renderables:s}=e.state,n=a.getParameter(a.DEPTH_RANGE);a.enable(a.DEPTH_TEST),a.depthMask(!0),a.depthFunc(a.LESS),a.depthRange(0,1),a.clear(a.DEPTH_BUFFER_BIT);for(let a=0,n=s.length;a<n;a++){const n=s[a];t.setUniform("tileCoordOffset",(new al).fromArray(n.uvOffset)),e.scene&&!e.renderTarget?e.scene.render(i,r):(i.updateMatrixWorld(),i.draw({camera:r}))}a.depthRange(n[0],n[1]),a.disable(a.DEPTH_TEST)}};class Yp extends vo{}let Zp=null;const Xp=wd(Np),Qp=wd("precision mediump float;<\n#defines>\n<\n#includes>\nuniform vec4 color;uniform sampler2D tOutput;uniform sampler2D tMask;varying vec2 vUv;void main(){gl_FragColor=color;}"),Kp={},Jp=class extends yd{constructor(e){super(e),this.program=e.cache.getProgram("draw-debug",[],(()=>new ed(this.context,{vertexShader:Xp,fragmentShader:Qp,uniforms:Object.assign({},Kp),includes:a}))),this.mesh=new gd(e,e.cache.getFullscreenQuad().geometry,this.program)}draw(e){const{renderables:t}=e.state;for(let i=0,r=t.length;i<r;i++)this.drawTile(e,t[i])}drawTile(e,t){var i;const r=this.context,{region:a}=(null===(i=e.configurator)||void 0===i?void 0:i.stateForDrawPass(this,e))||{},s=this.mesh,n=s.program,o=e.renderTarget?r.cache.getFullscreenQuad().camera:void 0,l=bd.fromTileRenderable(t,o?a:void 0),h=l.scale,c=l.offset,d=r.resolution;n.setUniform("resolution",new eh(d.width,d.height)),s.scale.set(h.x,h.y,1),s.position.set(c.x,c.y,0),s.wireframe=!0,e.scene&&!e.renderTarget?e.scene.render(s,o):(s.updateMatrixWorld(),s.draw({camera:o}))}},em={raster:class extends nu{constructor(e,t){super(e,Object.assign({quality:ki.exact,renderer:t.renderer||new eu},t))}createTimeSeriesDataProvider(){return new du(this)}},circle:uu,symbol:uu,fill:uu,line:uu,text:uu,query:Mu,sample:wu,grid:wu,heatmap:uu,contour:wu,particle:wu,voronoi:uu,debug:class extends nu{constructor(e,t){Zp||(Zp=new Yp("debug",{type:"debug",id:"debug"})),super(e,Object.assign(Object.assign({},t),{source:Zp}))}onMove(){}},data:uu},tm={raster:eu,circle:Ju,symbol:Ju,fill:Ju,line:Ju,text:Ju,query:Ju,sample:dp,grid:class extends bu{constructor(e={}){super(lt({paint:{fill:{color:new hl("#fff")},stroke:{color:new hl(0,0,0,0)},icon:{size:{width:40,height:40}},grid:{size:60,spacing:30}}},e))}setup(){super.setup(),this.paint.sampleColorScale()||this.removeColorLookupTables()}setupEvents(){super.setupEvents(),this.layer.on(Ph,(e=>{let{property:t}=e;(t.includes("grid.spacing")||t.includes("symbol.size"))&&this.updateVectorData()}))}prepareDrawPasses(){var e;const t=this.context,i=[...Ou,...this.getProgramDefines(),"PITCH_WITH_MAP","IS_SYMBOL"],r=Array.isArray(this.channel)?this.channel[0]:this.channel,a=this.paint.sampleExpression();let s=mp;this.getColorLookupTable(r)&&i.push("COLOR_LOOKUP"),ve(this.paint.iconAtlas())&&(i.push("USE_ATLAS"),s=void 0),a===Tr.vector?i.push("EXPRESSION_VECTOR"):a===Tr.angle&&i.push("EXPRESSION_ANGLE"),this.updateVectorData();const n=new up(t,{options:{vertexShader:pp,fragmentShader:s,defines:i}}),o=new Yd(this.context,[n]);if(o.clear=!0,this.passes.addPass(o),this.layer.mask){const i=new Jd(t,{invert:this.layer.mask.inverted});i.enableBlend=!0,i.fullscreen=!0,i.texture=null===(e=o.renderTarget)||void 0===e?void 0:e.texture,i.textureId="tOutput",this.passes.addPass(i)}else{const e=new Kd(t);e.id="screen",e.fullscreen=!0,e.texture=o.renderTarget.texture,e.textureId="tOutput",e.enableBlend=!0,this.passes.addPass(e)}}stateForDrawPass(e,t){var i;if(e instanceof Wu){this.layer.map.getZoom();const e=this.getVisibleTiles(),t=[],i={};for(let r=0;r<e.length;r++){const a=e[r];a.data=this._vectorData,t.push(Mc.fromTile(a,a.coord));const s=this.getRenderablesForTile(a.coord,this.layer.getDataZoom());if(s.length>0){const e=s[0];i[a.coord.hash]={renderable:e,textures:e.tile.data.textures}}}return{renderables:t,dataRenderables:i,interval:this.timeState.index,nextInterval:this.timeState.nextIndex,progress:this.progress,layerId:this.layer.id,style:this.paint,mapStyle:this.layer.map.style,elapsedTime:this.renderState.elapsedTime,transform:this.layer.map.transform}}const r=super.stateForDrawPass(e,t);if("mask"===e.id&&e instanceof Jd){const t=this.layer.mask;e.mask=t?null===(i=null==t?void 0:t.layer.renderer.renderTarget)||void 0===i?void 0:i.texture:new lo(this.context)}return r}prepareDrawPass(e,t){const i=e.program;if(e instanceof Wu){[e.mesh.program,e.sdfMesh.program].forEach((e=>{this.setColorScaleUniforms(e)}));const t=this.paint.iconAtlas();if(xe(t)&&!this._symbolAtlas&&(this._symbolAtlas=this.layer.map.style.createImageAtlas(t.ids)),this._symbolAtlas){const e=this._vectorData.stores[this.layer.id];e instanceof ah&&(e.includesSDFIcons=this._symbolAtlas.includesSDFImages),this._vectorData.imageAtlas=this._symbolAtlas}}else(e instanceof Kd||e instanceof Jd)&&i.setUniform("opacity",this.paint.opacity())}updateVectorData(){this._vectorData=new fh({[this.layer.id]:this.generateVectorStore(this.paint.gridSpacing()||100)})}generateVectorStore(){const e=Math.round((arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.layer.map.transform.tileSize)/(arguments.length>0&&void 0!==arguments[0]?arguments[0]:50)),t=1/e,i=t/2,r=t/2,a=[];let s=0;for(let n=0;n<e;n++)for(let o=0;o<e;o++)a.push({featureIndex:s,sourceId:"",sourceLayerIndex:0,type:1,feature:new fp([{x:Co*(i+o*t),y:Co*(r+n*t)}]),properties:{}}),s+=1;let n={};const o=this.paint.iconAtlas();(null==o?void 0:o.ids)&&(n=this.layer.map.style.imageManager.getImages(o.ids));const l=new ah({tile:{x:0,y:0,z:0},sourceId:this.layer.source.id,sourceLayerIndex:0,zoom:0});return l.populate(a,void 0,{paint:this.paint}),l.layoutSymbols(n,{}),l.trim(),this.debugGrid(a),l}debugGrid(e){}},heatmap:class extends Ju{setup(){super.setup(),this._generateColorTable()}setupEvents(){super.setupEvents(),this.layer.on(Ph,(e=>{let{property:t}=e;t.includes("heatmap.color")&&(this._generateColorTable(),this.layer.setNeedsUpdate())}))}prepareDrawPasses(){var e;const t=this.context;t.gl.getExtension("OES_standard_derivatives");const i=t.cache.getProgram("draw-heatmap-circles",[],(()=>new ed(t,{vertexShader:Lu,fragmentShader:gp,uniforms:Object.assign({},vp),defines:[...Ou],includes:a}))),r=t.cache.getProgram("draw-heatmap",[],(()=>new ed(t,{vertexShader:yp,fragmentShader:xp,uniforms:Object.assign({colorScale:{value:this._colorLookup.texture},colorScaleRes:{value:this._colorLookup.texture.size.width},opacity:{value:1}},bp),defines:[...Ou],includes:a}))),s=new Uu(t,i);s.id="draw-data",s.clear=!0,s.prerender=!0;const n=new Yd(t,[s]);n.prerender=!0,this.passes.addPass(n);const o=new Kd(t,r);if(o.id="heatmap",o.fullscreen=!0,o.texture=n.renderTarget.texture,o.textureId="dataTexture",o.enableBlend=!0,this.layer.mask){const i=new Yd(this.context,[o]);i.clear=!0,i.prerender=!0,this.passes.addPass(i);const r=new Jd(t,{invert:this.layer.mask.inverted});r.enableBlend=!0,r.fullscreen=!0,r.texture=null===(e=i.renderTarget)||void 0===e?void 0:e.texture,r.textureId="tOutput",this.passes.addPass(r)}else this.passes.addPass(o)}stateForDrawPass(e,t){const i=super.stateForDrawPass(e,t),r=this.getInfoForStyles();return Object.assign(Object.assign({},i),{pointSize:this.paint.heatmapRadius(r)*this.context.dpr,intensity:this.paint.heatmapIntensity(r),weight:this.paint.heatmapWeight(r)||20})}prepareDrawPass(e,t){const i=e.program,r=this.getInfoForStyles();e instanceof Uu?(i.setUniform("intensity",this.paint.heatmapIntensity(r)||1),i.setUniform("weight",this.paint.heatmapWeight(r)||1),i.setUniform("blur",this.paint.heatmapBlur(r)||1)):e instanceof Kd&&(i.setUniform("colorScale",this._colorLookup.texture),i.setUniform("colorScaleRes",this._colorLookup.texture.size.width),i.setUniform("opacity",this.paint.opacity(r)))}_generateColorTable(){const e=this.paint.heatmapColor()||[0,"rgba(0, 0, 0, 0)",.2,"rgba(0, 0, 255, 0.2)",.45,"rgba(0, 255, 0, 0.5)",.85,"rgba(255, 255, 0, 1)",1,"rgba(255, 0, 0, 1)"];this._colorLookup=new yu({stops:e,range:{min:0,max:1},interval:.01}),this._colorLookup.createLookupTexture(this.context)}},contour:class extends dp{getColorizeProgram(){const e=["COLOR_LOOKUP","USE_FWIDTH"],t=this.config.channel,i=Object.keys(this.colorLookupTables).length>1,r=this.paint.sampleExpression();return this.context.gl.getExtension("OES_standard_derivatives"),ke(t)&&(r===Tr.vector?e.push("EXPRESSION_VECTOR"):i&&e.push("COLOR_MASK_LOOKUP")),this.noDataValue>=0&&e.push("NODATA"),this.context.cache.getProgram("draw-contours",e,(()=>new ed(this.context,{vertexShader:tp,fragmentShader:wp,uniforms:Object.assign({},rp),defines:e,includes:a})))}prepareDrawPass(e,t){const i=e.program;if(this.setColorScaleUniforms(i),e instanceof sp){const e=this.paint.contourInterval();i.setUniform("valueInterval",e),i.setUniform("majorValueInterval",this.paint.contourMajorInterval()),i.setUniform("width",this.paint.contourWidth()),i.setUniform("majorWidth",this.paint.contourMajorWidth()),i.setUniform("valueScale",this.paint.contourScale()),i.setUniform("valueOffset",this.paint.contourOffset()),i.setUniform("colorInterval",e),i.setUniform("noData",this.noDataValue/255),i.setUniform("opacity",this.paint.opacity())}}},particle:$p,voronoi:class extends Ju{constructor(e={}){super(Object.assign({type:Yh.circle},e)),this._coneVertices=[],this.throttledUpdateGeometryFromTiles=hh((()=>{this.updateGeometryFromTiles()}),250),this.debouncedUpdateGeometryFromTiles=Ni((()=>{this.updateGeometryFromTiles()}),100)}setup(){super.setup();const e=new eh(1,1),t=e.length(),i=e.divide(new eh(t,t)),r=[0,0,-.95];for(let e=0;e<40;e++){const t=e/39*Math.PI*2,a=Math.cos(t)*i.y*2,s=Math.sin(t)*i.x*2;r.push(.003*a,.003*s,1)}this._coneVertices=r}setupEvents(){super.setupEvents(),this.addEventHandler(this.layer.source,ws,(e=>{this.debouncedUpdateGeometryFromTiles()}))}onDirty(){super.onDirty();const e=this.renderState.visibleRegion;let t=this._voronoiTile;t||(t=new Kn(new Xn(e.zoom,e.bounds.left,e.bounds.top)),this._voronoiTile=t),this.throttledUpdateGeometryFromTiles()}prepareDrawPasses(){var e;const t=this.context,i=t.gl,r=new Wp(this.context);if(r.id="draw-voronoi",this.layer.mask){const a=new Yd(this.context,[r],{size:{width:this.context.size.width/2,height:this.context.size.height/2},minFilter:i.NEAREST,magFilter:i.NEAREST,format:i.RGBA,depth:!0,autoResize:!1});a.clear=!0,a.prerender=!0,this.passes.addPass(a);const s=new Jd(t,{invert:this.layer.mask.inverted});s.enableBlend=!0,s.fullscreen=!0,s.texture=null===(e=a.renderTarget)||void 0===e?void 0:e.texture,s.textureId="tOutput",this.passes.addPass(s)}else r.clear=!0,this.passes.addPass(r)}stateForDrawPass(e,t){const i=super.stateForDrawPass(e,t);if("draw-voronoi"===e.id&&this._voronoiTile){const e=Mc.fromTile(this._voronoiTile,this._voronoiTile.coord);i.renderables=[e]}return i}prepareDrawPass(e,t){var i,r;if("mask"===e.id&&e instanceof Jd){const t=this.layer.mask;e.mask=t?null===(r=null===(i=t.layer)||void 0===i?void 0:i.renderer.renderTarget)||void 0===r?void 0:r.texture:new lo(this.context)}super.prepareDrawPass(e,t)}updateGeometryFromTiles(){var e,t;const i=[];this.renderState.renderables.forEach((e=>{var t,r;const a=e.tile.coord,s=Bn({x:a.x,y:a.y,z:a.z}),n=1/Math.pow(2,a.z),o=this.layer.source.tiles.get(a.normalize()),l=null==o?void 0:o.data;if(l instanceof fh){const e=null==l?void 0:l.getDrawData(this.context,"circle",this.layer.id,{paint:this.paint,mapStyle:this.layer.map.style});if(e){const a=null===(t=null==l?void 0:l.getStore("circle",this.layer.id))||void 0===t?void 0:t.features,o=null===(r=e.primary)||void 0===r?void 0:r.geometry;if((null==o?void 0:o.length)>0){const e=o[0].getAttribute("anchor");if(e){const t=[...e.data];for(let e=0;e<t.length/2;e++)i.push({x:s.x+t[2*e+0]/Co*n,y:s.y+t[2*e+1]/Co*n,color:this.paint.fillColor(a[e].properties)})}}}}})),null===(e=this._dataGeometry)||void 0===e||e.dispose();const r=this.generateGeometryForPoints(i);this._dataGeometry=r;const a=this.passes.getPass("save"),s=a?a.getPass("draw-voronoi"):this.passes.getPass("draw-voronoi");null===(t=null==s?void 0:s.mesh.geometry)||void 0===t||t.dispose(),null==s||s.mesh.updateGeometry(r,!0),this.layer.map.redraw()}generateGeometryForPoints(e){const t=new Float32Array(2*e.length),i=new Float32Array(4*e.length);for(let r=0;r<e.length;r++){const{x:a,y:s,color:n}=e[r],[o,l,h,c]=n.toArray();t[2*r+0]=a,t[2*r+1]=s,i[4*r+0]=o,i[4*r+1]=l,i[4*r+2]=h,i[4*r+3]=c}const r=this.context,a=(new Float32Array).BYTES_PER_ELEMENT,s=new Bl(r.gl,t,2*a),n=new Bl(r.gl,i,4*a);return new kl(r,{position:{size:3,data:new Float32Array(this._coneVertices)},anchor:new El(s,2,!1,0,1),color:new El(n,4,!1,0,1)})}},debug:class extends Cc{constructor(e={}){super(lt({paint:{stroke:{color:"#ff0000"}}},e))}prepareDrawPasses(){const e=new Jp(this.context);e.id="debug-tiles",e.enableBlend=!0,this.passes.addPass(e)}stateForDrawPass(e,t){return{renderables:this.renderState.renderables}}prepareDrawPass(e,t){e.program.setUniform("color",this.paint.strokeColor().toArray())}getRenderablesLOD(e){const t=this.layer.viewport.getVisibleTileCoords(e||this.layer.getDataZoom()),i=[];for(let e=0,r=t.length;e<r;e++){const r=t[e],a=new Kn(r),s=jn(r.z),n=Bn(r.normalize()),o=new Mc(a,{x:s,y:s},{x:n.x+r.wrap,y:n.y});o.coord=r,i.push(o)}return i}},data:class{constructor(e={}){this.paint=new hc(e.paint)}onAdd(e){}onRemove(e){}onMoveStart(e){}onMoveEnd(e){}onZoomStart(e){}onZoomEnd(e){}onResize(e){}setNeedsUpdate(){}prerender(e){}draw(e){}prepareForOffscreenRender(){}dispose(){}}},im=e=>["sample","grid","particles","contour"].includes(e),rm=e=>["circle","fill","line","symbol","text","text-data","voronoi","data"].includes(e),am=class extends dt{constructor(e){super(),this.cache=new Map,this.order=[],this.layerIdsBySource={},this.datasources=e}get count(){return this.cache.size}has(e){return he(this.get(e))}get(e){return this.cache.get(e)}find(e){let t;return this.each((i=>{t||i.id!==e&&!new RegExp(e).test(i.id)||(t=i)})),t}orderedLayers(){return this.order.map((e=>this.cache.get(e)))}getIndex(e){return this.order.indexOf(e)}add(e,t,i){return this.insertAt(this.order.length,e,t,i)}insertAt(e,t,i,r){var a;let s,n;if(le(i))throw new Error("[MapsGL] Cannot add layer, an invalid layer configuration was provided");if(i instanceof qh?(s=i,n=s.source,t=s.id):i=Object.assign({},i),!this.has(t)){if(le(s)){const e=i,{mask:r}=e,o=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(i[r[a]]=e[r[a]])}return i}(e,["mask"]);if(ke(null==i?void 0:i.source)?n=this.datasources.get(i.source):i.source instanceof Os&&(n=i.source),o.source=n,le(null==o?void 0:o.type))throw new Error("[MapsGL] A layer type must be provided.");if([Pi.circle,Pi.heatmap,Pi.symbol,Pi.text].includes(o.type)&&(o.sourceType=Li.point),s=((e,t)=>{var i;if(t.type===Pi.particles&&(t.type=Pi.particle),le(em[t.type]))throw new Error(`[MapsGL] Invalid layer type '${t.type}' specified for layer {${e}}. Type must be one \n            of the following: ${Object.keys(em).join(", ")}.`);if(le(t.source)&&t.type!==Pi.debug)throw new Error(`[MapsGL] Layer {${e}} configuration is missing a value for 'source'.`);const r=t.paint||{};let a={paint:r},s={source:t.source};if(["raster","debug"].includes(n=t.type)||im(n)||rm(n)){const e=s;if(e.zoomOffset=t.zoomOffset,e.quality=t.quality||ki.exact,s=e,rm(t.type)){const e=s;e.sourceType=t.sourceType,e.sourceLayer=t.sourceLayer,e.filter=t.filter,a.type=t.type,s=e}}var n;if(t.type===Pi.query&&(a.type=Yh.symbol),im(t.type)){const e=a;e.channel=(null===(i=r.sample)||void 0===i?void 0:i.channel)||"r",a=e}const o=new tm[t.type](a),l=new em[t.type](e,Object.assign(Object.assign({},s),{renderer:o}));if(l.id!==e)throw new Error(`[MapsGL] Expected layer ID to be ${e} but got ${l.id} instead.`);if(l.type=t.type,l.type===Pi.query&&(l.type=t.queryType||Pi.symbol),he(t.timeSeries)){const{mode:e,clamp:i,range:r,intervals:a,interleaved:s}=t.timeSeries;he(e)&&(l.timing.mode=e),he(i)&&(l.timing.clamp=i),he(r)&&(l.timing.range=r),he(a)&&(l.timing.intervals=a),"boolean"===fe(s)&&(l.timing.interleaved=s)}return l})(t,o),n=s.source,s instanceof Mu){const e="string"==typeof o.queryLayer?o.queryLayer:null===(a=o.queryLayer)||void 0===a?void 0:a.id;xe(e)&&(s.queryLayer=this.get(e))}if(xe(r)){const e="string"==typeof r?{id:r}:r;s.mask={layer:this.get(e.id),inverted:Boolean(e.invert)}}}return this.layerIdsBySource[n.id]||(this.layerIdsBySource[n.id]=[]),this.layerIdsBySource[n.id].push(s.metadata),s.source.addConsumer(s.metadata),s.scene=r,this.cache.set(t,s),this.order.splice(e,0,t),this.trigger("add",{layer:s}),s}console.warn(`[MapsGL] A layer with ID ${t} already exists.`)}move(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;const i=this.order.indexOf(e);if(i>=0){const e=this.order.splice(i,1)[0];-1===t?this.order.push(e):this.order.splice(t,0,e)}}remove(e){const t=this.get(e);if(t){const i=this.order.indexOf(e);t.scene=void 0;const r=t.source.id;this.layerIdsBySource[r]&&(this.layerIdsBySource[r]=this.layerIdsBySource[r].filter((t=>t.layerId!==e))),t.source.removeConsumerForLayerId(e),t.onRemove(),this.cache.delete(e),i>=0&&this.order.splice(i,1),this.trigger(Gh,{layer:t})}return t}each(e){this.cache.forEach(((t,i)=>{e(t)}))}};var sm;!function(e){e[e.orthographic=0]="orthographic",e[e.perspective=1]="perspective"}(sm||(sm={}));class nm extends pd{constructor({near:e=1,far:t=1e3,fov:i=45,aspect:r=1,bounds:a,zoom:s=1}={}){super(),this.type=sm.perspective,this.projectionMatrix=new wc,this.viewMatrix=new bc,this.projectionViewMatrix=new wc,this.worldPosition=new Mn,this.near=e,this.far=t,this.fov=i,this.aspect=r,this.bounds=a,this.zoom=s;const{left:n,right:o,top:l,bottom:h}=a||{};this.type=n||o?sm.orthographic:sm.perspective,this.type===sm.orthographic?this.orthographic(n,o,l,h,e,t,s):this.perspective(i,r,e,t)}perspective(e,t,i,r){this.fov=e,this.aspect=t,this.near=i,this.far=r,this.projectionMatrix.fromPerspective(e,t,i,r),this.type=sm.perspective}orthographic(e,t,i,r,a,s){let n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;this.bounds={left:e,right:t,top:i,bottom:r},this.near=a,this.far=s,this.projectionMatrix.orthographic(e/n,t/n,i/n,r/n,a,s),this.type=sm.orthographic}lookAt(e){return super.lookAt(e,!0),this}updateMatrixWorld(){return super.updateMatrixWorld(),this.viewMatrix.inverse(this.worldMatrix),this.worldMatrix.getTranslation(this.worldPosition),this.projectionViewMatrix.multiply(this.projectionMatrix,this.viewMatrix),this}updateProjectionMatrix(){}}class om extends nm{constructor(e,t,i,r,a,s,n=1){super({bounds:{left:e,right:t,top:i,bottom:r},near:a,far:s,zoom:n})}updateProjectionMatrix(){const{left:e,right:t,top:i,bottom:r}=this.bounds,a=this.zoom;this.projectionMatrix.orthographic(e/a,t/a,i/a,r/a,this.near,this.far)}}class lm extends nm{constructor(e,t,i,r){super({fov:e,aspect:t,near:i,far:r})}updateProjectionMatrix(){this.projectionMatrix.fromPerspective(this.fov,this.aspect,this.near,this.far)}}const hm=class{constructor(e){const{camera:t,map:i}=e;this.scene=new ud;const{width:r,height:a}=i.size,s=i.fov;this.camera="orthographic"===t?new om(-r/2,r/2,a/2,-a/2,.1,1e21):new lm(s,r/a,.1,1e21),this.camera.matrixAutoUpdate=!1,this.camera.position.z=600}add(e){this.scene.add(e)}remove(e){this.scene.remove(e)}render(e,t){this.scene.add(e),e.updateMatrixWorld(),e.draw({camera:this.camera}),this.scene.remove(e)}},cm="update",dm="empty",um="units:change",pm={width:200,insets:4,points:{radius:4,margin:[3,4]},text:{family:"Helvetica",color:"#000000",size:10,style:"normal",weight:"normal"}},mm=class extends dt{get measurement(){var e,t,i;const r=this.options.bar;return Array.isArray(r)?null===(t=null===(e=r[0])||void 0===e?void 0:e.measurement)||void 0===t?void 0:t.type:ze(r)?null===(i=r.measurement)||void 0===i?void 0:i.type:void 0}get size(){return{width:this._layout.size.width,height:this._layout.size.height}}get canvas(){return this._canvas}get layout(){return this._layout}constructor(e,t){super(),this.options={},this._rendered=!1,this.update=Ni(((e,t)=>{this._update(e,t)}),100),this.id=e,this.options=Object.freeze(lt({},pm,t)),this.state=new rr({units:void 0}),this._canvas=zs({width:40,height:40})}setUnits(e){this.state.setState({units:e}),this._rendered&&this.render()}render(){this._prepare(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).then((()=>{const e=this.options.text.family,t=this.options.text.size,i=this.options.text.style,r=this.options.text.weight;this._prepareCanvas();const a=this.canvas.getContext("2d");a.font=`${i} ${r} ${t}px ${e}`,a.textAlign="left",a.textBaseline="bottom",a.clearRect(0,0,this.canvas.width,this.canvas.height),this._render(a),this._rendered=!0,this.trigger(cm)}))}_prepare(){throw new Error("Method not implemented.")}_render(e){throw new Error("Method not implemented.")}_update(e){throw new Error("Method not implemented.")}_calculateLayout(e,t){throw new Error("Method not implemented")}_prepareCanvas(){const e=window.devicePixelRatio||1;this._layout=this._calculateLayout(this.options.width,this.options.insets);const t=this._layout.size.width,i=this._layout.size.height;this.canvas.width=t*e,this.canvas.height=i*e,this.canvas.style.width=`${t}px`,this.canvas.style.height=`${i}px`,this.canvas.getContext("2d").scale(e,e)}},fm=100,gm={height:10,rounded:!1,labels:{margin:[6,4]}},vm=(e,t)=>{var i,r;const a=lt({},e,t);return a.colorscale.stops=(null===(i=t.colorscale)||void 0===i?void 0:i.stops)||(null===(r=e.colorscale)||void 0===r?void 0:r.stops),a},ym=class extends mm{constructor(e,t){var i;super(e,t),this._bars=[];const r=Array.isArray(this.options.bar)?this.options.bar[0]:this.options.bar;let a;r&&(a=null===(i=r.measurement)||void 0===i?void 0:i.units),this.state.setState("units",a)}_prepare(e){const t=this.options,i=Array.isArray(t.bar)?t.bar:[t.bar];return this._bars=i.map((e=>{const t=e.colorscale,i=st(t.stops,t.range,t.normalized);return t.positions&&i.setPositions(t.positions),{config:lt({},gm,e),scale:i}})),Promise.resolve()}_render(e){const{bounds:t,rowHeight:i}=this.layout,r=t.left;let a=t.top;this._bars.forEach(((t,s)=>{((e,t,i,r,a,s)=>{var n;const{config:o,scale:l}=t,{labels:h,colorscale:c,units:d}=o,u=c.range,p=(null===(n=o.measurement)||void 0===n?void 0:n.units)||(null==d?void 0:d.data),m=a.units||p,f=(e=>{var t,i,r;return(null===(t=e.measurement)||void 0===t?void 0:t.converter)?e.measurement.converter:(null===(i=e.units)||void 0===i?void 0:i.converter)?null===(r=e.units)||void 0===r?void 0:r.converter:(e,t,i)=>e})(o),g=new vu(c.range),v=l.getRamp({range:g,totalColors:Math.min(s.colWidth,500),interval:c.interval,interpolate:c.interpolate,breaks:Array.isArray(c.breaks)?c.breaks:Jt(c.breaks)?c.breaks(u.min,u.max,c.interval):void 0,easing:c.resample?"function"==typeof c.resample?c.resample:He[c.resample]:void 0}),y={options:t.config,legendOptions:r,state:a,layout:s,pos:i,ramp:v,range:g,unitsConverter:f,fromUnits:p,toUnits:m};if(((e,t)=>{let{options:i,layout:r,ramp:a,pos:s}=t;const n=a.stops.map((e=>e.color)),{rounded:o}=i,{colWidth:l}=r;let h=s.x,c=s.y;const d={width:Math.max(1,l/n.length),height:i.height};d.width=Math.floor(d.width*fm)/fm,d.height=Math.floor(d.height),e.save(),o&&(((e,t,i,r,a,s)=>{const n=Math.PI/180;r-t-2*s<0&&(s=(r-t)/2),a-i-2*s<0&&(s=(a-i)/2),e.beginPath(),e.moveTo(t+s,i),e.lineTo(r-s,i),e.arc(r-s,i+s,s,270*n,360*n,!1),e.lineTo(r,a-s),e.arc(r-s,a-s,s,0*n,90*n,!1),e.lineTo(t+s,a),e.arc(t+s,a-s,s,90*n,180*n,!1),e.lineTo(t,i+s),e.arc(t+s,i+s,s,180*n,270*n,!1),e.closePath()})(e,h,c,h+l,c+d.height,d.height/2),e.clip());const u=l-d.width*n.length,p=u>1?Math.floor((n.length-1)/u):0;for(let t=0;t<n.length;t++){const i=n[t],r={r:Math.round(i.r),g:Math.round(i.g),b:Math.round(i.b),a:i.a},a=t>0?1:0,s=il(r),o=d.width+(p>1&&t%p==0?1:0);h=Math.floor(h*fm)/fm,c=Math.floor(c*fm)/fm;const l=o+a;e.save(),r.a<1&&(e.globalAlpha=r.a),e.beginPath(),e.fillStyle=s,e.rect(Math.floor(h),Math.floor(c),Math.ceil(l),d.height),e.fill(),e.closePath(),e.restore(),h+=o}e.restore()})(e,y),h){const t=(e=>{let{options:t,ramp:i,range:r,unitsConverter:a,fromUnits:s,toUnits:n}=e;const{values:o,every:l,everyStep:h}=t.labels,{interpolate:c,stops:d,normalized:u}=t.colorscale,p=new vu(t.colorscale.range),m="function"==typeof l?l(n):l,f=h||0;let g="function"==typeof o?o(n).map((e=>"number"==typeof e?a(e,n,s):Object.assign(Object.assign({},e),{value:a(e.value,n,s)}))):o;if(le(g))if(!1===c)g=d.filter(((e,t)=>t%2==0)).map((e=>{const t=u?p.min+p.delta*Number.parseFloat(`${e}`):Number.parseFloat(`${e}`);return a(t,s,n)}));else if(f>0)g=Array.from({length:Math.floor(1/h)+1},((e,t)=>i.getValue(h*t)));else if(m>0){const e=[],t=a(r.min,s,n),i=a(r.max,s,n);let o=((e,t)=>e%t==0?e:Math.round((e+t/2)/t)*t)(t,m);for(;o<=i;)e.push(o),o+=m;g=e.map((e=>a(e,n,s)))}return g})(y);if((null==t?void 0:t.length)>0){const i=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(e,t,i)=>`${e}`,{options:i,state:r,ramp:a,range:s,unitsConverter:n,fromUnits:o,toUnits:l}=arguments.length>2?arguments[2]:void 0;const{labels:h}=i;return e.map(((e,i)=>{if(ze(e)){const t=Object.assign({},e);return!0===h.normalized&&(t.value=be(s.min,s.max,t.value)),t}let c=ke(e)?Number.parseFloat(`${e}`):e;!0===h.normalized&&(c=be(s.min,s.max,c));const d=n(c,o,l),u=t(d,i,r);let p=0;const m=a.stops;for(let e=0;e<m.length;e++){const t=m[e],i=m[e+1];if(e===m.length-1)p=t.position;else if(c>=t.value&&i&&c<i.value){p=be(t.position,i.position,(c-t.value)/(i.value-t.value));break}}return{value:c,label:null==u?void 0:u.replace(/%%units%%/,l),position:p}}))}(t,h.formatter,y);((e,t,i)=>{let{options:r,legendOptions:a,layout:s,pos:n,range:o}=i;const{labels:l}=r,{text:{size:h,color:c,offset:d,stroke:u,shadow:p}}=a,m=l.placement||"bottom",f=l.marks||"point",g=Object.assign({x:0,y:0},d),v=n.x,y=n.y,x=r.height,b=s.bounds.right-s.bounds.left,w=Array.isArray(l.margin)?l.margin:[l.margin,l.margin];let _=s.bounds.top;"middle"===m?_=y+x/2+h/2:"bottom"===m&&(_=y+x+h+w[1]),_+=g.y;const M=[],A=e=>M.some((t=>e.left<t.right&&e.right>t.left)),S=[t[0],t.at(-1),...t.slice(1,-1)].filter(Boolean);e.save();for(const{value:t,label:i,position:r}of S){const a=he(r)?r:(t-o.min)/(o.max-o.min),n=e.measureText(i).width,l=0,d={x:s.bounds.left+b*a,y},m={left:d.x-n/2-w[0],right:d.x+n/2+w[0],top:_-h,bottom:_};if(a<0||a>1)continue;let g=d.x;if(m.left<v?(g=v+l,m.left=v,m.right=g+n,e.textAlign="left"):m.right>v+b?(g=v+b-l,m.left=g-n,m.right=g,e.textAlign="right"):e.textAlign="center",!1===A(m)){if("none"!==f&&(e.beginPath(),"line"===f?(e.strokeStyle=c,e.lineWidth=1,e.moveTo(d.x,d.y+x-4),e.lineTo(d.x,d.y+x+4),e.stroke()):(e.fillStyle=c,e.arc(d.x,d.y+x,2,0,2*Math.PI),e.fill()),e.closePath()),he(p)){const{color:t,blur:i=4,offset:r={x:0,y:0}}=p;e.shadowOffsetX=r.x,e.shadowOffsetY=r.y,e.shadowColor=t,e.shadowBlur=i}if(he(u)){const{color:t,width:r=1}=u;t&&(e.strokeStyle=t,e.lineWidth=r,e.strokeText(i,g,_))}e.fillStyle=c,e.fillText(i,g,_),M.push(m)}}e.restore()})(e,i,y)}}})(e,t,{x:r,y:a},this.options,this.state.value,this.layout),a+=i+4}))}_update(e,t){const i=lt({},this.options,e),r=e.bar,a=this.options.bar;r&&a&&(i.bar=Array.isArray(a)?Array.isArray(r)?r.map(((e,t)=>vm(a[t],e))):vm(a[0],r):Array.isArray(r)?r.map((e=>vm(a,e))):vm(a,r)),this.options=Object.freeze(i),this.render(t)}_calculateLayout(e,t){Array.isArray(t)||(t=[t,t,t,t]),2===t.length&&(t=[t[0],t[1],t[0],t[1]]);const i=this.options.text.size,[r,a,s,n]=t,o=new sh(n,e-a,r,0),l=zs().getContext("2d");l.font=`bold ${i}px Helvetica`,l.textAlign="left",l.textBaseline="bottom";const h=e;let c=0,d=1,u=0,p=0;return this._bars.forEach(((e,t)=>{let{config:r}=e;var a;const{margin:s}=r.labels,n=Array.isArray(s)?s:[s,s],o=(null===(a=r.labels)||void 0===a?void 0:a.placement)||"bottom";c+=r.height,"middle"!==o&&(c+=i+n[1]),t>0?c+=4:p=c})),d=this._bars.length,u=o.size.width,o.bottom=o.top+c,{size:{width:h,height:r+s+c},bounds:o,cols:d,rows:1,colWidth:u,rowHeight:p}}},xm=class extends mm{constructor(){super(...arguments),this._items=[]}_prepare(e){return this._preparePointItems(this.options.points.values,e).then((e=>{this._items=e}))}_preparePointItems(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Jt(e)?e(t):Array.isArray(e)?new Promise((t=>{t(e)})):void 0}_render(e){((e,t,i,r,a,s)=>{const{radius:n,margin:o}=r.points,{size:l,color:h}=r.text,{bounds:c,cols:d,rows:u,colWidth:p}=s,m=Array.isArray(o)?o:[o,o];let f=c.left+i.x,g=c.top+i.y;const v=n,y=Math.max(2*n,l);let x=0,b=c.left;for(let i=0;i<d;i++){f=Math.round(c.left+p*i+n),g=Math.round(c.top+v);for(let i=0;i<u&&!(x>=t.length);i++){const{color:i,label:r}=t[x];1===u&&(f=b+n),e.beginPath(),e.fillStyle=i,e.arc(f,g,n,0,2*Math.PI),e.fill(),e.closePath();const a=e.measureText(r),s=f+n+m[0],o=g+l/2+1;e.fillStyle=h,e.fillText(r,s,o),b+=2*n+m[0]+a.width+2*n,g+=y+m[1],x+=1}}})(e,this._items,{x:0,y:0},this.options,0,this.layout),0===this._items.length&&this.trigger(dm)}_update(e,t){var i,r;const a=lt({},this.options,e);(null===(i=e.points)||void 0===i?void 0:i.values)&&(a.points.values=null===(r=e.points)||void 0===r?void 0:r.values),this.options=Object.freeze(a),this.render(t)}_calculateLayout(e,t){Array.isArray(t)||(t=[t,t,t,t]),2===t.length&&(t=[t[0],t[1],t[0],t[1]]);const i=this.options.text.size,[r,a,s,n]=t,o=new sh(n,e-a,r,0),l=zs().getContext("2d");l.font=`bold ${i}px Helvetica`,l.textAlign="left",l.textBaseline="bottom";let h=e,c=0,d=1,u=1,p=0,m=0;const{radius:f,margin:g}=this.options.points,v=Array.isArray(g)?g:[g,g];let y=0;const x=Math.max(2*f,i);return this._items.forEach((e=>{let{label:t}=e;const i=l.measureText(t);y=Math.max(y,i.width)})),p=y+2*f+2*v[0],d=Math.floor(o.size.width/p),u=Math.ceil(this._items.length/d),p=Math.max(o.size.width/d,p),m=x,c=u*x+(u-1)*v[1],h=d*p,o.bottom=o.top+c,{size:{width:h,height:r+s+c},bounds:o,cols:d,rows:u,colWidth:p,rowHeight:m}}},bm={width:400,insets:4,metric:!1,toggleOnClick:!0};class wm extends dt{constructor(e,t){super(),this.ref=0,this.index=0,this._elements={},this._maxHeight=100,this.hide=()=>{this.element.remove()},this.remove=()=>{this.element.remove(),this.dispose()},this._onEmpty=()=>{this.hide()},this._onUpdate=()=>{this.show()},this._updateFade=e=>{null==e||e.stopPropagation();const t=this.legend.size.height,i=this._elements.container,r=this._elements.topOverlay,a=this._elements.bottomOverlay,s=t-this._maxHeight;t>this._maxHeight?(r.style.opacity=i.scrollTop<=0?"0":"1",a.style.opacity=i.scrollTop>=s?"0":"1"):(r.style.opacity="0",a.style.opacity="0")};const i=document.createElement("div");if(i.classList.add("awxgl-legend-container"),this.element=i,this.legend=e,t){const e=document.createElement("div");e.classList.add("awxgl-legend-title"),e.innerHTML=t,i.append(e)}const r=document.createElement("div");r.classList.add("awxgl-legend-item-wrapper"),r.style.position="relative",i.append(r),this._elements.wrapper=r;const a=document.createElement("div");a.classList.add("awxgl-legend-item"),a.style.display="flex",a.style.maxHeight=`${this._maxHeight}px`,a.style.overflowY="auto",a.append(e.canvas),r.append(a),this._elements.container=a;const s=document.createElement("div");s.classList.add("awxgl-legend-item-fade","awxgl-legend-item-fade-top"),this._elements.topOverlay=s;const n=document.createElement("div");n.classList.add("awxgl-legend-item-fade","awxgl-legend-item-fade-bottom"),this._elements.bottomOverlay=n,[s,n].forEach(((e,t)=>{e.style.position="absolute",e.style.left="0",e.style.right="0",1===t?e.style.bottom="0":e.style.top="0",r.append(e)})),e.on(cm,(()=>{this._updateFade(),this.trigger(cm)})),this.observe(),a.addEventListener("scroll",this._updateFade)}show(){var e;const t=null===(e=this.parent)||void 0===e?void 0:e.childNodes;t&&!this.element.parentElement&&(this.index>=t.length?this.parent.append(this.element):this.parent.insertBefore(this.element,t[this.index]))}observe(){this.legend.on(dm,this._onEmpty),this.legend.on(cm,this._onUpdate)}dispose(){this.legend.off(dm,this._onEmpty),this.legend.off(cm,this._onUpdate)}}const _m=class extends dt{get container(){return this._container}get metric(){return this._state.value.metric}set metric(e){this._state.setState("metric",e),this.trigger(um,{metric:e})}constructor(e={}){if(super(),this.options={},this.legends=new Map,this._handleClick=e=>{null==e||e.stopImmediatePropagation(),this.toggleUnits()},this._handleLegendItemUpdate=()=>{this.trigger(cm)},he(e.width)){const t=!1===Number.isNaN(e.width)&&"number"==typeof e.width;Zt(t,"[MapsGL] LegendControl: width must be a number or string"),e.width=Math.max(140,e.width)}this.options=Object.freeze(lt({},bm,e)),this._state=new rr({units:void 0,metric:!1}),this._state.on(rr.Events.UPDATE_KEY,(e=>{let{key:t}=e;"metric"===t&&[...this.legends.values()].forEach((e=>{let{legend:t}=e;return t.render()}))}))}setUnits(e){this.legends.forEach((t=>{const i=t.legend.measurement;i&&e[i]&&t.legend.setUnits(e[i])}))}addTo(e){if(e){let t;t=ke(e)?document.querySelector(e):e;const i=document.createElement("div");i.classList.add("awxgl-control-legend"),i.style.position="absolute",this._container=i,t.append(i);const r=t.lastChild;r&&this.options.toggleOnClick&&r.addEventListener("click",this._handleClick)}}remove(){var e;null===(e=this._container)||void 0===e||e.remove()}update(e){this.legends.forEach((t=>{t.legend.update({},e)}))}hasLegend(e){return this.legends.has(e)}getLegend(e){var t;return null===(t=this.legends.get(e))||void 0===t?void 0:t.legend}addLegend(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this.hasLegend(e)){const t=this.legends.get(e);return t.ref+=1,t.show(),t.legend}const r=Object.assign(Object.assign({},t),{width:this.options.width,insets:this.options.insets});let a;switch(t.type){case"bar":a=new ym(e,r);break;case"point":a=new xm(e,r);break;default:throw new Error(`[MapsGL] LegendControl: unknown legend type: ${t.type}`)}a.setUnits(h(a.measurement,this.metric)),a.render(i);const s=new wm(a,null==t?void 0:t.title);return s.element.setAttribute("id",`awxgl-legend-${e}`),s.ref+=1,s.parent=this.container,s.index=this.legends.size,s.on(cm,this._handleLegendItemUpdate),this.container.append(s.element),this.legends.set(e,s),this.trigger("add",{id:e,legend:a}),this.trigger(cm),a}removeLegend(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=this.legends.get(e);i&&(i.ref-=1,(i.ref<=0||t)&&(i.remove(),i.off(cm,this._handleLegendItemUpdate),this.legends.delete(e),this.trigger("remove",{id:e}),this.trigger(cm)))}showLegend(e){const t=this.legends.get(e);t&&t.show()}hideLegend(e){const t=this.legends.get(e);t&&t.hide()}toggleUnits(){this.metric=!this.metric}};function Mm(e){if(null==e)return window;if("[object Window]"!==e.toString()){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function Am(e){return e instanceof Mm(e).Element||e instanceof Element}function Sm(e){return e instanceof Mm(e).HTMLElement||e instanceof HTMLElement}function Tm(e){return"undefined"!=typeof ShadowRoot&&(e instanceof Mm(e).ShadowRoot||e instanceof ShadowRoot)}var Em=Math.max,Om=Math.min,Cm=Math.round;function Rm(){var e=navigator.userAgentData;return null!=e&&e.brands&&Array.isArray(e.brands)?e.brands.map((function(e){return e.brand+"/"+e.version})).join(" "):navigator.userAgent}function Pm(){return!/^((?!chrome|android).)*safari/i.test(Rm())}function km(e,t,i){void 0===t&&(t=!1),void 0===i&&(i=!1);var r=e.getBoundingClientRect(),a=1,s=1;t&&Sm(e)&&(a=e.offsetWidth>0&&Cm(r.width)/e.offsetWidth||1,s=e.offsetHeight>0&&Cm(r.height)/e.offsetHeight||1);var n=(Am(e)?Mm(e):window).visualViewport,o=!Pm()&&i,l=(r.left+(o&&n?n.offsetLeft:0))/a,h=(r.top+(o&&n?n.offsetTop:0))/s,c=r.width/a,d=r.height/s;return{width:c,height:d,top:h,right:l+c,bottom:h+d,left:l,x:l,y:h}}function Dm(e){var t=Mm(e);return{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function zm(e){return e?(e.nodeName||"").toLowerCase():null}function Im(e){return((Am(e)?e.ownerDocument:e.document)||window.document).documentElement}function Fm(e){return km(Im(e)).left+Dm(e).scrollLeft}function Lm(e){return Mm(e).getComputedStyle(e)}function jm(e){var t=Lm(e);return/auto|scroll|overlay|hidden/.test(t.overflow+t.overflowY+t.overflowX)}function Nm(e,t,i){void 0===i&&(i=!1);var r,a,s=Sm(t),n=Sm(t)&&function(e){var t=e.getBoundingClientRect(),i=Cm(t.width)/e.offsetWidth||1,r=Cm(t.height)/e.offsetHeight||1;return 1!==i||1!==r}(t),o=Im(t),l=km(e,n,i),h={scrollLeft:0,scrollTop:0},c={x:0,y:0};return(s||!s&&!i)&&(("body"!==zm(t)||jm(o))&&(h=(r=t)!==Mm(r)&&Sm(r)?{scrollLeft:(a=r).scrollLeft,scrollTop:a.scrollTop}:Dm(r)),Sm(t)?((c=km(t,!0)).x+=t.clientLeft,c.y+=t.clientTop):o&&(c.x=Fm(o))),{x:l.left+h.scrollLeft-c.x,y:l.top+h.scrollTop-c.y,width:l.width,height:l.height}}function Um(e){var t=km(e),i=e.offsetWidth,r=e.offsetHeight;return Math.abs(t.width-i)<=1&&(i=t.width),Math.abs(t.height-r)<=1&&(r=t.height),{x:e.offsetLeft,y:e.offsetTop,width:i,height:r}}function Vm(e){return"html"===zm(e)?e:e.assignedSlot||e.parentNode||(Tm(e)?e.host:null)||Im(e)}function Bm(e){return["html","body","#document"].indexOf(zm(e))>=0?e.ownerDocument.body:Sm(e)&&jm(e)?e:Bm(Vm(e))}function $m(e,t){var i;void 0===t&&(t=[]);var r=Bm(e),a=r===(null==(i=e.ownerDocument)?void 0:i.body),s=Mm(r),n=a?[s].concat(s.visualViewport||[],jm(r)?r:[]):r,o=t.concat(n);return a?o:o.concat($m(Vm(n)))}function qm(e){return["table","td","th"].indexOf(zm(e))>=0}function Gm(e){return Sm(e)&&"fixed"!==Lm(e).position?e.offsetParent:null}function Hm(e){for(var t=Mm(e),i=Gm(e);i&&qm(i)&&"static"===Lm(i).position;)i=Gm(i);return i&&("html"===zm(i)||"body"===zm(i)&&"static"===Lm(i).position)?t:i||function(e){var t=/firefox/i.test(Rm());if(/Trident/i.test(Rm())&&Sm(e)&&"fixed"===Lm(e).position)return null;var i=Vm(e);for(Tm(i)&&(i=i.host);Sm(i)&&["html","body"].indexOf(zm(i))<0;){var r=Lm(i);if("none"!==r.transform||"none"!==r.perspective||"paint"===r.contain||-1!==["transform","perspective"].indexOf(r.willChange)||t&&"filter"===r.willChange||t&&r.filter&&"none"!==r.filter)return i;i=i.parentNode}return null}(e)||t}var Wm="top",Ym="bottom",Zm="right",Xm="left",Qm="auto",Km=[Wm,Ym,Zm,Xm],Jm="start",ef="end",tf="viewport",rf="popper",af=Km.reduce((function(e,t){return e.concat([t+"-"+Jm,t+"-"+ef])}),[]),sf=[].concat(Km,[Qm]).reduce((function(e,t){return e.concat([t,t+"-"+Jm,t+"-"+ef])}),[]),nf=["beforeRead","read","afterRead","beforeMain","main","afterMain","beforeWrite","write","afterWrite"];function of(e){var t=new Map,i=new Set,r=[];function a(e){i.add(e.name),[].concat(e.requires||[],e.requiresIfExists||[]).forEach((function(e){if(!i.has(e)){var r=t.get(e);r&&a(r)}})),r.push(e)}return e.forEach((function(e){t.set(e.name,e)})),e.forEach((function(e){i.has(e.name)||a(e)})),r}var lf={placement:"bottom",modifiers:[],strategy:"absolute"};function hf(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return!t.some((function(e){return!(e&&"function"==typeof e.getBoundingClientRect)}))}function cf(e){void 0===e&&(e={});var t=e.defaultModifiers,i=void 0===t?[]:t,r=e.defaultOptions,a=void 0===r?lf:r;return function(e,t,r){void 0===r&&(r=a);var s,n,o={placement:"bottom",orderedModifiers:[],options:Object.assign({},lf,a),modifiersData:{},elements:{reference:e,popper:t},attributes:{},styles:{}},l=[],h=!1,c={state:o,setOptions:function(r){var s="function"==typeof r?r(o.options):r;d(),o.options=Object.assign({},a,o.options,s),o.scrollParents={reference:Am(e)?$m(e):e.contextElement?$m(e.contextElement):[],popper:$m(t)};var n,h,u=function(e){var t=of(e);return nf.reduce((function(e,i){return e.concat(t.filter((function(e){return e.phase===i})))}),[])}((n=[].concat(i,o.options.modifiers),h=n.reduce((function(e,t){var i=e[t.name];return e[t.name]=i?Object.assign({},i,t,{options:Object.assign({},i.options,t.options),data:Object.assign({},i.data,t.data)}):t,e}),{}),Object.keys(h).map((function(e){return h[e]}))));return o.orderedModifiers=u.filter((function(e){return e.enabled})),o.orderedModifiers.forEach((function(e){var t=e.options,i=e.effect;if("function"==typeof i){var r=i({state:o,name:e.name,instance:c,options:void 0===t?{}:t});l.push(r||function(){})}})),c.update()},forceUpdate:function(){if(!h){var e=o.elements,t=e.reference,i=e.popper;if(hf(t,i)){o.rects={reference:Nm(t,Hm(i),"fixed"===o.options.strategy),popper:Um(i)},o.reset=!1,o.placement=o.options.placement,o.orderedModifiers.forEach((function(e){return o.modifiersData[e.name]=Object.assign({},e.data)}));for(var r=0;r<o.orderedModifiers.length;r++)if(!0!==o.reset){var a=o.orderedModifiers[r],s=a.fn,n=a.options;"function"==typeof s&&(o=s({state:o,options:void 0===n?{}:n,name:a.name,instance:c})||o)}else o.reset=!1,r=-1}}},update:(s=function(){return new Promise((function(e){c.forceUpdate(),e(o)}))},function(){return n||(n=new Promise((function(e){Promise.resolve().then((function(){n=void 0,e(s())}))}))),n}),destroy:function(){d(),h=!0}};if(!hf(e,t))return c;function d(){l.forEach((function(e){return e()})),l=[]}return c.setOptions(r).then((function(e){!h&&r.onFirstUpdate&&r.onFirstUpdate(e)})),c}}var df={passive:!0};function uf(e){return e.split("-")[0]}function pf(e){return e.split("-")[1]}function mf(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function ff(e){var t,i=e.reference,r=e.element,a=e.placement,s=a?uf(a):null,n=a?pf(a):null,o=i.x+i.width/2-r.width/2,l=i.y+i.height/2-r.height/2;switch(s){case Wm:t={x:o,y:i.y-r.height};break;case Ym:t={x:o,y:i.y+i.height};break;case Zm:t={x:i.x+i.width,y:l};break;case Xm:t={x:i.x-r.width,y:l};break;default:t={x:i.x,y:i.y}}var h=s?mf(s):null;if(null!=h){var c="y"===h?"height":"width";switch(n){case Jm:t[h]=t[h]-(i[c]/2-r[c]/2);break;case ef:t[h]=t[h]+(i[c]/2-r[c]/2)}}return t}var gf={top:"auto",right:"auto",bottom:"auto",left:"auto"};function vf(e){var t,i=e.popper,r=e.popperRect,a=e.placement,s=e.variation,n=e.offsets,o=e.position,l=e.gpuAcceleration,h=e.adaptive,c=e.roundOffsets,d=e.isFixed,u=n.x,p=void 0===u?0:u,m=n.y,f=void 0===m?0:m,g="function"==typeof c?c({x:p,y:f}):{x:p,y:f};p=g.x,f=g.y;var v=n.hasOwnProperty("x"),y=n.hasOwnProperty("y"),x=Xm,b=Wm,w=window;if(h){var _=Hm(i),M="clientHeight",A="clientWidth";_===Mm(i)&&"static"!==Lm(_=Im(i)).position&&"absolute"===o&&(M="scrollHeight",A="scrollWidth"),(a===Wm||(a===Xm||a===Zm)&&s===ef)&&(b=Ym,f-=(d&&_===w&&w.visualViewport?w.visualViewport.height:_[M])-r.height,f*=l?1:-1),a!==Xm&&(a!==Wm&&a!==Ym||s!==ef)||(x=Zm,p-=(d&&_===w&&w.visualViewport?w.visualViewport.width:_[A])-r.width,p*=l?1:-1)}var S,T=Object.assign({position:o},h&&gf),E=!0===c?function(e,t){var i=e.y,r=t.devicePixelRatio||1;return{x:Cm(e.x*r)/r||0,y:Cm(i*r)/r||0}}({x:p,y:f},Mm(i)):{x:p,y:f};return p=E.x,f=E.y,Object.assign({},T,l?((S={})[b]=y?"0":"",S[x]=v?"0":"",S.transform=(w.devicePixelRatio||1)<=1?"translate("+p+"px, "+f+"px)":"translate3d("+p+"px, "+f+"px, 0)",S):((t={})[b]=y?f+"px":"",t[x]=v?p+"px":"",t.transform="",t))}var yf={left:"right",right:"left",bottom:"top",top:"bottom"};function xf(e){return e.replace(/left|right|bottom|top/g,(function(e){return yf[e]}))}var bf={start:"end",end:"start"};function wf(e){return e.replace(/start|end/g,(function(e){return bf[e]}))}function _f(e,t){var i=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(i&&Tm(i)){var r=t;do{if(r&&e.isSameNode(r))return!0;r=r.parentNode||r.host}while(r)}return!1}function Mf(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function Af(e,t,i){return t===tf?Mf(function(e,t){var i=Mm(e),r=Im(e),a=i.visualViewport,s=r.clientWidth,n=r.clientHeight,o=0,l=0;if(a){s=a.width,n=a.height;var h=Pm();(h||!h&&"fixed"===t)&&(o=a.offsetLeft,l=a.offsetTop)}return{width:s,height:n,x:o+Fm(e),y:l}}(e,i)):Am(t)?function(e,t){var i=km(e,!1,"fixed"===t);return i.top=i.top+e.clientTop,i.left=i.left+e.clientLeft,i.bottom=i.top+e.clientHeight,i.right=i.left+e.clientWidth,i.width=e.clientWidth,i.height=e.clientHeight,i.x=i.left,i.y=i.top,i}(t,i):Mf(function(e){var t,i=Im(e),r=Dm(e),a=null==(t=e.ownerDocument)?void 0:t.body,s=Em(i.scrollWidth,i.clientWidth,a?a.scrollWidth:0,a?a.clientWidth:0),n=Em(i.scrollHeight,i.clientHeight,a?a.scrollHeight:0,a?a.clientHeight:0),o=-r.scrollLeft+Fm(e),l=-r.scrollTop;return"rtl"===Lm(a||i).direction&&(o+=Em(i.clientWidth,a?a.clientWidth:0)-s),{width:s,height:n,x:o,y:l}}(Im(e)))}function Sf(e){return Object.assign({},{top:0,right:0,bottom:0,left:0},e)}function Tf(e,t){return t.reduce((function(t,i){return t[i]=e,t}),{})}function Ef(e,t){void 0===t&&(t={});var i=t.placement,r=void 0===i?e.placement:i,a=t.strategy,s=void 0===a?e.strategy:a,n=t.boundary,o=void 0===n?"clippingParents":n,l=t.rootBoundary,h=void 0===l?tf:l,c=t.elementContext,d=void 0===c?rf:c,u=t.altBoundary,p=void 0!==u&&u,m=t.padding,f=void 0===m?0:m,g=Sf("number"!=typeof f?f:Tf(f,Km)),v=e.rects.popper,y=e.elements[p?d===rf?"reference":rf:d],x=function(e,t,i,r){var a="clippingParents"===t?function(e){var t=$m(Vm(e)),i=["absolute","fixed"].indexOf(Lm(e).position)>=0&&Sm(e)?Hm(e):e;return Am(i)?t.filter((function(e){return Am(e)&&_f(e,i)&&"body"!==zm(e)})):[]}(e):[].concat(t),s=[].concat(a,[i]),n=s.reduce((function(t,i){var a=Af(e,i,r);return t.top=Em(a.top,t.top),t.right=Om(a.right,t.right),t.bottom=Om(a.bottom,t.bottom),t.left=Em(a.left,t.left),t}),Af(e,s[0],r));return n.width=n.right-n.left,n.height=n.bottom-n.top,n.x=n.left,n.y=n.top,n}(Am(y)?y:y.contextElement||Im(e.elements.popper),o,h,s),b=km(e.elements.reference),w=ff({reference:b,element:v,strategy:"absolute",placement:r}),_=Mf(Object.assign({},v,w)),M=d===rf?_:b,A={top:x.top-M.top+g.top,bottom:M.bottom-x.bottom+g.bottom,left:x.left-M.left+g.left,right:M.right-x.right+g.right},S=e.modifiersData.offset;if(d===rf&&S){var T=S[r];Object.keys(A).forEach((function(e){var t=[Zm,Ym].indexOf(e)>=0?1:-1,i=[Wm,Ym].indexOf(e)>=0?"y":"x";A[e]+=T[i]*t}))}return A}function Of(e,t,i){return Em(e,Om(t,i))}function Cf(e,t,i){return void 0===i&&(i={x:0,y:0}),{top:e.top-t.height-i.y,right:e.right-t.width+i.x,bottom:e.bottom-t.height+i.y,left:e.left-t.width-i.x}}function Rf(e){return[Wm,Zm,Ym,Xm].some((function(t){return e[t]>=0}))}var Pf=cf({defaultModifiers:[{name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(e){var t=e.state,i=e.instance,r=e.options,a=r.scroll,s=void 0===a||a,n=r.resize,o=void 0===n||n,l=Mm(t.elements.popper),h=[].concat(t.scrollParents.reference,t.scrollParents.popper);return s&&h.forEach((function(e){e.addEventListener("scroll",i.update,df)})),o&&l.addEventListener("resize",i.update,df),function(){s&&h.forEach((function(e){e.removeEventListener("scroll",i.update,df)})),o&&l.removeEventListener("resize",i.update,df)}},data:{}},{name:"popperOffsets",enabled:!0,phase:"read",fn:function(e){var t=e.state;t.modifiersData[e.name]=ff({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})},data:{}},{name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(e){var t=e.state,i=e.options,r=i.gpuAcceleration,a=void 0===r||r,s=i.adaptive,n=void 0===s||s,o=i.roundOffsets,l=void 0===o||o,h={placement:uf(t.placement),variation:pf(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:a,isFixed:"fixed"===t.options.strategy};null!=t.modifiersData.popperOffsets&&(t.styles.popper=Object.assign({},t.styles.popper,vf(Object.assign({},h,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:n,roundOffsets:l})))),null!=t.modifiersData.arrow&&(t.styles.arrow=Object.assign({},t.styles.arrow,vf(Object.assign({},h,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})},data:{}},{name:"applyStyles",enabled:!0,phase:"write",fn:function(e){var t=e.state;Object.keys(t.elements).forEach((function(e){var i=t.styles[e]||{},r=t.attributes[e]||{},a=t.elements[e];Sm(a)&&zm(a)&&(Object.assign(a.style,i),Object.keys(r).forEach((function(e){var t=r[e];!1===t?a.removeAttribute(e):a.setAttribute(e,!0===t?"":t)})))}))},effect:function(e){var t=e.state,i={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,i.popper),t.styles=i,t.elements.arrow&&Object.assign(t.elements.arrow.style,i.arrow),function(){Object.keys(t.elements).forEach((function(e){var r=t.elements[e],a=t.attributes[e]||{},s=Object.keys(t.styles.hasOwnProperty(e)?t.styles[e]:i[e]).reduce((function(e,t){return e[t]="",e}),{});Sm(r)&&zm(r)&&(Object.assign(r.style,s),Object.keys(a).forEach((function(e){r.removeAttribute(e)})))}))}},requires:["computeStyles"]},{name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(e){var t=e.state,i=e.name,r=e.options.offset,a=void 0===r?[0,0]:r,s=sf.reduce((function(e,i){return e[i]=function(e,t,i){var r=uf(e),a=[Xm,Wm].indexOf(r)>=0?-1:1,s="function"==typeof i?i(Object.assign({},t,{placement:e})):i,n=s[0],o=s[1];return n=n||0,o=(o||0)*a,[Xm,Zm].indexOf(r)>=0?{x:o,y:n}:{x:n,y:o}}(i,t.rects,a),e}),{}),n=s[t.placement],o=n.y;null!=t.modifiersData.popperOffsets&&(t.modifiersData.popperOffsets.x+=n.x,t.modifiersData.popperOffsets.y+=o),t.modifiersData[i]=s}},{name:"flip",enabled:!0,phase:"main",fn:function(e){var t=e.state,i=e.options,r=e.name;if(!t.modifiersData[r]._skip){for(var a=i.mainAxis,s=void 0===a||a,n=i.altAxis,o=void 0===n||n,l=i.fallbackPlacements,h=i.padding,c=i.boundary,d=i.rootBoundary,u=i.altBoundary,p=i.flipVariations,m=void 0===p||p,f=i.allowedAutoPlacements,g=t.options.placement,v=uf(g),y=l||(v!==g&&m?function(e){if(uf(e)===Qm)return[];var t=xf(e);return[wf(e),t,wf(t)]}(g):[xf(g)]),x=[g].concat(y).reduce((function(e,i){return e.concat(uf(i)===Qm?function(e,t){void 0===t&&(t={});var i=t.boundary,r=t.rootBoundary,a=t.padding,s=t.flipVariations,n=t.allowedAutoPlacements,o=void 0===n?sf:n,l=pf(t.placement),h=l?s?af:af.filter((function(e){return pf(e)===l})):Km,c=h.filter((function(e){return o.indexOf(e)>=0}));0===c.length&&(c=h);var d=c.reduce((function(t,s){return t[s]=Ef(e,{placement:s,boundary:i,rootBoundary:r,padding:a})[uf(s)],t}),{});return Object.keys(d).sort((function(e,t){return d[e]-d[t]}))}(t,{placement:i,boundary:c,rootBoundary:d,padding:h,flipVariations:m,allowedAutoPlacements:f}):i)}),[]),b=t.rects.reference,w=t.rects.popper,_=new Map,M=!0,A=x[0],S=0;S<x.length;S++){var T=x[S],E=uf(T),O=pf(T)===Jm,C=[Wm,Ym].indexOf(E)>=0,R=C?"width":"height",P=Ef(t,{placement:T,boundary:c,rootBoundary:d,altBoundary:u,padding:h}),k=C?O?Zm:Xm:O?Ym:Wm;b[R]>w[R]&&(k=xf(k));var D=xf(k),z=[];if(s&&z.push(P[E]<=0),o&&z.push(P[k]<=0,P[D]<=0),z.every((function(e){return e}))){A=T,M=!1;break}_.set(T,z)}if(M)for(var I=function(e){var t=x.find((function(t){var i=_.get(t);if(i)return i.slice(0,e).every((function(e){return e}))}));if(t)return A=t,"break"},F=m?3:1;F>0&&"break"!==I(F);F--);t.placement!==A&&(t.modifiersData[r]._skip=!0,t.placement=A,t.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}},{name:"preventOverflow",enabled:!0,phase:"main",fn:function(e){var t=e.state,i=e.options,r=e.name,a=i.mainAxis,s=void 0===a||a,n=i.altAxis,o=void 0!==n&&n,l=i.tether,h=void 0===l||l,c=i.tetherOffset,d=void 0===c?0:c,u=Ef(t,{boundary:i.boundary,rootBoundary:i.rootBoundary,padding:i.padding,altBoundary:i.altBoundary}),p=uf(t.placement),m=pf(t.placement),f=!m,g=mf(p),v="x"===g?"y":"x",y=t.modifiersData.popperOffsets,x=t.rects.reference,b=t.rects.popper,w="function"==typeof d?d(Object.assign({},t.rects,{placement:t.placement})):d,_="number"==typeof w?{mainAxis:w,altAxis:w}:Object.assign({mainAxis:0,altAxis:0},w),M=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,A={x:0,y:0};if(y){if(s){var S,T="y"===g?Wm:Xm,E="y"===g?Ym:Zm,O="y"===g?"height":"width",C=y[g],R=C+u[T],P=C-u[E],k=h?-b[O]/2:0,D=m===Jm?x[O]:b[O],z=m===Jm?-b[O]:-x[O],I=t.elements.arrow,F=h&&I?Um(I):{width:0,height:0},L=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},j=L[T],N=L[E],U=Of(0,x[O],F[O]),V=f?x[O]/2-k-U-j-_.mainAxis:D-U-j-_.mainAxis,B=f?-x[O]/2+k+U+N+_.mainAxis:z+U+N+_.mainAxis,$=t.elements.arrow&&Hm(t.elements.arrow),q=null!=(S=null==M?void 0:M[g])?S:0,G=C+B-q,H=Of(h?Om(R,C+V-q-($?"y"===g?$.clientTop||0:$.clientLeft||0:0)):R,C,h?Em(P,G):P);y[g]=H,A[g]=H-C}if(o){var W,Y=y[v],Z="y"===v?"height":"width",X=Y+u["x"===g?Wm:Xm],Q=Y-u["x"===g?Ym:Zm],K=-1!==[Wm,Xm].indexOf(p),J=null!=(W=null==M?void 0:M[v])?W:0,ee=K?X:Y-x[Z]-b[Z]-J+_.altAxis,te=K?Y+x[Z]+b[Z]-J-_.altAxis:Q,ie=h&&K?function(e,t,i){var r=Of(e,t,i);return r>i?i:r}(ee,Y,te):Of(h?ee:X,Y,h?te:Q);y[v]=ie,A[v]=ie-Y}t.modifiersData[r]=A}},requiresIfExists:["offset"]},{name:"arrow",enabled:!0,phase:"main",fn:function(e){var t,i=e.state,r=e.name,a=e.options,s=i.elements.arrow,n=i.modifiersData.popperOffsets,o=uf(i.placement),l=mf(o),h=[Xm,Zm].indexOf(o)>=0?"height":"width";if(s&&n){var c=function(e,t){return Sf("number"!=typeof(e="function"==typeof e?e(Object.assign({},t.rects,{placement:t.placement})):e)?e:Tf(e,Km))}(a.padding,i),d=Um(s),u="y"===l?Wm:Xm,p="y"===l?Ym:Zm,m=i.rects.reference[h]+i.rects.reference[l]-n[l]-i.rects.popper[h],f=n[l]-i.rects.reference[l],g=Hm(s),v=g?"y"===l?g.clientHeight||0:g.clientWidth||0:0,y=v/2-d[h]/2+(m/2-f/2),x=Of(c[u],y,v-d[h]-c[p]);i.modifiersData[r]=((t={})[l]=x,t.centerOffset=x-y,t)}},effect:function(e){var t=e.state,i=e.options.element,r=void 0===i?"[data-popper-arrow]":i;null!=r&&("string"!=typeof r||(r=t.elements.popper.querySelector(r)))&&_f(t.elements.popper,r)&&(t.elements.arrow=r)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]},{name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(e){var t=e.state,i=e.name,r=t.rects.reference,a=t.rects.popper,s=t.modifiersData.preventOverflow,n=Ef(t,{elementContext:"reference"}),o=Ef(t,{altBoundary:!0}),l=Cf(n,r),h=Cf(o,a,s),c=Rf(l),d=Rf(h);t.modifiersData[i]={referenceClippingOffsets:l,popperEscapeOffsets:h,isReferenceHidden:c,hasPopperEscaped:d},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":c,"data-popper-escaped":d})}}]});const kf=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return()=>({width:0,height:0,top:t,right:e,bottom:t,left:e})},Df={getBoundingClientRect:kf()};let zf=0;const If=class{constructor(e){this.id=`tooltip-${e}-${++zf}`,this._tooltip=document.createElement("div"),this._tooltip.setAttribute("id",this.id),this._tooltip.setAttribute("role","tooltip"),this._tooltip.classList.add("awxgl-tooltip"),this._tooltip.innerHTML=`\n            <div class="awxgl-tooltip-content"></div>\n            <div id="${this.id}-arrow" class="awxgl-tooltip-arrow data-popper-arrow"></div>\n        `,document.body.append(this._tooltip),this._instance=Pf(Df,this._tooltip,{placement:"top",modifiers:[{name:"arrow",options:{element:document.querySelector(`#${this.id}-arrow`)}},{name:"offset",options:{offset:[0,15]}}]})}append(e){const t=ke(e)?document.querySelector(e):e;t.append(this._tooltip),this._target=t}show(e,t,i){var r;i&&this.setContent(i);const a=(null===(r=this._target)||void 0===r?void 0:r.getBoundingClientRect())||{left:0,top:0};Df.getBoundingClientRect=kf(a.left+e,a.top+t),this._tooltip.dataset.show="",this._tooltip.style.display="block",this._instance.update()}hide(){delete this._tooltip.dataset.show,this._tooltip.style.display="none"}setContent(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._content||(this._content=document.querySelector(`#${this.id} .awxgl-tooltip-content`),this._instance.update()),this._content.innerHTML=e,t&&this._instance.update().catch((e=>{}))}setHasData(e){e?this._tooltip.classList.add("awxgl-tooltip-has-data"):this._tooltip.classList.remove("awxgl-tooltip-has-data")}},Ff={event:"click",stream:!0,tooltip:{}},Lf=class{get isEnabled(){return this._enabled}constructor(e,t={}){this._evaluators={},this._enabled=!0,this.update=()=>{this._coord&&this._queryFeatures(this._coord)},this.handleMapClickEvent=e=>{this.isEnabled&&e.point&&e.coord&&(this._coord=Object.assign({},e.coord),this._queryFeaturesAsync(e.coord).then((()=>{this.show(e.point)})))},this.handleMapMoveEvent=e=>{this.hide()},this.handleMouseMoveEvent=e=>{this.isEnabled&&e.point&&e.coord&&(this._coord=Object.assign({},e.coord),this._queryFeatures(e.coord),this.show(e.point))},this.handleMouseOutEvent=e=>{this._tooltip.hide()},this._queryFeatures=hh((e=>{const t=this._inspector.query(e);this._setFeatures(e,t)}),50),this._queryFeaturesAsync=e=>this._inspector.queryPromise(e).then((t=>{this._setFeatures(e,t)})).catch((e=>{console.error(e)})),this.options=Object.freeze(lt({},Ff,t)),this._inspector=e,this._tooltip=new If("data")}addTo(e){e&&this._tooltip.append(e)}remove(){}show(e,t){this.isEnabled&&(this._position=e,t?(this._coord=Object.assign({},t),this._queryFeaturesAsync(t).then((()=>{this.show(this._position)}))):this._tooltip.show(e.x,e.y))}hide(){this._tooltip.hide()}enable(){this._enabled=!0}disable(){this.hide(),this._enabled=!1}setEvaluator(e,t){this._evaluators[e]=t}_setFeatures(e,t){const i=`${e.lat.toFixed(3)}, ${e.lon.toFixed(3)}`;let r="";const a=[],s=[];t&&(Object.keys(t).forEach((e=>{var i,r;const n=null===(i=t[e])||void 0===i?void 0:i.nodata,o=null===(r=t[e])||void 0===r?void 0:r.value,l=e,h=this._evaluators[l];if(h&&!ge(h)){const e=h.title||l.replace(/:.+$/,""),t=Jt(e)?e(o):e,i=h.alwaysShow||!1===s.includes(t),r=he(h.fn)?h.fn(o):`${o}`;r&&""!==r&&i&&!1===n&&(s.push(t),a.push(`<span class="awxgl-data-title">${t}</span> ${r}`))}})),r=a.map((e=>`<div class="awxgl-data-row">${e}</div>`)).join("")),this._tooltip.setHasData(a.length>0),this._tooltip.setContent(`\n            <div class="awxgl-data-coord">${i}</div>\n            <div class="awxgl-data-rows">${r}</div>\n        `)}},jf=class extends dt{get isPausedForLoading(){return this._pausedForLoading}constructor(e){super(),this.pauseWhileLoading=!1,this.shouldResumeAfterLoading=!0,this._layers=new Map,this._pausedForLoading=!1,this._handleTimelinePlayback=Ni((()=>{const e=this.timeline;e.isActive&&this.pauseWhileLoading&&(this._getLoadingAnimators().length>0?(this._pausedForLoading=!0,e.pause()):this._pausedForLoading&&this.shouldResumeAfterLoading&&(this._pausedForLoading=!1,e.isPaused?e.resume():e.play()))}),10),this.timeline=e,e.on(Ui.RANGE_CHANGE,(()=>{[...this._layers.values()].reduce(((e,t)=>(!1===e.includes(t.source)&&e.push(t.source),e)),[]).forEach((e=>{e instanceof vo&&e.getMetadata()})),this.setNeedsUpdate()})),e.on(Ui.PLAY,(()=>{this.pauseWhileLoading&&this._handleTimelinePlayback()}))}add(e){if(!this._layers.get(e.id)){this._layers.set(e.id,e);const t=e.animator.provider;t&&t.on(Vi.LOAD_START,(()=>{this.shouldResumeAfterLoading=!1===this.timeline.isPaused,this._handleTimelinePlayback()})).on(Vi.LOAD_COMPLETE,(()=>{this._handleTimelinePlayback()}))}}remove(e){this._layers.delete(e.id)}setNeedsUpdate(){this._layers.forEach((e=>{var t,i;null===(i=null===(t=e.animator)||void 0===t?void 0:t.provider)||void 0===i||i.setNeedsUpdate()}))}_getLoadingAnimators(){return[...this._layers].map((e=>{let[t,i]=e;const r=i.animator,a=null==r?void 0:r.provider;return i.visible&&a&&!a.isReady?r:null})).filter((e=>he(e)))}};const Nf=(e,t)=>function(e,t){return i=this,a=function*(){const i=new Request(e.url,{method:e.method||"GET",headers:e.headers,body:e.body,signal:null==t?void 0:t.signal}),r=e.type||"string";"json"===r&&i.headers.set("Accept","application/json");const a=yield fetch(i);if(!a.ok)throw new Error(`Request failed: ${a.status} ${a.statusText}`);let s;switch(r){case"json":s=yield a.json();break;case"arrayBuffer":case"image":s=yield a.arrayBuffer();break;default:s=yield a.text()}if(null==t?void 0:t.signal.aborted)throw new Error("Request was aborted");return{response:a,data:s}},new((r=void 0)||(r=Promise))((function(e,t){function s(e){try{o(a.next(e))}catch(e){t(e)}}function n(e){try{o(a.throw(e))}catch(e){t(e)}}function o(t){var i;t.done?e(t.value):(i=t.value,i instanceof r?i:new r((function(e){e(i)}))).then(s,n)}o((a=a.apply(i,[])).next())}));var i,r,a}(Object.assign(Object.assign({},e),{type:"json"}),t);var Uf=function(e,t,i,r){return new(i||(i=Promise))((function(a,s){function n(e){try{l(r.next(e))}catch(e){s(e)}}function o(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,o)}l((r=r.apply(e,t||[])).next())}))};new Set(["inter-bold"]);const Vf=[{start:0,end:255},{start:256,end:383},{start:384,end:591}],Bf=e=>{const t={start:e,end:e+255};return Vf.forEach((i=>{i.start===e&&(t.end=i.end)})),t};class $f{constructor(e){this.glyphs={},this.textures=[],this._atlasCount=0,this.url=e.url}getRangeForChar(e){return this.getRangeForCodePoint(e.codePointAt(0))}getRangeForCodePoint(e){let t=null;return Vf.forEach((i=>{e>=i.start&&e<=i.end&&(t=i)})),t}getRanges(e){var t;const i=null===(t=this.glyphs[e])||void 0===t?void 0:t.ranges;return i?Object.values(i):[]}getAtlasTextures(e){const t=[];return Object.values(this.glyphs).forEach((e=>{Object.values(e.ranges).forEach((e=>{var i;(null===(i=e.atlas)||void 0===i?void 0:i.bitmap)&&t.push(e.atlas)}))})),t.sort(((e,t)=>e.index-t.index)).forEach((t=>{if(!this.textures[t.index]){const i=new lo(e,{image:t.bitmap,size:t.size});this.textures[t.index]=i}})),this.textures}loadGlyphs(e){return Uf(this,void 0,void 0,(function*(){const t=[];return Object.keys(e).forEach((i=>{this.glyphs[i]||(this.glyphs[i]={ranges:{},requests:{}});const r=e[i];e[i]=[...new Set(r.filter((e=>"number"==typeof e)))],r.forEach((e=>{const r=this.getRangeForCodePoint(e);if(r){const e=this.glyphs[i],a=e.ranges[r.start],s=e.requests[r.start];if(s)t.push(s);else if(!a){const a=this.loadGlyphRange(i,r.start).then((()=>{delete e.requests[r.start]}));this.glyphs[i].requests[r.start]=a,t.push(a)}}}))})),Promise.all(t)}))}loadBitmaps(){return Uf(this,void 0,void 0,(function*(){const e=[];return Object.keys(this.glyphs).forEach((t=>{const i=this.glyphs[t].ranges;Object.keys(i).forEach((r=>{const a=Number.parseInt(r,10),s=i[a];s.spec&&!s.atlas&&e.push(this.loadFontAtlas(t,a,s.spec.pages[0]))}))})),Promise.all(e)}))}loadGlyphRange(e,t){return Uf(this,void 0,void 0,(function*(){const{start:i,end:r}=Bf(t),a=yield this.loadFontSpec(e,t);if(!a)throw new Error(`[MapsGL] Failed to load font glyph range ${t}: ${e}:${i}-${r}`);return this.glyphs[e].ranges[t]={start:i,end:r,spec:a,atlas:null},a.pages&&Array.isArray(a.pages)?yield this.loadFontAtlas(e,t,a.pages[0]):console.error("[MapsGL] Invalid font metadata",a),this.glyphs[e].ranges[t]}))}loadFontSpec(e,t){return Uf(this,void 0,void 0,(function*(){const{start:i,end:r}=Bf(t),a=Ct(this.url,{name:e,start:i,end:r}),s=new AbortController,{data:n}=yield Nf({url:a},s);return n}))}loadFontAtlas(e,t,i){return Uf(this,void 0,void 0,(function*(){const r=Ct(this.url,{}).replace(/\/[^/]+\.json$/,`/${i}`),a=yield(e=>new Promise(((t,i)=>{const r=new Image;r.addEventListener("load",(()=>{const e=document.createElement("canvas");e.width=r.width,e.height=r.height;const i=e.getContext("2d");i.drawImage(r,0,0);const a=i.getImageData(0,0,r.width,r.height).data;t({size:{width:r.width,height:r.height},data:new Uint8Array(a.buffer)})})),r.addEventListener("error",(()=>{i(r)})),r.crossOrigin="anonymous",r.src=e})))(r);this.glyphs[e].ranges[t].atlas={index:this._atlasCount,size:a.size,bitmap:a.data},this._atlasCount+=1}))}serialize(){return{url:this.url,glyphs:Object.assign({},this.glyphs)}}merge(e){this.glyphs=lt(this.glyphs,e.glyphs)}static deserialize(e){const t=new $f({url:e.url});return t.glyphs=Object.keys(e.glyphs).reduce(((t,i)=>(t[i]={ranges:e.glyphs[i].ranges,requests:{}},t)),Object.create(null)),t}}const qf=$f;var Gf=function(e,t,i,r){return new(i||(i=Promise))((function(a,s){function n(e){try{l(r.next(e))}catch(e){s(e)}}function o(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,o)}l((r=r.apply(e,t||[])).next())}))};let Hf=[],Wf=0;const Yf=(e,t)=>new Promise(((i,r)=>{e.type="image",Hf.push({request:e,state:"pending",abortController:t,onSuccess:e=>i(e),onError:e=>r(e)}),Qf()})),Zf=e=>Gf(void 0,void 0,void 0,(function*(){e.state="loading",Wf+=1;const t=Xf(e.request,e.abortController);try{const i=yield t;if(delete e.abortController,e.state="completed",i.data instanceof HTMLImageElement)e.onSuccess(i);else if(i.data){const t=yield createImageBitmap(i.data);e.onSuccess({response:null,data:t})}}catch(t){delete e.abortController,e.onError(t)}finally{Wf-=1,Qf()}})),Xf=(e,t)=>Gf(void 0,void 0,void 0,(function*(){return new Promise(((i,r)=>{const a=new Image;a.crossOrigin="anonymous",t.signal.addEventListener("abort",(()=>{a.src="",r(new Error("AbortError"))})),a.addEventListener("load",(()=>{i({response:null,data:a})})),a.addEventListener("error",(()=>{t.signal.aborted||r(new Error("Failed to load image"))})),a.src=e.url}))})),Qf=()=>{for(let e=Wf;e<12;e++){const e=Hf.shift();if(e){if(e.abortController.signal.aborted){Wf-=1;continue}Zf(e)}}},Kf=class{get size(){return{width:this.image.width,height:this.image.height}}constructor(e={}){this.iconPositions={},this.includesSDFImages=!1,this._dirty=!1,this.update(e)}update(e){const t={},i=[];this._addImages(e,i,t),i.forEach((e=>{e.w+=2,e.h+=2}));const{w:r,h:a}=function(e){let t=0,i=0;for(const r of e)t+=r.w*r.h,i=Math.max(i,r.w);e.sort(((e,t)=>t.h-e.h));const r=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),i),h:1/0}];let a=0,s=0;for(const t of e)for(let e=r.length-1;e>=0;e--){const i=r[e];if(!(t.w>i.w||t.h>i.h)){if(t.x=i.x,t.y=i.y,s=Math.max(s,t.y+t.h),a=Math.max(a,t.x+t.w),t.w===i.w&&t.h===i.h){const t=r.pop();e<r.length&&(r[e]=t)}else t.h===i.h?(i.x+=t.w,i.w-=t.w):t.w===i.w?(i.y+=t.h,i.h-=t.h):(r.push({x:i.x+t.w,y:i.y,w:i.w-t.w,h:t.h}),i.y+=t.h,i.h-=t.h);break}}return{w:a,h:s,fill:t/(a*s)||0}}(i),s=lr({width:r||1,height:a||1},4);Object.keys(e).forEach((i=>{const r=e[i],a=t[i];hr({data:r.data,width:r.size.width,height:r.size.height},s,0,0,a.x+1,a.y+1,{width:a.w-2,height:a.h-2})})),this.image=s,this.iconPositions=t}texturePosition(e){const t=this.iconPositions[e];if(t)return{x:t.x/this.image.width,y:t.y/this.image.height,w:t.w/this.image.width,h:t.h/this.image.height}}prepareTexture(e){this.image&&(this.texture?this._dirty&&(this._dirty=!1):this.texture=new lo(e,{image:this.image.data,size:this.size,premultiplyAlpha:!0}))}patchUpdatedImages(e){Object.keys(e.updatedImages).forEach((t=>{this.updateImage(t,e.getImage(t))}))}updateImage(e,t){const i=this.iconPositions[e];this.texture&&i&&(this.texture.updateImage(t.data,i.x+1,i.y+1,i.w-2,i.h-2),this._dirty=!0)}_addImages(e,t,i){Object.keys(e).forEach((r=>{const a=e[r],s={x:0,y:0,w:a.stretchX||a.size.width,h:a.stretchY||a.size.height};!0===a.sdf&&(this.includesSDFImages=!0),t.push(s),i[r]=s,this._dirty=!0}))}},Jf=class{get texture(){var e;return null===(e=this._atlas)||void 0===e?void 0:e.texture}get updatedImages(){return this._updatedImages}constructor(){this.images={},this._dirty=!1,this._updatedImages={},this._requests={},this._renderCallbacks=[],this._atlas=new Kf}getImage(e){return this.images[e]}getImages(e){return this._getImages(e)}addImage(e,t){if(this.images[e])throw new Error(`[MapsGL] Image with id '${e}' already exists, use updateImage instead.`);Zt(xe(e),"[MapsGL] Image 'id' was not provided."),Zt(he(t.data),"[MapsGL] Image 'data' was not provided."),t.version=t.version||1,this.images[e]=t;const i=t.renderer;i&&(i.initialize&&i.initialize(t.data,t.size),i.draw&&this._renderCallbacks.push(e)),this._atlas.update(this.images),this._dirty=!0}updateImage(e,t){const i=this.images[e];if(i.size.width!==t.size.width||i.size.height!==t.size.height)throw new Error(`[MapsGL] Cannot update image with id '${e}', dimensions do not match.`);t.version=i.version+1,this.images[e]=t,this._updatedImages[e]=!0,this._dirty=!0}removeImage(e){var t;const i=this.images[e];delete this.images[e],(null===(t=i.renderer)||void 0===t?void 0:t.dispose)&&i.renderer.dispose()}loadSprite(e,t){return i=this,void 0,a=function*(){let i,r;const a=new AbortController,s=[Nf({url:t}),Yf({url:t.replace(".json",".png")},a)];return Promise.all(s).then((a=>{let[s,n]=a;if(!n.data)throw new Error(`[MapsGL] Failed to load sprite from '${t}'.`);i=s.data,r=n.data;const o=zs({width:n.data.width,height:n.data.height}).getContext("2d",{willReadFrequently:!0});o.drawImage(r,0,0),Object.keys(i).forEach((t=>{const{x:r,y:a,width:s,height:n,pixelRatio:l}=i[t],h=`${e}:${t}`.replace(/-sdf$/,""),c=t.endsWith("-sdf");this.getImage(h)?this.updateImage(h,{data:o.getImageData(r,a,s,n).data,size:{width:s,height:n},sdf:c,pixelRatio:l}):this.addImage(h,{data:o.getImageData(r,a,s,n).data,size:{width:s,height:n},sdf:c,pixelRatio:l})}))}))},new((r=void 0)||(r=Promise))((function(e,t){function s(e){try{o(a.next(e))}catch(e){t(e)}}function n(e){try{o(a.throw(e))}catch(e){t(e)}}function o(t){var i;t.done?e(t.value):(i=t.value,i instanceof r?i:new r((function(e){e(i)}))).then(s,n)}o((a=a.apply(i,[])).next())}));var i,r,a}loadImages(e){return new Promise(((t,i)=>{const r=e.map((e=>{let{id:t,url:i,sdf:r=!1}=e;return this.getImage(t)?Promise.resolve():this._requests[i]?this._requests[i].task:this.loadImage(t,i,{sdf:r})}));Promise.all(r).then((()=>{t()})).catch(i)}))}loadImage(e,t,i){if(this._requests[t])return this._requests[t].task;Zt(xe(t),`[MapsGL] Image 'url' was not provided for '${e}'.`),Zt(xe(e),`[MapsGL] Image 'id' was not provided for '${t}'.`);const r=new AbortController,a=Yf({url:t},r).then((e=>(delete this._requests[t],e.data))).then((t=>{const r=zs({width:t.width,height:t.height}).getContext("2d");return r.drawImage(t,0,0),this.addImage(e,Object.assign(Object.assign({},i),{data:r.getImageData(0,0,t.width,t.height).data,size:{width:t.width,height:t.height}})),this.getImage(e)}));return this._requests[t]={task:a,abortController:r},a}prepare(e){var t;null===(t=this._atlas)||void 0===t||t.prepareTexture(e)}createAtlas(e){const t=new Kf;return t.update(this._getImages(e)),t}triggerFrame(){this._renderCallbacks.forEach((e=>{var t;const i=this.getImage(e);if((null===(t=null==i?void 0:i.renderer)||void 0===t?void 0:t.draw)&&!0===i.used){const t=i.renderer.draw(i.data,i.size);t instanceof Uint8ClampedArray?(i.data=t,this.updateImage(e,i)):delete this._updatedImages[e]}}))}triggerImageUpdates(){Object.keys(this._updatedImages).forEach((e=>{const t=this.getImage(e);t&&this._atlas.updateImage(e,t)})),this._updatedImages={}}_getImages(e){var t;const i={},r=(null===(t=this._atlas)||void 0===t?void 0:t.size)||{width:1,height:1};return e.forEach((e=>{var t;const a=this.images[e];if(a){const s=null===(t=this._atlas)||void 0===t?void 0:t.iconPositions[e];i[e]={data:a.data,size:a.size,pixelRatio:a.pixelRatio,sdf:a.sdf,position:{x:s.x/r.width,y:s.y/r.height,w:s.w/r.width,h:s.h/r.height},stretchX:a.stretchX,stretchY:a.stretchY,version:a.version},a.used=!0}else kt.has(s=`[MapsGL] Image with id '${e}' not found. Make sure the image has been added with controller.style.addImage().`)||(console.warn(s),kt.add(s));var s})),i}},eg=class{constructor(e){this.glyphManager=new qf({url:e.fontUrl}),this.imageManager=new Jf}getGlyphs(e){return this.glyphManager.loadGlyphs(e).then((()=>this.getFonts()))}getFonts(){const e=this.glyphManager.glyphs;return Object.keys(this.glyphManager.glyphs).reduce(((t,i)=>(t[i]={ranges:e[i].ranges},t)),Object.create(null))}getFontTextures(e){return this.glyphManager.getAtlasTextures(e)}loadSprite(e,t){return this.imageManager.loadSprite(e,t)}loadImages(e){return this.imageManager.loadImages(e)}loadImage(e,t,i){return this.imageManager.loadImage(e,t,i)}getImages(e){return Promise.resolve(this.imageManager.getImages(e))}getImage(e){return this.imageManager.getImage(e)}addImage(e,t){this.getImage(e)||this.imageManager.addImage(e,t)}updateImage(e,t){this.imageManager.updateImage(e,t)}removeImage(e){this.getImage(e)&&this.imageManager.removeImage(e)}createImageAtlas(e){return this.imageManager.createAtlas(e)}},tg=180*Math.atan(3/4)/Math.PI,ig=function(e,t){return(180+e)/360*((arguments.length>2&&void 0!==arguments[2]?arguments[2]:Fn)*Ln(t))},rg=function(e,t){const i=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:Fn)*Ln(t);return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360*i},ag=class{get projectionMatrix(){return this.scene.camera.projectionMatrix}get zoomScale(){return Ln(this.state.zoom)}get worldSize(){return function(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:Fn)*Ln(e)}(this.state.zoom,this.tileSize)}constructor(e,t){this.tileSize=Fn,this.worldSizeScale=1,this.updateOnMapViewChange=!0,this.projection=new On,this.scene=t}update(e){this.state=Object.assign(Object.assign({},this.state),e);const t=Object.freeze(this.state),i=this.scene.camera,{width:r,height:a}=t.size,s=t.center,n=t.pitch,o=t.bearing,l=js(t.fov),h=l/2,c=Math.cos(Math.PI/2-t.pitch),d=a/50,u=Math.max(d*c,d),p=1e21,m=.5/Math.tan(l/2)*a,f=Math.PI/2+n;Math.sin(h),Math.sin(Math.PI-f-h),Math.cos(Math.PI/2-n),this.cameraToCenterDistance=m;const g=this.worldSize,v=this.projection.project(s.lat,s.lon),y=v.x*g,x=v.y*g;(null==t?void 0:t.projectionMatrix)?i.projectionMatrix.copy(t.projectionMatrix):i instanceof om?i.projectionMatrix.orthographic(-r/2,r/2,a/2,-a/2,u,p):i.projectionMatrix.perspective(l,r/a,u,p);const b=(new bc).fromTranslation(new Mn(0,0,this.cameraToCenterDistance)),w=(new bc).premultiply(b).premultiply((new bc).fromRotationX(js(n))).premultiply((new bc).fromRotationZ(-js(o)));i.worldMatrix.copy(w),i.updateMatrixWorld();const _=(new bc).fromRotationZ(Math.PI),M=(new bc).fromScale(new Mn(-g,g,1)),A=(new bc).fromTranslation(new Mn(-y,x,0));this.scene.scene.worldMatrix=(new wc).premultiply(_).premultiply(M).premultiply(A),this.updateMatrices()}calculateTilePos(e){const t=e.normalize(),i=this.tileSize*this.zoomScale/Ln(e.z),r=t.x+Math.pow(2,e.z)*e.wrap,a=new Mn(r*i,e.y*i,0),s=new Mn(i/Co,i/Co,1),n=this.projMatrix.clone();return n.translate(a),n.scale(s),{translation:a,scale:s,matrix:n}}getLabelPlaneMatrix(e,t,i,r){const a=new bc;return t?(a.scale(new Mn(1/r,1/r,1)),i||a.rotateZ(this.state.bearing)):(a.multiply(e),a.multiply(this.labelPlaneMatrix)),a}getGlCoordMatrix(e,t,i,r){if(t){const t=e.clone();return t.scale(new Mn(r,r,1)),i||t.rotateZ(-this.state.bearing),t}return this.glCoordMatrix}locationToPoint(e){return this.projection.project(e.lat,e.lon)}pointToLocation(e){return this.projection.unproject(e.x,e.y)}locationToCoordinate(e){return In.fromCoordinate(e)}coordinateToLocation(e){return e.toCoordinate()}tilePointToLocation(e,t){const i=Co*Math.pow(2,t.z);return Hn({x:(t.x*Co+e.x)/i,y:(t.y*Co+e.y)/i})}getPerspectiveRatio(e,t){return.5+e/t*.5}updateMatrices(){const{width:e,height:t}=this.state.size,i=this.state.center,r=this.state.zoom,a=this.state.bearing,s=this.state.pitch,n=this.worldSize,o=this.projection.pixelsPerMeter(i.lat,n);this.mercatorMatrix=(new bc).scale(new Mn(n,n,n/o));let l=new bc;l.scale(new Mn(e/2,-t/2,1)),l.translate(new Mn(1,-1,0)),this.labelPlaneMatrix=l.clone(),l=new bc,l.scale(new Mn(1,-1,1)),l.translate(new Mn(-1,-1,0)),l.scale(new Mn(2/e,2/t,1)),this.glCoordMatrix=l.clone();const h=js(this.state.fov),c=h/2,d=.5/Math.tan(h/2)*t,u=Math.PI/2+s,p=Math.sin(c)*d/Math.sin(Math.PI-u-c),m=1.01*(Math.cos(Math.PI/2-s)*p+d);l=(new wc).perspective(h,e/t,1,m),l.scale(new Mn(1,-1,1)),l.translate(new Mn(0,0,-this.cameraToCenterDistance)),l.rotateX(js(s)),l.rotateZ(js(-a));const f=ig(i.lon,r,this.tileSize),g=rg(i.lat,r,this.tileSize);l.translate(new Mn(-f,-g,0));const v=n/(2*Math.PI*6378137*Math.abs(Math.cos(js(i.lat))));l.scale(new Mn(1,1,v)),this.projMatrix=l.clone()}addMatrixTestMarkers(){this.addTestMarker(38.91217392903104,-77.02116668112512,"#ff00ff"),this.addTestMarker(47.613107,-122.342033,"#ff00ff"),this.addTestMarker(29.7569385,-95.3650946,"#ff00ff"),this.addTestMarker(25.7824017,-80.2707436,"#ff00ff"),this.addTestMarker(41.8513329,12.1846031,"#ff00ff")}addTestMarker(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#ff0000";const r=this.worldSize,a=Math.floor(this.state.zoom),s=ig(t,a,this.tileSize),n=rg(e,a,this.tileSize),o=(Ln(a),{x:s/this.tileSize,y:n/this.tileSize}),l={x:Math.floor(o.x),y:Math.floor(o.y),zoom:a,wrap:0},h={x:(o.x-l.x)*Co,y:(o.y-l.y)*Co},c=this.projMatrix.clone(),d=r/Ln(l.zoom),u=l.x+Math.pow(2,l.zoom)*l.wrap,p=new Mn(u*d,l.y*d,0),m=(new bc).fromTranslation(p);c.multiply(m);const f=new Mn(d/Co,d/Co,1),g=(new bc).fromScale(f);c.multiply(g);const v=`${e}-${t}-${i.replaceAll("#","")}`.replaceAll(".","_");let y=document.querySelector(`#marker-${v}`);y||(y=document.createElement("div"),y.setAttribute("id",`marker-${v}`),y.style.position="absolute",y.style.backgroundColor=i,y.style.width="12px",y.style.height="12px",y.style.borderRadius="100%",y.style.zIndex="1000",document.body.append(y));const x=new al(h.x,h.y,0,1).clone().applyMatrix4(c),b=x.clone().divideScalar(x.w).clone().applyMatrix4(this.labelPlaneMatrix);y.style.left=b.x-6+"px",y.style.top=b.y-6+"px"}},sg=class{get id(){var e;return null===(e=this.layer)||void 0===e?void 0:e.id}get layer(){return this._layer}get isMask(){return!0===/::mask/.test(this.id)}constructor(e,t){this.refs=new Map,this.code=e,this.config=Object.assign({},t)}addConsumer(e,t){this.refs.set(e,{hidden:t})}removeConsumer(e){this.refs.delete(e)}addTo(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var r,a,s,n,o,l,h,c,d,u,p,m,f,g,v,y;const x=this.config,b=x.source.id,w=i.id||x.id;e.hasSource(b)||(x.source instanceof Os==0&&((null===(r=i.data)||void 0===r?void 0:r.bounds)&&(x.source.bounds=i.data.bounds),he(null===(a=i.data)||void 0===a?void 0:a.minZoom)&&(x.source.minZoom=i.data.minZoom),he(null===(s=i.data)||void 0===s?void 0:s.maxZoom)&&(x.source.maxZoom=i.data.maxZoom)),e.addSource(b,x.source)),x.layer.source=b;const _=Object.assign({},x.layer);if(xe(i.paint)){_.paint=lt({},_.paint,i.paint),xe(null===(o=null===(n=_.paint.sample)||void 0===n?void 0:n.colorscale)||void 0===o?void 0:o.stops)&&(xe(null===(c=null===(h=null===(l=null==i?void 0:i.paint)||void 0===l?void 0:l.sample)||void 0===h?void 0:h.colorscale)||void 0===c?void 0:c.stops)&&(_.paint.sample.colorscale.stops=i.paint.sample.colorscale.stops),delete _.paint.sample.colorscale.masks);const e=null===(d=i.paint.sample)||void 0===d?void 0:d.colorscale,t=null===(u=x.legend)||void 0===u?void 0:u.bar;if(xe(t)&&xe(null==e?void 0:e.stops)){const i=Array.isArray(t)?t[0]:t;x.legend.bar=Object.assign(Object.assign({},i),{colorscale:Object.assign(Object.assign({},i.colorscale),{stops:e.stops,range:e.normalized?{min:0,max:1}:i.colorscale.range,interval:e.interval||i.colorscale.interval})})}}if(((e,t)=>{if(he(t)){const{clamp:i,range:r,interleaved:a}=t,s=Object.assign({},e.timeSeries);i&&(s.clamp=i),r&&(s.clamp=wr.range,s.range=r),"boolean"===fe(a)&&(s.interleaved=a),e.timeSeries=s}})(_,null==i?void 0:i.timing),_.type===Pi.query&&Array.isArray(null===(p=_.paint)||void 0===p?void 0:p.text)&&!1===(null===(m=null==i?void 0:i.data)||void 0===m?void 0:m.cities)&&(_.paint.text=_.paint.text.slice(0,-1)),xe(null===(f=x.query)||void 0===f?void 0:f.layerId)){_.queryLayer=this._setupQueryLayer(e,x.query),this._queryLayerInfo=_.queryLayer;const t=e.getWeatherElement(x.query.layerId);t&&t.addConsumer(w,x.query.hidden)}if(xe(null===(g=x.mask)||void 0===g?void 0:g.layerId)){let t=x.mask.layerId;if(xe(t)&&e.weatherProvider.isWeatherLayer(t)){t=`${t}::mask`;const e=Object.assign(Object.assign({},x.mask.overrides),null===(v=i.mask)||void 0===v?void 0:v.overrides);(null==e?void 0:e.filter)&&(t+=`-${window.btoa(JSON.stringify(e.filter))}`),x.mask.id=t}_.mask=this._setupMaskLayer(e,x.mask)}else delete _.mask;if(this.config.legend){const e=null===(y=this.config.legend)||void 0===y?void 0:y.bar,t=Array.isArray(e)?e:[e];this.legendId=this.config.legend.id,t.forEach((e=>{var t,i;(null===(i=null===(t=_.paint.sample)||void 0===t?void 0:t.colorscale)||void 0===i?void 0:i.breaks)&&e.colorscale&&(e.colorscale.breaks=_.paint.sample.colorscale.breaks)}))}return this._layer=e.addLayer(w,_,t),i.hidden&&this.layer.hide(),this.layer}remove(e){var t,i,r,a;if(null===(t=this.config.query)||void 0===t?void 0:t.layerId){const t=e.getWeatherElement(this.config.query.layerId);t&&t.removeConsumer(this.id)}if((null===(i=this.refs)||void 0===i?void 0:i.size)>0){this.active=!1;let e=!0;return this.refs.forEach((t=>{!1===t.hidden&&(e=!1)})),e&&this.layer.hide(),!1}if(e.removeLayer(this.id),this._layer=null,null===(r=this._queryLayerInfo)||void 0===r?void 0:r.id){const t=e.getLayer(this._queryLayerInfo.id);t&&!0!==t.visible&&e.removeWeatherLayer(null===(a=this.config.query)||void 0===a?void 0:a.layerId)}return!0}_setupMaskLayer(e,t){const i=t.id||t.layerId;let r=e.getLayer(i);if(!r){let a=t.layerId;"water"!==a&&"land"!==a||("land"===a&&(t.invert=!0,a="water"),t.overrides=Object.assign(Object.assign({},Xr.overrides),t.overrides));const s=e.addWeatherLayer(a,Object.assign(Object.assign({},t.overrides),{id:i}));r=Array.isArray(s)?s[0]:s}if(r)return{id:r.id,invert:t.invert}}_setupQueryLayer(e,t){var i;let r=e.getWeatherLayer(t.layerId);if(Array.isArray(r))return void console.warn(`[MapsGL] Query layer cannot use multiple layers: ${t.layerId}`);let a=e.getLayer(null==r?void 0:r.id);return a||(r=e.addWeatherLayer(t.layerId,{hidden:t.hidden},null===(i=t.overrides)||void 0===i?void 0:i.beforeId),a=Array.isArray(r)?r[0]:r),a?{id:a.id,hidden:t.hidden}:void 0}},ng=class extends dt{get container(){}get context(){return this._context}set context(e){this._context=e,this.store.source.each((t=>{if(t instanceof Wo){const i=e.gl;t.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE)}}))}get isReady(){return this._isReady}get fps(){return this._fps.fps}get sources(){return[...this.store.source.cache.values()]}get layers(){return[...this.store.layer.orderedLayers()]}get controls(){return this._controls}get sourceIds(){return[...this.store.source.cache.keys()]}get layerIds(){return[...this.store.layer.cache.keys()]}get weatherLayerIds(){return[...this._weatherElements.keys()]}get libraryInfo(){return{name:void 0,version:{current:0,min:0}}}constructor(e,t){var i,r,a;if(super(),this.store={source:void 0,layer:void 0},this.state=new rr({fullscreen:!1,tileBounds:void 0,units:Object.assign({},l.imperial)}),this._loadingSources=new Set,this._weatherElements=new Map,this._controls={legend:void 0,dataInspector:void 0},this._eventHandlers={},this._resumeAnimationOnMoveEnd=!0,this._resumeAnimation=!1,this._dataEvaluatorsByLayer={},this.needsRedraw=!1,this.isFadingSymbols=!1,this._isReady=!1,this.updateSymbolPlacement=hh((()=>{const e=this.getSymbolLayers();e.length>0&&this.placement.placeSymbols(e),this.isFadingSymbols=e.length>0||this.placement.isDirty,this.isFadingSymbols&&this.fadeSymbolsIfNeeded()}),150),this._handleFullScreenChange=e=>{const t=pe(this.container);this.state.setState({fullscreen:t}),this.trigger("fullscreenchange")},this._handleSourceLoadEvent=e=>{const{type:t,sourceId:i}=e;t===ms?this.trigger(Ms):t===Ms?(0===this._loadingSources.size&&this.trigger(Ms),this._loadingSources.has(i)||this._loadingSources.add(i)):t===As&&(this._loadingSources.delete(i),0===this._loadingSources.size&&this.trigger(As)),this.updateSymbolPlacement()},this._handleLayerVisibilityChange=e=>{this.updateSymbolPlacement()},this._handleLegendUnitsChange=e=>{this.setUnits(!0===e.metric?l.metric:l.imperial)},this._updateLegendsForMap=e=>{const t=this.controls.legend;null==t||t.legends.forEach((e=>{var t,i;if(null===(t=e.legend.options.points)||void 0===t?void 0:t.requiresMapBounds)e.legend.update({},{time:this.timeline.currentDate,bounds:this.getBounds()});else if(null===(i=e.legend.options.points)||void 0===i?void 0:i.layerId){const t=this.getWeatherLayer("alerts")||this.getWeatherLayer("alerts-outline");if(t instanceof uu){const i=t.getVisibleFeatures();e.legend.update({},{features:i})}}}))},!t.account)throw new Error("[MapsGL] Map controller must include a valid account configuration.");this._fps=new wh,this._fps.start(5e3),window.addEventListener("focus",(()=>{this._fps.fps<50&&this._fps.start(5e3)})),this.account=t.account,this.weatherProvider=new Ko(this.account),this.map=e,this.store.source=new Wh,this.store.layer=new am(this.store.source),this.style=new eg({fontUrl:"https://cdn.aerisapi.com/sdk/js/mapsgl/fonts/{name}_{start}-{end}.json"}),this.scene=new hm({camera:"perspective",map:{size:this.getSize(),fov:this.getFov()}}),this.transform=new ag(An.mercator,this.scene),this.viewport=new Th,this.updateViewport(),this.placement=new uh(this.transform),this.checkVersion(),t.units&&this.state.setState({units:Object.assign(Object.assign({},this.state.get("units")),t.units)}),this.timeline=new bh(Object.assign({id:"map-timeline",start:new Date(Date.now()-864e5),end:new Date,duration:4,endDelay:2},t.animation)),this._animatorSync=new jf(this.timeline),this._animatorSync.pauseWhileLoading=(null===(i=t.animation)||void 0===i?void 0:i.pauseWhileLoading)||!1,this.on(Bh,(()=>{this._animatorSync.setNeedsUpdate()})),this._resumeAnimationOnMoveEnd=null===(a=null===(r=t.animation)||void 0===r?void 0:r.resumeOnMoveEnd)||void 0===a||a,this.inspector=new _h(this),this.on(Nh,(()=>{this.updateViewport()})),this.on(Uh,(()=>{this.timeline.isPaused?!0!==this._animatorSync.isPausedForLoading&&(this._animatorSync.shouldResumeAfterLoading=!1):(this.timeline.pause(),this._resumeAnimation=this._resumeAnimationOnMoveEnd)})),this.on(Vh,(()=>{this.updateViewport(),this.timeline.isPaused&&this._resumeAnimation&&(this._animatorSync.shouldResumeAfterLoading=this._resumeAnimationOnMoveEnd,!1===this._animatorSync.isPausedForLoading&&this.timeline.resume()),this._resumeAnimation=!1})),this.updateViewport()}initialize(){return this.updateViewport(),this.weatherProvider.loadStyles(this.style).then((()=>{this._isReady=!0,this.trigger(Dh)}))}checkVersion(){const{name:e,version:{current:t,min:i}}=this.libraryInfo;he(t)&&Zt(t>=i,`[MapsGL] Version for the ${e} library must be ${i} or higher, but version ${t} is being used.`)}getSize(){throw new Error("Subclasses must override `getSize`")}setSize(e){throw new Error("Subclasses must override `setSize`")}setContainerSize(e){let{width:t,height:i}=e;const r=this.container;r&&(r.style.width="string"==typeof t?t:`${t}px`,r.style.height="string"==typeof i?i:`${i}px`,this.resize())}getCenter(){throw new Error("Subclasses must override `getCenter`")}setCenter(e){throw new Error("Subclasses must override `setCenter`")}getBounds(){throw new Error("Subclasses must override `getBounds`")}getZoom(){throw new Error("Subclasses must override `getZoom`")}setZoom(e){throw new Error("Subclasses must override `setZoom`")}getBearing(){throw new Error("Subclasses must override `getBearing`")}getPitch(){throw new Error("Subclasses must override `getPitch`")}getFov(){throw new Error("Subclasses must override `getFov`")}getUnits(){return Object.assign({},this.state.get("units"))}setUnits(e){var t;this.state.setState({units:Object.assign(Object.assign({},this.state.get("units")),e)}),null===(t=this.controls.legend)||void 0===t||t.setUnits(this.state.get("units")),this.trigger($h,{units:this.state.get("units")})}redraw(){throw new Error("Subclasses must override `redraw`")}resize(){const e=this.getSize();this.context.size.width===e.width&&this.context.size.height===e.height||this.invalidateMapSize()}toggleFullscreen(){const e=this.container,t=this.state.get("fullscreen"),i=document;t?(i.exitFullscreen?i.exitFullscreen():i.mozCancelFullScreen?i.mozCancelFullScreen():i.webkitCancelFullScreen?i.webkitCancelFullScreen():i.msExitFullscreen&&i.msExitFullscreen(),this.state.setState({fullscreen:!1})):(e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):e.msRequestFullscreen?e.msRequestFullscreen():e.webkitEnterFullscreen&&e.webkitEnterFullscreen(),this.state.setState({fullscreen:!0}))}setPaintProperty(e,t,i){const r=this.getLayer(e);r&&r.setPaintProperty(t,i)}addLegendControl(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.controls.legend)return;if(le(e))throw new Error("[MapsGL] DOM target not provided for `addLegendControl`");const i=new _m(t);return i.addTo(e),this._controls.legend=i,this.on(Vh,this._updateLegendsForMap,null,this),i.on("add",this._updateLegendsForMap,null,this),i.on(um,this._handleLegendUnitsChange,null,this),this.timeline.on(Ui.ADVANCE,this._updateLegendsForMap,null,this),i}addDataInspectorControl(){if(this.controls.dataInspector)return;const e=this.container||document.body,t=new Lf(this.inspector,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});return t.addTo(e),this._controls.dataInspector=t,[...this._weatherElements.values()].forEach((e=>{const i=this._dataEvaluatorsByLayer[e.id];i&&t.setEvaluator(e.id,i)})),"move"===t.options.event?(this.on(Fh,t.handleMouseMoveEvent),this.on(Ih,t.handleMouseOutEvent)):this.on(zh,t.handleMapClickEvent),t.options.stream&&this.timeline.on(Ui.ADVANCE,t.update),this.on(Uh,t.handleMapMoveEvent),t}removeLegendControl(){const e=this._controls.legend;e&&(e.remove(),e.off(um,this._handleLegendUnitsChange)),this.off(Vh,this._updateLegendsForMap),this.off(Ui.ADVANCE,this._updateLegendsForMap)}removeDataInspectorControl(){const e=this._controls.dataInspector;e&&(e.remove(),this.off(Fh,e.handleMouseMoveEvent),this.off(Ih,e.handleMouseOutEvent),this.off(zh,e.handleMapClickEvent),this.off(Uh,e.handleMapMoveEvent),this.timeline.off(Ui.ADVANCE,e.update))}hasWeatherLayer(e){var t;const i=(null===(t=this.getWeatherElement(e))||void 0===t?void 0:t.id)||e,r=this.weatherProvider.getWeatherLayerConfig(e);return!!this.hasLayer(i)||!!Array.isArray(r)&&r.filter((e=>this.hasWeatherLayer(e))).length===r.length}getWeatherLayer(e){var t;const i=this.weatherProvider.getWeatherLayerConfig(e);return Array.isArray(i)?i.map((e=>{const t=this.getWeatherLayer(e);return!1===Array.isArray(t)?t:null})).filter(Boolean):null===(t=this.getWeatherElement(e))||void 0===t?void 0:t.layer}setWeatherLayerVisibility(e,t){let i=this.getWeatherLayer(e);i&&(Array.isArray(i)||(i=[i]),i.forEach((i=>{const r=this.getWeatherElement(e);t?i.show():i.hide(),this.controls.legend&&(null==r?void 0:r.legendId)&&(t?this.controls.legend.addLegend(r.legendId,r.config.legend,{bounds:this.getBounds()}):this.controls.legend.removeLegend(r.legendId))})))}getWeatherElement(e){return this._weatherElements.get(e)}addWeatherLayer(e,t,i){var r,a,s;t=t||{};const n=this.getWeatherElement(e);if(n){if(!1===n.active)return n.active=!0,n.layer.show(),n.layer;if(ge(t))return void console.warn(`[MapsGL] Weather layer with id '${e}' already exists on the map`)}const o=this.weatherProvider.getLayerAlias(e);if(o)return console.warn(`[MapsGL] Attempting to use deprecated weather layer id '${e}'. Using '${o}' instead.`),this.hasWeatherLayer(o)?void 0:this.addWeatherLayer(o,t,i);const l=this.weatherProvider.getWeatherLayerConfig(e,Object.assign(Object.assign({},t),{timeline:{from:this.timeline.startDate,to:this.timeline.endDate,current:this.timeline.currentDate}}));if(ye(l))return void console.warn(`[MapsGL] No weather layer configuration for the id '${e}'`);if(Array.isArray(l)){delete t.id;let e=i;const r=l.reduce(((r,a)=>{if(this.hasWeatherLayer(a))r.push(this.getWeatherLayer(a));else{const s=this.addWeatherLayer(a,t,i);s instanceof qh&&(e=s.id,r.push(s))}return r}),[]);return r.length>0?r:void 0}const h=new sg(e,l);if(h.addTo(this,i,t),ye(h.layer))return void console.error(`[MapsGL] No layer created for weather layer with id '${e}'`);h.isMask||this._weatherElements.set(e,h);const c=h.config.legend;if(this.controls.legend&&xe(c)&&!0!==(null==t?void 0:t.hidden)){const e=this.controls.legend.addLegend(c.id,c,{bounds:this.getBounds()});e&&(h.legendId=e.id,h.layer.on(Ph,(t=>{let{property:i,value:r}=t;if("sample.colorscale"===i)he(r.masks)?e.update({bar:r.masks.map((e=>e))}):e.update({bar:{colorscale:r}});else if(/^sample\.colorscale\.\w+/.test(i)){const t=i.replace(/^sample\.colorscale\./,""),a=e.options.bar;Array.isArray(a)?a.forEach((e=>pt(e.colorscale,t,r))):pt(a.colorscale,t,r),e.update({bar:a})}}))),(null===(r=c.points)||void 0===r?void 0:r.layerId)&&(null===(a=this.getSource(h.config.source.id))||void 0===a||a.on(vs,this._updateLegendsForMap))}return this._dataEvaluatorsByLayer[h.id]=h.config.evaluator,null===(s=this.controls.dataInspector)||void 0===s||s.setEvaluator(h.id,h.config.evaluator),h.layer}removeWeatherLayer(e){var t,i,r;const a=this.weatherProvider.getWeatherLayerConfig(e);if(!a)return void console.warn(`[MapsGL] No weather layer configuration for the id '${e}'`);if(Array.isArray(a))return void a.forEach((e=>this.removeWeatherLayer(e)));const s=this.getWeatherElement(e);if(s&&this.getLayer(s.id)&&(s.legendId&&(null===(t=this.controls.legend)||void 0===t||t.removeLegend(s.legendId)),s.remove(this))){this._weatherElements.delete(e);const t=s.config.source.id;this.hasSource(t)&&(null===(r=null===(i=this.getSource(t))||void 0===i?void 0:i.consumingLayers)||void 0===r?void 0:r.length)<=1&&this.removeSource(t)}}hasSource(e){return this.store.source.has(e)}hasLayer(e){return this.store.layer.has(e)}getSource(e){return this.store.source.get(e)}getLayer(e){return this.store.layer.get(e)}findLayer(e){return this.store.layer.find(e)}addSource(e,t){const i=this.store.source.add(e,t);if(i){if(i.style=this.style,i.on(Ms,this._handleSourceLoadEvent.bind(this)),i.on(xs,this._handleSourceLoadEvent.bind(this)),i.on(As,this._handleSourceLoadEvent.bind(this)),i instanceof vo){const e=()=>{i.metadata.setValidTimeRange({start:this.timeline.startDate,end:this.timeline.endDate})};this.timeline.on(Ui.RANGE_CHANGE,(()=>{e()})),e()}return this.trigger("source:add",{source:i}),i}}addLayer(e,t,i){var r;let a=this.store.layer.count;i&&(a=Math.max(0,this.store.layer.getIndex(i)-1)),"debug"===t.type&&!1===this.hasSource("debug")&&(this.addSource("debug",{type:"debug"}),t.source="debug");const s=this.store.layer.insertAt(a,e,t,this.scene);return le(s)&&this.hasLayer(e)?this.getLayer(e):(s&&(s.on(Oh,this._handleLayerVisibilityChange,null,this),s.on(Ch,this._handleLayerVisibilityChange,null,this),this.add(s,i),s.animator&&(this._animatorSync.add(s),null===(r=this.timeline)||void 0===r||r.add(s.animator.animation),s.enabled=s.animator.canShowForDate()),this.triggerRedraw(),this.trigger("layer:add",{layer:s}),this._handleLayerVisibilityChange({layer:s})),s)}moveLayer(e,t){const i=le(t)?-1:Math.max(0,this.store.layer.getIndex(t))-1;this.store.layer.move(e,i)}removeSource(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=this.getSource(e);i?(this.store.source.remove(e),i.style=void 0,i.off(Ms,this._handleSourceLoadEvent),i.off(xs,this._handleSourceLoadEvent),i.off(As,this._handleSourceLoadEvent),this.trigger("source:remove",{source:i}),t&&i.dispose()):console.warn(`[MapsGL] Source does not exist for identifier '${e}'`)}removeLayer(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var i,r;const a=this.store.layer.remove(e);a?(a.off(Oh,this._handleLayerVisibilityChange),a.off(Ch,this._handleLayerVisibilityChange),a.animator&&(this._animatorSync.remove(a),null===(i=this.timeline)||void 0===i||i.remove(a.animator.animation)),a.mask=void 0,this.remove(a),this.triggerRedraw(),this.trigger("layer:remove",{layer:a}),this._handleLayerVisibilityChange({layer:a}),t&&(a.mask&&(null===(r=a.mask.layer)||void 0===r||r.dispose()),a.dispose())):console.warn(`[MapsGL] Layer does not exist for identifier '${e}'`)}query(e){return this.inspector.query(e)}queryPromise(e){return this.inspector.queryPromise(e)}triggerRedraw(){this.needsRedraw=!0,this.redraw()}add(e,t){e.map=this}remove(e){e.map=void 0}invalidateMapSize(){throw new Error("Subclasses must override `invalidateMapSize`")}updateViewport(){const e={size:this.getSize(),center:this.getCenter(),zoom:this.getZoom(),bounds:this.getBounds(),pitch:this.getPitch(),bearing:this.getBearing(),fov:this.getFov()};this.viewport.updateFromMapViewState(e,this.transform),this.transform.updateOnMapViewChange&&this.transform.update(e),this.updateSymbolPlacement();const t=this.viewport.getVisibleTileBounds(),i=this.state.get("tileBounds");(le(i)||!1===(null==i?void 0:i.equals(t)))&&(this.state.setState("tileBounds",t),this.trigger(Bh,{tileBounds:t.info}))}getSymbolLayers(){const e=[];return this.layers.filter((e=>e.visible)).forEach((t=>{const i="symbol"===t.type||"text"===t.type,r=t.paint.symbolAllowOverlap()&&"map"!==t.paint.symbolOverlapMode();if(t instanceof nu&&i&&!1===r){const i=this.viewport.getVisibleTileCoords(t.getDataZoom()).map((e=>{const i=e.normalize();let r=t.source.tiles.get(i);return he(r)&&(r=r.clone(e.wrap)),r})).filter((e=>he(e)));e.push({id:t.id,tiles:i,paint:t.paint})}})),e}fadeSymbolsIfNeeded(){let e=!1;this.getSymbolLayers().forEach((t=>{if(this.placement.updateLayerOpacities(t.id,t.tiles)){const i=this.getLayer(t.id);null==i||i.setNeedsUpdate(),e=!0}})),this.isFadingSymbols=e,this.triggerRedraw()}setupEvents(e){const t=this.map;let i="on";t.addEventListener?i="addEventListener":t.addListener&&(i="addListener"),"function"==typeof t[i]&&Object.keys(e).forEach((t=>{this._eventHandlers[i]=(i=>{const r=this.dataForMapEvent(t,i);this.shouldTriggerMapEvent(t)&&this.trigger(e[t],r)}).bind(this),this.map[i](t,this._eventHandlers[i])})),["","moz","webkit","ms"].forEach((e=>{document.addEventListener(`${e}fullscreenchange`,this._handleFullScreenChange.bind(this))}))}_tick(e){this.style.imageManager.triggerFrame(),this.isFadingSymbols&&this.fadeSymbolsIfNeeded()}shouldTriggerMapEvent(e){return!0}dataForMapEvent(e,t){}dispose(){var e;this.timeline.clear(),this.store.layer.each((e=>{this.hasLayer(e.id)&&this.removeLayer(e.id,!0)})),this.store.source.each((e=>{this.hasSource(e.id)&&this.removeSource(e.id,!0)})),null===(e=this.context)||void 0===e||e.dispose();const t=this.map;let i="off";t.addEventListener?i="addEventListener":t.addListener&&(i="addListener"),"function"==typeof t[i]&&(Object.keys(this._eventHandlers).forEach((e=>{this.map[i](e,this._eventHandlers[i])})),this._eventHandlers={})}},og=class extends ng{get context(){return this.map.context}constructor(e,t){super(e,t),this.setupEvents({load:"load",unload:"unload",resize:"resize",click:"click",dblclick:"dblclick",mousedown:"mousedown",mouseup:"mouseup",mouseover:"mouseover",mouseout:"mouseout",mousemove:"mousemove",zoom:"zoom",zoomstart:"zoom:start",zoomend:"zoom:end",move:"move",movestart:"move:start",moveend:"move:end",popupopen:"popupopen",popupclose:"popupclose"}),this.initialize()}getSize(){return this.map.getSize()}getCenter(){return this.map.getCenter()}setCenter(e){this.map.setCenter(e)}getZoom(){return this.map.getZoom()}setZoom(e){this.map.setZoom(e)}getBounds(){return this.map.getBounds()}fitBounds(){}getBearing(){return 0}getPitch(){return 0}getFov(){return tg}redraw(){this.map.redraw()}add(e,t){super.add(e,t),e.map=this,this.map.addLayer(e)}remove(e){super.remove(e),this.map.removeLayer(e),e.map=void 0}updateViewport(){super.updateViewport(),this.map.transform.state=this.transform.state}project(e){const t=this.transform.projection.project(e.lat,e.lon);return{x:t.x*this.map.container.offsetWidth,y:t.y*this.map.container.offsetHeight}}unproject(e){const t={x:e.x/this.map.container.offsetWidth,y:e.y/this.map.container.offsetHeight,z:0};return this.transform.projection.unproject(t.x,t.y)}dataForMapEvent(e,t){if(!t)return;let i;switch(e){case"click":case"dblclick":case"mousemove":i={coord:{lat:t.latlng.lat,lon:t.latlng.lng},point:{x:t.containerPoint.x,y:t.containerPoint.y}}}return i}},lg=class{constructor(){this.cache=new Map}get(e){return this.cache.get(e)}set(e,t){this.cache.set(e,t)}has(e){return this.cache.has(e)}exists(e){const t=[...this.cache.values()];return e instanceof oo?t.some((t=>t.id===e.id)):t.includes(e)}delete(e){const t=this.get(e);t instanceof oo&&t.dispose(),this.cache.delete(e)}dispose(){this.cache.forEach(((e,t)=>{this.delete(t)})),this.cache.clear()}},hg=class{constructor(e){this.textures=new lg,this.programs=new lg,this.geometry=new lg,this.objects=new lg,this.context=e}getProgram(e,t,i){const r=function(e){let t=e;return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).forEach((e=>{t+=`/${e}`})),t}(e,t);let a=this.programs.get(r);return a||(a=i(this.context),this.programs.set(r,a)),a}hasProgram(e){return this.programs.exists(e)}getFullscreenQuad(){let e=this.geometry.get("quad"),t=this.objects.get("camera:quad");return e||(e=new kl(this.context,{position:{size:2,data:new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1])},uv:{size:2,data:new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1])}}),this.geometry.set("quad",e)),t||(t=new om(0,1,1,0,0,1),this.objects.set("camera:quad",t)),{geometry:e,camera:t}}dispose(){this.textures.dispose(),this.programs.dispose(),this.geometry.dispose(),this.objects.dispose()}};var cg;const dg=!!(null===(cg=null===document||void 0===document?void 0:document.createElement("canvas"))||void 0===cg?void 0:cg.getContext("webgl2")),ug=()=>dg&&"undefined"!=typeof WebGL2RenderingContext;let pg=1;const mg=class extends dt{constructor(e,t={}){var i,r,a;super(),this.dpr=1,this._extensions={},this._ownsCanvas=!1,this.id=pg++,this.cache=new hg(this),e||((null===(i=t.context)||void 0===i?void 0:i.canvas)?e=t.context.canvas:(e=zs(),this._ownsCanvas=!0)),this._canvas=e,this._gl=t.context?t.context:ug()&&"webgl"!==t.type?e.getContext("webgl2",Object.assign({antialias:!0},t)):e.getContext("webgl",Object.assign({antialias:!0},t)),this._state=new Gc(this.gl),this.vertexAttribDivisor=this.getExtension("ANGLE_instanced_arrays","vertexAttribDivisor","vertexAttribDivisorANGLE"),this.drawArraysInstanced=this.getExtension("ANGLE_instanced_arrays","drawArraysInstanced","drawArraysInstancedANGLE"),this.drawElementsInstanced=this.getExtension("ANGLE_instanced_arrays","drawElementsInstanced","drawElementsInstancedANGLE"),this.createVertexArray=this.getExtension("OES_vertex_array_object","createVertexArray","createVertexArrayOES"),this.bindVertexArray=this.getExtension("OES_vertex_array_object","bindVertexArray","bindVertexArrayOES"),this.deleteVertexArray=this.getExtension("OES_vertex_array_object","deleteVertexArray","deleteVertexArrayOES"),this._contextSize={width:(null===(r=this.canvas)||void 0===r?void 0:r.clientWidth)||this.canvas.width,height:(null===(a=this.canvas)||void 0===a?void 0:a.clientHeight)||this.canvas.height},this._handleResizeBind=this._handleResize.bind(this),window.addEventListener("resize",this._handleResizeBind,!1),window.addEventListener("orientationchange",this._handleResizeBind,!1),window.addEventListener("webkitfullscreenchange",this._handleResizeBind,!1)}get canvas(){return this._canvas}get gl(){return this._gl}get size(){const e=this.dpr;return{width:this.canvas.clientWidth||this.canvas.width/e,height:this.canvas.clientHeight||this.canvas.height/e}}get resolution(){return{width:this.canvas.width,height:this.canvas.height}}get state(){return this._state}get isWebGL(){const e=this.gl;return Boolean(e&&(e instanceof WebGLRenderingContext||34962===e.ARRAY_BUFFER))}get isWebGL2(){const e=this.gl;return Boolean(e&&ug()&&(e instanceof WebGL2RenderingContext||32874===e.ARRAY_BUFFER))}getExtension(e,t,i){const r=this.gl[t];if(t&&r)return r.bind(this.gl);this._extensions[e]||(this._extensions[e]=this.gl.getExtension(e));const a=this._extensions[e];return t?a?a[i].bind(a):null:a}resetState(){this.state.reset(),this.bindVertexArray(null)}resize(e,t){const i=this.canvas,r=this.dpr;i.width===e&&i.height===t||(i.width=e*r,i.height=t*r,i.style.width=`${e}px`,i.style.height=`${t}px`,this._handleResize())}dispose(){var e;if(window.removeEventListener("resize",this._handleResizeBind),this.cache.dispose(),this._ownsCanvas){this.canvas.width=1,this.canvas.height=1;const t=null===(e=this.gl)||void 0===e?void 0:e.getExtension("WEBGL_lose_context");t&&t.loseContext()}this._gl=void 0,this._canvas=void 0,this._state.reset()}invalidateSize(){this._handleResize()}createTexture(){return new lo(this,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}createFramebuffer(){return new ac(this,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}createVertexShader(e){return new Uc(this,e)}createFragmentShader(e){return new Vc(this,e)}createProgram(e){return new ed(this,e)}createMesh(e,t){return new gd(this,e,t)}_handleResize(){this._resizeTimeout&&window.clearTimeout(this._resizeTimeout);const e=Is(this.gl),t=this.canvas.width,i=this.canvas.height;t===this._contextSize.width&&i===this._contextSize.height&&e===this.dpr||(this._contextSize.width=t,this._contextSize.height=i,this.dpr=e,this.trigger("resize",this._contextSize))}},fg=class{constructor(e){this.id=e.id,this.glLayer=e,this.type="custom",this.renderingMode="2d"}onAdd(e,t){const i=this.glLayer.map;i.context||(i.context=new mg(t.canvas,{context:t}),i.context.dpr=Is(i.context.gl));const r=i.context;this._lastContextSize={width:r.resolution.width,height:r.resolution.height},this.glLayer.onAdd(i.context);const a=this.glLayer;this._eventHandlers={move:a.onMove.bind(a),zoom:a.onZoom.bind(a),click:a.onClick.bind(a),mousemove:a.onMouseMove.bind(a),movestart:a.onMoveStart.bind(a),moveend:a.onMoveEnd.bind(a),resize:a.onResize.bind(a)},Object.keys(this._eventHandlers).forEach((t=>{e.on(t,this._eventHandlers[t])}))}onRemove(e,t){this.glLayer.onRemove(),this.renderLoop=void 0,e&&this._eventHandlers&&Object.keys(this._eventHandlers).forEach((t=>{e.off(t,this._eventHandlers[t])}))}prerender(e,t){var i;const r=this.glLayer.map.context,a=this._lastContextSize,s=r.resolution;!a||a.width===s.width&&a.height===s.height||(r.invalidateSize(),this._lastContextSize={width:s.width,height:s.height}),this.glLayer.prerender(null===(i=this.renderLoop)||void 0===i?void 0:i.elapsedTime)}render(e,t){var i;this.glLayer.render(null===(i=this.renderLoop)||void 0===i?void 0:i.elapsedTime)}},gg=class extends ng{get container(){return this.map.getContainer()}get libraryInfo(){var e;const t=this.map.version||(null===(e=null===window||void 0===window?void 0:window.mapboxgl)||void 0===e?void 0:e.version);return{name:"mapbox",version:{current:void 0===t?void 0:Number.parseFloat(t.replace(/-.+$/,"")),min:2}}}constructor(e,t){if(super(e,t),this._mapboxLayers=new Map,this._mapEventHandlers={},void 0!==e.getProjection){const t=e.getProjection();"globe"===(null==t?void 0:t.name)&&console.warn('[MapsGL] Mapbox "globe" projection has limitations that prevent MapsGL from being fully supported. Update your Mapbox map instance to use the "mercator" projection with MapsGL. See https://docs.mapbox.com/mapbox-gl-js/guides/projections/')}this._loop=new Qi(this._tick.bind(this)),this.setupEvents({remove:"unload",resize:"resize",click:"click",dblclick:"dblclick",mousedown:"mousedown",mouseup:"mouseup",mouseover:"mouseover",mouseout:"mouseout",mousemove:"mousemove",zoom:"zoom",zoomstart:"zoom:start",zoomend:"zoom:end",move:"move",movestart:"move:start",moveend:"move:end"}),e.isStyleLoaded()?this.initialize():(this._mapEventHandlers.load=this.initialize.bind(this),this._mapEventHandlers.remove=this.dispose.bind(this),this._mapEventHandlers.resize=this._resize.bind(this),e.on("load",this._mapEventHandlers.load),e.on("remove",this._mapEventHandlers.remove),e.on("resize",this._mapEventHandlers.resize)),this._mapEventHandlers["style.load"]=()=>{setTimeout((()=>{this._mapboxLayers.forEach((t=>{let{layer:i,beforeId:r}=t;e.getLayer(i.id)||e.addLayer(i,r)}))}),500)},e.on("style.load",this._mapEventHandlers["style.load"])}getSize(){const e=this.map.getContainer();return pe(this.container)?{width:window.innerWidth,height:window.innerHeight}:{width:e.offsetWidth,height:e.offsetHeight}}setSize(e){this.setContainerSize(e)}getCenter(){const e=this.map.getCenter();return{lat:e.lat,lon:e.lng}}setCenter(e){this.map.setCenter({lat:e.lat,lng:e.lon})}getBounds(){const e=this.map.getBounds();return{north:e.getNorth(),south:e.getSouth(),west:e.getWest(),east:e.getEast()}}getZoom(){return this.map.getZoom()}setZoom(e){this.map.setZoom(e)}getBearing(){return this.map.getBearing()}getPitch(){return this.map.getPitch()}getFov(){return Ns(this.map.transform._fov)}redraw(){this.map.triggerRepaint()}moveLayer(e,t){super.moveLayer(e,t),this.map.moveLayer(e,t)}add(e,t){var i;if(super.add(e,t),!(null===(i=this.map)||void 0===i?void 0:i.getStyle()))return;const r=new fg(e);this.map.getLayer(e.id)||this._mapboxLayers.get(e.id)?console.warn(`[MapsGL] A WebGLLayer with id {${e.id}} already exists on the map`):(this._mapboxLayers.set(e.id,{layer:r,beforeId:t}),r.renderLoop=this._loop,this.map.addLayer(r,t),this._loop.start())}remove(e){var t;if(null===(t=this.map)||void 0===t?void 0:t.getStyle()){const t=this.map.getLayer(e.id);this.map&&t&&this.map.removeLayer(e.id)}this._mapboxLayers.delete(e.id),0===this._mapboxLayers.size&&this._loop.stop(),super.remove(e)}_tick(e){super._tick(e)}_resize(){var e;null===(e=this.context)||void 0===e||e.invalidateSize()}invalidateMapSize(){this.map.resize()}dataForMapEvent(e,t){if(!t)return;let i;switch(e){case"click":case"dblclick":case"mousemove":i={target:this,originalEvent:t,coord:{lat:t.lngLat.lat,lon:t.lngLat.lng},point:{x:t.point.x,y:t.point.y}}}return i}dispose(e){this._loop.dispose(),Object.keys(this._mapEventHandlers).forEach((e=>{this.map.off(e,this._mapEventHandlers[e])})),super.dispose(e)}},vg=class extends gg{get libraryInfo(){var e;const t=this.map.version||(null===(e=null===window||void 0===window?void 0:window.maplibregl)||void 0===e?void 0:e.version);return{name:"maplibre",version:{current:void 0===t?void 0:Number.parseFloat(t),min:2.3}}}constructor(e,t){super(e,t),this.on("fullscreenchange",(()=>{this.map.resize()}))}},yg=class{get libraryInfo(){return{name:"leaflet",version:{current:0,min:0}}}constructor(e){this.id=e.id,this.glLayer=e,this.type="custom",this.renderingMode="2d"}onAdd(e,t){this.glLayer.onAdd(this.glLayer.map.context);const i=this.glLayer;this._eventHandlers={move:i.onMove.bind(i),zoom:i.onZoom.bind(i),click:i.onClick.bind(i),mousemove:i.onMouseMove.bind(i),movestart:i.onMoveStart.bind(i),moveend:i.onMoveEnd.bind(i),resize:i.onResize.bind(i)},Object.keys(this._eventHandlers).forEach((t=>{e.on(t,this._eventHandlers[t])}))}onRemove(e,t){this.renderLoop=void 0,this.glLayer.onRemove(),e&&this._eventHandlers&&Object.keys(this._eventHandlers).forEach((t=>{e.off(t,this._eventHandlers[t])}))}prerender(e,t){var i;this.glLayer.prerender(null===(i=this.renderLoop)||void 0===i?void 0:i.elapsedTime)}render(e){var t;this.glLayer.render(null===(t=this.renderLoop)||void 0===t?void 0:t.elapsedTime)}},xg=class extends ng{get container(){return this.map.getContainer()}constructor(e,t){super(e,t),this._glLayers=new Map,this._canvasTransform={x:0,y:0,scale:1},this._isMoving=!1,this._isZooming=!1,this._mapEventHandlers={},this.context=new mg(void 0,{premultipliedAlpha:!0,depth:!1,antialias:!(me.safari&&me.version>=15.4&&me.version<16),alpha:!0}),this.context.dpr=Is(this.context.gl),this._loop=new Qi(this._tick.bind(this)),this.transform.tileSize=256,this.transform.worldSizeScale=this.transform.tileSize/512;const i=e.options.zoomAnimation,r=this.context.canvas;r.style.position="absolute",r.className="leaflet-zoom-"+(i?"animated":"hide"),e._panes.overlayPane.append(r),this._mapEventHandlers.resize=this._resize.bind(this),e.on("resize",this._mapEventHandlers.resize),this._resize(),this.setupEvents({load:"load",unload:"unload",resize:"resize",click:"click",dblclick:"dblclick",mousedown:"mousedown",mouseup:"mouseup",mouseover:"mouseover",mouseout:"mouseout",mousemove:"mousemove",zoom:"zoom",zoomstart:"zoom:start",zoomend:"zoom:end",move:"move",movestart:"move:start",moveend:"move:end",popupopen:"popupopen",popupclose:"popupclose"}),i&&(this._mapEventHandlers.zoomanim=this._animateZoom.bind(this),e.on("zoomanim",this._mapEventHandlers.zoomanim)),this.initialize(),setTimeout((()=>this.trigger(Dh)),250)}getSize(){const e=this.container;return pe(e)?{width:window.innerWidth,height:window.innerHeight}:{width:e.offsetWidth,height:e.offsetHeight}}setSize(e){this.setContainerSize(e)}getCenter(){const e=this.map.getCenter();return{lat:e.lat,lon:e.lng}}setCenter(e){this.map.setView({lat:e.lat,lng:e.lon},this.getZoom())}getBounds(){const e=this.map.getBounds();return{north:e.getNorth(),west:e.getWest(),south:e.getSouth(),east:e.getEast()}}getZoom(){return this.map.getZoom()}setZoom(e){this.map.setZoom(e)}getBearing(){return 0}getPitch(){return 0}getFov(){return tg}redraw(){this.needsRedraw=!0}add(e,t){super.add(e,t);const i=new yg(e);i.renderLoop=this._loop,this._glLayers.set(e.id,i),i.onAdd(this.map,this.context.gl)}remove(e){e.onRemove();const t=this._glLayers.get(e.id);t&&(t.onRemove(this.map,this.context.gl),this._glLayers.delete(t.id),this.redraw())}invalidateMapSize(){this.map.invalidateSize(!0),this._resize()}_resize(){const e=this.map.getSize(),t=this.context.canvas,i=this.context.dpr;t.width/i===e.x&&t.height/i===e.y||this.context.resize(e.x,e.y),this._resetCanvas()}_tick(e){super._tick(e);const t=this.context,i=t.gl;this._isMoving&&!this._isZooming?this._moveCanvas():!this._isZooming&&this._canvasNeedsReset()&&this._resetCanvas(),(this.needsRedraw||this.store.layer.orderedLayers().some((e=>e.isDirty)))&&(t.state.setBlendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA),this.store.layer.each((e=>{e.prerender()})),t.state.bindFramebuffer({buffer:null}),t.state.setViewport(this.context.resolution.width,this.context.resolution.height),t.state.setClearColor(new hl(0,0,0,0)),t.state.clear(!0),this.store.layer.each((e=>{e.render()})),t.bindVertexArray(null),t.state.setBlendFunc(i.ONE,i.ZERO))}setupEvents(e){super.setupEvents(e),this.on(Uh,(()=>{this._isMoving=!0})),this.on(Vh,(()=>{this._isMoving=!1})),this.on(Lh,(()=>{this._isZooming=!0})),this.on(jh,(()=>{this._isZooming=!1,this._resetCanvas()})),this.on("fullscreenchange",(()=>{this.map.invalidateSize(!0),setTimeout((()=>{this._resetCanvas()}),300)}))}dataForMapEvent(e,t){if(!t)return;let i;switch(e){case"click":case"dblclick":case"mousemove":i={coord:{lat:t.latlng.lat,lon:t.latlng.lng},point:{x:t.containerPoint.x,y:t.containerPoint.y}}}return i}_moveCanvas(){const e=this.map.containerPointToLayerPoint([0,0]);this._transformCanvas({x:e.x,y:e.y})}_resetCanvas(){const e=this.map.containerPointToLayerPoint([0,0]);this._transformCanvas({x:e.x,y:e.y}),this._canvasTransform={x:0,y:0,scale:1}}_transformCanvas(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const i=this.context.canvas;let r=`translate(${(e=e||{x:0,y:0}).x}px, ${e.y}px)`;r+=` scale(${t})`,this._canvasTransform={x:e.x,y:e.y,scale:t},i&&(i.style.transform=r)}_animateZoom(e){const t=this.map,i=t.getZoomScale(e.zoom,t.getZoom()),r=this._unclampedLatLngBoundsToNewLayerBounds(t.getBounds(),e.zoom,e.center).min;this._transformCanvas(r,i)}_animateZoomNoLayer(e){const t=this.map,i=t.getZoomScale(e.zoom,t.getZoom()),r=t._getCenterOffset(e.center).multiplyBy(-i).subtract(t._getMapPanePos());this._transformCanvas(r,i)}_unclampedProject(e,t,i){var r;const{crs:a}=this.map.options,{R:s}=a.projection,n=Math.sin(t*(Math.PI/180)),o=new L.Point(s*(e*(Math.PI/180)),s*Math.log((1+n)/(1-n))/2),l=null!==(r=a.scale(i))&&void 0!==r?r:0;return a.transformation._transform(o,l)}_unclampedLatLngBoundsToNewLayerBounds(e,t,i){const r=this.map._getNewPixelOrigin(i,t),a=e.getNorth(),s=e.getSouth(),n=e.getWest(),o=e.getEast();return new L.Bounds([this._unclampedProject(n,s,t).subtract(r),this._unclampedProject(n,a,t).subtract(r),this._unclampedProject(o,s,t).subtract(r),this._unclampedProject(o,a,t).subtract(r)])}_canvasNeedsReset(){const e=this._canvasTransform;return 0!==e.x||0!==e.y||1!==e.scale}dispose(e){Object.keys(this._mapEventHandlers).forEach((e=>{this.map.off(e,this._mapEventHandlers[e])})),this._loop.stop(),super.dispose(e)}},bg=("undefined"!=typeof navigator&&/iphone|ipad|ipod|android/i.test(navigator.userAgent),"undefined"!=typeof window&&window.matchMedia("(max-width: 767px)"),!("object"==typeof process&&"[object process]"===String(process)&&!process.browser)&&"undefined"!=typeof document);let wg=bg&&"complete"===document.readyState;bg?new Promise(((e,t)=>{wg?e(document):window.addEventListener("load",(()=>{wg=!0,e(document)}))})):Promise.resolve({});var _g,Mg=function(e,t,i,r){if("a"===i&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?r:"a"===i?r.call(e):r?r.value:t.get(e)};_g=new WeakMap;const Ag=class{constructor(e){_g.set(this,void 0),this.id=e.id,this.glLayer=e}onAdd(e,t){this.glLayer.onAdd(this.glLayer.map.context);const i=this.glLayer;(function(e,t,i,r,a){if("function"==typeof t||!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");t.set(e,i)})(this,_g,{zoom_changed:i.onZoom.bind(i),click:i.onClick.bind(i),mousemove:i.onMouseMove.bind(i),resize:i.onResize.bind(i)}),Object.keys(Mg(this,_g,"f")).forEach((t=>{e.addListener(t,Mg(this,_g,"f")[t])}))}onRemove(e,t){this.renderLoop=void 0,this.glLayer.onRemove(),e&&Mg(this,_g,"f")&&Object.keys(Mg(this,_g,"f")).forEach((e=>{}))}prerender(e,t){var i;this.glLayer.prerender(null===(i=this.renderLoop)||void 0===i?void 0:i.elapsedTime)}render(e){var t;this.glLayer.render(null===(t=this.renderLoop)||void 0===t?void 0:t.elapsedTime)}},Sg=85.05113,Tg=e=>{const t=e.getDiv().firstChild;return{width:t.offsetWidth,height:t.offsetHeight}},Eg=(e,t)=>{const i=t?e/t:1;return(new wc).perspective(js(25),i,.75,3e14)},Og=(e,t,i)=>{const r=new google.maps.Point(t,i),a=e.fromContainerPixelToLatLng(r);return[a.lng(),a.lat()]};function Cg(){}const Rg=class extends dt{constructor(e,t){super(),this._triggerContextEvent=!0,this._needsRedraw=!1,this.controller=e,this.options=Object.freeze(t),this.setMap(e.map)}getViewCenter(){var e;return null===(e=this._viewState)||void 0===e?void 0:e.center}getViewZoom(){var e;return null===(e=this._viewState)||void 0===e?void 0:e.zoom}getViewBounds(){var e;const t=null===(e=this._dummyOverlay)||void 0===e?void 0:e.getProjection();if(t){const e=this.controller.map,i=e.getBounds(),r=null==i?void 0:i.getNorthEast(),a=null==i?void 0:i.getSouthWest(),s=e.getDiv().firstChild,n=e.getCenter(),o=t.getWorldWidth(),l=s.clientWidth/o*360;return{north:null==r?void 0:r.lat(),west:n.lng()-l/2,south:null==a?void 0:a.lat(),east:n.lng()+l/2}}return null}setMap(e){var t;if(e!==this._map&&(this._map&&(null===(t=this._overlay)||void 0===t||t.setMap(null),this._map=null),e)){this._map=e;const{UNINITIALIZED:t}=google.maps.RenderingType;e.getRenderingType()===t?e.addListener("renderingtype_changed",(()=>{this._createOverlay(e)})):this._createOverlay(e)}}redraw(){this._overlay instanceof google.maps.WebGLOverlayView?this._overlay.requestRedraw():this._needsRedraw=!0}onAdd(){const e=this.controller.map;if(this._overlay instanceof google.maps.OverlayView){const e=this._overlay.getPanes(),t=document.createElement("div");t.style.position="absolute",t.append(this.controller.context.canvas),this._overlayContainer=t,e.overlayLayer.append(this._overlayContainer)}else!1===this.options.interleaved&&this._mapContext&&this._mapContext.canvas.parentElement.append(this.controller.context.canvas);setTimeout((()=>{const t=e.getZoom();e.setZoom(t+.01),setTimeout((()=>e.setZoom(t)),1)}),1)}onContextRestored(e){const{gl:t}=e,i=this.controller;this._mapContext=t,i.context||(i.context=new mg(t.canvas,{context:t}),i.context.dpr=Math.min(2,Is(t)),i.context.on("resize",(()=>{this._lastContextSize=i.context.resolution,this.onResize()})),this._lastContextSize=i.context.resolution);const{width:r,height:a}=t.canvas;t.viewport(0,0,r,a)}onStateUpdate(e){}onContextLost(){console.warn("[MapsGL] Google Maps context lost")}onRemove(){}onResize(){this._overlay instanceof google.maps.WebGLOverlayView?this._overlay.requestRedraw():this._onDrawRaster()}tick(e){if(this.controller.context&&this.controller.map){if(!this.options.interleaved)return this._redraw(this.controller.context.gl),void(this._needsRedraw=!1);this.controller.layers.forEach((e=>{if(e.renderer instanceof $p){const t=e.renderer.passes.getPass("update-particles");t&&(t.enabled=!0),e.prerender(),t&&(t.enabled=!1)}})),this.controller.context.resetState()}}_createOverlay(e){const{VECTOR:t,UNINITIALIZED:i}=google.maps.RenderingType,r=e.getRenderingType();if(r===i)return;const a=new(r===t&&google.maps.WebGLOverlayView?google.maps.WebGLOverlayView:google.maps.OverlayView);google.maps.WebGLOverlayView&&a instanceof google.maps.WebGLOverlayView?(this.options.interleaved?(a.onContextRestored=this.onContextRestored.bind(this),a.onStateUpdate=this.onStateUpdate.bind(this),a.onDraw=this._onDrawVectorInterleaved.bind(this)):(a.onContextRestored=Cg,a.onStateUpdate=this.onStateUpdate.bind(this),a.onDraw=this._onDrawVectorOverlay.bind(this)),a.onContextLost=this.onContextLost.bind(this)):a instanceof google.maps.OverlayView&&(a.draw=this._onDrawRaster.bind(this)),a.onAdd=this.onAdd.bind(this),a.onRemove=this.onRemove.bind(this),this._overlay=a,this._overlay.setMap(e);const s=new google.maps.OverlayView;s.onAdd=Cg,s.draw=Cg,s.onRemove=Cg,s.setMap(e),this._dummyOverlay=s}_prepareDrawWithTransformer(e){const t=((e,t)=>{const{width:i,height:r}=Tg(e),{center:a,heading:s,tilt:n,zoom:o}=t.getCameraParams(),l=Eg(i,r);return{size:{width:i,height:r},viewState:{altitude:.5*l.value[5],bearing:s,center:{lat:a.lat(),lon:a.lng()},pitch:n,projectionMatrix:l,repeat:!0,zoom:o}}})(this.controller.map,e);this._prepareDraw(t)}_prepareDraw(e){const t=this.controller;this._checkContext(),this._viewState=e.viewState,t.transform.update({size:t.getSize(),center:e.viewState.center,zoom:e.viewState.zoom,bounds:t.getBounds(),pitch:e.viewState.pitch,bearing:e.viewState.bearing,fov:t.getFov(),projectionMatrix:e.viewState.projectionMatrix})}_onDrawVectorInterleaved(e){let{gl:t,transformer:i}=e;if(!this.controller.map)return;const r=this._overlay;this._prepareDrawWithTransformer(i),this._redraw(t),r.requestRedraw()}_onDrawVectorOverlay(e){let{transformer:t}=e;this.controller.map&&(this._prepareDrawWithTransformer(t),this._redraw(this.controller.context.gl))}_onDrawRaster(){if(!this.controller.map)return;const e=this._overlay;if(!e.getProjection())return;const t=this.controller,i=((e,t)=>{const{width:i,height:r}=Tg(e),a=t.getProjection(),s=e.getBounds();if(!s)return{size:{width:i,height:r},position:{x:0,y:0}};const n=s.getNorthEast(),o=s.getSouthWest(),l=a.fromLatLngToDivPixel(n),h=a.fromLatLngToDivPixel(o),c=Og(a,i/2,r/2),d=new google.maps.LatLng(0,c[0]),u=a.fromLatLngToContainerPixel(d),p=a.fromLatLngToDivPixel(d);if(!(l&&h&&p&&u))return{size:{width:i,height:r},position:{x:0,y:0}};const m=Math.round(p.x-u.x);let f=p.y-u.y;const g=Og(a,i/2,0),v=Og(a,i/2,r);let y=c[1];const x=c[0];if(Math.abs(y)>Sg){y=y>0?Sg:-85.05113;const e=new google.maps.LatLng(y,x);f+=a.fromLatLngToContainerPixel(e).y-r/2}f=Math.round(f);const b=(new eh).fromArray(g).subtract((new eh).fromArray(v));let w=180*Math.atan2(b.x,b.y)/Math.PI;w<0&&(w+=360);const _=e.getHeading()||0;let M=e.getZoom(),A=1;if(0===w)A=r?Math.round(h.y-l.y)/r:1;else if(w===_){const e=new eh(l.x,l.y).subtract(new eh(h.x,h.y)).length(),t=new eh(i,-r).length();A=t?e/t:1}M+=Math.log2(A||1);const S=Eg(i,r);return{size:{width:i,height:r},position:{x:m,y:f},viewState:{altitude:1e4,bearing:w,center:{lat:y,lon:x},pitch:e.getTilt(),projectionMatrix:S,repeat:!0,zoom:M}}})(t.map,e),{position:r}=i,a=t.context.canvas.parentElement.style;a.left=`${r.x}px`,a.top=`${r.y}px`,this._prepareDraw(i),this._redraw(t.context.gl)}_checkContext(){void 0===this._viewState&&this._triggerContextEvent&&(this._triggerContextEvent=!1,this.trigger("context:ready"))}_redraw(e){const t=this.controller.context,i=this._lastContextSize,r=t.resolution;!i||i.width===r.width&&i.height===r.height||(t.invalidateSize(),this._lastContextSize={width:r.width,height:r.height}),t.bindVertexArray(null),t.state.setBlendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA),this.controller.layers.forEach((e=>{e.prerender()})),t.state.setViewport(t.resolution.width,t.resolution.height),t.state.bindFramebuffer({buffer:null}),this.options.interleaved||(e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT)),this.controller.layers.forEach(((e,t)=>{e.render()})),t.bindVertexArray(null),t.state.setBlendFunc(e.ONE,e.ZERO)}dispose(){const e=this._overlay;null==e||e.setMap(null),this._map=null,this._overlay=void 0,e instanceof google.maps.WebGLOverlayView?(e.onContextRestored=Cg,e.onStateUpdate=Cg,e.onDraw=Cg,e.onContextLost=Cg):e instanceof google.maps.OverlayView&&(e.draw=Cg)}},Pg=class extends ng{get container(){return this.map.getDiv()}get googleLayers(){return[...this._googleLayers.values()]}get renderLoop(){return this._loop}get libraryInfo(){return{name:"google",version:{current:Number.parseFloat(google.maps.version.replaceAll(/[^\d.]/g,"")),min:3.48}}}isVector(){return this.map.getRenderingType()===google.maps.RenderingType.VECTOR}constructor(e,t){t=lt({interleaved:!0},t),super(e,t),this._googleLayers=new Map,this._mapEventHandlers={},this._eventState={lastZoom:0,isIdle:!0},this._loop=new Qi(this._tick.bind(this)),this.transform.updateOnMapViewChange=!1,this.transform.tileSize=256,this.transform.worldSizeScale=this.transform.tileSize/512,this.setupEvents({load:"load",remove:"unload",resize:"resize",click:"click",dblclick:"dblclick",mousedown:"mousedown",mouseup:"mouseup",mouseover:"mouseover",mouseout:"mouseout",mousemove:"mousemove",zoomstart:"zoom:start",zoom_changed:"zoom:end",bounds_changed:"move",dragstart:"move:start",dragend:"move:end"});const i=e=>{var i;(e===r||!t.interleaved||this.libraryInfo.version.current<3.48)&&(t.interleaved=!1,this.context=new mg(void 0,{premultipliedAlpha:!0,depth:!0,antialias:!(me.safari&&me.version>=15.4),alpha:!0}),this.context.dpr=(i=this.context.gl,("undefined"==typeof window?1:window.devicePixelRatio)/(i.webkitBackingStorePixelRatio||i.mozBackingStorePixelRatio||i.msBackingStorePixelRatio||i.oBackingStorePixelRatio||i.backingStorePixelRatio||1)),this._resizeHandler=this._resize.bind(this),window.addEventListener("resize",this._resizeHandler),this._resize()),this._renderer=new Rg(this,{interleaved:t.interleaved}),this._renderer.on("context:ready",(()=>{this.initialize(),this.trigger(Dh)}))},{RASTER:r,UNINITIALIZED:a}=google.maps.RenderingType,s=e.getRenderingType();s===a?this._mapEventHandlers.renderTypeChange=e.addListener("renderingtype_changed",(()=>{i(e.getRenderingType())})):i(s)}getSize(){const e=this.map.getDiv();return pe(this.container.firstChild)?{width:window.innerWidth,height:window.innerHeight}:{width:e.offsetWidth,height:e.offsetHeight}}setSize(e){this.setContainerSize(e)}getCenter(){var e;let t=null===(e=this._renderer)||void 0===e?void 0:e.getViewCenter();if(!t){const e=this.map.getCenter();t={lat:e.lat(),lon:e.lng()}}return t}setCenter(e){this.map.setCenter({lat:e.lat,lng:e.lon})}getBounds(){var e;const t=this.map.getBounds(),i=null==t?void 0:t.getNorthEast(),r=null==t?void 0:t.getSouthWest();let a=null==r?void 0:r.lng(),s=null==i?void 0:i.lng();a>s&&(a-=360);const n=null===(e=this._renderer)||void 0===e?void 0:e.getViewBounds();return n&&(a=n.west,s=n.east),{north:null==i?void 0:i.lat(),west:a,south:null==r?void 0:r.lat(),east:s}}getZoom(){var e;let t=null===(e=this._renderer)||void 0===e?void 0:e.getViewZoom();return("number"!=typeof t||Number.isNaN(t))&&(t=this.map.getZoom()),t}setZoom(e){this.map.setZoom(e)}getBearing(){return this.map.getHeading()||0}getPitch(){return this.map.getTilt()||0}getFov(){return 25}redraw(){var e;null===(e=this._renderer)||void 0===e||e.redraw()}add(e,t){if(super.add(e,t),this._googleLayers.get(e.id))console.warn(`[MapsGL] A WebGLLayer with id {${e.id}} already exists on the map`);else{const t=new Ag(e);t.renderLoop=this._loop,t.onAdd(this.map,this.context.gl),this._googleLayers.set(e.id,t),this._loop.start()}}remove(e){super.remove(e),e.onRemove();const t=this._googleLayers.get(e.id);this.map&&t&&(t.onRemove(this.map,this.context.gl),this._googleLayers.delete(e.id)),0===this._googleLayers.size&&(this._tick(this._loop.elapsedTime),this._loop.stop())}invalidateMapSize(){this._resize()}_resize(){var e;if(!this.context)return;const t=this.getSize(),i=this.context.dpr,r=this.context.canvas;t.width===r.width/i&&t.height===r.height/i||(this.context.resize(t.width,t.height),null===(e=this._renderer)||void 0===e||e.onResize())}_tick(e){var t;super._tick(e),null===(t=this._renderer)||void 0===t||t.tick(e)}_onIdle(){this._eventState.isIdle||(this.trigger("move:end"),this.layers.forEach((e=>{e.onMove(),e.onMoveEnd()}))),this._eventState.isIdle=!0}_onMove(){this._eventState.isIdle&&(this.trigger("move:start"),this.layers.forEach((e=>e.onMoveStart()))),this.trigger("move"),this.layers.forEach((e=>e.onMove())),this._eventState.isIdle=!1}setupEvents(e){super.setupEvents(e),this._mapEventHandlers.onMove=this.map.addListener("bounds_changed",this._onMove.bind(this)),this._mapEventHandlers.onIdle=this.map.addListener("idle",this._onIdle.bind(this)),this.isVector||this.on("fullscreenchange",this._resize.bind(this))}dataForMapEvent(e,t){if(!t)return;let i,r=t.pixel;switch(!r&&t.domEvent&&(r={x:t.domEvent.screenX,y:t.domEvent.screenY}),e){case"click":case"dblclick":case"mousemove":i={target:this,originalEvent:t,coord:{lat:t.latLng.lat(),lon:t.latLng.lng()},point:r}}return i}dispose(e){this._loop.stop(),this._renderer.dispose(),Object.keys(this._mapEventHandlers).forEach((e=>{google.maps.event.removeListener(this._mapEventHandlers[e])})),window.removeEventListener("resize",this._resizeHandler),super.dispose(e)}},kg=`${i("k8fO").version}`,Dg={datasets:{},colorscales:Object.assign({},t),getColorScaleNames:()=>Object.keys(at),getColorScale:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const i=at[e];if(ye(i))throw new Error(`[MapsGL] Invalid colorscale name: ${e}`);const r=[...t,...i];return{stops:r.reduce(((e,t,i)=>(e.push(i/(r.length-1),t),e)),[]),normalized:!0}}},zg={browser:me},Ig={getWeatherSourceSpec:function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};console.warn("`getWeatherSourceSpec` is deprecated and will be removed in a future release. Use `MapController#weatherProvider.getWeatherLayerConfig` instead");const r=new Ko(t).getWeatherLayerConfig(e,i);if(!1===Array.isArray(r))return r.source},getWeatherLayerConfig:function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return console.warn("`getWeatherLayerConfig` is deprecated and will be removed in a future release. Use `MapController#weatherProvider.getWeatherLayerConfig` instead"),new Ko(t).getWeatherLayerConfig(e,i)},getWeatherLayerAlias:e=>(console.warn("`getWeatherLayerAlias` is deprecated and will be removed in a future release. Use `MapController#weatherProvider.getLayerAlias` instead"),new Ko(new Ht("null","null")).getLayerAlias(e))},Fg=Object.assign({},e)})(),r})()));